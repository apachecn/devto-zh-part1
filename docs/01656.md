# ç½‘ç»œæ‰©å±•æŒ‡å—

> åŸæ–‡:[https://dev.to/christiankaindl/a-webextension-guide-36ag](https://dev.to/christiankaindl/a-webextension-guide-36ag)

å¯¹äºé‚£äº›ä¸çŸ¥é“çš„äººæ¥è¯´ï¼ŒWebExtension æ˜¯ä¸€ä¸ªæ–°çš„é™„åŠ æ¶æ„/è§„èŒƒï¼Œç”šè‡³å¯ä»¥è·¨æµè§ˆå™¨ä½¿ç”¨(åœ¨æŸç§ç¨‹åº¦ä¸Š)ã€‚å®ƒæ˜¯ä¸€ä¸ªæµè§ˆå™¨æœ¬åœ° API æ¥å£ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥ç”¨ web æŠ€æœ¯ç¼–å†™æ‰©å±•ã€‚WebExtension API çš„æ ¸å¿ƒæ˜¯æ ‡å‡†åŒ–çš„ï¼Œä»¥ä¾¿äºå°†æ¥çš„å¼€å‘ã€‚å¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°†å†™åœ¨ Firefox çš„æ‰©å±•å¼€å‘çš„èƒŒæ™¯ä¸‹ï¼Œä½†æœ‰äº›äº‹æƒ…å¯¹äºå…¶ä»–æµè§ˆå™¨ä¹Ÿå¯èƒ½æ˜¯çœŸçš„ã€‚

* * *

# [](#getting-started)å…¥é—¨

æ‰©å±•çš„æ ¸å¿ƒå’Œèµ·ç‚¹æ˜¯å®ƒçš„**æ¸…å•**ã€‚æ¸…å•æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†å…³äºé™„åŠ ç»„ä»¶çš„å„ç§ä¿¡æ¯:åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€æƒé™ã€UI å…ƒç´ ã€å›¾æ ‡ç­‰ç­‰ã€‚

ä¸ºäº†å°½å¯èƒ½åˆ›å»ºæœ€ç®€å•çš„ web æ‰©å±•ï¼Œ`manifest.json`å¯èƒ½æ˜¯è¿™æ ·çš„:

```
 {  "manifest_version":  2,  "name":  "Super Awesome Extension ğŸ‘“",  "version":  "1"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢æ˜¾ç¤ºçš„ 3 ä¸ª JSON é”®æ˜¯æ¸…å•ä¸­å”¯ä¸€çš„å¼ºåˆ¶é”®ã€‚ä½†æ˜¯ï¼Œåœ¨æ‚¨æ·»åŠ ä¸€äº›å¥‡ç‰¹çš„åŠŸèƒ½ä¹‹å‰ï¼Œè®©æˆ‘å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨æµè§ˆå™¨ä¸­å®‰è£…ä¸€ä¸ªæœ¬åœ°æ’ä»¶:

1.  ä½¿ç”¨æ‚¨çš„åœ°å€æ è½¬åˆ°â€œå…³äº:è°ƒè¯•â€:

    [![Visiting 'about:debugging'](../Images/dcebc531c0322ad6f634584f837d226c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qWfkH_9E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2ll5kpkoaq50jdgwfcx3.gif)

2.  å•å‡»â€œåŠ è½½ä¸´æ—¶åŠ è½½é¡¹â€å¹¶ä»æœ¬åœ°åŠ è½½é¡¹ä¸­é€‰æ‹© manifest.json:

    [![Loading a temporary Add-on](../Images/e78ad0a868254b07986d5447ba785866.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---dWAk7Ye--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/h2o9ilhqol2m2mv77ui7.gif)

ä½ çš„æ‰©å±•ç°åœ¨ä¼šæ˜¾ç¤ºåœ¨ç«ç‹çš„é™„åŠ é¡µé¢ä¸Š(å³ä¸Šè§’çš„åœ°å€æ æˆ–æ±‰å ¡èœå•ä¸­çš„â€œå…³äº:é™„åŠ é¡¹â€ï¼Œç„¶åæ˜¯â€œé™„åŠ é¡¹â€)ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨äº†ï¼è¿™å°±æ˜¯è®©æ‚¨çš„é™„åŠ ç»„ä»¶æ­£å¸¸è¿è¡Œæ‰€éœ€äº†è§£çš„å…¨éƒ¨å†…å®¹ã€‚ä½ å¯ä»¥ç°åœ¨å°±å»è¯•è¯•ï¼Œæˆ‘åœ¨è¿™é‡Œç­‰ã€‚æ³¨æ„:å½“ä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯¹ä½ çš„æ’ä»¶åšä»»ä½•ä¿®æ”¹æ—¶ï¼Œä¸è¦å¿˜è®°ç‚¹å‡»`about:debugging`é¡µé¢ä¸Šçš„`Reload`æŒ‰é’®ã€‚

* * *

å¦‚æœæ‚¨æƒ³ä»æ‚¨çš„é™„åŠ ç»„ä»¶ä¸­çœ‹åˆ°æ½œåœ¨çš„é”™è¯¯å’Œ/æˆ–`log`è¯­å¥ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„è°ƒè¯•çª—å£(æ‚¨å°†éœ€è¦å®ƒ)ã€‚

è¦æ‰“å¼€å®ƒï¼Œè¯·è½¬åˆ°â€œå…³äº:è°ƒè¯•â€(å¦‚ä¸Šæ‰€ç¤º)ï¼Œå¹¶åŠ è½½æ‚¨çš„é™„åŠ ç»„ä»¶(ä¹Ÿå¦‚ä¸Šæ‰€ç¤º)ã€‚åœ¨é‚£é‡Œï¼Œé€‰ä¸­â€œå¯ç”¨åŠ è½½é¡¹è°ƒè¯•â€å¤é€‰æ¡†ï¼Œç„¶åä¸ºæ‚¨çš„åŠ è½½é¡¹å•å‡»â€œè°ƒè¯•â€:

[![Opening the debug window](../Images/3f972a7b7c783be687e6d99d079d4ff4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--GpHQzIS0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/3redngq619nhg1852lgs.gif)

*è¿‘*æ‰€æœ‰çš„è°ƒè¯•ä¿¡æ¯éƒ½ä¼šæ˜¾ç¤ºåœ¨è¿™ä¸ªçª—å£ä¸­ï¼Œæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ä¸ºä»€ä¹ˆåªæœ‰*è¿‘*ã€‚

**é“¾æ¥:**
> [Web-ext å·¥å…·](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Getting_started_with_web-ext)
> [åœ¨ MDN ä¸Šè°ƒè¯•](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Debugging)

* * *

# [](#javascript)JavaScriptï¼

å¯¹äº WebExtensionsï¼Œæ‰€æœ‰ API éƒ½å­˜åœ¨äº`browser`åç§°ç©ºé—´ä¸­ã€‚è¿™æ„å‘³ç€æ‚¨çš„è„šæœ¬å¯ä»¥è®¿é—®åä¸º`browser`çš„ JavaScript å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«æ‰€æœ‰é»˜è®¤ API å’Œæ‚¨é€šè¿‡æ¸…å•æˆäºˆæƒé™çš„æ‰€æœ‰ API çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä»ä½ çš„è„šæœ¬ä¸­æ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œä½ å¯ä»¥å†™`browser.tabs.create({});`

***æ³¨æ„:** Google Chrome ä¸ºå…¶ API ä½¿ç”¨äº†éæ ‡å‡†çš„`chrome`å‘½åç©ºé—´ã€‚`browser`ä½¿ç”¨ JavaScript æ‰¿è¯ºä½œä¸ºå¼‚æ­¥ API çš„è¿”å›å€¼ï¼Œ`chrome`ä½¿ç”¨å›è°ƒã€‚å¯¹äºè·¨æµè§ˆå™¨æ‰©å±•ï¼Œæœ‰ä¸€ä¸ªå¯ä»¥åœ¨ Google Chrome ä¸­ä½¿ç”¨çš„`browser`åç§°ç©ºé—´çš„ polyfillã€‚ç«ç‹åŒæ—¶æ”¯æŒ`browser`å’Œ`chrome`ï¼Œä½¿å¾—ä»è°·æ­Œ Chrome ç§»æ¤æ‰©å±•æ›´åŠ å®¹æ˜“ã€‚å¦‚æœä½ å¼€å‘äº†ä¸€ä¸ªæ–°çš„è·¨æµè§ˆå™¨å…¼å®¹çš„æ‰©å±•ï¼Œä½¿ç”¨å¸¦æœ‰ polyfill for Google Chrome çš„åç§°ç©ºé—´`browser`ã€‚*

åœ¨ WebExtension ä¸–ç•Œä¸­æœ‰ä¸‰ç§ç±»å‹çš„è„šæœ¬:

1.  åå°è„šæœ¬æ˜¯ä½ çš„æ‰©å±•å¯ä»¥è¿è¡Œçš„æœ€é«˜çº§åˆ«çš„è„šæœ¬ã€‚å®ƒå¯ä»¥è®¿é—®æ‰€æœ‰é»˜è®¤ API å’Œæ‚¨é€šè¿‡æ¸…å•æˆäºˆçš„æ‰€æœ‰ API(è¿™ç§è„šæœ¬ç§°ä¸ºâ€œç‰¹æƒè„šæœ¬â€)ã€‚åå°è„šæœ¬ç‹¬ç«‹äºä»»ä½•æ ‡ç­¾è¿è¡Œ**(äº‹å®ä¸Šï¼Œåœ¨æ–°çš„ Firefox ä¸­ï¼Œå®ƒä»¬ç”šè‡³æœ‰è‡ªå·±çš„å†…å®¹è¿›ç¨‹)ï¼Œè¿™æ„å‘³ç€å®ƒåœ¨æµè§ˆå™¨å¯åŠ¨(æˆ–é™„åŠ å®‰è£…)æ—¶å¼€å§‹å®ƒçš„ç”Ÿå‘½ï¼Œåœ¨ä½ å…³é—­æµè§ˆå™¨(æˆ–å¸è½½é™„åŠ )æ—¶ç»“æŸå®ƒçš„ç”Ÿå‘½ã€‚åå°è„šæœ¬ä¹Ÿè·¨å¤šä¸ªæµè§ˆå™¨å®ä¾‹è¿è¡Œ(ä¾‹å¦‚ï¼Œæ‚¨åŒæ—¶æ‰“å¼€äº†å¤šä¸ª Firefox çª—å£)ã€‚å› æ­¤ï¼Œåå°è„šæœ¬æ˜¯æ‚¨çš„é¦–é€‰ 1)ç¹é‡çš„å·¥ä½œ(æœ‰ä¸€ä¸ª API æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦ç©ºé—²ï¼Œè¿™å¯èƒ½æ˜¯ç¹é‡ä»»åŠ¡çš„å¥½æ—¶æœºï¼*(æ‹œæ‰˜ï¼Œä¸è¦åšåŠ å¯†é‡‡çŸ¿ã€‚Upsã€‚)*)ã€2)ç¡®ä¿ç‹¬ç«‹äºç½‘ç«™å·¥ä½œçš„ç‰¹æ€§ï¼Œä»¥åŠ 3)ä½¿ç”¨ç‰¹æƒ APIã€‚æ‚¨è¿˜å¯ä»¥ä»åå°è„šæœ¬æ³¨å†Œç½‘ç«™è®¿é—®ç­‰äº‹ä»¶ï¼Œç„¶åä»¥ç¼–ç¨‹æ–¹å¼æ’å…¥è„šæœ¬ã€‚**

2.  **å†…å®¹è„šæœ¬**æˆ–è€…ä»¥ç¼–ç¨‹æ–¹å¼(ä¾‹å¦‚é€šè¿‡åå°è„šæœ¬)æ’å…¥ï¼Œæˆ–è€…è‡ªåŠ¨(ä½¿ç”¨`content_scripts`æ¸…å•å¯†é’¥)æ’å…¥ç½‘ç«™ã€‚ä¸€æ—¦è¿›å…¥ï¼Œä»–ä»¬å¯ä»¥ç›´æ¥ä¸ç«™ç‚¹çš„ DOM äº¤äº’ã€‚å†…å®¹è„šæœ¬ä¸æ˜¯ç‰¹æƒè„šæœ¬ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åªèƒ½æœ‰é™åœ°è®¿é—® WebExtension APIsã€‚æ³¨æ„:å¦‚æœæ‚¨ä¸ç¡®å®šæ‚¨çš„é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Œæ‚¨å¯ä»¥åœ¨è¿™ç¯‡ MDN æ–‡ç« ä¸­æ‰¾åˆ°æ‰€æœ‰å¯ç”¨äºå†…å®¹è„šæœ¬[çš„ APIï¼Œæˆ–è€…æ‚¨å¯ä»¥å§‹ç»ˆä½¿ç”¨ä¸€ä¸ª`console.info(browser);`è¯­å¥å¹¶åœ¨æ§åˆ¶å°ä¸­æ£€æŸ¥å…¶é™„åŠ æ–¹æ³•ã€‚](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Content_scripts#WebExtension_APIs)

3.  æ¥è‡ª WebExtension UIs çš„è„šæœ¬ã€‚è¿™äº›åŒ…æ‹¬ä¾§è¾¹æ ä¸­çš„é¡µé¢ã€é¡µé¢å’Œæµè§ˆå™¨æ“ä½œå¼¹å‡ºçª—å£ä»¥åŠå¼€å‘äººå‘˜å·¥å…·ã€‚å®ƒä»¬ä¸å†…å®¹è„šæœ¬æœ‰ä¸€ä¸ªç›¸ä¼¼ä¹‹å¤„ï¼Œå³ä¸€æ—¦å¼¹å‡ºçª—å£/é¢æ¿/ä¾§è¾¹æ å…³é—­ï¼Œå®ƒä»¬å°±ä¼šè¢«ç»ˆæ­¢ã€‚å®ƒä»¬çš„è°ƒè¯•ä¿¡æ¯ä¸åå°è„šæœ¬ä¸€èµ·æ˜¾ç¤ºåœ¨è°ƒè¯•çª—å£ä¸­ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ç‰¹æƒè„šæœ¬ã€‚äº‹å®ä¸Šï¼Œåœ¨å¼¹å‡ºçª—å£ä¸­æ‰§è¡Œçš„è„šæœ¬åªæœ‰åœ¨å¼¹å‡ºçª—å£æ‰“å¼€æ—¶æ‰æœ‰æ•ˆï¼Œè¿™æ˜¯ä¸€ä¸ªé™åˆ¶å› ç´ ã€‚å› æ­¤ï¼Œæ ¹æ®æ‚¨çš„ç”¨ä¾‹ï¼Œå¾ˆå¯èƒ½æ‚¨è¿˜éœ€è¦ä¸€ä¸ªèƒŒæ™¯è„šæœ¬é¡µé¢ã€‚

*ä½¿ç”¨`browser.extension.getViews()`å¯ä»¥è®¿é—®å…¶ä»–ç‰¹æƒè„šæœ¬çš„èŒƒå›´ï¼Œæˆ–è€…ä½¿ç”¨`browser.extension.getBackgroundPage()`* åªèƒ½è®¿é—®åå°è„šæœ¬çš„èŒƒå›´

**é“¾æ¥:**
>[`browser``chrome`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API)
>[å‰–æä¸€ä¸ªæ‰©å±•æ¦‚è¿°](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Anatomy_of_a_WebExtension)(åå°è„šæœ¬ã€å†…å®¹è„šæœ¬ã€ä¾§è¾¹æ ã€å¼¹å‡ºçª—å£ã€é€‰é¡¹é¡µ)
> [æ›´å¤šå…³äºå†…å®¹è„šæœ¬](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Content_scripts)

* * *

æ‚¨å¯ä»¥ä½¿ç”¨çš„ API æ•°é‡å—åˆ°ä»¥ä¸‹å› ç´ çš„é™åˆ¶:1)æ‚¨é€šè¿‡æ¸…å•æˆäºˆçš„æƒé™ï¼›2)æ‰€è®¨è®ºçš„è„šæœ¬æ˜¯ç‰¹æƒè„šæœ¬(åå°è„šæœ¬ã€ä¾§æ ã€å¼¹å‡ºçª—å£)è¿˜æ˜¯å†…å®¹è„šæœ¬ã€‚

å†…å®¹è„šæœ¬åªèƒ½ä½¿ç”¨æŸäº› web æ‰©å±• APIï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è®¿é—®å®ƒä»¬è¢«æ³¨å…¥çš„é¡µé¢çš„ DOMã€‚

ç‰¹æƒè„šæœ¬å¯ä»¥è®¿é—®æ‰€æœ‰ WebExtension APIs(é™¤äº†é‚£äº›éœ€è¦æƒé™çš„ APIï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰å½“æ‚¨æŒ‡å®šäº†ç›¸åº”çš„æ¸…å•é”®æ—¶)ã€‚å¦‚æœç‰¹æƒè„šæœ¬å¸¦æœ‰ HTML é¡µé¢(ä¾§è¾¹æ ã€å¼¹å‡ºçª—å£)ï¼Œå®ƒä»¬å¯ä»¥è®¿é—®è‡ªå·±çš„ DOMã€‚åå°è„šæœ¬ä¹Ÿå¯ä»¥è®¿é—®è‡ªå·±çš„ DOMï¼Œä½†æ˜¯ä¸ä¼šåœ¨ä»»ä½•åœ°æ–¹å‘ˆç°ã€‚

è¦è·å¾—é™¤é»˜è®¤æƒé™ä¹‹å¤–çš„æƒé™ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬åŒ…å«åœ¨æ¸…å•ä¸­ï¼Œç„¶ååœ¨ç”¨æˆ·å®‰è£…é™„åŠ ç»„ä»¶æ—¶å‘ä»–ä»¬æ˜¾ç¤ºã€‚

[![Permissions popup on install](../Images/6a79b5bfb2f44bd07e8f6febe09d95eb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--kk2p9Bev--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9qmvyajg81twgaivo3za.png)

æ·»åŠ äº†æƒé™ã€å›¾æ ‡å’Œæè¿°åï¼Œæ‚¨çš„æ¸…å•å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

```
 {  "manifest_version":  2,  "name":  "Super Awesome Extension ğŸ‘“",  "version":  "1",  "description":  "Super awesome Add-on for super awesome people.",  "icons":  {  "16":  "assets/logos/logo_small.svg",  "32":  "assets/logos/logo_small.svg",  "48":  "assets/logos/logo_small.svg",  "64":  "assets/logos/logo.svg",  "128":  "assets/logos/logo.svg"  },  "permissions":  [  "tabs",  "storage",  "https://awesome.com/*/",  "notifications",  "downloads"  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

# [](#uis)ç”¨æˆ·ç•Œé¢

ä½ çš„æ’ä»¶å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•ç”¨æˆ·ç•Œé¢å…ƒç´ çš„æƒ…å†µä¸‹å®Œå…¨è¿è¡Œ(ä¾‹å¦‚ï¼Œåªæœ‰ä¸€ä¸ªåå°è„šæœ¬),ä½†æ˜¯ä½ å¾ˆå¯èƒ½éœ€è¦ä¸€äº›ã€‚å¹¸è¿çš„æ˜¯ï¼Œæµè§ˆå™¨å¸®åŠ©æˆ‘ä»¬åšåˆ°äº†è¿™ä¸€ç‚¹ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥åœ¨åŠ è½½é¡¹ä¸­ä½¿ç”¨çš„ UI å…ƒç´ åˆ—è¡¨:

*   **æµè§ˆå™¨åŠ¨ä½œ**ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜¾ç¤ºåœ¨å·¥å…·æ ä¸­çš„å›¾æ ‡ï¼Œå°±åœ¨å…¶ä»–å·¥å…·æ å›¾æ ‡çš„æ—è¾¹ã€‚å½“å›¾æ ‡è¢«ç‚¹å‡»æ—¶ï¼Œæ‚¨çš„åå°è„šæœ¬ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`browser.browserAction.onClicked.addListener()`è®¢é˜…è¯¥äº‹ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å½“å›¾æ ‡è¢«ç‚¹å‡»æ—¶æ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºçª—å£ã€‚

*   **é¡µé¢åŠ¨ä½œ**ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜¾ç¤ºåœ¨*åœ°å€æ *ä¸­çš„å›¾æ ‡ã€‚ä¸æµè§ˆå™¨æ“ä½œä¸åŒçš„æ˜¯ï¼Œå®ƒåªåœ¨æŸäº›ç½‘ç«™ä¸Šæ˜¾ç¤º(æ‚¨å¯ä»¥å®šä¹‰)ã€‚å½“å›¾æ ‡è¢«ç‚¹å‡»æ—¶ï¼Œæ‚¨çš„åå°è„šæœ¬ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`browser.pageAction.onClicked.addListener()`è®¢é˜…è¯¥äº‹ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å½“å›¾æ ‡è¢«ç‚¹å‡»æ—¶æ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºçª—å£ã€‚

*   **ä¾§æ **ã€‚è¿™å°†æ·»åŠ ä¸€ä¸ªä¾§è¾¹æ (é»˜è®¤åœ¨å·¦è¾¹)å¹¶æ˜¾ç¤ºä¸€ä¸ªæ™®é€šçš„ HTML é¡µé¢(å°±åƒä½ åœ¨æ™®é€šç½‘ç«™ä¸Šåšçš„ä¸€æ ·)ã€‚åœ¨ Firefox çš„æƒ…å†µä¸‹ï¼Œthrere æ˜¯ä¸€ä¸ªå…¨å±€ä¾§è¾¹æ ï¼Œå®ƒæœ‰ä¸€ä¸ªç”¨äºåœ¨ä¾§è¾¹æ ä¹‹é—´åˆ‡æ¢çš„ä¸‹æ‹‰èœå•ã€‚å¦‚æœä½ ä½¿ç”¨è¿™ä¸ª UI å…ƒç´ ï¼Œä½ çš„ä¾§è¾¹æ ä¼šè¢«æ·»åŠ åˆ°ä¸‹æ‹‰åˆ—è¡¨ä¸­ã€‚

*   **å¼€å‘å·¥å…·**é¢æ¿ã€‚æ˜¯çš„ï¼Œå¦‚æœä½ æƒ³å¢å¼ºç«ç‹çš„å¼€å‘è€…å·¥å…·ï¼Œä½ å¯ä»¥ã€‚

*   **å†…å®¹è„šæœ¬**ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªç›´æ¥çš„ç”¨æˆ·ç•Œé¢ç»„ä»¶ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ç§ä¸ç”¨æˆ·äº¤äº’çš„æ–¹å¼ã€‚æ­£å¦‚ä¸‹é¢è¿›ä¸€æ­¥è§£é‡Šçš„ï¼Œå†…å®¹è„šæœ¬è¢«æ³¨å…¥åˆ°ç½‘ç«™ä¸­ï¼Œå¯ä»¥ç›´æ¥ä¸ç½‘ç«™çš„ DOM äº¤äº’ã€‚

*   **é€šçŸ¥**ã€‚åšå®ƒæ‰€è¯´çš„ã€‚

*   **åœ°å€æ **å»ºè®®ã€‚è¿™è®©ä½ å¯ä»¥ç›‘å¬åœ°å€æ ä¸­çš„è¾“å…¥ï¼Œç„¶åå»ºè®®é“¾æ¥æˆ–åŠ¨ä½œã€‚ç›¸å½“é…·ã€‚

æµè§ˆå™¨åŠ¨ä½œã€é¡µé¢åŠ¨ä½œã€å†…å®¹è„šæœ¬(å¯é€‰)ã€ä¾§æ å’Œå¼€å‘å·¥å…·åœ¨æ¸…å•ä¸­å®šä¹‰ï¼Œç„¶åå¯ä»¥ä¸æ‰©å±•çš„(åå°)è„šæœ¬äº¤äº’ã€‚

## [](#debugging-popups)è°ƒè¯•å¼¹å‡ºçª—å£

å¦‚æœä½ ä½¿ç”¨å¼¹å‡ºçª—å£ï¼Œä½ å¾ˆå¿«å°±ä¼šæƒ³å¦‚ä½•è°ƒè¯•å®ƒï¼Œå› ä¸ºå½“å®ƒå¤±å»ç„¦ç‚¹æ—¶ä¼šè‡ªåŠ¨å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‚¨å¸Œæœ›åœ¨å¼¹å‡ºçª—å£æ‰“å¼€çš„æƒ…å†µä¸‹åˆ‡æ¢åˆ°è°ƒè¯•çª—å£æ—¶ï¼Œå®ƒä¸ä¼šå¦‚æ‚¨æ‰€æ„¿åœ°å·¥ä½œã€‚ä¸ºäº†å…‹æœè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¼¹å‡ºçª—å£â€œé”å®šâ€åˆ°å®ƒä»¬æ‰€åœ¨çš„ä½ç½®:

1.  åœ¨å…ˆå‰æ‰“å¼€çš„è°ƒè¯•çª—å£ä¸­ï¼Œå•å‡»â€œç¦ç”¨å¼¹å‡ºçª—å£è‡ªåŠ¨éšè—â€æŒ‰é’®ã€‚è¿™ç¡®ä¿äº†å¼¹å‡ºçª—å£æ€»æ˜¯åœ¨é¡¶éƒ¨(è€Œä¸æ˜¯åƒé€šå¸¸é‚£æ ·è‡ªå·±å…³é—­)ã€‚*æ³¨æ„ï¼Œå³ä½¿ä½ åˆ‡æ¢åˆ°ä¸€ä¸ªä¸åŒçš„åº”ç”¨ç¨‹åº*ï¼Œå®ƒå®é™…ä¸Šæ€»æ˜¯åœç•™åœ¨é¡¶éƒ¨ã€‚**å®Œæˆåä¸è¦å¿˜è®°å†æ¬¡ç¦ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œ(å®ƒç”šè‡³ä¼šåœ¨é‡å¯åä¿å­˜)ï¼Œå¦åˆ™ä½ ä¼šä»¥[å¾ˆå¤šå¼¹å‡ºçª—å£](https://thepracticaldev.s3.amazonaws.com/i/kdx4eocf670zfiwbmmrs.png)** ç»“æŸã€‚

    [![Enabling 'Disable popup auto hide'](../Images/46955bb29675638ea53c38dcca08f99a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1MNm8WfU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zaiz6asbtkbdq3v3z8sm.gif)

2.  åœ¨å‰é¢å·¦è¾¹çš„æŒ‰é’®ä¸Šï¼Œé€‰æ‹©æ‚¨çš„å¼¹å‡ºç›®æ ‡:
    *(æŒ‰é’®æ˜¾ç¤ºâ€˜é€‰æ‹©ä¸€ä¸ª iframe ä½œä¸ºå½“å‰ç›®æ ‡æ–‡æ¡£â€™)*

    [![Selecting your popup HTML from the 'Select an iframe as the currently targeted document' dropdown](../Images/6dd26d22f7c4a43edf68f754b2127ed6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--V1II7-MC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qa223klvg62p8hzt2sl5.gif)

æ‚¨ç°åœ¨å¯ä»¥è½»æ¾åœ°æ£€æŸ¥å¼¹å‡ºçª—å£ã€‚

* * *

è®©æˆ‘ä»¬å‘æ¸…å•ä¸­æ·»åŠ ä¸€ä¸ªç¤ºä¾‹é¡µé¢åŠ¨ä½œ:

```
 {  "manifest_version":  2,  "name":  "Super Awesome Extension ğŸ‘“",  "version":  "1",  "description":  "Super awesome Add-on for super awesome people.",  "icons":  {  "16":  "assets/logos/logo_small.svg",  "32":  "assets/logos/logo_small.svg",  "48":  "assets/logos/logo_small.svg",  "64":  "assets/logos/logo.svg",  "128":  "assets/logos/logo.svg"  },  "permissions":  [  "tabs",  "storage",  "https://awesome.com/*/",  "notifications",  "downloads"  ],  "page_action":  {  "browser_style":  true,  "default_icon":  {  "16":  "/assets/page-action/page-action-16.svg",  "19":  "/assets/page-action/page-action-19.svg",  "32":  "/assets/page-action/page-action-32.svg",  "38":  "/assets/page-action/page-action-38.svg"  },  "default_title":  "Awesome Page Action!",  "default_popup":  "/page-action/index.html"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**é“¾æ¥:**
> [UI æœ€ä½³å®è·µ](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/User_experience_best_practices)
> UI å…ƒç´ :

*   [æµè§ˆå™¨åŠ¨ä½œ](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/browser_action)
*   [é¡µé¢åŠ¨ä½œ](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/page_action)
*   [ä¾§è¾¹æ ](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/sidebar_action)
*   [å¼€å‘å·¥å…·](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/devtools_page)
*   [å†…å®¹è„šæœ¬](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/content_scripts)
*   [é€šçŸ¥](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/notifications)
*   [åœ°å€æ å»ºè®®](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/user_interface/Omnibox)

* * *

å†…å®¹è„šæœ¬åªèƒ½è®¿é—®æœ‰é™çš„ APIï¼Œä½†æ˜¯æœ‰æ—¶æ‚¨éœ€è¦åªæœ‰ç‰¹æƒè„šæœ¬æ‰èƒ½ä»å†…å®¹è„šæœ¬ä¸­æä¾›çš„åŠŸèƒ½ã€‚è¿™å°±æ˜¯æ¶ˆæ¯ä¼ é€’ API çš„ç”¨æ­¦ä¹‹åœ°ã€‚æ¶ˆæ¯ä¼ é€’ API æ˜¯ä¸€ç§ä¸è„šæœ¬é€šä¿¡çš„ç®€å•æ–¹å¼ã€‚ä¸ç®¡æ˜¯åå°è„šæœ¬ã€å†…å®¹è„šæœ¬ã€å¼¹å‡ºçª—å£è¿˜æ˜¯ä¾§è¾¹æ ã€‚

è¦å¼€å§‹ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ API:

```
 // Sends a message to all privileged scripts (can be used by Content Scripts, but can't be used to send to Content Scripts)
browser.runtime.sendMessage(optionalID, messageData); 

// Sends a message to a Content Script (from a privileged script)
browser.tabs.sendMessage(tabId, optionalObject); 

// Receive messages sent via methods above
browser.runtime.onMessage(function); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*æ³¨æ„:ä½ ä¸èƒ½åœ¨åå°è„šæœ¬ä¹‹é—´é€šä¿¡ï¼Œå› ä¸ºå®ƒä»¬å…±äº«ç›¸åŒçš„ä½œç”¨åŸŸ(å°±åƒä¸€ä¸ªç½‘ç«™)ã€‚æ‚¨å¯ä»¥åŒ…å«å¤šä¸ªï¼Œä½†å®ƒä»¬éƒ½åœ¨åŒä¸€ä¸ªèƒŒæ™¯ç¯å¢ƒä¸­æ‰§è¡Œ*

å¦‚æœæˆ‘åœ¨ä¸€ä¸ªå†…å®¹è„šæœ¬ä¸­ä½¿ç”¨`runtime.sendMessage()`ï¼Œé‚£ä¹ˆæ‰€æœ‰ç‰¹æƒè„šæœ¬(æ¯”å¦‚åå°è„šæœ¬)éƒ½ä¼šæ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘å¿…é¡»ä¸ºä¸¤ä¸ªä¸åŒçš„ä»»åŠ¡å‘é€ä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“å“ªä¸ªæ˜¯å“ªä¸ªå‘¢ï¼Ÿ

ä½ ä¹Ÿå¯ä»¥åœ¨ä¿¡æ¯ä¸­å‘é€å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘æ˜¯è¿™æ ·è§£å†³è¿™ä¸ªé—®é¢˜çš„:

```
/* EXAMPLE */

/* contentScript.js */

// Send a message. In this case, we send an object
browser.runtime.sendMessage({
type: "notification", // Include a 'type' property so the receiving scripts know what to do
data: { url: "example.com", numbers: [1, 2, 3, 4, 5] } // Some data you want to send
});

// ==================

/* background.js */

// Listen for messages
browser.runtime.onMessage(handleMessage);

// Handle received messages
function handleMessage( message ) {
  console.log( message.type )           // "notification"
  console.log( message.data.url )       // "example.com"
  console.log( message.data.numbers )   // Array[1, 2, 3, 4, 5]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡å‘é€ä¸€ä¸ªå¯¹è±¡å¹¶èµ‹äºˆå®ƒä¸€ä¸ª`type`å±æ€§ï¼Œæˆ‘å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†é€šçŸ¥ä¸è„šæœ¬å¯èƒ½å¾—åˆ°çš„å…¶ä»–æ¶ˆæ¯åŒºåˆ†å¼€æ¥ã€‚*(ä½¿ç”¨`type`å’Œ`data`åªæ˜¯è™šæ„çš„å±æ€§ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ä»»ä½•ä¸œè¥¿æ¥ä»£æ›¿)*

å¯¹äºæ›´é«˜çº§çš„é€šä¿¡éœ€æ±‚ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨`runtime.connect()`å’Œ`tabs.connect()`æ¥å»ºç«‹ä¸€ä¸ªé•¿æœŸçš„é€šä¿¡æ¸ é“ï¼Œæ‚¨å¯ä»¥éšæ—¶çŸ¥é“æ˜¯è°å‘é€äº†æ¶ˆæ¯ã€‚

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å°†è¿”å›å€¼å‘é€å›å‘é€æ–¹:

```
/* EXAMPLE */

/* contentScript.js */

// Send a message. Assuming async function context, otherwise we would get a promise back
var returnValue = await browser.runtime.sendMessage({
type: "notification",
data: { url: "example.com", numbers: [1, 2, 3, 4, 5] }
});

// ==================

/* background.js */

// Listen for messages
browser.runtime.onMessage(handleMessage);

// Handle received messages
function handleMessage( message ) {
  // Do something with received message...

  // Return a "response" and fulfill the promise for the message sender
  return 42;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**é“¾æ¥:**
> [JavaScript API æ¦‚è¿°](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API)
>[runtime . sendmessage()](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/runtime/sendMessage)
>[runtime . on message()](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/runtime/onMessage)
[tabs . sendmessage()](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/tabs/sendMessage)

* * *

# [](#publishing)å‡ºç‰ˆ

ä¸ºäº†è®©ä½ èƒ½å¤Ÿæ°¸ä¹…åœ°å®‰è£…ç«ç‹æ‰©å±•ï¼Œä½ å¿…é¡»å…ˆç­¾åã€‚è¿™å¯ä»¥åœ¨ Mozilla çš„é™„åŠ ç½‘ç«™ä¸Šå®Œæˆã€‚è¦è®©äººä»¬ä½¿ç”¨ä½ çš„æ’ä»¶(ä¹Ÿå°±æ˜¯å‘å¸ƒå®ƒ),ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©:

1.  ä¸Šä¼ åˆ° Mozilla çš„é™„åŠ ç½‘ç«™ã€‚è¿™å¤§æ¦‚æ˜¯å¤§å¤šæ•°äººçš„é€‰æ‹©ã€‚ä½ çš„æ‰©å±•å¾—åˆ°å®¡æŸ¥ï¼Œç„¶ååœ¨ç½‘ç«™ä¸Šåˆ—å‡ºå’Œæœç´¢ï¼Œä½ ä¹Ÿå¯ä»¥å¾—åˆ°æ–¹ä¾¿çš„ä½¿ç”¨ç»Ÿè®¡ã€‚

2.  **è‡ªå·±å‘**ã€‚åœ¨ addons.mozilla.org(AMO)ï¼Œä½ å¯ä»¥é€‰æ‹©åªç­¾ç½²ä½ çš„æ‰©å±•ï¼Œè€Œä¸æ˜¯æŠŠå®ƒåˆ—åœ¨ç½‘ç«™ä¸Šã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è‡ªå·±åˆ†å‘å·²ç­¾åçš„é™„åŠ ç»„ä»¶(ä¾‹å¦‚ï¼Œä»æ‚¨çš„ç½‘ç«™)ã€‚ä¸ºäº†æä¾›å¯¹æ‰©å±•çš„æ›´æ–°ï¼Œæ‚¨å¿…é¡»æä¾›ä¸€ä¸ª`update_url`æ¸…å•å¯†é’¥ã€‚

### [](#notes-about-amo)å…³äº AMO çš„ç¬”è®°

AMO åªåœ¨ç¬¬ä¸€æ¬¡æäº¤ æ—¶ä½¿ç”¨ *[è´§å•ä¸Šçš„å›¾æ ‡ä½œä¸ºä»–ä»¬çš„é™„åŠ é¡µé¢ã€‚è¿™æ„å‘³ç€å¦‚æœä½ æƒ³æ”¹å˜ä½ çš„å›¾æ ‡æ˜¾ç¤ºåœ¨ AMO ä¹‹åï¼Œä½ åªèƒ½é€šè¿‡ä»–ä»¬çš„ç½‘ç»œç•Œé¢æ¥æ”¹å˜å®ƒã€‚å¦‚æœä½ ç¬¬ä¸€æ¬¡ä¸Šä¼ æ²¡æœ‰å›¾æ ‡çš„æ’ä»¶ï¼Œç„¶åé€šè¿‡æ›´æ–°æ·»åŠ å®ƒä»¬ï¼Œä½ ä¹Ÿå¿…é¡»é€šè¿‡ AMO æ‰‹åŠ¨æ·»åŠ å®ƒä»¬(æˆ‘çœŸçš„å¸Œæœ›è¿™åœ¨æœªæ¥çš„æŸä¸ªæ—¶å€™æ”¹å˜ã€‚*è¿™åªé€‚ç”¨äº AMO ç½‘ç«™çš„å›¾æ ‡ï¼Œä¸é€‚ç”¨äºç«ç‹çš„æ’ä»¶ç®¡ç†å™¨æˆ–å…¶ä»–åœ°æ–¹*ã€‚](https://discourse.mozilla.org/t/manifest-specified-icons-on-amo/17443)*

æ­¤å¤–ï¼Œæˆ‘å»ºè®®ä½ æœ‰ä¸€ä¸ªå……å®çš„â€œæ›´å¤šä¿¡æ¯â€é¢æ¿ã€‚è¿™ç¡®å®æœ‰åŠ©äºäººä»¬äº†è§£ä½ çš„é™„åŠ äº§å“ï¼Œå¹¶ç»™è®¿é—®è€…ç•™ä¸‹è‰¯å¥½çš„å°è±¡ã€‚æä¾›ä¸€ä¸ªç½‘ç«™(å¦‚æœä½ çš„æ’ä»¶æ˜¯å¼€æºçš„ï¼Œç•™ä¸‹ä¸€ä¸ªåˆ°åº“çš„é“¾æ¥(ä¾‹å¦‚ GitHub))ï¼Œæ”¯æŒç”µå­é‚®ä»¶ï¼Œæ”¯æŒç½‘ç«™(ä¾‹å¦‚ bug è¿½è¸ªå™¨ï¼Œè®ºå›ï¼Œæˆ–è€… GitHub ä¸Šçš„â€œé—®é¢˜â€é¡µé¢)ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥æ·»åŠ è®¸å¯è¯(MITã€GPL ç­‰ã€‚)å’Œéšç§æ”¿ç­–(å¦‚æœæ‚¨çš„é™„åŠ ç»„ä»¶å˜å¾—æ›´å¤§ï¼Œæ‚¨å°†éœ€è¦è¿™ä¸€ç‚¹)ã€‚æ‰€æœ‰è¿™äº›æåˆ°çš„ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡ AMO ç½‘ç»œç•Œé¢æ·»åŠ ã€‚

[![More Information panel](../Images/c48a3251c75da258256176196a91779c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7UvoADX7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/pqb43gyfb5ru08ab6duq.png)

æœ€åä¸€ç‚¹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ AMO ä¸Šè·å¾—é™„åŠ è½¯ä»¶çš„æµ‹è¯•ç‰ˆã€‚

> "ç‰ˆæœ¬ä»¥|alpha|b|beta|pre|rc ç»“å°¾å¹¶å¸¦æœ‰å¯é€‰æ•°å­—çš„æ–‡ä»¶è¢«æ£€æµ‹ä¸º betaã€‚"

å› æ­¤ï¼Œå¦‚æœæ‚¨çš„æ¸…å•çš„`version`æ˜¯â€œ1.2â€ï¼Œå¹¶ä¸”æ˜¯é¢„å‘å¸ƒç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥æ·»åŠ æåˆ°çš„å­—æ¯ä¹‹ä¸€ï¼Œä¾‹å¦‚â€œ1.2aâ€ã€‚ä¸Šä¼ æ—¶ï¼ŒAMO ä¼šå‘æ‚¨æ˜¾ç¤ºæ­¤é€‰é¡¹:

[![Upload a beta release](../Images/a1fc7f57304ad189b01b36290b082692.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jVZStFnH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/m0anfr27myzxgf3xzdsk.png)

**é“¾æ¥:**
> [æ›´å¤šå‘å¸ƒä¿¡æ¯](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Publishing_your_WebExtension)
> [Mozilla çš„é™„åŠ ç½‘ç«™(AMO)](https://addons.mozilla.org/en-US/firefox/)

### [](#notes-on-self-distributing)å…³äºè‡ªæˆ‘åˆ†é…çš„è¯´æ˜

å½“æ‚¨é€‰æ‹©è‡ªåˆ†å‘è·¯çº¿æ—¶ï¼Œæ‚¨å¾ˆå¯èƒ½éœ€è¦ä¸€ä¸ª`update_url`å¯†é’¥ã€‚è¿™æ˜¯é€šè¿‡`applications`é”®ä¸­çš„`gecko`é”®å®Œæˆçš„ï¼Œå¦‚ä¸‹å›¾:

```
{  "applications":  {  "gecko":  {  "update_url":  "https://example.com/updates.json"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŒ‡å®šçš„ URL æ˜¯æ›´æ–°æ¸…å•ã€‚è¿™æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œä¸“é—¨ç”¨æ¥å‘Šè¯‰æµè§ˆå™¨æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ä»€ä¹ˆä»¥åŠåœ¨å“ªé‡Œå¯ä»¥è·å¾—å®ƒã€‚

**é“¾æ¥:**
> [æ›´å¤šå…³äºè‡ªå‘å¸ƒ](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Alternative_distribution_options)
>[â€˜åº”ç”¨â€™æ¸…å•é”®](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/applications)
> [æ›´æ–°æ¸…å•](https://developer.mozilla.org/en-US/Add-ons/Updates)

* * *

# [](#more-stuff)æ›´å¤šçš„ä¸œè¥¿

**å›½é™…åŒ–(i18n)**
æ ¹æ®æ‚¨çš„é™„åŠ ç»„ä»¶çš„èŒƒå›´ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†å…¶ç¿»è¯‘æˆå…¶ä»–è¯­è¨€ï¼Œä»¥ä¾¿æ›´å¤šçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»–ä»¬çš„æ¯è¯­ã€‚è¿™å¯ä»¥é€šè¿‡ WebExtensions å®ç°ã€‚å»ºè®®ä½ çœ‹[æœ¬æŒ‡å—](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Internationalization)å…¥é—¨ï¼Œä½†æ˜¯ TLï¼›åšå£«æ˜¯è¿™æ ·çš„:

1.  æ‰€æœ‰çš„è¯­è¨€ç¯å¢ƒéƒ½ä½äºæ’ä»¶æ ¹ç›®å½•ä¸‹çš„ä¸€ä¸ªåä¸º`_locales`çš„æ–‡ä»¶å¤¹ä¸­
2.  æ¯ç§è¯­è¨€åœ¨`_locales`æ–‡ä»¶å¤¹ä¸­éƒ½æœ‰å®ƒè‡ªå·±çš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä»¥å®ƒçš„[é€‚å½“çš„è¯­è¨€çŸ­ä»£ç ](https://r12a.github.io/app-subtags/)å‘½å
3.  æ¯ä¸ªè¯­è¨€æ–‡ä»¶å¤¹ä¸­éƒ½æœ‰ä¸€ä¸ªåä¸º`messages.json`çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¯¥è¯­è¨€çš„æ‰€æœ‰å­—ç¬¦ä¸²
4.  æ‚¨å¯ä»¥é€šè¿‡ä»è„šæœ¬ä¸­è°ƒç”¨`browser.i18n.getMessage('yourStringYouWantLocalised')`æ¥è·å¾—æœ¬åœ°åŒ–çš„å­—ç¬¦ä¸²ã€‚

æ³¨æ„ï¼Œä½ å¿…é¡»è‡ªå·±ç¿»è¯‘ä½ çš„ ui(HTML é¡µé¢)ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ª HTML é¡µé¢è¢«åŠ è½½æ—¶ï¼Œä½ éœ€è¦æŸç§æœºåˆ¶æ¥*å°†ç¿»è¯‘åçš„å­—ç¬¦ä¸²*åº”ç”¨åˆ°ä½ çš„ HTML ä¸­ã€‚ä½¿ç”¨æˆ‘çš„æ’ä»¶ï¼Œæˆ‘é€šè¿‡ç»™ HTML ä¸­æ¯ä¸ªå¯ç¿»è¯‘çš„å…ƒç´ èµ‹äºˆä¸€ä¸ª`data-translate`å±æ€§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å½“åŠ è½½ HTML é¡µé¢æ—¶ï¼Œæˆ‘æœ‰ä¸€ä¸ªåä¸º`translate()`çš„å°åŠ©æ‰‹å‡½æ•°ï¼Œç”¨ä¸€ä¸ª`data-translate`å±æ€§æ›¿æ¢æ¯ä¸ªå…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚è¯¥å‡½æ•°ä½¿ç”¨`data-translate`çš„å€¼æ¥è·å–åœ¨`messages.json`æ–‡ä»¶ä¸­æŒ‡å®šçš„ç›¸åº”ç¿»è¯‘å­—ç¬¦ä¸²ã€‚

**è®ºå›**
å¦‚æœä½ æœ‰æ—¶è§‰å¾—è¿æ°”ä¸å¥½ï¼Œæ‰¾ä¸åˆ°è·¯ï¼Œè¿˜æœ‰ä¸€ä¸ªå®˜æ–¹çš„ AMO è®ºå›ã€‚æˆ‘ä¸çŸ¥é“æˆ‘æœ€åˆæ˜¯å¦‚ä½•æ‰¾åˆ°å®ƒçš„ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸å®¹æ˜“æ‰¾åˆ°çš„ä¸œè¥¿ã€‚ä½ å¯ä»¥å»çœ‹çœ‹è¿™é‡Œçš„ã€‚

**è®¾ç½®é¡µé¢**
ä½ å¯èƒ½ä¼šå‘ç°è‡ªå·±å¤„åœ¨ä¸€ä¸ªæƒ³ä¸ºè‡ªå·±çš„é™„åŠ ç»„ä»¶åšä¸€ä¸ªè®¾ç½®é¡µé¢çš„ä½ç½®ã€‚ç¬¬ä¸€æ­¥æ˜¯åœ¨æ‚¨çš„æ¸…å•ä¸­æŒ‡å®šä¸€ä¸ª`options_ui`é”®ã€‚ä½ å¯ä»¥è¾“å…¥ä¸€ä¸ª`page`é”®å¹¶æŒ‡å®šä¸€ä¸ª HTML é¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
{  "options_ui":  {  "page":  "settings/options.html",  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå½“ä½ åœ¨æ’ä»¶ç®¡ç†å™¨ä¸­è®¿é—®ä½ çš„æ’ä»¶é¡µé¢æ—¶ï¼Œä½ ä¼šåœ¨åº•éƒ¨çœ‹åˆ°ä½ æŒ‡å®šçš„ HTML é¡µé¢ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ·»åŠ ä¸€äº›è¡¨å•å…ƒç´ ï¼Œè®©ç”¨æˆ·é€‰æ‹©ä»–ä»¬çš„åå¥½ã€‚éœ€è¦æ³¨æ„ä¸¤ä»¶äº‹:

1.  æ‚¨å¿…é¡»å®é™…ä¿å­˜è®¾ç½®ã€‚è¿™å¯ä»¥é€šè¿‡å­˜å‚¨ API: `browser.storage.set()`)æ¥å®ç°ã€‚
2.  åŠ è½½è®¾ç½® HTML é¡µé¢æ—¶ï¼Œæ‚¨å¿…é¡»å°†è¾“å…¥å…ƒç´ åˆå§‹åŒ–ä¸ºå…¶å­˜å‚¨å€¼ã€‚è¦ä»å­˜å‚¨å™¨ä¸­è·å–å€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`browser.storage.get()`ã€‚

**é“¾æ¥:**
> [AMO è®ºå›](https://discourse.mozilla.org/c/add-ons)
> [å­˜å‚¨ API](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/storage)
> [è®¾ç½®é¡µé¢æŒ‡å—](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Implement_a_settings_page)
> [æˆ‘çš„ç¿»è¯‘æ–¹æ³•](https://github.com/christiankaindl/trello-super-powers/blob/master/CONTRIBUTE.md#translating-ui-elements)
> [é“¾æ¥åˆ°æˆ‘çš„`translate()`åŠ©æ‰‹åŠŸèƒ½](https://github.com/christiankaindl/trello-super-powers/blob/master/translate.js)

* * *

åœ¨ Firefox 57 ä¸­ï¼ŒMozilla å®Œå…¨æ”¾å¼ƒäº†ä¼ ç»Ÿçš„æ‰©å±•æ”¯æŒï¼Œè½¬è€Œæ”¯æŒè¿™ç§æ–°çš„æ¶æ„ã€‚åœ¨ WebExtensions å‡ºç°ä¹‹å‰â€”â€”ä½œä¸ºå¼€å‘ Firefox æ‰©å±•çš„å¼€å‘è€…â€”â€”ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æµè§ˆå™¨å†…éƒ¨çš„ä¸œè¥¿ã€‚è¿™å¯¼è‡´äº†ç³Ÿç³•çš„å…¼å®¹æ€§ä½“éªŒï¼Œå› ä¸ºæ›´æ–°å¾ˆå®¹æ˜“ä¸­æ–­ï¼Œè€Œä¸”ç»å¸¸æ²¡æœ‰è¿™äº›å†…éƒ¨åŠŸèƒ½çš„æ–‡æ¡£ã€‚Mozilla è¯•å›¾é€šè¿‡æä¾› SDK æ¥ç®€åŒ–å¼€å‘ï¼Œä½†å®ƒä»ç„¶ä¸å¤Ÿå®Œç¾ã€‚æ‰€ä»¥ç°åœ¨ï¼Œç¼–å†™ä¸€ä¸ª WebExtension æ˜¯è·å¾—ä¸€ä¸ªå¯ç”¨çš„ Firefox æ’ä»¶çš„å”¯ä¸€æ–¹æ³•ã€‚

å”·ï¼å¦‚æœä½ èƒ½èµ°åˆ°è¿™ä¸€æ­¥ï¼Œæ­å–œä½ ï¼å†™è¿™ç¯‡æ–‡ç« ä¸å®¹æ˜“ï¼Œä½†ä¹Ÿå¾ˆæœ‰è¶£ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–è€…æˆ‘æœ‰ä»€ä¹ˆä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œè¯·ç•™ä¸‹è¯„è®ºï¼Œæˆ‘ä¼šå¾ˆä¹æ„å›ç­”ã€‚è°¢è°¢ä½ ã€‚

WebExtensions çš„å¯èƒ½æ€§æ¯”æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­å¯èƒ½å±•ç¤ºçš„è¦å¤šå¾—å¤šï¼Œæ‰€ä»¥è¯·åŠ¡å¿…æŸ¥çœ‹ MDN ä¸Šçš„æ‰€æœ‰ API å’Œæ¸…å•é”®[ã€‚](https://developer.mozilla.org/de/Add-ons/WebExtensions)

*æˆ‘åœ¨å¼€å§‹æ—¶è°ˆåˆ°çš„é™„ä»¶(æ˜¾ç¤ºåœ¨ gif ä¸­)æ˜¯[ç‰¹é›·ç½—è¶…èƒ½åŠ›](https://addons.mozilla.org/en-US/firefox/addon/trello-super-powers/)ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ‰©å±•ï¼Œä¸ºæ‚¨çš„ Trello æ¿æ·»åŠ äº†ä¸€äº›æ¼‚äº®çš„åŠŸèƒ½ã€‚è€Œä¸”å¯¹äº†ï¼Œå®ƒæ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ GitHubT5 ä¸ŠæŸ¥çœ‹*