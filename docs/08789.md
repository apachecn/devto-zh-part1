# åœ¨åªæœ‰ 2 ä¸ª AZ çš„ AWS åŒºåŸŸä¸­æœ‰ kops çš„å¤š AZ Kubernetes

> åŸæ–‡:[https://dev . to/peterfication/multi-az-kubernetes-with-kops-in-AWS-regions-with-only-2-az](https://dev.to/peterfication/multi-az-kubernetes-with-kops-in-aws-regions-with-only-2-az)

ç›®å‰ï¼Œæˆ‘ä»¬æ­£åœ¨ store2be è®¾ç«‹ Kubernetesã€‚æˆ‘ä»¬æ˜¯ä¸€å®¶æ¥è‡ªå¾·å›½çš„å…¬å¸ï¼Œæˆ‘ä»¬çš„å¤§éƒ¨åˆ†ä¸šåŠ¡éƒ½å‘ç”Ÿåœ¨å¾·å›½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ AWS æœåŠ¡å™¨åœ¨æ³•å…°å…‹ç¦ã€‚

æˆ‘ä»¬ä½¿ç”¨ [kops](https://github.com/kubernetes/kops) è¿›è¡Œ Kubernetes é›†ç¾¤ç®¡ç†ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„é›†ç¾¤æ˜¯ä¸€ä¸ªå¤šå¯ç”¨æ€§åŒºåŸŸ(AZ)éƒ¨ç½²ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°è¯•äº†ä»¥ä¸‹å‘½ä»¤:

```
$ kops create cluster \
    --node-count 4 \
    --zones eu-central-1a,eu-central-1b \
    --master-zones eu-central-1a,eu-central-1b \
    --node-size t2.medium \
    --master-size m3.medium \
    --yes \
    kubernetes-cluster.example.org 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯ç»“æœå¹¶ä¸ä¹è§‚

```
There should be an odd number of master-zones, for etcd's quorum.  Hint: Use --zones and --master-zones to declare node zones and master zones separately. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ä¸å¹¸çš„æ˜¯ï¼Œç›®å‰çœ‹æ¥åœ¨ä¸€ä¸ªåªæœ‰ 2 AZ çš„ AWS åŒºåŸŸä¸­ä½¿ç”¨ kops å¼€ç®±å³ç”¨æ˜¯ä¸å¯èƒ½çš„ã€‚ä½†æ˜¯ç»è¿‡ä¸€ç•ªæŒ–æ˜ä¹‹åï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæè¿°æˆ‘ä»¬é—®é¢˜çš„ Github é—®é¢˜ï¼Œç”šè‡³è¿˜æœ‰ä¸€ä¸ªé’ˆå¯¹è¿™ä¸ªé—®é¢˜çš„ T2 è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥ä¸‹é¢çš„æ­¥éª¤æ˜¯åŸºäº[å¡ç±³å°”Â·èµ«é‡Œæ–¯æ‰˜å¤«](https://github.com/kamilhristov)æä¾›çš„è§£å†³æ–¹æ¡ˆã€‚

## [](#1-create-a-clusteryml-for-a-aws-region-with-3-az)1ã€‚ä¸ºå¸¦æœ‰ 3 ä¸ª AZ çš„ AWS åŒºåŸŸåˆ›å»ºä¸€ä¸ª cluster.yml

åœ¨æ¬§ç›Ÿè¥¿éƒ¨åˆ›å»ºä¸€ä¸ªé›†ç¾¤(å› ä¸ºå®ƒæœ‰ 3 ä¸ª AZ):

```
$ kops create cluster \
    --node-count 4 \
    --zones eu-west-1a,eu-west-1b,eu-west-1c \
    --master-zones eu-west-1a,eu-west-1b,eu-west-1c \
    --node-size t2.medium \
    --master-size m3.medium \
    --yes \
    kubernetes-cluster.example.org 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è½¬å‚¨é›†ç¾¤å’Œå®ä¾‹ç»„é…ç½®å¹¶é™„åŠ åˆ°:

```
$ kops get cluster --name=kubernetes-cluster.example.org --output yaml > cluster.yml && \
  echo "\n---\n" >> cluster.yml && \
  kops get instancegroups --name=kubernetes-cluster.example.org --output yaml >> cluster.yml 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#2-adjust-the-clusteryml)2ã€‚è°ƒæ•´é›†ç¾¤. yml

*   ç”¨æ¬§ç›Ÿä¸­éƒ¨æ›¿æ¢æ‰€æœ‰å‡ºç°çš„æ¬§ç›Ÿè¥¿éƒ¨
*   ç”¨ eu-central-1a æ›¿æ¢ eu-central-1c çš„æ‰€æœ‰åˆ†åŒºå®šä¹‰
*   å°† eu-central-1c çš„æ‰€æœ‰åç§°å®šä¹‰æ›¿æ¢ä¸ºä¸åŒäº eu-central-1a çš„åç§°å®šä¹‰ï¼Œä¾‹å¦‚ eu-central-1a2(å¦åˆ™ä¼šæœ‰åç§°å†²çª)

## [](#3-create-the-cluster-by-using-the-adjusted-clusteryml)3ã€‚ä½¿ç”¨è°ƒæ•´åçš„ cluster.yml åˆ›å»ºåˆ†ç±»

 `# [](#we-have-to-use-replace-here-because-the-cluster-spec-already-has)è¿™é‡Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ replaceï¼Œå› ä¸ºé›†ç¾¤è§„èŒƒå·²ç»æœ‰äº†

# [](#been-created-in-step-1)å·²åœ¨æ­¥éª¤ 1 ä¸­åˆ›å»ºã€‚

$ kops replace-f cluster . yml
$ kops create secret-name kubernetes-cluster.example.org ssh public key admin-I ~/ã€‚ssh/id_rsa.pub
$ kops æ›´æ–°é›†ç¾¤-æ˜¯
`

 `åœ¨âœ¨ï¼Œæ³•å…°å…‹ç¦æœ‰ä¸€ä¸ªå¤šé˜¿å…¹æ˜Ÿå›¢ğŸ‰

æˆ‘å†™è¿™ç¯‡æ–‡ç« æ˜¯å› ä¸ºæˆ‘ä»¬èŠ±äº†ä¸€æ®µæ—¶é—´æ‰æ‰¾åˆ°è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬èƒ½å¸®åŠ©ä¸€äº›äººã€‚æ„Ÿè°¢[å¡ç±³å°”Â·èµ«é‡Œæ–¯æ‰˜å¤«](https://github.com/kamilhristov)åˆ†äº«è§£å†³æ–¹æ¡ˆã€‚æ„Ÿè°¢[æ±¤å§†Â·éœåˆ©](https://github.com/tomhoule)å®¡é˜…è¿™ç¯‡æ–‡ç« ã€‚

* * *

*å¤§å®¶å¥½ï¼Œæˆ‘ä»¬æ˜¯ [store2be](https://www.store2be.com) ï¼Œä¸€å®¶æ€»éƒ¨ä½äºæŸæ—çš„åˆåˆ›å…¬å¸ï¼Œä¸ºçŸ­æœŸé›¶å”®ç©ºé—´å»ºç«‹äº†ä¸€ä¸ªæ”¯æŒ SaaS çš„å¸‚åœºã€‚å¦‚æœä½ å–œæ¬¢æˆ‘ä»¬å‘å¸ƒçš„å†…å®¹ï¼Œä½ å¯èƒ½æƒ³çœ‹çœ‹[store 2 be æŠ€æœ¯é¡µé¢](https://tech.store2be.com)æˆ–è€…å…³æ³¨æˆ‘ä»¬çš„[åª’ä½“é¢‘é“](https://medium.com/store2be-tech)ã€‚*``