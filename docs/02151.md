# æ„å¤–ä¸»ä½“å¯¼è‡´ dredd å¤±è´¥æ—¶æ˜¾ç¤ºå·®å¼‚

> åŸæ–‡:[https://dev . to/ryosukes/show-diff-when-dredd-was-failed-by-unexpected-body-7cd](https://dev.to/ryosukes/show-diff-when-dredd-was-failed-by-unexpected-body-7cd)

å¦‚æœ dredd å› æ„å¤–ä¸»ä½“è€Œå¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ cli ä¸Šæ˜¾ç¤ºä¸€äº›æ¶ˆæ¯ã€å®é™…å“åº”å’Œé¢„æœŸå“åº”ã€‚ä½†æ˜¯ï¼Œcli ä¸Šä¸ä¼šæ˜¾ç¤º diffã€‚

> ç›®å‰æ²¡æœ‰å·®å¼‚ï¼ŒDredd æ˜¾ç¤ºé¢„æœŸçš„å“åº”å’ŒçœŸå®çš„å“åº”ï¼Œè®©ç”¨æˆ·è‡ªå·±å†³å®šå·®å¼‚

[https://github.com/apiaryio/dredd/issues/765](https://github.com/apiaryio/dredd/issues/765)

å¦‚æœè¦æ˜¾ç¤º diffï¼Œå°±éœ€è¦åƒè¿™æ ·å°† diff æ’å…¥åˆ°`transaction.fail`ä¸­(ä½¿ç”¨ node)ã€‚

```
var hooks = require('hooks');
var diff  = require('diff'); // need diff package

hooks.beforeEachValidation(function (transaction) {
    var real     = transaction.real.body;
    var expected = transaction.expected.body;

    if (real !== expected) {
        transaction.fail = diff.createPatch(
            transaction.id + " failed diff",
            JSON.stringify(JSON.parse(real), undefined, 4),
            JSON.stringify(JSON.parse(expected), undefined, 4),
            "real",
            "expected"
        );
    }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

cf: [ç¼–ç¨‹æµ‹è¯•å¤±è´¥](https://github.com/apiaryio/dredd/blob/master/docs/hooks-nodejs.md#failing-tests-programmatically)

å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘æ€ä¹ˆåšğŸ™‚

è°¢è°¢ä½ ã€‚