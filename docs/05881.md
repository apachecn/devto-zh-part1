# ä½¿ç”¨ Mapbox æ„å»ºå›½å®¶é«˜äº®æ˜¾ç¤ºå·¥å…·

> åŸæ–‡:[https://dev . to/wuz/building-a-country-highlighting-tool-with-map box-2k BH](https://dev.to/wuz/building-a-country-highlighting-tool-with-mapbox-2kbh)

> è¿™æ˜¯æˆ‘æœ€è¿‘åœ¨æˆ‘æ–°å»ºçš„ä¸ªäººç½‘ç«™ä¸Šå‘å¸ƒçš„ä¸€ä¸ªæ—§å¸–å­ã€‚æ„Ÿè°¢é˜…è¯»ï¼

å¯¹äºæœ€è¿‘çš„ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåŠ¨æ€åœ°å›¾ï¼Œçªå‡ºæ˜¾ç¤ºæˆ‘ä»¬çš„å®¢æˆ·å·²ç»å®Œæˆå·¥ä½œçš„åŒºåŸŸã€‚åœ¨è¯„ä¼°äº†éœ€æ±‚å¹¶ç ”ç©¶äº†æˆ‘ä»¬çš„é€‰æ‹©ä¹‹åï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨ [Mapbox](http://mapbox.com/) æ¥æ„å»ºè¿™ä¸ªã€‚ä»–ä»¬ä¸ [OpenStreetMap](https://www.openstreetmap.org/) çš„é›†æˆä»¥åŠåœ¨æˆ‘ä»¬çš„åœ°å›¾ä¸Šè½»æ¾å®šåˆ¶ç£è´´é›†å’Œæ ·å¼çš„èƒ½åŠ›ç«‹å³å¸å¼•äº†æˆ‘ä»¬ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆã€‚

[https://codepen.io/wuz/embed/ayOwjY/?height=600&default-tab=js,result&embed-version=2](https://codepen.io/wuz/embed/ayOwjY/?height=600&default-tab=js,result&embed-version=2)

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¼¹å‡ºçª—å£ï¼Œæ˜¾ç¤ºè¯¥å›½å®¶çš„ä¸€äº›åŸºæœ¬ç»Ÿè®¡æ•°æ®ã€‚è¯¥æ–¹æ³•å¯ç”¨äºä»»ä½•ç±»å‹çš„åœ°å›¾æ¡† tilesetï¼Œä½†æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¥è‡ª[è‡ªç„¶åœ°çƒæ•°æ®](http://www.naturalearthdata.com/downloads/10m-cultural-vectors/)çš„æ•°æ®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„çŸ¢é‡ tileset çš„é“¾æ¥ã€‚ç‚¹å‡»è¯¥é¡µé¢ä¸Šçš„ä¸‹è½½å›½å®¶é“¾æ¥ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼

[![getting your access token](../Images/508de9bbdd62a5ece7b99ec522d589fe.png)T2ã€‘](///static/7f97ce40e3b7dea3a2640e7740a4ecc2/9199c/access_token.png)

è¦å¼€å§‹æ„å»ºï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª [Mapbox Studio å¸æˆ·](http://mapbox.com/studio)ã€‚ä¸€æ—¦ä½ æ³¨å†Œäº†ï¼Œä½ éœ€è¦å¾—åˆ°ä½ çš„ API è®¿é—®ä»¤ç‰Œã€‚ç™»å½•åˆ°æ‚¨çš„ Mapboxaccountï¼Œç‚¹å‡»ä»ªè¡¨æ¿å·¦ä¸‹æ–¹çš„å¸æˆ·æŒ‰é’®ã€‚ç„¶åç‚¹å‡»å³ä¸Šè§’çš„ API è®¿é—®ä»¤ç‰Œã€‚å¯»æ‰¾æ‚¨çš„é»˜è®¤å…¬å…±ä»¤ç‰Œã€‚

> æ¥ä¸‹æ¥çš„å‡ ä¸ªæ­¥éª¤å‡è®¾æ‚¨ä½¿ç”¨æœ¬åœ°æ–‡ä»¶æ¥è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœä½ æƒ³åœ¨ Codepen ä¸­ä½¿ç”¨å®ƒï¼Œ[è¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿæ¨¡æ¿](https://codepen.io/wuz/pen/Mvaavy?editors=0010)ï¼Œå®ƒåŒ…å«äº†é¡¹ç›®çš„å¼€å§‹ã€‚

ç»§ç»­å¤åˆ¶ï¼Œç„¶åç²˜è´´åˆ°ä¸€ä¸ªåä¸º`main.js`çš„æ–° Javascript æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
mapboxgl.accessToken =
  'pk.eyJ1IjoiYnlmcm9zdC1hcnRpY2xlcyIsImEiOiJjajVsZ3NwZGczMWNtMnFyeTR2cHRnajZ4In0.HOjYrueiLWlhLfhsDCa7wQ'; // Replace with your token 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬åªéœ€è¦ä¸€äº›åŸºæœ¬çš„ HTML æ ·æ¿æ–‡ä»¶ã€‚åˆ›å»ºä¸€ä¸ªåä¸º index.html çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
<!DOCTYPE html>
<html>
  <head>
    <title>My Awesome Map</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="map"></div>
    <script src="https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js"></script>
    <script src="main.js"></script>
  </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æ ·å¼ã€‚åˆ›å»ºä¸€ä¸ª style.css å¹¶æ·»åŠ è¿™ä¸ª:

```
#map {
  height: 500px;
  width: 1000px;
}
#map .mapboxgl-popup-content {
  padding: 10px;
  max-width: 300px;
  padding-top: 20px;
}
#map .mapboxgl-popup-content ul {
  list-style: none;
  margin: 0;
  padding: 0;
  float: left;
}

#map .mapboxgl-popup-content ul h3 {
  margin: 0 0 10px 0;
}

#map .mapboxgl-popup-content img {
  float: left;
  width: 30px;
  margin-right: 10px;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ åŠ è½½ä½ çš„é¡µé¢ï¼Œä½ å¯èƒ½ä»€ä¹ˆä¹Ÿçœ‹ä¸åˆ°ã€‚æˆ‘ä»¬çš„ä¸‹ä¸€æ­¥æ˜¯æ·»åŠ åœ°å›¾ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° main.js:

```
mapboxgl.accessToken =
  'pk.eyJ1IjoiYnlmcm9zdC1hcnRpY2xlcyIsImEiOiJjajVsZ3NwZGczMWNtMnFyeTR2cHRnajZ4In0.HOjYrueiLWlhLfhsDCa7wQ'; // Replace with your token

var map = new mapboxgl.Map({
  container: 'map', //this is the id of the container you want your map in
  style: 'mapbox://styles/mapbox/light-v9', // this controls the style of the map. Want to see more? Try changing 'light' to 'simple'.
  minZoom: 2, // We want our map to start out pretty zoomed in to start.
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> å¦‚æœæ‚¨ä½¿ç”¨äº†ä¸Šé¢çš„ Codepen æ¨¡æ¿ï¼Œé‚£ä¹ˆåˆ°ç›®å‰ä¸ºæ­¢æ‚¨åº”è¯¥å·²ç»æ‹¥æœ‰äº†æ‰€æœ‰çš„ä¸œè¥¿ã€‚

[https://codepen.io/wuz/embed/NvGGjQ/?height=600&default-tab=js,result&embed-version=2](https://codepen.io/wuz/embed/NvGGjQ/?height=600&default-tab=js,result&embed-version=2)

æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Mapbox Studio ä¸­åŠ è½½æˆ‘ä»¬çš„è‡ªå®šä¹‰ tilesetã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œè¯·ä¸‹è½½å‰é¢çš„è‡ªç„¶åœ°çƒæ•°æ®ã€‚æ‰“å¼€ Mapbox Studio å¹¶ç‚¹å‡» Tilesetsã€‚ä»é‚£é‡Œç‚¹å‡»â€œæ–°å»º tilesetâ€

[![the new tileset button](../Images/b240998b69aec483aadbac828a147ab2.png)T2ã€‘](///static/df1071a162ab3b23c92b230933a0045a/e198c/new_tileset.png)

ä¸Šä¼ ä½ ä» Natural Earth Data ä¸‹è½½çš„æ•´ä¸ª zip æ–‡ä»¶ã€‚

[![uploading the tile set](../Images/af493646c3a3b276eeedfe81ff99d126.png)T2ã€‘](///static/f519c413c22958e7609e3d564f60565f/0a9c2/upload.png)

ç­‰å¾…å®ƒå®Œæˆä¸Šä¼ å’Œå¤„ç†ã€‚

[![waiting for the upload to finish](../Images/6129c3e43fa62ab39acf6990d414b4f1.png)T2ã€‘](///static/8ad67a0f5ddb65c3a68640ff32abc3ca/fddbb/waiting.png)

å®Œæˆåï¼Œç‚¹å‡»ä½ çš„è‡ªå®šä¹‰ tilesetã€‚

[![your custom tileset](../Images/eed10ebd5c52afb4f15018a82a8ab822.png)T2ã€‘](///static/13c9e42945e1f2a4e825c9b51e8624e2/232f1/custom_tileset.png)

æˆ‘ä»¬ç°åœ¨éœ€è¦å°†è¿™ä¸ªè‡ªå®šä¹‰å›¾å—é›†åŠ è½½åˆ°æ‚¨çš„åœ°å›¾ä¸­ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåœ°å›¾åŠ è½½å‡½æ•°ã€‚åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ä¾¦å¬å™¨ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨ addLayerã€‚

<figure>

[![mapid](../Images/52ffe311893b05b8a4fe5582fd54fd3d.png)T2ã€‘](///static/e2cf2d185ae105634fe10c988d5a98af/02744/mapid.png)

<figcaption>Copy your map ID</figcaption>

</figure>

åœ¨å³ä¾§æ ä¸­æŸ¥æ‰¾åœ°å›¾ IDã€‚

<figure>

[![copyname](../Images/6471e6c4bbe35d24f691005ac3da0b07.png)T2ã€‘](///static/ce944423236e16ad5984bce1c429a636/6ff5e/copyname.png)

<figcaption>Copy the name starting with ne_</figcaption>

</figure>

æ‚¨è¿˜éœ€è¦æºå±‚åç§°ï¼Œå³ä»¥`ne_`å¼€å¤´çš„é‚£ä¸ªä½ã€‚è·å–è¿™ä¸ªå’Œåœ°å›¾ IDï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° JS ä»£ç ä¸­ã€‚

```
mapboxgl.accessToken =
  'pk.eyJ1IjoiYnlmcm9zdC1hcnRpY2xlcyIsImEiOiJjajVsZ3NwZGczMWNtMnFyeTR2cHRnajZ4In0.HOjYrueiLWlhLfhsDCa7wQ'; // Replace with your token

var map = new mapboxgl.Map({
  container: 'map', //this is the id of the container you want your map in
  style: 'mapbox://styles/mapbox/light-v9', // this controls the style of the map. Want to see more? Try changing 'light' to 'simple'.
  minZoom: 2, // We want our map to start out pretty zoomed in to start.
});

map.on('load', function() {
  //On map load, we want to do some stuff
  map.addLayer({
    //here we are adding a layer containing the tileset we just uploaded
    id: 'countries', //this is the name of our layer, which we will need later
    source: {
      type: 'vector',
      url: 'mapbox://', // <--- Add the Map ID you copied here
    },
    'source-layer': '', // <--- Add the source layer name you copied here
    type: 'fill',
    paint: {
      'fill-color': '#52489C', //this is the color you want your tileset to have (I used a nice purple color)
      'fill-outline-color': '#F2F2F2', //this helps us distinguish individual countries a bit better by giving them an outline
    },
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨åº”è¯¥å·²ç»åŠ è½½äº† tilesetï¼Œæ‚¨çš„åœ°å›¾åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·:

[https://codepen.io/wuz/embed/WEQQav/?height=600&default-tab=js,result&embed-version=2](https://codepen.io/wuz/embed/WEQQav/?height=600&default-tab=js,result&embed-version=2)

ç°åœ¨è¿™ä¸æ˜¯è¶…çº§æœ‰ç”¨çš„ã€‚æ‰€æœ‰çš„å›½å®¶éƒ½åœ¨æ˜¾ç¤ºï¼Œè¿™ä½¿å¾—å¾ˆéš¾åŒºåˆ†ä»»ä½•ä¸œè¥¿ã€‚è®©æˆ‘ä»¬ç¨å¾®è¿‡æ»¤ä¸€ä¸‹æ•°æ®ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ ID ä¸ºâ€œADM0_A3_ISâ€çš„ tileset ä¸­çš„ ISO Alpha3 ä»£ç è¿›è¡Œè¿‡æ»¤ã€‚

æˆ‘ä»¬åœ¨ load å‡½æ•°ä¸­æ·»åŠ ä¸€è¡Œæ¥å¼€å§‹è¿‡æ»¤:

```
mapboxgl.accessToken =
  'pk.eyJ1IjoiYnlmcm9zdC1hcnRpY2xlcyIsImEiOiJjajVsZ3NwZGczMWNtMnFyeTR2cHRnajZ4In0.HOjYrueiLWlhLfhsDCa7wQ'; // Replace with your token

var map = new mapboxgl.Map({
  container: 'map', //this is the id of the container you want your map in
  style: 'mapbox://styles/mapbox/light-v9', // this controls the style of the map. Want to see more? Try changing 'light' to 'simple'.
  minZoom: 2, // We want our map to start out pretty zoomed in to start.
});

map.on('load', function() {
  //On map load, we want to do some stuff
  map.addLayer({
    //here we are adding a layer containing the tileset we just uploaded
    id: 'countries', //this is the name of our layer, which we will need later
    source: {
      type: 'vector',
      url: 'mapbox://', // <--- Add the Map ID you copied here
    },
    'source-layer': '', // <--- Add the source layer name you copied here
    type: 'fill',
    paint: {
      'fill-color': '#52489C', //this is the color you want your tileset to have (I used a nice purple color)
      'fill-outline-color': '#F2F2F2', //this helps us distinguish individual countries a bit better by giving them an outline
    },
  });

  map.setFilter(
    'countries',
    ['in', 'ADM0_A3_IS'].concat(['USA', 'AUS', 'NGA']),
  ); // This line lets us filter by country codes.
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[https://codepen.io/wuz/embed/RZWWEv/?height=600&default-tab=js,result&embed-version=2](https://codepen.io/wuz/embed/RZWWEv/?height=600&default-tab=js,result&embed-version=2)

å¥½å¤šäº†ã€‚ç°åœ¨æˆ‘ä»¬çš„åœ°å›¾çªå‡ºæ˜¾ç¤ºäº†ä¸‰ä¸ªå›½å®¶:å°¼æ—¥åˆ©äºšã€æ¾³å¤§åˆ©äºšå’Œç¾å›½ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ æ›´å¤šçš„å›½å®¶ï¼Œæˆ‘ä»¬å¯ä»¥åªç¼–è¾‘å›½å®¶ä»£ç æ•°ç»„ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥ä» API ä¸­æå–è¿™äº›ä»£ç ï¼Œå¹¶ä»¥è¿™ç§æ–¹å¼æ·»åŠ å®ƒä»¬ã€‚

æœ€åï¼Œè®©åœ°å›¾å…·æœ‰äº¤äº’æ€§ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç”± [REST å›½å®¶](https://restcountries.eu/)æä¾›çš„ APIã€‚å¹¸è¿çš„æ˜¯ï¼Œä»–ä»¬æœ‰ä¸€ä¸ªæ¥å— ISO Alpha3 ä»£ç çš„ç«¯ç‚¹ï¼

```
mapboxgl.accessToken =
  'pk.eyJ1IjoiYnlmcm9zdC1hcnRpY2xlcyIsImEiOiJjajVsZ3NwZGczMWNtMnFyeTR2cHRnajZ4In0.HOjYrueiLWlhLfhsDCa7wQ'; // Replace with your token

var map = new mapboxgl.Map({
  container: 'map', //this is the id of the container you want your map in
  style: 'mapbox://styles/mapbox/light-v9', // this controls the style of the map. Want to see more? Try changing 'light' to 'simple'.
  minZoom: 2, // We want our map to start out pretty zoomed in to start.
});

map.on('load', function() {
  //On map load, we want to do some stuff
  map.addLayer({
    //here we are adding a layer containing the tileset we just uploaded
    id: 'countries', //this is the name of our layer, which we will need later
    source: {
      type: 'vector',
      url: 'mapbox://byfrost-articles.74qv0xp0', // <--- Add the Map ID you copied here
    },
    'source-layer': 'ne_10m_admin_0_countries-76t9ly', // <--- Add the source layer name you copied here
    type: 'fill',
    paint: {
      'fill-color': '#52489C', //this is the color you want your tileset to have (I used a nice purple color)
      'fill-outline-color': '#F2F2F2', //this helps us distinguish individual countries a bit better by giving them an outline
    },
  });

  map.setFilter(
    'countries',
    ['in', 'ADM0_A3_IS'].concat(['USA', 'AUS', 'NGA']),
  ); // This line lets us filter by country codes.

  map.on('click', 'countries', function(mapElement) {
    const countryCode = mapElement.features[0].properties.ADM0_A3_IS; // Grab the country code from the map properties.

    fetch(`https://restcountries.eu/rest/v2/alpha/${countryCode}`) // Using tempalate tags to create the API request
      .then(data => data.json()) //fetch returns an object with a .json() method, which returns a promise
      .then(country => {
        //country contains the data from the API request
        // Let's build our HTML in a template tag
        const html = ` 
        <img src='${country.flag}' /> 
        <ul>
          <li><h3>${country.name}</h3></li>
          <li><strong>Currencies:</strong> ${country.currencies
            .map(c => c.code)
            .join(', ')}</li>
          <li><strong>Capital:</strong> ${country.capital}</li>
          <li><strong>Population:</strong> ${country.population}</li>
          <li><strong>Demonym:</strong> ${country.demonym}</li>
        </ul>
      `; // Now we have a good looking popup HTML segment.
        new mapboxgl.Popup() //Create a new popup
          .setLngLat(mapElement.lngLat) // Set where we want it to appear (where we clicked)
          .setHTML(html) // Add the HTML we just made to the popup
          .addTo(map); // Add the popup to the map
      });
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªçªå‡ºæ˜¾ç¤ºå›½å®¶çš„äº¤äº’å¼åœ°å›¾ï¼

[https://codepen.io/wuz/embed/ayOwjY/?height=600&default-tab=js,result&embed-version=2](https://codepen.io/wuz/embed/ayOwjY/?height=600&default-tab=js,result&embed-version=2)

* * *

æ„Ÿè°¢é˜…è¯»ï¼æˆ‘åˆšå¼€å§‹äº†ä¸€ä¸ªæ–°çš„æ—¶äº‹é€šè®¯ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½é˜…è¯»å¹¶æ³¨å†Œå®ƒï¼æˆ‘ä¼šåˆ†äº«æˆ‘å†™çš„ä¸€äº›æ–‡ç« ï¼Œæˆ‘å‘ç°çš„ä¸€äº›å¾ˆé…·çš„ä¸œè¥¿ï¼Œä»¥åŠä¸€äº›æˆ‘åœ¨ç½‘ä¸Šæœ€å–œæ¬¢çš„é“¾æ¥ã€‚

### 

<center>T3ã€‘ğŸ‰åŠ å…¥æ—¶äº‹é€šè®¯ğŸ‰</center>

* * *