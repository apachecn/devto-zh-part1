# ä½¿ç”¨ HOC åœ¨ React åº”ç”¨ç¨‹åºä¸­å¼‚æ­¥åŠ è½½ç»„ä»¶

> åŸæ–‡ï¼š<https://dev.to/_arpy/loading-components-asynchronously-in-react-app-with-an-hoc-6nh>

[![](img/ed15612a3bf5a7802e023e70f547d7cb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--L_L-eYFt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mrmodbtgw57x3ar8t2nq.jpg)

åœ¨å•é¡µåº”ç”¨çš„æ—¶ä»£ï¼Œä½ å¯ä»¥ç”¨ä½ æœ€å–œæ¬¢çš„ **React** æ¥ç¼–å†™(å‡ ä¹)ä»»ä½• web appã€‚äº‹å®ä¸Šï¼Œæœ‰äº›åº”ç”¨ç¨‹åºå¯èƒ½éå¸¸åºå¤§ï¼æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªè„¸ä¹¦çš„å…‹éš†ä½“â€¦â€¦å¾ˆå¤§ï¼Œæ˜¯å§ï¼Ÿ

ç°åœ¨ï¼Œæ‚¨å¯èƒ½å·²ç»çŸ¥é“ï¼Œå½“æ‚¨çš„ Webpack é…ç½®å¯¹ä»£ç æ–½å±•å…¶é­”åŠ›æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ **bundle.js** æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å‰ç«¯æ‰€éœ€çš„æ‰€æœ‰ä»£ç ã€‚å®ƒåŒ…æ‹¬æ‰€æœ‰çš„ç»„ä»¶ï¼Œæ­¤å¤–è¿˜æœ‰è®¸å¤šé™„åŠ çš„æ„å»ºå—ã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºè¶Šå¤§ï¼Œæ–‡ä»¶å°±è¶Šå¤§ã€‚å½“ç„¶ï¼Œå¤§æ–‡ä»¶çš„ä¸‹è½½æ—¶é—´ä¹Ÿæ›´é•¿ã€‚å› æ­¤ï¼Œç¬¬ä¸€é¡µçš„åŠ è½½é€Ÿåº¦å‡æ…¢ã€‚è€Œä¸”ï¼Œäº‹å®ä¸Šï¼Œç”¨æˆ·å¯èƒ½æ°¸è¿œä¸ä¼šè®¿é—®å¾ˆå¤šåŠ è½½çš„é¡µé¢ï¼Œä¹Ÿæ°¸è¿œä¸ä¼šçœ‹åˆ°å¾ˆå¤šç»„ä»¶ã€‚

å°†æœ€åˆçš„ **bundle.js** æ–‡ä»¶åˆ†è§£æˆå—å¹¶æ ¹æ®è¯·æ±‚åŠ è½½ç»„ä»¶è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚å› æ­¤ï¼Œç”¨æˆ·æ— æ„è®¿é—®çš„é¡µé¢å’Œæ°¸è¿œä¸ä¼šå‘ˆç°çš„ç»„ä»¶å°†æ°¸è¿œä¸ä¼šè¢«åŠ è½½ã€‚

æœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘å°†åˆ†äº«ä¸€ä¸ªæ¶‰åŠ **HOCs** :)

# ä»€ä¹ˆæ˜¯ç‰¹è®¾ï¼Ÿ

> é«˜é˜¶ç»„ä»¶(HOC)æ˜¯ React ä¸­é‡ç”¨ç»„ä»¶é€»è¾‘çš„é«˜çº§æŠ€æœ¯ã€‚æœ¬è´¨ä¸Šï¼Œhoc ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬æ˜¯ä» React çš„ç»„åˆæ€§è´¨ä¸­å‡ºç°çš„ä¸€ç§æ¨¡å¼ã€‚

å¯ä»¥æŠŠä¸€ä¸ª HOC çœ‹ä½œæ˜¯ä½ çš„ç»„ä»¶çš„åŒ…è£…å™¨ï¼Œå½“ç»„ä»¶è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šå¯¹å®ƒä»¬åº”ç”¨ä¸€äº›å…¬å…±çš„çŠ¶æ€å’Œè¡Œä¸ºæ”¹å˜ã€‚ä¸€ä¸ªç‰¹è®¾åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªç»„ä»¶ã€‚æ‚¨å¯ä»¥åœ¨æ‚¨çš„ *jsx* ä¸­å°†å®ƒä»¬ä½œä¸ºæ™®é€šç»„ä»¶ä½¿ç”¨ã€‚[è¿™é‡Œæ˜¯é«˜é˜¶ç»„ä»¶çš„è¯¦ç»†æ–‡æ¡£](https://reactjs.org/docs/higher-order-components.html)ã€‚

[![](img/692487e8df415428d21e711232072872.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VL857Pwe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a7a0ctfk3rc40uydpfcy.jpg)

å› æ­¤ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª HOCï¼Œå¹¶å°†å…¶åº”ç”¨äºé‚£äº›æˆ‘ä»¬å¸Œæœ›å¼‚æ­¥åŠ è½½çš„ç»„ä»¶ã€‚

# å¼‚æ­¥ç»„ä»¶ HOC

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬çš„ HOC çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å°±æŠŠå®ƒå«åš **asyncComponent.js** ã€‚æˆ‘å–œæ¬¢åœ¨æˆ‘çš„é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªåä¸ºâ€œhocâ€çš„ç‹¬ç«‹æ–‡ä»¶å¤¹æ¥å­˜æ”¾æ‰€æœ‰é«˜é˜¶ç»„ä»¶ã€‚

ä»¥ä¸‹æ˜¯æ–‡ä»¶å†…å®¹:

```
//hoc/asyncComponent.js

import React, {Component} from 'react';

const asyncComponent = (importComponent) => {
    return class extends Component {
        state = {
            component: null
        }

        componentDidMount() {
            importComponent()
                .then(cmp => {
                    this.setState({component: cmp.default});
                });
        }

        render() {
            const C = this.state.component;
            return C ? <C {...this.props}/> : null;
        }
    }
};

export default asyncComponent; 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚ä½ æ‰€è§ï¼Œå®ƒåªæ˜¯è¿”å›ä¸€ä¸ªæ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªä» **React ç»„ä»¶**æ‰©å±•è€Œæ¥çš„*åŒ¿åç±»*ã€‚æ‰€ä»¥ï¼ŒåŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬çš„ *asyncComponent* æ˜¯ä¸€ä¸ªè¿”å›*ç»„ä»¶*çš„å‡½æ•°ã€‚

ç°åœ¨ï¼Œ **importComponent** æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåªæ˜¯è¿”å›ä¸€ä¸ªç»„ä»¶å¯¼å…¥ã€‚å®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·:

```
const impFn = () => {
    return import('./components/Card');
} 
```

Enter fullscreen mode Exit fullscreen mode

æ¯æ¬¡è°ƒç”¨ **importComponent** æ—¶ï¼ŒReact éƒ½ä¼šå°è¯•å¯¼å…¥ç»„ä»¶ã€‚å®ƒå°†ä¸‹è½½ä¸€ä¸ªåŒ…å«å¯¼å…¥ç»„ä»¶çš„ **chunk.js** æ–‡ä»¶ã€‚

# ä½¿ç”¨ asyncComponent

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç»„ä»¶ï¼Œä»¥åŠå¦‚æœæˆ‘ä»¬è¿™æ ·åšå°†ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†å°è¯•åœ¨å¦ä¸€ä¸ªåŠŸèƒ½ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚

```
//components/Container.js

import React from 'react';
import asyncComponent from '../../hoc/asyncComponent';

const AsyncButton = asyncComponent(() => {
    return import('../Button');
});

const container = () => {
    return (
        <div>
            <h1>Here goes an async loaded button component</h1>
            <AsyncButton/>
        </div>
    );
};

export default container; 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ DOM ä¸­çš„< Button />ç»„ä»¶ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ªåä¸º **AsyncButton** çš„æ–°ç»„ä»¶ã€‚çŸ¥é“äº†æˆ‘ä»¬å¦‚ä½•å®šä¹‰äº†**å¼‚æ­¥ç»„ä»¶**ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹**å¼‚æ­¥æŒ‰é’®**å°†è¢«åˆ†é…ä¸€ä¸ªæ–°ç±»å‹çš„ç»„ä»¶ã€‚ä½†æ˜¯å½“å®ƒè¢«æ·»åŠ åˆ° DOM æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆåœ¨ **asyncComponent** é‡Œã€‚

æ˜¾ç„¶ï¼Œå½“**å¼‚æ­¥æŒ‰é’®**è¢«å®‰è£…æ—¶(è§*ç»„ä»¶å¸è½½*ï¼Œå®ƒè°ƒç”¨æˆ‘ä»¬çš„**å¯¼å…¥ç»„ä»¶**å‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒå°†å¯¼å…¥å¹¶è¿”å›**æŒ‰é’®**ç»„ä»¶ã€‚åœ¨å¯¼å…¥å®Œæˆä¹‹å‰ï¼Œå‘ˆç°çš„ DOM å°†æ˜¯ç©ºçš„ã€‚å½“ä¸¢å¤±çš„ç»„ä»¶é€šè¿‡å—æ–‡ä»¶ä¸‹è½½åŠ è½½æ—¶ï¼Œå®ƒå°†è¢«æ·»åŠ åˆ° **AsyncButton** ç»„ä»¶çš„çŠ¶æ€ï¼Œåè€…å°†é‡æ–°å‘ˆç°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„å¼‚æ­¥ç»„ä»¶å°†ç®€å•åœ°ä½¿ç”¨ä¼ é€’çš„å±æ€§å‘ˆç°ä¸‹è½½çš„**æŒ‰é’®**ç»„ä»¶ã€‚

ä»…æ­¤è€Œå·²ã€‚æˆ‘ä»¬å·²ç»ä½¿æˆ‘ä»¬çš„**æŒ‰é’®**ç»„ä»¶åªæœ‰åœ¨å®é™…å®‰è£…æ—¶æ‰è¢«è·å–ï¼›)

# å¸¦å¼‚æ­¥ç»„ä»¶çš„è·¯ç”±

å½“ä½ çš„åº”ç”¨ç¨‹åºä¸­æœ‰å¾ˆå¤šå®¹å™¨ç»„ä»¶(å³é¡µé¢)æ—¶ï¼Œæœ€åˆåªåŠ è½½æœ€æœ‰å¯èƒ½è¢«è®¿é—®çš„é¡µé¢å¹¶å¼‚æ­¥è·å–å…¶ä½™çš„é¡µé¢æ˜¯åˆç†çš„ã€‚æˆ‘ä»¬çš„ **asyncComponent** éå¸¸é€‚åˆè¿™ç§æƒ…å†µã€‚ä½ éœ€è¦åƒæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨æŒ‰é’®ä¸€æ ·ä½¿ç”¨å®ƒã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬å°†æ‰€æœ‰è·¯ç”±æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œåªå®šä¹‰äº† 2 æ¡è·¯ç”±ã€‚åˆå§‹åŠ è½½çš„ä¸»é¡µï¼Œä»¥åŠä¸ä¿è¯ä¼šè¢«è®¿é—®çš„ç”¨æˆ·é…ç½®æ–‡ä»¶é¡µé¢ã€‚

```
//Routes.js

import React, {Component} from 'react';
import {Route, Switch} from 'react-router-dom';

import HomePage from './containers/HomePage';

const AsyncProfilePage    = asyncComponent(() => {
    return import('./containers/ProfilePage');
});

class Routes extends Component {
    render() {
        return (
            <Switch>
                <Route exact path='/' component={HomePage}/>
                <Route exact path='/profile' component={AsyncProfilePage}/>
            </Switch>
        );
    }
}

export default Routes; 
```

Enter fullscreen mode Exit fullscreen mode

å› æ­¤ï¼Œåªæœ‰å½“ç”¨æˆ·å•å‡»ä¸»é¡µä¸­æ˜¾ç¤ºæ‰€éœ€é¡µé¢çš„é“¾æ¥æ—¶ï¼Œæ‰ä¼šä¸‹è½½ç”¨æˆ·é…ç½®æ–‡ä»¶é¡µé¢çš„ä»£ç ã€‚

å¸Œæœ›ä½ åœ¨è¿™é‡Œå­¦åˆ°äº†æ–°çš„ä¸œè¥¿ï¼Œå¹¶æ„‰å¿«çš„ååº”ç¼–ç ï¼ğŸ¤˜