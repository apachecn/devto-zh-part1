# å¤§é”ˆè¯

> åŸæ–‡:[https://dev.to/cad97/great-rust-ci-1fk6](https://dev.to/cad97/great-rust-ci-1fk6)

ä¼Ÿå¤§çš„ CI æ„å‘³ç€è‡ªä¿¡åœ°ç¼–ç ã€‚è€Œä¸”é’ˆå¯¹ Rust çš„ CI å…¼å®¹å·¥å…·çš„æƒ…å†µéå¸¸å¥½ï¼Œæ‰€ä»¥æ‚¨åº”è¯¥åˆ©ç”¨å®ƒã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“æ‰€æœ‰å¯ç”¨å·¥å…·çš„å…¨éƒ¨ç»†èŠ‚ï¼Œé‚£ä¹ˆå»ºç«‹å®Œç¾çš„ CI ä¼šå¾ˆå›°éš¾ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»æˆ‘æ­£åœ¨ä½¿ç”¨çš„è®¾ç½®ã€‚

* * *

## [](#install-local-tools)å®‰è£…æœ¬åœ°å·¥å…·ã€‚

ä»¥ä¸‹æ˜¯æˆ‘æ¯å¤©ä½¿ç”¨çš„:

1.  æ¯”èµ· rustc ç»™ä½ çš„ï¼Œä¸ºæ—æŒºå†™æ›´å¤šè‡ªä»¥ä¸ºæ˜¯çš„ä¸œè¥¿ã€‚

    ç›®å‰ï¼Œclippy å°†åªä¸æœ€æ–°çš„å¤œé—´å·¥ä½œã€‚ç”¨ rustup å®‰è£…å¹¶æ›´æ–°æ¯å¤œ rustï¼Œç„¶åè¿è¡Œ`cargo +nightly install clippy --force`å¼ºåˆ¶å®‰è£…ä¸€ä¸ªé’ˆå¯¹ä½ å½“å‰æ¯å¤œçš„ clippyã€‚é…åˆ`cargo +nightly clippy`ä½¿ç”¨ã€‚

2.  [Rustfmt](https://github.com/rust-lang-nursery/rustfmt) :è‡ªåŠ¨ä»£ç æ ¼å¼åŒ–ã€‚

    å¯¹äºè®¸å¤š(è™½ç„¶ä¸æ˜¯å…¨éƒ¨ï¼Œå¾ˆé—æ†¾)çš„å¤œç”Ÿæ´»ï¼Œrustfmt å¯ä»¥ä½¿ç”¨ rustup æ¥ç®¡ç†ï¼Œå°±åƒä½ å¯ä»¥ç®¡ç† rls ä¸€æ ·ã€‚å¦‚æœä½ æ‰€åœ¨çš„å¤œæ™šåŒ…å« rustfmtï¼Œä½ å¯ä»¥åš`rustup component add rustfmt-preview`ã€‚å¦‚æœä½ çš„ nightly ä¸åŒ…å« rustfmt-previewï¼Œä½ å¯ä»¥ä» crates.io: `cargo +nightly install rustfmt-nightly --force`å®‰è£…ã€‚æ‹¥æœ‰ rustup æ‰˜ç®¡ç‰ˆæœ¬å’Œ cargo æ‰˜ç®¡ç‰ˆæœ¬å¯èƒ½ä¼šå¯¼è‡´å†²çªï¼Œæ‰€ä»¥ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªã€‚é…åˆ`cargo +nightly fmt`ä½¿ç”¨ã€‚

3.  [Cargo-Update](https://github.com/nabijaczleweli/cargo-update) :æ£€æŸ¥å¹¶æ›´æ–° Cargo-installed äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

    å¯¹ clippy/rustfmt æ²¡æœ‰å¤ªå¤§å¸®åŠ©ï¼Œå› ä¸ºæ¯æ™šéƒ½éœ€è¦å¼ºåˆ¶é‡æ–°å®‰è£…(å› ä¸ºå®ƒä»¬é“¾æ¥åˆ°å®ƒ)ï¼Œä½†å¯¹æ— ç¼æ›´æ–°å…¶ä»–å·¥å…·(åŒ…æ‹¬å®ƒæœ¬èº«)æ¥è¯´æ˜¯æ— ä»·çš„ã€‚(éœ€è¦ CMake)

4.  å¯é€‰: [Cargo-Edit](https://github.com/killercup/cargo-edit) :ä»å‘½ä»¤è¡Œç”¨ç®€å•çš„å‘½ä»¤ä¿®æ”¹æ„å»ºæ¸…å•(`Cargo.toml`)ï¼Œè€Œä¸æ˜¯æ‰‹å·¥ç¼–è¾‘æ–‡ä»¶ã€‚

5.  å¯é€‰é¡¹:IDE æ”¯æŒã€‚æˆ‘ä½¿ç”¨ IntelliJ IDEA å’Œ IntelliJ Rust æ’ä»¶ã€‚è¿˜æœ‰ç”¨äº VSCode çš„ [RLSï¼Œæˆ–è€…ä½ å¯ä»¥ä½¿ç”¨](https://marketplace.visualstudio.com/items?itemName=rust-lang.rust) [Vim](https://github.com/rust-lang/rust.vim) æˆ– [Emacs](https://github.com/rust-lang/rust-mode) ï¼Œå¦‚æœä½ å–œæ¬¢é‚£ç§ä¸œè¥¿çš„è¯(æ²¡æœ‰è¯„åˆ¤ï¼).

## [](#create-your-project)åˆ›å»ºæ‚¨çš„é¡¹ç›®ï¼

```
$ cargo new great-ci
     Created library `great-ci` project 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®¾ç½®`.git/info/exclude`æ¥å‘Šè¯‰ git å¿½ç•¥ä½ çš„ IDE æ–‡ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ„å‘³ç€ git exclude çš„å†…å®¹æ˜¯:

```
.idea/
*.iml 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‡ºäºè¿™ä¸ªä¾‹å­çš„ç›®çš„ï¼Œè®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªå¾®å‹çš„â€œHello Worldâ€æ ·å¼åº“:

```
//! Example library for great CI integration!

use std::fmt;

/// Greetings to some target
#[derive(Copy, Clone, Debug, Eq, PartialEq, Hash)]
pub struct Greeting<'a>(&'a str);

impl<'a> Greeting<'a> {
    /// Construct a Greeter to greet a target
    pub fn greet(target: &str) -> Greeting {
        Greeting(target)
    }
}

impl<'a> fmt::Display for Greeting<'a> {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "Greetings, {}!", self.0)
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        assert_eq!(2 + 2, 4);
    }

    #[test]
    fn greet_author() {
        let greeter = Greeting::greet("CAD97");
        assert_eq!(greeter.to_string(), "Greetings, CAD97!");
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ è®¸å¯è¯å’Œè‡ªè¿°æ–‡ä»¶ï¼Œç„¶åæ˜¯æäº¤çš„æ—¶å€™äº†ï¼Œç„¶å[åœ¨çº¿è·å–ä»£ç ](https://github.com/CAD97/great-ci/tree/91a0947f638fb7beda5356e7dc520296fcffae93)ã€‚

```
$ git add .
$ git commit -m "Initial commit"
$ git remote add CAD97 git@github.com:CAD97/great-ci.git
$ git push -u CAD97 master 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#set-up-ci)è®¾ç½® CI

æˆ‘ä»¬å…³å¿ƒçš„éƒ¨åˆ†ï¼æˆ‘ä½¿ç”¨ [Travis CI](https://travis-ci.org/) ã€ [Cargo-Travis](https://github.com/roblabla/cargo-travis) ã€ [Codecov](https://codecov.io/) å’Œ [Bors](https://bors.tech/) ä½œä¸ºæˆ‘çš„ CI å †æ ˆã€‚

é‚£ä¹ˆè®©æˆ‘ä»¬åˆ‡æ¢åˆ°ä¸€ä¸ªç‰¹æ€§åˆ†æ”¯ï¼Œè®¾ç½®ä¸€ä¸ªåŸºæœ¬çš„`bors.toml`

```
status = [
    "continuous-integration/travis-ci/push"
] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å’Œ`.travis.yml` :

```
language: rust

rust:
  - stable
  - beta
  - nightly

script: |
  cargo build --verbose &&
  cargo test  --verbose &&
  cargo doc   --verbose

branches:
  only:
    - staging # bors r+
    - trying  # bors try
    - master 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸è¦å¿˜è®°ä¸ºå­˜å‚¨åº“å¯ç”¨ Travis å’Œ Bors(æˆ‘å·²ç»å¯ç”¨äº†)ï¼Œç„¶å[å‘é€ä¸€ä¸ª PR](https://github.com/CAD97/great-ci/pull/2) ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ çš„ CI æ˜¯ç»¿è‰²çš„ï¼Œå¯ä»¥å’Œ`bors r+`åˆå¹¶ã€‚

## [](#testing-rustfmt-and-clippy)æµ‹è¯• rustfmt å’Œ clippy

å½“ä½ åœ¨å¤„ç†ä¸€ä¸ªä½ æœŸæœ›å˜å¤§çš„é¡¹ç›®æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ‰§è¡Œæ ‡å‡†æ ¼å¼ï¼Œclippy åœ¨é˜²æ­¢ç®€å•é”™è¯¯å’Œè®©äººä»¬è¿œç¦»æœ‰é—®é¢˜çš„ API å†³ç­–æ–¹é¢æœ‰ç€æƒŠäººçš„è¡¨ç°ã€‚

å› ä¸º rustfmt å’Œ clippy æœ‰äº›ä¸ç¨³å®šï¼Œéœ€è¦æŸäº›å°èŒƒå›´çš„å¤œé—´ç¼–è¯‘å™¨ï¼Œæœ‰æ—¶ä¼šä¸­æ–­ï¼Œå¹¶ä¸”æ›´æ”¹é»˜è®¤æ ¼å¼æˆ–æ·»åŠ  lints å¯èƒ½ä¼šä¸­æ–­æ‚¨çš„æ„å»ºï¼Œæˆ‘ä»¬ä¾èµ–äºå·¥å…·çš„ç‰¹å®šç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ–°ç‰ˆæœ¬ã€‚

æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåŒ…å« Travis ä¸Šçš„çš„[çŸ©é˜µæ¥æ·»åŠ æ”¯ç¥¨:](https://docs.travis-ci.com/user/customizing-the-build/#Explicitly-Including-Jobs) 

```
cache: cargo
matrix:
  include:
    - rust: nightly-2018-01-12
      env: # use env so updating versions causes cache invalidation
        - CLIPPY_VERSION=0.0.179
      before_script:
        - rustup component add rustfmt-preview
        - cargo install clippy --version $CLIPPY_VERSION || echo "clippy already installed"
      script:
        - cargo fmt -- --write-mode=diff
        - cargo clippy -- -D clippy 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨`cargo install`å®‰è£… clippyï¼Œå¦‚æœå·²ç»å®‰è£…ï¼Œåˆ™æˆåŠŸå®‰è£…ã€‚æˆ‘ä»¬ä½¿ç”¨ rustup å®‰è£… rustfmtï¼Œå› ä¸ºåœ¨ Travis çš„ Rust è®¾ç½®ä¸­ï¼Œrustfmt å·²ç»è¢« rustup è·Ÿè¸ªï¼Œæ‰€ä»¥`cargo-fmt`å¯æ‰§è¡Œæ–‡ä»¶å­˜åœ¨ï¼Œæ²¡æœ‰`--force`çš„å®‰è£…ä¼šå¤±è´¥ã€‚å¦‚æœæˆ‘ä»¬ä¸é€‰æ‹©ä¸€ä¸ªçœŸæ­£åŒ…å«`cargo-fmt`çš„å¤œé—´å·¥å…·é“¾ï¼Œä½¿ç”¨å®ƒå°†ä¼šå¤±è´¥ã€‚è¿™é‡Œæˆ‘ä»¬æœ‰`rust: nightly-2018-01-12 CLIPPY_VERSION=0.0.179`,å› ä¸ºè¿™æ˜¯ rustfmt-preview æ‰€åœ¨çš„æœ€æ–°å·¥å…·é“¾ï¼Œä¹Ÿæ˜¯æ¯æ™šæ„å»ºçš„ clippy çš„æœ€æ–°ç‰ˆæœ¬ã€‚

å®‰è£…åƒ rustfmt å’Œ clippy è¿™æ ·çš„å·¥å…·éœ€è¦æ—¶é—´ï¼Œè€Œ CI åœ¨å®ƒ*å¿«*çš„æ—¶å€™å˜å¾—å¾ˆæ£’ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ç”¨ [Travis çš„ Rust Cargo cache](https://docs.travis-ci.com/user/caching/#Rust-Cargo-cache) æ¥ç¼“å­˜è´§ç‰©çš„ç¬¦å·ã€‚è¿™åŠ å¿«äº†æ„å»ºçš„é€Ÿåº¦ï¼Œå› ä¸º cargo ä¸éœ€è¦é‡æ–°ç¼–è¯‘ä¾èµ–é¡¹ï¼Œä¸ç®¡å®ƒä»¬æ˜¯æ„å»ºä¾èµ–é¡¹è¿˜æ˜¯å·¥å…·ã€‚

ç¼“å­˜ç”±è¯­è¨€ç‰ˆæœ¬(è¿™é‡Œæ˜¯`rust: nightly-2018-01-18`)å’Œ env(è¿™é‡Œæ˜¯`CLIPPY_VERSION=0.0.180`)å†³å®šï¼Œå¹¶ä¸”åœ¨å…·æœ‰ç›¸åŒ rust ç‰ˆæœ¬å’Œ env çš„æ„å»ºä½œä¸šä¹‹é—´å…±äº«ã€‚é€šè¿‡å°† clippy çš„ç‰ˆæœ¬æ”¾åœ¨ env ä¸­ï¼Œæˆ‘ä»¬å°†å·¥å…·æ„å»ºçš„ç¼“å­˜ä¸å…¶ä»–ç¼“å­˜åˆ†å¼€ï¼Œå¹¶ç¡®ä¿ç‰ˆæœ¬æ›´æ–°ä¼šå¯¼è‡´é‡æ–°æ„å»ºã€‚

æ‚¨å¯èƒ½æƒ³å°†è¿™äº›ç¯å¢ƒå˜é‡æ”¾åœ¨ CI é…ç½®ä¸­ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æ›´æ–°å®ƒä»¬ï¼Œè€Œæ— éœ€é¢å¤–æäº¤åˆ°å­˜å‚¨åº“ã€‚è¿™æ˜¯ä¸æ˜æ™ºçš„ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦åŸå› ã€‚é¦–å…ˆï¼Œç‰ˆæœ¬ç¢°æ’è¿™äº›å·¥å…·å¾ˆæœ‰å¯èƒ½æ”¹å˜æ‚¨çš„æ„å»ºéœ€æ±‚ï¼Œå¹¶ä¸”ä¼šçªç„¶å‡ºç°é—®é¢˜ã€‚è¿™ç§å˜åŒ–åº”è¯¥åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­è¿›è¡Œæ ‡è®°ã€‚å…¶æ¬¡ï¼Œåœ¨è¿™é‡Œä½¿ç”¨ env ä¹Ÿæ˜¯ä¸ºäº†å°†è¿™äº›å·¥å…·çš„ç¼“å­˜ä¸å…¶ä»–ç¼“å­˜åˆ†å¼€ã€‚å¦‚æœæŒ‡å®šçš„ rust ç‰ˆæœ¬æ˜¯æ¯å¤œæœ€æ–°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªç¼“å­˜å’Œæ¯å¤œç¼“å­˜ä¼šäº’ç›¸ç¢°æ’ã€‚ä½ ä¹Ÿä¸æƒ³åœ¨ä¸éœ€è¦çš„ CI æ„å»ºä¸Šå¼ºåˆ¶å®‰è£…è¿™äº›å·¥å…·ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦é‚£äº›*çµæ´»*çš„ CI ç»¿è‰²ã€‚

æ‰€ä»¥åšå‡ºè¿™äº›æ”¹å˜ï¼Œ[æäº¤ä¸€ä»½ PR](https://github.com/CAD97/great-ci/pull/3) ï¼Œæˆ‘ä»¬å¼€å§‹æœ€åä¸€æ­¥ï¼

## [](#using-cargotravis)åˆ©ç”¨è´§ç‰©-ç‰¹æ‹‰ç»´æ–¯

Cargo-travis ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾ä½¿ç”¨ [kcov](https://github.com/SimonKagstrom/kcov) å¹¶å°†è¦†ç›–ä¿¡æ¯ä¸Šä¼ åˆ° codecov æˆ–å·¥ä½œæœã€‚æ­¤å¤–ï¼Œæˆ‘æœ€è¿‘æ·»åŠ çš„ï¼Œå®ƒå…è®¸æ‚¨å°†æ‚¨çš„æ¿æ¡ç®±çš„æ–‡æ¡£ä¸Šä¼ åˆ° GitHub é¡µé¢ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªå¯ç†è§£çš„ git å†å²å’Œç›®å½•ç»“æ„ï¼Œå…è®¸æ‚¨è®°å½•å¤šä¸ªåˆ†æ”¯(`master` / `beta` / `release`åˆ†æ”¯ï¼Œä»¥æ¨¡ä»¿ Rust çš„`nightly` / `beta` / `stable`åˆ—è½¦)ï¼Œå¦‚æœæ‚¨æ„¿æ„çš„è¯ã€‚

å› ä¸ºè¿™äº›ä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¹¶ä¸”æ›´å¤šçš„æ˜¯ä¸ºäº†é€šçŸ¥å†³ç­–è€Œä¸æ˜¯ç¡¬å…³ PRsï¼Œæ‰€ä»¥æˆ‘å°†è¿™äº›æ”¾å…¥æˆ‘çš„æ„å»ºçš„å…è®¸å¤±è´¥çŸ©é˜µè¡Œä¸­ã€‚è¿™æ„å‘³ç€ Travis åœ¨ä¸Šè¿°å››ä¸ªä½œä¸šé€šè¿‡åç«‹å³é€šè¿‡(`rust: [stable, beta, nightly]`ã€rustfmt & clippy)ï¼Œå¹¶å…è®¸ cargo-travis ä½œä¸šç»§ç»­åœ¨åå°è¿è¡Œã€‚

æˆ‘ä»¬çš„`.travis.yml`æ–°å¢:

```
env: # required for allow_failures
matrix:
  fast_finish: true
  allow_failures:
    - env: NAME='cargo-travis'
  include:
    - env: NAME='cargo-travis'
      sudo: required # travis-ci/travis-ci#9061
      before_script:
        - cargo install cargo-update || echo "cargo-update already installed"
        - cargo install cargo-travis || echo "cargo-travis already installed"
        - cargo install-update -a
      script:
        - |
          cargo build    --verbose &&
          cargo coverage --verbose &&
          bash <(curl -s https://codecov.io/bash) -s target/kcov
        - |
          cargo doc --verbose &&
          cargo doc-upload
      addons: # required for kcov
        apt:
          packages:
            - libcurl4-openssl-dev
            - libelf-dev
            - libdw-dev
            - binutils-dev
            - cmake 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœè¦ç”¨å·¥ä½œæœï¼Œç”¨`cargo coveralls`ä»£æ›¿`cargo coverage`å°±è¡Œäº†ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨ Codecovï¼Œåªéœ€åˆ é™¤ Codecov bash è„šæœ¬è¡Œã€‚

ç„¶è€Œï¼Œè¿™å¯¹äº`doc-upload`ä»»åŠ¡æ¥è¯´è¿˜ä¸å¤Ÿ(å°½ç®¡è¿™ä¸ª*ä¸ä¼š*è®©ä½ çš„ CI å˜çº¢ï¼Œå› ä¸ºæˆ‘ä»¬å…è®¸è¿™ä¸ªä»»åŠ¡å¤±è´¥)ã€‚ä¸ºäº†ä¸Šä¼ æ–‡æ¡£ï¼Œ`doc-upload`è„šæœ¬éœ€è¦è·å¾—æƒé™æ‰èƒ½æ¨é€åˆ°æ‚¨çš„ GitHub å­˜å‚¨åº“ã€‚æœ€ç®€å•çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ª [GitHub ä»¤ç‰Œ](https://github.com/blog/1509-personal-api-tokens)ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨ [cargo-travis README](https://github.com/roblabla/cargo-travis#doc-upload) ä¸Šé˜…è¯»æ›´å¤šå…³äºè¿™ä¸ªé€‰é¡¹çš„ä¿¡æ¯ã€‚

ä¸ºäº†ç”Ÿæˆ GitHub ä»¤ç‰Œï¼Œè¯·å¯¼èˆªåˆ°[æ‚¨çš„ä»¤ç‰Œè®¾ç½®é¡µé¢](https://github.com/settings/tokens)ã€‚å½“ä½ åœ¨é‚£é‡Œæ—¶ï¼Œæ£€æŸ¥ä½ å½“å‰å‘è¡Œçš„ä»¤ç‰Œï¼Œå¹¶æ’¤é”€é‚£äº›ä½ ä¸å†ä½¿ç”¨çš„ä»¤ç‰Œã€‚ç”Ÿæˆä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œç»™å®ƒä¸€ä¸ªæè¿°æ€§çš„åå­—(è¿™ä¸ªå¯ä»¥ç¨åç¼–è¾‘)(æˆ‘å»ºè®®ç”¨`repo-name-doc-upload`)å’Œ`public_repo`ä½œç”¨åŸŸ(è¿™ä¸ªå¯ä»¥ç¨åç¼–è¾‘)ã€‚è¯·ç¡®ä¿åœ¨ç”Ÿæˆä»¤ç‰Œåå¤åˆ¶å®ƒï¼Œå› ä¸ºæ‚¨å°†å†ä¹Ÿçœ‹ä¸åˆ°å®ƒäº†(å°½ç®¡æ‚¨å¯ä»¥é‡æ–°ç”Ÿæˆå®ƒ)ï¼è¿™ä¸ªä»¤ç‰Œå…è®¸ä»»ä½•æ‹¥æœ‰ä»¤ç‰Œçš„äººåœ¨è¯»/å†™æ‚¨æœ‰æƒé™è¯»/å†™çš„ä»»ä½•å…¬å…±å­˜å‚¨åº“æ—¶å……å½“æ‚¨çš„è§’è‰²ï¼Œæ‰€ä»¥è¦ä¿è¯å®ƒçš„å®‰å…¨ã€‚å°†å…¶æ·»åŠ åˆ° Travis ä¸Šçš„`GH_TOKEN`ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶*ç¡®ä¿â€œåœ¨æ„å»ºæ—¥å¿—ä¸­æ˜¾ç¤ºå€¼â€è®¾ç½®ä¸º off* ã€‚

[![Environment Variables](../Images/b839bbc2421c5c53a10de1d084a24ffa.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--T6pIP9Lr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://imgur.com/kfu4hgY.png)

ä¸€æ—¦ä½ å‘å‡ºä½ çš„ç®€å†ï¼Œæ–°çš„å·¥ä½œå°±ä¼šå¼€å§‹ã€‚

å…³äºæ­¤è®¾ç½®ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:

*   CI å°†åœ¨è¦†ç›–å®Œæˆä¹‹å‰é€šè¿‡ã€‚è¿™æ˜¯æœ‰æ„çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°æµ‹è¯•é€šè¿‡/å¤±è´¥çš„å¿«é€Ÿ CI åé¦ˆï¼Œå¹¶ä¸”è¦†ç›–ç‡ä¸éœ€è¦å‡ç¼“ PRs çš„åé¦ˆå¾ªç¯(æˆ–è€…èŠ±è´¹åœ¨`bors r+`å’Œåˆå¹¶ä¸Šçš„æ—¶é—´)ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶å¸Œæœ›çœ‹åˆ°è¿™äº›ç»Ÿè®¡æ•°æ®ï¼ŒCodecov/workalls ä»ç„¶ä¼šè¿›è¡Œåˆ†æï¼Œå¹¶åœ¨è¦†ç›–ä¿¡æ¯ä¸Šä¼ åå‘è¡¨è¯„è®ºã€‚
*   ç¬¬ä¸€æ¬¡ä¼šèŠ±å¾ˆé•¿æ—¶é—´ï¼›ä½ è¦æ„å»ºå¤§é‡çš„å·¥å…·ï¼ŒåŒ…æ‹¬ kcov æœ¬èº«ã€‚ç„¶è€Œï¼Œå¸Œæœ›æ‰€æœ‰è¿™äº›éƒ½è¢«ç¼“å­˜ï¼Œè¿™æ ·åç»­çš„æ„å»ºä¼šå¿«å¾—å¤šã€‚
*   å½“ CI ä»…æ„å»ºä¸»åˆ†æ”¯æ—¶ï¼Œå°†æ„å»ºæ–‡æ¡£ã€‚æ‚¨å¯ä»¥é€šè¿‡å‘`cargo doc-upload`ä¼ é€’(å¯é€‰å¤šä¸ª)`--branch NAME`å‚æ•°æ¥æŒ‡å®šè¦æ„å»ºçš„åˆ†æ”¯ã€‚
*   `doc-upload` *ä¸ä¼š*ä¸ºä½ å»ºç«‹æ–‡æ¡£ï¼Œæ‰€ä»¥ä½ éœ€è¦è‡ªå·±è°ƒç”¨`cargo doc`ã€‚è¿™æ ·ï¼Œå¦‚æœä½ çš„åº“æä¾›äº†ç‰¹æ€§æ ‡å¿—æˆ–å…¶ä»–æ¡ä»¶ç¼–è¯‘ï¼Œä½ å°±å¯ä»¥åœ¨`target/doc` (rustdoc çš„è¾“å‡ºç›®å½•)ä¸­å»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œç„¶å`doc-upload`å°†åœ¨ä¸Šä¼ åˆ° GitHub é¡µé¢æ—¶ä½¿ç”¨è¿™ä¸ªç›®å½•ã€‚
*   æ–‡æ¡£åœ¨`https://<user>.github.io/<repo>/<branch>/<crate>/`ç»“æŸï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯[https://cad97.github.io/great-ci/master/great_ci/](https://cad97.github.io/great-ci/master/great_ci/)ã€‚
*   [è¦†ç›–ç‡ä¸º 100%](https://codecov.io/gh/CAD97/great-ci) ğŸ‰

## [](#further-extensions)è¿›ä¸€æ­¥æ‰©å±•

å¦‚æœä½ æƒ³(æˆ–è€…éœ€è¦)åœ¨ Windows å¹³å°ä¸Šæµ‹è¯•ï¼Œç»å¸¸ä½¿ç”¨ [AppVeyor](https://www.appveyor.com/) ã€‚è¿™ä¸ªé…ç½®é¡¹å¯ä»¥ä¸è¿™ä¸ª Travis è®¾ç½®å¹¶è¡Œä½¿ç”¨ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä¸€å®šè¦å‘Šè¯‰ Bors ç­‰å¾… AppVeyor æ„å»ºï¼

ä¸è¦å¿˜è®°ï¼Œå¦‚æœæ‚¨ä¸å¸Œæœ› rustfmt å’Œ clippy è­¦å‘Šåº”ç”¨äºæŸäº›ä»£ç å—ï¼Œæ‚¨å¯ä»¥å–æ¶ˆå®ƒä»¬ã€‚å¦‚æœæ˜¯æºåº“ä¸­çš„é—®é¢˜ï¼Œæäº¤ä¸€ä¸ªé—®é¢˜ï¼Œæˆ–è€…å¦‚æœåªæ˜¯ä¸ä¸€è‡´ï¼Œæ£€æŸ¥é…ç½®ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥åœ¨é‚£é‡Œæ›´æ”¹ã€‚

å¯¹äºæ³¨é‡å®‰å…¨çš„äººæ¥è¯´ï¼ŒGitHub ä»¤ç‰Œçš„`public_repo`èŒƒå›´å¯èƒ½å¤ªå¹¿äº†ã€‚è¿™æ˜¯ä¸€ä¸ªå·²ç»è§£å†³çš„é—®é¢˜ï¼›è§£å†³æ–¹æ¡ˆæ˜¯ç‰¹å®šäºå›è´­çš„éƒ¨ç½²å¯†é’¥ã€‚å¦‚æœæ‚¨ä¸ºæ‚¨çš„å­˜å‚¨åº“æä¾›äº†ä¸€ä¸ªéƒ¨ç½²å¯†é’¥ï¼Œå¹¶å°†å…¶åŠ è½½åˆ° Travis ä¸­(å¹¶ä¸”æ²¡æœ‰æä¾›ä»¤ç‰Œ)ï¼Œ`doc-upload`å°†ä¼šä½¿ç”¨å®ƒã€‚

æ‚¨å·²ç»å»ºç«‹äº† CIï¼Œåœ¨æ‚¨çš„è‡ªè¿°æ–‡ä»¶ä¸­ä½¿ç”¨å¾½ç« å’ŒåµŒå…¥è¦†ç›–ç‡å›¾è¡¨æ¥å¹å˜˜å®ƒå§ï¼ [Shields|IO](https://shields.io/) ä¸ºå‡ ä¹æ‰€æœ‰æœåŠ¡æä¾›é£æ ¼ä¸€è‡´çš„å¾½ç« ï¼Œè€Œ [Codecov graphs](https://codecov.io/gh/CAD97/great-ci/branch/master/graphs) åˆ™æ˜¯ğŸ”¥ğŸ”¥ğŸ”¥ã€‚

ä½ çš„ GitHub é¡µé¢çš„åŸºç¡€é¡µé¢(`<user>.github.io/<repo>/`)å°†ä¼šè½¬åˆ° 404ï¼Œå› ä¸ºåœ¨ä½ çš„`gh-pages`åˆ†æ”¯çš„æ ¹ä¸­ä¸å­˜åœ¨`index.html`ã€‚å¯¹äºåˆ†æ”¯æ ¹(`<user>.gihub.io/<repo>/<branch>`)ä¹Ÿæ˜¯å¦‚æ­¤ã€‚`doc-upload`æ•…æ„ä¸å¼„ä¹±ä½ çš„æ ¹ç›®å½•æˆ–åˆ†æ”¯æ ¹å¤„çš„`index.html`ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨è¿™äº›åœ°æ–¹åŒ…å«ä¸€ä¸ª HTML é‡å®šå‘ï¼Œæˆ–è€…å¦‚æœä½ æ„¿æ„çš„è¯åŒ…å«ä¸€ä¸ªæ›´æœ‰ä¿¡æ¯çš„ç´¢å¼•ã€‚å¯¹äº HTML é‡å®šå‘ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç :

```
<meta http-equiv="refresh" content="0; url=<crate>">
<a href="<crate>">Redirect</a> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[åœ¨ Reddit](https://redd.it/7rnyg8) ä¸Šè®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå‘Šè¯‰æˆ‘æˆ‘æ˜¯å¦é—æ¼äº†ä»€ä¹ˆæˆ–è€…ä»€ä¹ˆä¸œè¥¿è¿‡æ—¶äº†ï¼

[å‚è§ GitHub ä¸Šçš„å…¬å…±çŸ¥è¯†åº“ï¼](https://github.com/CAD97/great-ci)