# ä»‹ç»æ³¢å°”å¡:ä¸€ä¸ªå¾®å‹ç½‘ç»œæœåŠ¡å™¨ã€‚

> åŸæ–‡:[https://dev . to/kvng _ zeez/introducing-polka-a-micro-web-server-3p 55](https://dev.to/kvng_zeez/introducing-polka-a-micro-web-server-3p55)

[![polka](../Images/3f954ed3b9c261d05e2a3d407bd61dc8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--gLlb2R-x--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qz07w2nqfdarbkbpfs93.png)

# [](#what-is-polka-)ä»€ä¹ˆæ˜¯æ³¢å°”å¡ï¼Ÿ

æ³¢å°”å¡æ˜¯ä¸€ç§æå…¶ç®€çº¦ã€é«˜æ€§èƒ½çš„ Express.js æ›¿ä»£æ–¹æ¡ˆã€‚

## [](#installation)å®‰è£…ã€‚

```
npm i --save polka 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#usage)ç”¨æ³•

åœ¨è·¯ç”±å’Œ API è°ƒç”¨æ–¹é¢ï¼ŒPolka ä¸ ExpressJS æœ‰ç›¸ä¼¼çš„æ¨¡å¼ã€‚

### [](#simple-example)ç®€å•çš„ä¾‹å­ã€‚

```
const polka = require('polka');

polka()
  .get('/', (req, res) => {
      res.end('Hello there !');
  })
  .listen(9000).then(_ => {
    console.log(`> Running on localhost:3000`);
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#polkas-api)æ³¢å°”å¡çš„ API

æ³¢å°”å¡æœ‰å››ä¸ªä¸»è¦çš„ API æ–¹æ³•ã€‚

*   **æ³¢å°”å¡(é€‰é¡¹)** -è¿”å›æ³¢å°”å¡çš„ä¸€ä¸ªå®ä¾‹ã€‚
*   **ä½¿ç”¨(åŸºç¡€ã€..fn)**
*   **parse(req)**
*   **ç›‘å¬(ç«¯å£ï¼Œä¸»æœºå)**
*   **å¤„ç†ç¨‹åº(è¯·æ±‚ã€ç»“æœã€å·²è§£æ)**

## [](#routing-with-polka)ç”¨æ³¢å°”å¡è·¯ç”±ã€‚

è·¯ç”±ç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºå¦‚ä½•å“åº”ä¸åŒçš„ HTTP æ–¹æ³•å’Œç«¯ç‚¹ã€‚

### [](#basics)åŸºç¡€çŸ¥è¯†

æ¯æ¡è·¯çº¿éƒ½ç”±ä¸€ä¸ª[è·¯å¾„æ¨¡å¼](#patterns)ã€ä¸€ä¸ª [HTTP æ–¹æ³•](#methods)å’Œä¸€ä¸ª[å¤„ç†ç¨‹åº](#handlers)(ä¹Ÿå°±æ˜¯æ‚¨æƒ³è¦åšçš„äº‹æƒ…)ç»„æˆã€‚

åœ¨ä»£ç ä¸­ï¼Œè¿™çœ‹èµ·æ¥åƒ:

```
app.METHOD(pattern, handler); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¶ä¸­:

*   `app`æ˜¯`polka`çš„å®ä¾‹* `method`æ˜¯ä»»ä½•æœ‰æ•ˆçš„ HTTP æ–¹æ³•ï¼Œå°å†™
*   `pattern`æ˜¯ä¸€ä¸ªè·¯ç”±æ¨¡å¼(å­—ç¬¦ä¸²)
*   `handler`æ˜¯åŒ¹é…`pattern`æ—¶è¦æ‰§è¡Œçš„åŠŸèƒ½

æ­¤å¤–ï¼Œå•ä¸ªè·¯å¾„å(æˆ–`pattern`)å¯ä»¥åœ¨å¤šç§æ–¹æ³•ä¸­é‡å¤ä½¿ç”¨ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†ä¸€äº›ç®€å•çš„è·¯ç”±ã€‚

```
const app = polka();

app.get('/', (req, res) => {
  res.end('Hello world!');
});

app.get('/users', (req, res) => {
  res.end('Get all users!');
});

app.post('/users', (req, res) => {
  res.end('Create a new User!');
});

app.put('/users/:id', (req, res) => {
  res.end(`Update User with ID of ${req.params.id}`);
});

app.delete('/users/:id', (req, res) => {
  res.end(`CY@ User ${req.params.id}!`);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#patterns)å›¾æ¡ˆ

ä¸éå¸¸æµè¡Œçš„ [`path-to-regexp`](https://github.com/pillarjs/path-to-regexp) ä¸åŒï¼Œæ³¢å°”å¡ä½¿ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒæ¥å®šä½è·¯çº¿åŒ¹é…ã€‚è™½ç„¶[æ›´å¿«](https://github.com/lukeed/matchit#benchmarks)æ›´é«˜æ•ˆ&æ›´å†…å­˜ï¼Œè¿™ä¹Ÿç¡®å®é˜²æ­¢äº†å¤æ‚çš„æ¨¡å¼åŒ¹é…ã€‚

ä½†æ˜¯ï¼Œä¸è¦å®³æ€•ï¼ğŸ’¥æ”¯æŒæ‰€æœ‰åŸºæœ¬çš„å’Œæœ€å¸¸ç”¨çš„æ¨¡å¼ã€‚æ‚¨å¯èƒ½åªåœ¨ç¬¬ä¸€æ—¶é—´ä½¿ç”¨è¿‡è¿™äº›æ¨¡å¼ã€‚ğŸ˜‰

> æ³¢å°”å¡ä¸æ”¯æŒçš„åŸºäº`RegExp`çš„æ¨¡å¼åˆ—è¡¨è§ [`comparison`](#comparions) ã€‚

æ”¯æŒçš„æ¨¡å¼ç±»å‹æœ‰:

*   é™æ€(`/users`)
*   å‘½åå‚æ•°(`/users/:id`)
*   åµŒå¥—å‚æ•°(`/users/:id/books/:title`)
*   å¯é€‰å‚æ•°(`/users/:id?/books/:title?`)
*   ä»»ä½•åŒ¹é…/é€šé…ç¬¦(`/users/*`)

### [](#parameters)å‚æ•°

è·¯çº¿`pattern`ä¸­åŒ…å«çš„ä»»ä½•å‘½åå‚æ•°å°†è‡ªåŠ¨æ·»åŠ åˆ°æ‚¨çš„ä¼ å…¥`req`å¯¹è±¡ä¸­ã€‚æ‰€æœ‰çš„å‚æ•°éƒ½å°†åœ¨`req.params`ä¸­æ‰¾åˆ°ï¼Œå¹¶ä»¥ç›¸åŒçš„åå­—å‘½åã€‚

> **é‡è¦æç¤º:**æ‚¨çš„å‚æ•°åç§°åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºå…±äº«åç§°ä¼šç›¸äº’è¦†ç›–ï¼

```
app.get('/users/:id/books/:title', (req, res) => {
  let { id, title } = req.params;
  res.end(`User: ${id} && Book: ${title}`);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
$ curl /users/123/books/Narnia
#=> User: 123 && Book: Narnia 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#methods)æ–¹æ³•

æ”¯æŒä»»ä½•æœ‰æ•ˆçš„ HTTP æ–¹æ³•ï¼ç„¶è€Œï¼Œå‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæœ¬æ–‡ä¸­åªä½¿ç”¨äº†æœ€å¸¸è§çš„æ–¹æ³•ã€‚

> **æ³¨:**æœ‰æ•ˆæ–¹æ³•çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§[è¯¥åˆ—è¡¨](http://expressjs.com/en/4x/api.html#routing-methods)ã€‚

## [](#handlers)ç»æ‰‹äºº

è¯·æ±‚å¤„ç†è€…æ¥å—ä¼ å…¥çš„ [`ClientRequest`](https://nodejs.org/dist/latest-v9.x/docs/api/http.html#http_class_http_clientrequest) å’Œåˆ¶å®šçš„ [`ServerResponse`](https://nodejs.org/dist/latest-v9.x/docs/api/http.html#http_class_http_serverresponse) ã€‚

æ¯ä¸ªè·¯ç”±å®šä¹‰å¿…é¡»åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„`handler`å‡½æ•°ï¼Œå¦åˆ™åœ¨è¿è¡Œæ—¶å°†ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

> **é‡è¦:**ä½ å¿…é¡»*æ°¸è¿œ*ç»ˆæ­¢ä¸€ä¸ª`ServerResponse`ï¼

è¿™æ˜¯ä¸€ä¸ª**éå¸¸å¥½çš„**å®è·µï¼Œåœ¨ä¸€ä¸ªå¤„ç†ç¨‹åºä¸­*æ€»æ˜¯*ç»ˆæ­¢ä½ çš„å“åº”( [`res.end`](https://nodejs.org/api/http.html#http_request_end_data_encoding_callback) )ï¼Œå³ä½¿ä½ æœŸæœ›ä¸€ä¸ªä¸­é—´ä»¶ä¸ºä½ åšè¿™ä»¶äº‹ã€‚å¦‚æœå“åº”è¢«ç»ˆæ­¢/æœªè¢«ç»ˆæ­¢ï¼ŒæœåŠ¡å™¨å°†æŒ‚èµ·&å¹¶æœ€ç»ˆé€€å‡ºï¼Œå‡ºç°`TIMEOUT`é”™è¯¯ã€‚

> **æ³¨æ„:**è¿™æ˜¯ä¸€ç§æœ¬åœŸçš„`http`è¡Œä¸ºã€‚

#### [](#async-handlers)å¼‚æ­¥å¤„ç†å™¨

å¦‚æœä½¿ç”¨ Node 7.4 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨æœ¬æœºçš„`async`å’Œ`await`è¯­æ³•ï¼ğŸ˜»

ä¸éœ€è¦ç‰¹åˆ«çš„å‡†å¤‡â€”åªéœ€æ·»åŠ é€‚å½“çš„å…³é”®å­—ã€‚

```
const app = polka();

const sleep = ms => new Promise(r => setTimeout(r, ms));

async function authenticate(req, res, next) {
  let token = req.getHeader('authorization');
  if (!token) return app.send(res, 401);
  req.user = await Users.find(token); // <== fake
  next(); // done, woot!
}

app
  .use(authenticate)
  .get('/', async (req, res) => {
    // log middleware's findings
    console.log('~> current user', req.user);
    // force sleep, because we can~!
    await sleep(500);
    // send greeting
    res.end(`Hello, ${req.user.name}`);
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#middleware)ä¸­é—´ä»¶

ä¸­é—´ä»¶æ˜¯è¿è¡Œåœ¨æ¥æ”¶è¯·æ±‚å’Œæ‰§è¡Œè·¯ç”±çš„`handler`å“åº”ä¹‹é—´çš„åŠŸèƒ½ã€‚

> ä»å¿«é€’è¿‡æ¥çš„ï¼Ÿä½¿ç”¨ä»»ä½•ä½ å·²ç»çŸ¥é“å’Œå–œæ¬¢çš„ä¸­é—´ä»¶ï¼ğŸ‰

ä¸­é—´ä»¶ç­¾åæ¥æ”¶è¯·æ±‚(`req`)ã€å“åº”(`res`)å’Œå›è°ƒ(`next`)ã€‚

è¿™äº›å¯ä»¥å¯¹`req`å’Œ`res`å¯¹è±¡åº”ç”¨çªå˜ï¼Œå¹¶ä¸”ä¸ Express ä¸åŒï¼Œå¯ä»¥è®¿é—®`req.params`ã€`req.pathname`ã€`req.search`å’Œ`req.query`ï¼

æœ€é‡è¦çš„æ˜¯ï¼Œä¸€ä¸ªä¸­é—´ä»¶ ***å¿…é¡»*** è¦ä¹ˆè°ƒç”¨`next()`ï¼Œè¦ä¹ˆç»ˆæ­¢å“åº”(`res.end`)ã€‚åšä¸åˆ°è¿™ä¸€ç‚¹å°†å¯¼è‡´æ°¸æ— æ­¢å¢ƒçš„å›åº”ï¼Œæœ€ç»ˆå¯¼è‡´`http.Server`å´©æºƒã€‚

```
// Log every request
function logger(req, res, next) {
  console.log(`~> Received ${req.method} on ${req.url}`);
  next(); // move on
}

function authorize(req, res, next) {
  // mutate req; available later
  req.token = req.getHeader('authorization');
  req.token ? next() : ((res.statusCode=401) && res.end('No token!'));
}

polka().use(logger, authorize).get('*', (req, res) => {
  console.log(`~> user token: ${req.token}`);
  res.end('Hello, valid user');
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
$ curl /
# ~> Received GET on /
#=> (401) No token!

$ curl -H "authorization: secret" /foobar
# ~> Received GET on /foobar
# ~> user token: secret
#=> (200) Hello, valid user 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ Polka ä¸­ï¼Œä¸­é—´ä»¶åŠŸèƒ½æ˜¯å…¨å±€å®‰è£…çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å°†æ ¹æ®æ¯ä¸ªè¯·æ±‚è¿è¡Œã€‚ç›¸åï¼Œæ‚¨å¿…é¡»åº”ç”¨å†…éƒ¨è¿‡æ»¤å™¨æ¥å†³å®šæ‚¨çš„ä¸­é—´ä»¶åº”è¯¥åœ¨ä½•æ—¶ä½•åœ°è¿è¡Œã€‚

> æ³¨æ„:è¿™å¯èƒ½ä¼šåœ¨æ³¢å°”å¡ 1.0 ä¸­æ”¹å˜ğŸ¤”

```
function foobar(req, res, next) {
  if (req.pathname.startsWith('/users')) {
    // do something magical
  }
  next();
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#middleware-errors)ä¸­é—´ä»¶é”™è¯¯

å¦‚æœä¸­é—´ä»¶å‡ºç°é”™è¯¯ï¼Œå°†é€€å‡ºå¾ªç¯ã€‚è¿™æ„å‘³ç€æ²¡æœ‰å…¶ä»–ä¸­é—´ä»¶ä¼šæ‰§è¡Œ&è·¯ç”±å¤„ç†ç¨‹åºä¹Ÿä¸ä¼šã€‚

ç±»ä¼¼åœ°ï¼Œä¸ç®¡`statusCode`å¦‚ä½•ï¼Œæå‰å“åº”ç»ˆæ­¢ä¹Ÿå°†é€€å‡ºå¾ªç¯&ï¼Œé˜»æ­¢è·¯ç”±å¤„ç†å™¨è¿è¡Œã€‚

æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥ä»ä¸­é—´ä»¶å‡½æ•°ä¸­â€œæŠ›å‡ºâ€é”™è¯¯ã€‚

> **æç¤º:**éƒ½ä¸ç”¨`throw`

1.  * *å°†ä»»ä½•å­—ç¬¦ä¸²ä¼ é€’ç»™`next()` **

    è¿™å°†é€€å‡ºå¾ªç¯å¹¶å‘é€ä¸€ä¸ª`500`çŠ¶æ€ä»£ç ï¼Œä»¥æ‚¨çš„é”™è¯¯å­—ç¬¦ä¸²ä½œä¸ºå“åº”ä½“ã€‚

```
 polka()
      .use((req, res, next) => next('ğŸ’©'))
      .get('*', (req, res) => res.end('wont run')); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
 $ curl /
    #=> (500) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  **ä¼ ä¸€ä¸ª`Error`åˆ°`next()`T3ã€‘**

    è¿™ç±»ä¼¼äºä¸Šé¢çš„é€‰é¡¹ï¼Œä½†æ˜¯ç»™ä½ ä¸€ä¸ªçª—å£å°†`statusCode`æ”¹å˜ä¸ºé»˜è®¤çš„`500`ä»¥å¤–çš„å€¼ã€‚

```
function oopsies(req, res, next) {
  let err = new Error('Try again');
  err.code = 422;
  next(err);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
 $ curl /
    #=> (422) Try again 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  **æå‰ç»ˆæ­¢å“åº”**

    ä¸€æ—¦å“åº”ç»“æŸï¼Œå°±æ²¡æœ‰ç†ç”±ç»§ç»­å¾ªç¯ï¼

    è¿™ç§æ–¹æ³•æ˜¯æœ€é€šç”¨çš„ï¼Œå› ä¸ºå®ƒå…è®¸æ§åˆ¶ä¼ å‡º`res`çš„æ¯ä¸ªæ–¹é¢ã€‚

```
 function oopsies(req, res, next) {
      if (true) {
        // something bad happened~
        res.writeHead(400, {
          'Content-Type': 'application/json',
          'X-Error-Code': 'Please dont do this IRL'
        });
        let json = JSON.stringify({ error:'Missing CSRF token' });
        res.end(json);
      } else {
        next(); // never called FYI
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
$ curl /
    #=> (400) {"error":"Missing CSRF token"} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#benchmarks)åŸºå‡†

ä¸€è½®è·¨ä¸åŒèŠ‚ç‚¹ç‰ˆæœ¬çš„ Polka-vs-Express åŸºå‡†æµ‹è¯•å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚

> **é‡è¦:**æ—¶é—´å¤§å¤šèŠ±åœ¨*ä½ çš„ç”³è¯·ç *è€Œä¸æ˜¯å¿«é€’æˆ–æ³¢å°”å¡ç ä¸Šï¼ä»å¿«é€Ÿåˆ‡æ¢åˆ°æ³¢å°”å¡(å¯èƒ½)ä¸ä¼šæ˜¾ç¤ºå‡ºå¦‚æ­¤å¤§çš„æ€§èƒ½å¢ç›Šã€‚

```
Node 8.9.0

Native
    Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     2.24ms  112.34us   5.57ms   92.15%
        Req/Sec     5.38k    99.48     5.57k    81.81%
      432562 requests in 10.10s, 42.90MB read
    Requests/sec:  42815.14
    Transfer/sec:      4.25MB

Polka
    Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     2.26ms  115.55us   5.19ms   87.16%
        Req/Sec     5.32k    97.34     5.55k    72.77%
      428208 requests in 10.10s, 42.47MB read
    Requests/sec:  42388.92
    Transfer/sec:      4.20MB

Express
    Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     5.15ms  421.69us   8.51ms   77.95%
        Req/Sec     2.34k    77.06     2.55k    72.12%
      186390 requests in 10.01s, 36.97MB read
    Requests/sec:  18628.36
    Transfer/sec:      3.70MB

Fastify
    Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     2.91ms  201.13us   7.51ms   58.07%
        Req/Sec     4.14k   130.04     4.48k    65.59%
      333158 requests in 10.10s, 41.30MB read
    Requests/sec:  32979.84
    Transfer/sec:      4.09MB

Koa
    Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     3.43ms  369.96us   8.67ms   87.30%
        Req/Sec     3.51k   114.78     4.12k    69.76%
      281808 requests in 10.10s, 38.97MB read
    Requests/sec:  27892.99
    Transfer/sec:      3.86MB 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#comparisons)æ¯”è¾ƒ

æ³¢å°”å¡çš„ API æ—¨åœ¨ä¸ Express éå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºå¤§å¤šæ•° Node.js å¼€å‘äººå‘˜å·²ç»ç†Ÿæ‚‰äº†å®ƒã€‚å¦‚æœä½ çŸ¥é“å¿«é€Ÿï¼Œä½ å·²ç»çŸ¥é“æ³¢å°”å¡ï¼ğŸ’ƒ

ç„¶è€Œï¼Œæœ‰å‡ ä¸ªä¸»è¦çš„åŒºåˆ«ã€‚æ³¢å°”å¡ä¸æ”¯æŒæˆ–ä¸æä¾›:

1) **ä»»ä½•å†…ç½®çš„è§†å›¾/æ¸²æŸ“å¼•æ“ã€‚**
å¤§å¤šæ•°æ¨¡æ¿å¼•æ“å¯ä»¥é›†æˆåˆ°ä¸­é—´ä»¶åŠŸèƒ½ä¸­ï¼Œæˆ–è€…ç›´æ¥åœ¨è·¯ç”±å¤„ç†å™¨ä¸­ä½¿ç”¨ã€‚

2) **ä»ä¸­é—´ä»¶å†…éƒ¨`throw`çš„èƒ½åŠ›ã€‚**
ç„¶è€Œï¼Œæ‰€æœ‰å…¶ä»–å½¢å¼çš„ä¸­é—´ä»¶-é”™è¯¯éƒ½è¢«æ”¯æŒã€‚(å‚è§ä¸­é—´ä»¶é€‰é¡¹)

```
 function middleware(res, res, next) {
  // pass an error message to next()
  next('uh oh');

  // pass an Error to next()
  next(new Error('ğŸ™€'));

  // send an early, customized error response
  res.statusCode = 401;
  res.end('Who are you?');
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

3) **ç±»ä¼¼å¿«é€’çš„å“åº”åŠ©æ‰‹...è¿˜æ²¡ï¼(#14)**
å¿«é€’æœ‰ä¸€å¥—ä¸é”™çš„[å“åº”å¸®æ‰‹](http://expressjs.com/en/4x/api.html#res.append)ã€‚è™½ç„¶ Polka ä¾èµ–äº [native Node.js å“åº”æ–¹æ³•](https://nodejs.org/dist/latest-v9.x/docs/api/http.html#http_class_http_serverresponse)ï¼Œä½†æ˜¯é™„åŠ ä¸€ä¸ªåŒ…å«ä¸€ç»„ç±»ä¼¼åŠ©æ‰‹çš„å…¨å±€ä¸­é—´ä»¶æ˜¯éå¸¸å®¹æ˜“/å¯èƒ½çš„ã€‚( *TODO* )

4) **`RegExp`ä¸ºåŸºç¡€çš„è·¯çº¿æ¨¡å¼ã€‚**
æ³¢å°”å¡çš„è·¯ç”±å™¨ä½¿ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒæ¥åŒ¹é…è·¯å¾„å’Œæ¨¡å¼ã€‚è¿™è¦å¿«å¾—å¤š&æ›´æœ‰æ•ˆç‡ã€‚
ä»¥ä¸‹è·¯ç”±æ¨¡å¼**ä¸è¢«**æ”¯æŒ:

```
 app.get('/ab?cd', _ => {});
app.get('/ab+cd', _ => {});
app.get('/ab*cd', _ => {});
app.get('/ab(cd)?e', _ => {});
app.get(/a/, _ => {});
app.get(/.*fly$/, _ => {}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»¥ä¸‹è·¯ç”±æ¨¡å¼**å—**æ”¯æŒ:

```
 app.get('/users', _ => {});
    app.get('/users/:id', _ => {});
    app.get('/users/:id?', _ => {});
    app.get('/users/:id/books/:title', _ => {});
    app.get('/users/*', _ => {}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#credits)å­¦åˆ†ã€‚

æ‰€æœ‰çš„è£èª‰éƒ½å½’äº[å¢å…‹Â·çˆ±å¾·åå…¹](http://twitter.com/lukeed05)å‡ºè‰²çš„ä½œå“ã€‚