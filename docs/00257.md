# iOS å›¢é˜ŸåŸå¸‚é¡¹ç›®

> åŸæ–‡:[https://dev.to/brightdevs/teamcity-for-ios-project-36ag](https://dev.to/brightdevs/teamcity-for-ios-project-36ag)

å—¨ï¼ä»Šå¤©çš„ä¸»é¢˜å°†æ˜¯å…³äº [TeamCity](https://www.jetbrains.com/teamcity/) ä»¥åŠå¦‚ä½•åœ¨ä½ çš„ iOS é¡¹ç›®ä¸­æä¾›æŒç»­é›†æˆã€‚

[![title image](img/22231c322f1b8cc5ffbaa6fe8160bd99.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1kYPEaek--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/r1cbzhmuxv4ztgm87vmr.jpg)

# åŠ¨æœº

æˆ‘å·²ç»ä¸ºè®¸å¤šé¡¹ç›®é…ç½®äº†å¤šæ¬¡å›¢é˜Ÿåˆä½œã€‚åœ¨ä½ çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨æŒç»­é›†æˆç³»ç»Ÿæœ‰å¾ˆå¤šå¥½å¤„ã€‚æ­¤å¤–ï¼Œå›¢é˜Ÿç²¾ç¥è¿˜æœ‰å¾ˆå¤šæ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ circle ci T1ã€T2 TravisCI T3 ç­‰ç­‰ã€‚ä½†æ˜¯åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³å’Œä½ åˆ†äº«æˆ‘åœ¨[å…‰æ˜å‘æ˜](https://brightinventions.pl)è·å¾—çš„å›¢é˜Ÿåˆä½œç»éªŒã€‚

æˆ‘ä»¬å¼€å§‹çš„æ¯ä¸€ä¸ªé¡¹ç›®â€”â€”æˆ‘ä»¬ä»é…ç½®æŒç»­é›†æˆçš„ä¸œè¥¿å¼€å§‹ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ TeamCity æ¥å¤„ç†ã€‚

è¿™ç¯‡æ–‡ç« æ›´åƒæ˜¯ä¸€ä¸ªæ•™ç¨‹ï¼ŒæŒ‡å¯¼ä½ å®Œæˆ iOS é¡¹ç›®é…ç½®çš„æ‰€æœ‰åŸºæœ¬å’Œæœ€é‡è¦çš„æ­¥éª¤ã€‚å¦å¤–ï¼Œæˆ‘å‡è®¾ä½ å·²ç»ä¸‹è½½å¹¶æ‰˜ç®¡äº†ä½ çš„å›¢é˜ŸåŸå¸‚æœåŠ¡ã€‚

å¸Œæœ›ä½ ä¼šå–œæ¬¢ï¼

# ç¬¬ä¸€æ­¥:åˆ›å»ºæ ¹é¡¹ç›®

é¦–å…ˆï¼Œä½ éœ€è¦è¿›å…¥ä¸€ä¸ªä½ çš„å›¢é˜Ÿæ‰€åœ¨çš„é¡µé¢ã€‚ç™»å½•åï¼Œè¿›å…¥ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»`Project-related Settings`éƒ¨åˆ†çš„`Projects`é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡»`Create project`

[![project settings](img/5c7357f891992484579a4342d3a83e84.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qIFTlnIf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5h3qrlbqvr0w1af1boqx.png)

ä¹‹åï¼Œæ‚¨åº”è¯¥çœ‹åˆ°é¡¹ç›®ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬æ§åˆ¶çš„é…ç½®å±å¹•ã€‚

[![create project version control](img/ab9e0ab369130197b23f37a836dd06a0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zgRegzC5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ze86k7fxbf62r2wsiges.png)

æˆ‘æ›´å–œæ¬¢æ‰‹åŠ¨é…ç½®ä¸€åˆ‡çš„æ–¹å¼ï¼Œä½†å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„éƒ¨åˆ†ï¼Œå¦‚:`From GitHub`ã€‚`From Bitbucket Cloud`ç­‰ã€‚
åœ¨è¿™ä¸€æ­¥ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯æä¾›ä½ çš„é¡¹ç›®åç§°ï¼Œç„¶åç‚¹å‡»`Create`

# ç¬¬äºŒæ­¥:æ·»åŠ  VCS æ ¹

å½“ç„¶ï¼Œä¸ºäº†æ„å»ºæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦æä¾›æ„å»ºçš„æºä»£ç ã€‚æˆ‘ä»¬çš„å›¢é˜ŸåŸå¸‚æœåŠ¡åº”è¯¥èƒ½å¤Ÿä»å­˜å‚¨åº“ä¸­è·å–å˜æ›´ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ GitHubã€BitBucket æˆ–è€…ç±»ä¼¼çš„å¹³å°ï¼Œä½ æœ‰ä¸¤ç§æ–¹æ³•:

*   å‘æœ‰æƒè®¿é—®å­˜å‚¨åº“çš„å¸æˆ·æä¾›å‡­æ®

æˆ–è€…

*   ç”Ÿæˆä¸€ä¸ª SSH å¯†é’¥ï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨ GitHub/Bitbucket ä¸­æˆæƒ TeamCity

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•é€šè¿‡ä¸Šä¼  SSH å¯†é’¥æ¥é…ç½®å®ƒã€‚

### ç”Ÿæˆæ–°çš„ SSH å¯†é’¥

*å¦‚æœæ‚¨æ²¡æœ‰å¬è¯´è¿‡ç”Ÿæˆ SSH å¯†é’¥ï¼Œæˆ–è€…æ‚¨ä¸çŸ¥é“ SSH å¯†é’¥åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè¯·æŸ¥çœ‹[æ­¤é“¾æ¥](https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/)T3ã€‘*

è¦ç”Ÿæˆæ–°çš„ SSH å¯†é’¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç»ˆç«¯å‘½ä»¤:

```
ssh-keygen -t rsa 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæä¾›æ–°å¯†é’¥çš„åç§°å’Œå¯é€‰çš„å¯†ç ï¼Œç„¶ååœ¨è¿è¡Œ`ssh-keygen -t rsa`å‘½ä»¤çš„ç›®å½•ä¸­ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸¤ä¸ªæ–‡ä»¶ã€‚ä¸€ä¸ªæ˜¯æ‰©å±•åä¸º`.pub`çš„å…¬é’¥ï¼Œç¬¬äºŒä¸ªæ˜¯ç§é’¥ã€‚
å…¬å…±çš„ä¼šåœ¨ä½ çš„ github/bitbucket ä¸Šçš„ä»“åº“é‡Œä½¿ç”¨ã€‚ç§é’¥å°†åœ¨ TeamCity æœåŠ¡ä¸­ä½¿ç”¨ã€‚

### åœ¨ TeamCity ä¸­ä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥

è½¬åˆ°å·²ç»åˆ›å»ºçš„é¡¹ç›®ï¼Œè®¾ç½®é¡µé¢ï¼Œç‚¹å‡»`VCS SSH Keys`é€‰é¡¹å¡ã€‚

[![ssh section in TeamCity](img/fa7a0ba59d7e5d8b49497840164db31d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--nf7ax_I0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6nv274t08knlp9rv68qc.png)

ç‚¹å‡»`Upload SSH Key`ã€‚ä¹‹åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªå¼¹å‡ºçª—å£ï¼Œå…è®¸æ‚¨ä¸Šä¼ ä¹‹å‰åˆ›å»ºçš„ SSH å¯†é’¥ã€‚
*è¯·è®°ä½ï¼Œä½ åº”è¯¥ä¸Šä¼ ä½ çš„å¯†é’¥çš„ç§æœ‰éƒ¨åˆ†ï¼Œæ²¡æœ‰`pub`æ‰©å±•å*ã€‚å¦‚æœé€‰æ‹©æ­£ç¡®ï¼Œå•å‡» saveï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹å±å¹•:

[![uploaded ssh key](img/7644f3e317864abb92621b0a8bea934a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--yN4DL57l--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/q9qfesq3d8es7rt925du.png)

å¦‚æ‚¨åœ¨`Usage`é€‰é¡¹å¡ä¸­æ‰€è§ï¼Œè¯¥é”®å°šæœªç”¨äºé…ç½®ã€‚
ä¸ºäº†ä½¿ç”¨å®ƒï¼Œæ‚¨å¿…é¡»å®Œæˆä»¥ä¸‹æ­¥éª¤...

### é…ç½® VCS æ ¹

è½¬åˆ°å·²ç»åˆ›å»ºçš„é¡¹ç›®çš„è®¾ç½®é¡µé¢ã€‚æ­£å¦‚æ‚¨åœ¨`SSH Keys`é€‰é¡¹å¡ä¸­çœ‹åˆ°çš„æ•°å­—â€˜1â€™â€”â€”è¿™æ„å‘³ç€æˆ‘ä»¬å·²ç»ä¸Šä¼ äº†ä¸€ä¸ª SSH å¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨äº†ã€‚

[![create project version control](img/7644f3e317864abb92621b0a8bea934a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--yN4DL57l--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/q9qfesq3d8es7rt925du.png)

ç‚¹å‡»`VCS Roots`é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡»`Create VC Root`ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåœ¨`Type of VCS`ä¸­é€‰æ‹©`Git`

[![type of vcs](img/8c345fe4b327d12a92f787669021708d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hEwIYmIG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/w3t6gkczoqgz4eb2zmsm.png)

åœ¨`VCS root name`ä¸­ï¼Œæä¾›ä¸€ä¸ªåç§°:

> ä¸€ä¸ªç‹¬ç‰¹çš„åå­—æ¥åŒºåˆ†è¿™ä¸ª VCS æ ¹ä»å…¶ä»–æ ¹ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨`Fetch URL`ä¸­ç²˜è´´ä¸€ä¸ªåˆ°æ‚¨çš„å­˜å‚¨åº“çš„é“¾æ¥ã€‚*è¯·è®°ä½åœ¨è¿™é‡Œç²˜è´´ä¸€ä¸ª SSH é“¾æ¥ç±»å‹ï¼Œä¾‹å¦‚`git@github.com:yournickname/yourrepositoryname.git`*

[![fetch url in vcs config](img/604de20d26d51c583b8f2b9e7e98024a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--bAA0i-cC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kwi8pp1epupqeb9zn2gc.png)

æ¥ä¸‹æ¥ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œåœ¨`Authentication method`ä¸­é€‰æ‹©`Uploaded Key`,å¹¶ä¸ºæ‚¨çš„å­˜å‚¨åº“é€‰æ‹©ä¸€ä¸ªå…ˆå‰ä¸Šä¼ çš„ç§æœ‰ ssh å¯†é’¥ã€‚

[![fetch url in vcs config](img/5c28387a3ed79ead4a6400cfbc054967.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--V9AgF4t5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rcxqbva9p9y4dj8e1si8.png)

å¿«å¥½äº†ã€‚ç°åœ¨è½¬åˆ°é¡µé¢æœ«å°¾ï¼Œç‚¹å‡»`Test Connection`ã€‚

å¦‚æœæ‚¨çœ‹åˆ°è¿™æ ·çš„å±å¹•:

[![fetch url in vcs config](img/d1c99cabc8eaa9957aa58c795963f689.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sax_vDIJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/odh5hdshdidzqdyj0k7t.png)

è¿™æ„å‘³ç€æˆ‘ä»¬ç”Ÿæˆçš„ SSH å¯†é’¥çš„å…¬å…±éƒ¨åˆ†æ²¡æœ‰åœ¨å­˜å‚¨åº“ä¸­ä½¿ç”¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šå‡ºç°`Auth failed`é”™è¯¯ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦åšçš„å°±æ˜¯åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­çš„`Access keys`æˆ–`Deploy keys`ä¸­æ·»åŠ  SSH å¯†é’¥çš„å…¬å…±éƒ¨åˆ†ã€‚

è¿™é‡Œæœ‰ Bitbucket å’Œ GitHub æŒ‡ä»¤çš„é“¾æ¥:

[ä½æ¡¶-ä½¿ç”¨è®¿é—®å¯†é’¥](https://confluence.atlassian.com/bitbucket/use-access-keys-294486051.html)

[GitHub -éƒ¨ç½²é”®](https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys)

å¦‚æœä½ å·²ç»æˆåŠŸä¸Šä¼ äº† SSH å¯†é’¥çš„å…¬å…±éƒ¨åˆ†ï¼Œå†æ¬¡ç‚¹å‡»`Test Connection`ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿçœ‹åˆ°`Connection successful`æç¤ºã€‚è¿™æ„å‘³ç€ TeamCity æœ‰æƒè¯»å–æ‚¨çš„å­˜å‚¨åº“ã€‚

[![fetch url in vcs config](img/cfcf4ab99eddc6b7787607e58dbdeb99.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jKx3Z7pv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/d27ltpd6sgiu101yk10d.png)

# æ­¥éª¤ 3:åˆ›å»ºæ„å»ºé…ç½®

å¥½äº†ï¼Œæˆ‘ä»¬çš„ VCS å·²ç»é…ç½®å¥½äº†ã€‚ç°åœ¨æ˜¯æ—¶å€™åœ¨ TeamCity é¡¹ç›®ä¸­åˆ›å»ºæ„å»ºé…ç½®äº†ã€‚æ„å»ºé…ç½®æ˜¯ä¸€ç§é€šé“ï¼Œå®ƒæŒ‡å®šæ‚¨åœ¨è¯¥é€šé“ä¸­æä¾›ä»€ä¹ˆç±»å‹çš„æ„å»ºã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé€šé“:ç¼–è¯‘ä½ çš„é¡¹ç›®å¹¶è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œæˆ–è€…åªæ˜¯ç¼–è¯‘ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ–è€…ç¼–è¯‘ä¸€ä¸ªé¡¹ç›®ç„¶ååˆ›å»ºã€‚ipa æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘é€åˆ° iTunesConnectï¼Œç”šè‡³æ˜¯è¿è¡Œ UI æµ‹è¯•çš„å•ç‹¬é€šé“ã€‚

è½¬åˆ°æ‚¨å·²ç»åˆ›å»ºçš„é¡¹ç›®ä¸­çš„`General Settings`å¹¶ç‚¹å‡»`Create build configuration`

[![build configuration step 1](img/bfc9794d4aa7dc7a2d7fd7d6c7e0d1f3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xsYRcUWV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/bh4nq87135skue65vwz1.png)

åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸­ï¼Œå†æ¬¡é€‰æ‹©`Manually`é€‰é¡¹å¹¶å‘½åæ‚¨çš„æ–°æ„å»ºé…ç½®ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠå®ƒå‘½åä¸º`[Develop] Build & Test`ã€‚è¿™ä¸ªåå­—å¾ˆæœ‰æ„ä¹‰ï¼Œæ„å‘³ç€æˆ‘ä»¬çš„ lane å°†ä½¿ç”¨ develop configuration - `Develop`æ„å»º iOS é¡¹ç›®ï¼Œå¹¶ä¸”è¿˜æä¾›äº†è¯¥ lane å°†åšä»€ä¹ˆçš„ç®€çŸ­ä¿¡æ¯- `Build & Test`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†ç¼–è¯‘æˆ‘ä»¬çš„é¡¹ç›®å¹¶è¿è¡Œå•å…ƒæµ‹è¯•ã€‚

[![build configuration step 2](img/65d1d29178450a75229b6d5e5d633fcf.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xesYeqkh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/612hue7oa301kc4ph7wj.png)

ç‚¹å‡»`Create`,ä¹‹åæ‚¨åº”è¯¥ä¼šçœ‹åˆ°:

[![build configuration step 2](img/f2505ffe0f6506fd1b496d4d36e3a9a8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--u4O5pK5f--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zkjlsxg3dudyytma2mma.png)

åœ¨è¿™é‡Œï¼Œé€‰æ‹©ä¸€ä¸ªå…ˆå‰åˆ›å»ºçš„`VCS Root`å¹¶ç‚¹å‡»`Attach`ã€‚

æ‰€æœ‰å·¥ä½œå®Œæˆåï¼Œæˆ‘ä»¬çš„æ„å»ºé…ç½®å°±ä¸ VCS è¿æ¥èµ·æ¥äº†ã€‚

# ç¬¬å››æ­¥:é…ç½®æ„å»ºæ­¥éª¤è¿›è¡Œé…ç½®

ç°åœ¨æ˜¯æ—¶å€™å®šä¹‰æ„å»ºé…ç½®ä¸­çš„æ­¥éª¤äº†ã€‚æ„å»ºæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬æ˜¯ TeamCity å°†åœ¨æˆ‘ä»¬çš„ä»£ç†æœºå™¨ä¸Šè¿è¡Œçš„ä¸€ç³»åˆ—æŒ‡ä»¤ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå¯èƒ½æ˜¯è¿™æ ·çš„:

1.  ä»å›è´­è·å–æ–°çš„å˜æ›´
2.  å®‰è£…ä¾èµ–é¡¹(cocoapodsã€æ†ç»‘å®‰è£…ç­‰ç­‰)
3.  ä½¿ç”¨è„šæœ¬ç¼–è¯‘é¡¹ç›®(xcodebuildï¼Œfastlane)

è¯·è®°ä½ï¼Œæ„å»ºæ­¥éª¤å–å†³äºæ‚¨å¦‚ä½•é…ç½®æ‚¨çš„ iOS é¡¹ç›®ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†[æµªå­](https://fastlane.tools)å’Œ[é‚¦å¾·å‹’](http://bundler.io/)æ¥ç®¡ç†å®‰è£…åœ¨ iOS é¡¹ç›®ä¸­çš„ gems ç‰ˆæœ¬ã€‚

ä¸ºäº†åˆ›å»ºæ„å»ºæ­¥éª¤ï¼Œè½¬åˆ°`Build configuration Settings`å¹¶ç‚¹å‡»`Build Steps`

[![build configuration step 2](img/d1b3cf628f60a3b6cca015757b28b26f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jiREnngt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lgka4txr0cb5vb7frwgc.png)

ç‚¹å‡»`Add build step`ï¼Œåœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸Šé€‰æ‹©ä¸€ä¸ª`Command line`æµé“ç±»å‹ã€‚
åœ¨`Step name`ä¸­å‘½åæ‚¨çš„æ„å»ºæ­¥éª¤(åœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯`Install Dependencies`)ã€‚åœ¨`Custom script`ä¸­ï¼Œé”®å…¥å°†åœ¨è¿™ä¸ªæ„å»ºæ­¥éª¤ä¸­æ‰§è¡Œçš„è„šæœ¬ã€‚åŒæ ·ï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œå®ƒå°†æ˜¯

```
bundle install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![build configuration step 2](img/df0ed3dec8c715a5d7828be1fb8c07b9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--kqaHyxht--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/g0i5hz8zzzcf84frg5cg.png)

ç‚¹å‡»`Save`ï¼Œä½ çš„ç¬¬ä¸€æ­¥å°±å‡†å¤‡å¥½äº†ï¼

æˆ‘è¿˜æ·»åŠ äº†å¦ä¸€ä¸ªåä¸º`Build and tests`çš„å‘½ä»¤è¡Œæ„å»ºæ­¥éª¤ï¼Œå®ƒå°†è¿è¡Œå‘½ä»¤:

```
bundle exec fastlane build_and_test 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*`build_and_test`æ˜¯`Fastfile`ä¸­è½¦é“çš„åç§°ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰æµªå­ï¼Œè¯·çœ‹çœ‹è¿™ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„å·¥å…·[æµªå­](https://fastlane.tools)T5ã€‘*

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†æ‰€æœ‰çš„æ„å»ºæ­¥éª¤ã€‚

[![build steps created](img/4196df389e5390406177922f5bc73d40.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Bqatkpu8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zicvtashuklys64yshaw.png)

# ç¬¬äº”æ­¥:è§¦å‘å™¨

æ‚¨æ˜¯å¦æƒ³è¿‡ TeamCity å¦‚ä½•çŸ¥é“ä½•æ—¶ä»å­˜å‚¨åº“ä¸­è·å–æ–°çš„å˜æ›´å¹¶æ„å»ºå®ƒï¼Ÿè§¦å‘å™¨æ˜¯ä¸€ä¸ªç­”æ¡ˆã€‚

æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ä¸¤ç§ç±»å‹çš„è§¦å‘å™¨ã€‚å…¶ä¸­ä¸€ä¸ªå«åš`VCS Trigger`ï¼Œè¿™æ„å‘³ç€ TeamCity ä¼šè‡ªåŠ¨æ£€æŸ¥æ‚¨çš„å­˜å‚¨åº“ä¸­æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªåŒ…å«è¯¥ç±»å‹è§¦å‘å™¨çš„æ„å»ºé…ç½®ã€‚
`VCS Trigger`ç”¨äº`Compile & Test`ç­‰é…ç½®ä¸­ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨æ¯æ¬¡æ¨é€åˆ°å­˜å‚¨åº“ä¹‹åç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•ã€‚

åä¸€ç§è§¦å‘ï¼Œå«åš`Schedule Trigger`ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è§¦å‘å™¨ï¼Œå¯ä»¥è¯´:*åœ¨æ¯å‘¨ä¸€ä¸Šåˆ 7:00 è¿è¡Œæ­¤é…ç½®*

è½¬åˆ°æ„å»ºé…ç½®ä¸»é¡µä¸­çš„`Triggers`éƒ¨åˆ†ã€‚ç‚¹å‡»`Add new trigger`å¹¶é€‰æ‹©`VCS Trigger`ï¼Œç„¶åç‚¹å‡»`Save`

[![vcs trigger](img/ad1896e3ba9c3968011be8479e0f6dd6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--okdJFUry--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/74r7bq9qswma8wd9oa4c.png)

`VCS Trigger`é…ç½®æˆåŠŸï¼Œå®¹æ˜“å§ï¼Ÿã€‚

æ¥ä¸‹æ¥ï¼ŒåšåŒæ ·çš„æ“ä½œï¼Œ`Add new trigger`->-`Schedule Trigger`ï¼Œé€‰æ‹©ç¬¦åˆæ‚¨è¦æ±‚çš„é€‰é¡¹(åœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯æ¯å¤©å‡Œæ™¨ 04:00 è§¦å‘)ï¼Œç„¶åç‚¹å‡»`Save`ã€‚

[![time trigger](img/6fe2f28e1cab1893ee114488b19533f0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--tUDZREbk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mabqemex9a05tbo9v48k.png)

æ‰€æœ‰è§¦å‘å™¨å·²åˆ›å»ºï¼

# ç¬¬å…­æ­¥:æ·»åŠ æ„å»ºç‰¹æ€§

æ„å»ºç‰¹æ€§æ˜¯å¾ˆé…·çš„ä¸œè¥¿ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨æ„å»ºç‰¹æ€§æ—¶ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¡ä»¶æ¥æ£€æŸ¥å®‰è£…äº†å“ªä¸ªç‰ˆæœ¬çš„ Rubyï¼Œæˆ–è€…æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¡ä»¶æ¥æ£€æŸ¥æ‚¨çš„æœºå™¨ä¸Šæ˜¯å¦æœ‰ä¸€äº›å¯ç”¨ç©ºé—´ã€‚å¦‚æœä½ æƒ³ç”Ÿæˆ`.ipa`æ–‡ä»¶ï¼Œå¹¶ä¸”ä½ çŸ¥é“ä½ éœ€è¦è‡³å°‘ 100MB çš„ç©ºé—²ç©ºé—´ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•é…ç½®ä¸¤ä¸ªæ„å»ºç‰¹æ€§â€”â€”ä¸€ä¸ªæ˜¯`XML report processing`ï¼Œå¦ä¸€ä¸ªæ˜¯`Ruby environment configurator`ã€‚

*   `XML report processing`

è½¬åˆ°æ„å»ºé…ç½®ä¸»é¡µçš„`Build Features`éƒ¨åˆ†ï¼Œç‚¹å‡»`Add build feature`ã€‚é€‰æ‹©`XML report processing`ï¼Œé€‰æ‹©`Ant JUnit`ï¼Œåœ¨`Monitoring rules`ä¸­ç²˜è´´ä¸€ä¸ªè·¯å¾„ç»™`scan`åŠ¨ä½œåæµªå­ç”Ÿæˆçš„`report.junit`æ–‡ä»¶ã€‚
åœ¨`report.junit`ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾å‡ºå·²ç»è¿è¡Œäº†å¤šå°‘æµ‹è¯•ï¼Œå¤±è´¥äº†å¤šå°‘æµ‹è¯•ï¼ŒæˆåŠŸå®Œæˆäº†å¤šå°‘æµ‹è¯•ã€‚

[![xml reporting](img/5dd4b27a33c353c222762fbdb4e1f4c1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Mvwk-ZYa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kev783pn70ioxs1hmohz.png)

*   `Ruby environment configurator`

è¿™æ¬¡åœ¨`Add build feature`çª—å£ä¸­é€‰æ‹©`Ruby environment configurator`ã€‚åœ¨`gemset`ä¸­å®šä¹‰ä½ éœ€è¦çš„ ruby ç‰ˆæœ¬ã€‚æˆ‘çš„æƒ…å†µæ˜¯`ruby-2.3.3`ã€‚

è¿™ä¸ªç‰¹æ€§å°†æ£€æŸ¥ä»£ç†æœºå™¨ä¸Šæ˜¯å¦æœ‰è¿™ä¸ªç‰ˆæœ¬çš„ rubyï¼Œå¦‚æœæ²¡æœ‰ï¼Œå®ƒå°†ä¸ä¼šå¯åŠ¨æ„å»ºé…ç½®ã€‚è¿™æ˜¯ä¸€ä¸ªå¯é€‰æ­¥éª¤ï¼Œä½†æœ‰æ—¶å®ƒéå¸¸æœ‰ç”¨â€”â€”ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å¤šä¸ª ruby ç‰ˆæœ¬ï¼Œæˆ–è€…å…¶ä»–äººå¯ä»¥åœ¨ä»£ç†æœºå™¨ä¸Šæ›´æ”¹ä¸€ä¸ªå…¨å±€ç‰ˆæœ¬çš„ rubyã€‚

[![xml reporting](img/84bd3fe06499d8b4343fc991f93e990a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--rALplpoe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lpk2b568p07r8ywfpccn.png)

# ç¬¬ä¸ƒæ­¥:å‚æ•°

æ„å»ºé…ç½®ç”šè‡³æ ¹é¡¹ç›®æœ‰ 3 ç§ç±»å‹çš„å‚æ•°ã€‚

*   ç»“æ„å‚æ•°

*   ç³»ç»Ÿå±æ€§(ç³»ç»Ÿã€‚)

*   ç¯å¢ƒå˜é‡(env)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é‡ç‚¹å…³æ³¨`Environment variables`ã€‚è¿™ç§ç±»å‹çš„å˜é‡æ˜¯åœ¨æ„å»ºå¼€å§‹ååˆ›å»ºçš„(å‡†å¤‡å¥½äº†å—ï¼Ÿ)å¹¶ä¸”å¯ä»¥é€šè¿‡å‰ç¼€ä¸º`$`çš„å‘½ä»¤è¡Œæ¥è®¿é—®å®ƒä»¬ã€‚ç¯å¢ƒå˜é‡çš„ä¸€ä¸ªä¾‹å­æ˜¯ XCode è·¯å¾„ã€‚ä¸ºäº†ç¼–è¯‘æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦æµªå­å·¥å…·å°†ä½¿ç”¨çš„ XCode è·¯å¾„ã€‚æ‰€ä»¥åœ¨`Fastfile`æˆ‘åŠ äº†ä¸€è¡Œ:

```
xcode_select ENV["XCODE_PATH"] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ„å‘³ç€-ä»ä¸€ä¸ªå¯ä»¥åœ¨`ENV["XCODE_PATH"]`å˜é‡ä¸‹æ‰¾åˆ°çš„è·¯å¾„ä¸­é€‰æ‹© XCodeã€‚

åœ¨æ„å»ºé…ç½®ä¸»é¡µä¸Šï¼Œé€‰æ‹©`Parameters`å¹¶ç‚¹å‡»`Add new parameter`ã€‚åœ¨`Name`ä¸­é”®å…¥`env.XCODE_PATH`ï¼ŒTeamCity åº”è¯¥è‡ªåŠ¨å°†ç§ç±»æ›´æ”¹ä¸º`Environment variable`ï¼Œå¹¶åœ¨å€¼ä¸­æä¾›ä»£ç†æœºå™¨ä¸Š XCode.app çš„è·¯å¾„ã€‚

[![xcode path](img/bdd33d7cba7ec63dd5124d53fc284139.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ymyW2RJ---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/jk87kbin2qv21rs4040q.png)

é€šè¿‡ä½¿ç”¨å‚æ•°ï¼Œæ‚¨å¯ä»¥ä¼ é€’è®¸å¤šæœ‰ç”¨çš„å€¼ï¼Œæ¯”å¦‚æ‚¨çš„æ„å»ºå·æˆ–åº”è¯¥æ„å»ºçš„æ–¹æ¡ˆçš„åç§°ç­‰ç­‰ã€‚æˆ‘é¼“åŠ±ä½ å»çœ‹çœ‹:)

# ç¬¬ 8 æ­¥:æ•…éšœæ¡ä»¶

å½“æ‚¨æƒ³è¦å¼ºåˆ¶æ‚¨çš„æ„å»ºå¤±è´¥æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å¤±è´¥æ¡ä»¶ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯è¶…æ—¶ã€‚è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨æ‚¨çš„ä»£ç†æœºå™¨ä¸Šå‘ç”Ÿäº†ä¸€äº›ä¸å¥½çš„äº‹æƒ…ï¼Œæ‚¨çš„æ„å»ºæŒ‚èµ·äº† 2 ä¸ªå¤šå°æ—¶ï¼Œè€Œæ­£å¸¸æƒ…å†µä¸‹åªéœ€è¦å‡ åˆ†é’Ÿã€‚å¤±è´¥çš„æ¡ä»¶ä¼´éšç€å¸®åŠ©è€Œæ¥ï¼ä½ å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ï¼Œå¦‚æœæ„å»ºæŒç»­è¶…è¿‡`n`åˆ†é’Ÿï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å¤±è´¥ã€‚

åœ¨æ„å»ºé…ç½®ä¸»é¡µä¸­ï¼Œè½¬åˆ°`Failure Conditions`ï¼Œåœ¨ç¬¬`if runs longer than specified limit in minutes`è¡Œè¾“å…¥ä¸€ä¸ªå€¼(ä»¥åˆ†é’Ÿä¸ºå•ä½)ã€‚æˆ‘çš„æƒ…å†µæ˜¯ 60 åˆ†é’Ÿã€‚

[![failuire condition](img/b133aa906664dd9a7d4f39e94ff01fc4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MrMU5S2W--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qjiivjmzdnjld4m9bw63.png)

# ç¬¬ä¹æ­¥:ä»£ç†æœº

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œæˆ‘ç»å¸¸æåˆ°`agent machine`ã€‚ä»£ç†ï¼Œ**åœ¨ iOS çš„æƒ…å†µä¸‹**ï¼Œæ˜¯è£…æœ‰ macOS ç³»ç»Ÿçš„ç”µè„‘(Macbookã€MacMini ç­‰)ã€‚ä»£ç†é€šè¿‡è„šæœ¬è¿æ¥åˆ°æ‚¨çš„ TeamCity é¡µé¢ã€‚TeamCity å¯ä»¥ä¸ä»£ç†é€šä¿¡ï¼Œä»¥ä¾¿ä½¿ç”¨å®ƒæ¥æ‰§è¡Œæ„å»ºé…ç½®ä¸­çš„æ„å»ºæ­¥éª¤ã€‚é‡è¦çš„æ˜¯ï¼Œæ‚¨çš„ä»£ç†åº”è¯¥ä¸€ç›´æ‰“å¼€ï¼Œä»¥æä¾›æŒç»­çš„é›†æˆã€‚

å¥½çš„ï¼Œä½†æ˜¯å¦‚ä½•é…ç½®ä»£ç†å‘¢ï¼Ÿ

è½¬åˆ° TeamCity é¡µé¢ä¸­çš„`Agents`é€‰é¡¹å¡ã€‚ä½ å¯ä»¥åœ¨é¡¶éƒ¨æ‰¾åˆ°å®ƒã€‚

[![agent tab](img/1fac22ddb334b743a8c56f3345815d64.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--eAQC5-2T--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6ywuzrhyr4ob8uknp801.png)

åœ¨æ–°åˆ›å»ºçš„å›¢é˜ŸåŸå¸‚ä¸­ï¼Œè¿˜æ²¡æœ‰å¯ç”¨çš„ä»£ç†ã€‚è®©æˆ‘ä»¬ç‚¹å‡»`Install Build Agents`ã€‚

[![failure condition](img/e76a94648ae7e29b3eac3f25b64897df.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ytsepJLU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rqi2excf4bnqipihmgg1.png)

æˆ‘æ›´å–œæ¬¢é€šè¿‡`Zip file distribution`å®‰è£…çš„æ–¹å¼ã€‚å•å‡»åï¼Œæ‚¨çš„ web æµè§ˆå™¨å°†ä¸‹è½½è¿è¡Œä»£ç†æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ã€‚

ä½ å¯ä»¥åœ¨ [TeamCity æ–‡æ¡£ä¸­æ‰¾åˆ°å…³äºå¦‚ä½•é…ç½® Mac ä»£ç†çš„æŒ‡å¯¼ï¼Œç‚¹å‡»](https://confluence.jetbrains.com/display/TCD10//Setting+up+and+Running+Additional+Build+Agents#SettingupandRunningAdditionalBuildAgents-InstallingviaZIPFile)ã€‚ä»¥ä¸‹æ˜¯è¯¥æ–‡æ¡£ä¸­çš„æ­¥éª¤:

```
1.Make sure a JDK (JRE) 1.8 (versions 1.6-1.8 are supported, but 1.8 is recommended) is properly installed on the agent computer.

2.On the agent computer, make sure the JRE_HOME or JAVA_HOME environment variables are set (pointing to the installed JRE or JDK directory respectively).

3.In the TeamCity Web UI, navigate to the Agents tab.

4.Click the Install Build Agents link and select Zip file distribution to download the archive.

5.Unzip the downloaded file into the desired directory.

6.Navigate to the <installation path>\conf directory, locate the file called buildAgent.dist.properties and rename it to buildAgent.properties.

7.Edit the buildAgent.properties file to specify the TeamCity server URL and the name of the agent. Please refer to Build Agent Configuration section for details on agent configuration.

8.Under Linux, you may need to give execution permissions to the bin/agent.sh shell script. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®Œæˆè¿™äº›æ­¥éª¤åï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘½ä»¤:
å¯åŠ¨ä»£ç†

```
pathToDownloadedUnzippedBuildAgentFiles\bin\agent.sh start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥è¦åšçš„æ˜¯å†æ¬¡è¿›å…¥`Agents`é€‰é¡¹å¡ä¸Šçš„å›¢é˜ŸåŸå¸‚é¡µé¢ã€‚æ‚¨éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¿‡ä¸€ä¼šå„¿æ‚¨åº”è¯¥ä¼šåœ¨`Unauthorized`é€‰é¡¹å¡ä¸‹çœ‹åˆ°ä¸€ä¸ªå¯ç”¨çš„ä»£ç†ã€‚å”¯ä¸€è¦åšçš„å°±æ˜¯å‘`Authorize`ä»£ç†ã€‚æ­¤åï¼Œæ‚¨å°†åœ¨`Connected`é€‰é¡¹å¡ä¸‹çœ‹åˆ°æ‚¨çš„ä»£ç†ã€‚

[![agent connected](img/e8a77b27036e2a7c20b1870400f5f0a2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4UZJX6wr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8djecskwgoh627driu7f.png)

# æ­¥éª¤ 10:ä¸ºæ„å»ºé…ç½®è®¾ç½®ä»£ç†éœ€æ±‚

æœ€åä¸€ä»¶äº‹...æ‚¨ç°åœ¨éœ€è¦æŒ‡å®šå“ªä¸ªä»£ç†åº”è¯¥æ„å»ºæ‚¨çš„é…ç½®ã€‚å¦‚æœä½ çš„ TeamCity åŒ…å«ä¸€ä¸ª iOS å’Œ Android çš„é¡¹ç›®ï¼Œå¯èƒ½ä¼šæœ‰ä¸¤ä¸ªä»£ç†â€”â€”ä¸€ä¸ªç”¨äº Androidï¼Œå¦ä¸€ä¸ªç”¨äº iOSã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸æƒ³åœ¨å¯èƒ½æ²¡æœ‰ XCode ç”šè‡³ macOS çš„ Android é¡¹ç›®çš„ç”µè„‘ä¸Šå¼€å§‹æˆ‘ä»¬çš„ iOS æ„å»ºé…ç½®ã€‚å› æ­¤ï¼Œä¸ºäº†ç»™ä½ çš„é¡¹ç›®æä¾›ä¸€ä¸ªåˆé€‚çš„ä»£ç†ï¼Œä½ éœ€è¦ä½¿ç”¨`Agent requirements`è¿›è¡Œæ„å»ºé…ç½®ã€‚

åœ¨æ„å»ºé…ç½®ä¸»é¡µä¸­ï¼Œè½¬åˆ°`Agent requirements`é€‰é¡¹å¡ï¼Œç„¶å:

*   é€‰æ‹©`Add new requirement`
*   åœ¨`Parameter Name`ä¸­è¾“å…¥`teamcity.agent.jvm.os.name`
*   åœ¨`Condition`ä¸­é€‰æ‹©`equals`
*   åœ¨`Value`ä¸­é€‰æ‹©`Mac OS X`
*   æ•‘æ´

[![agent connected](img/b743bf41371c9ef6744a5d6c1e3c32b2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--plASqOEk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/fhnlej3m9pa7v22hytfm.png)

æˆ‘ä»¬å·²ç»åˆ›å»ºçš„è¦æ±‚æ„å‘³ç€ä»£ç†æ“ä½œç³»ç»Ÿåç§°åº”è¯¥æ˜¯ Mac OS Xï¼Œå› ä¸ºæˆ‘ä»¬ä¸º iOS é…ç½®äº†ä¸€ä¸ªé¡¹ç›®ã€‚

# æ­¥éª¤ 11:å‡†å¤‡å¥½æ„å»º-è¿è¡Œï¼ğŸ‰

æ‰€æœ‰é…ç½®å®Œæˆåï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡ TeamCity å¼€å§‹æ„å»ºäº†ã€‚è½¬åˆ° TeamCity ä¸»é¡µï¼Œåœ¨æ‚¨æ–°åˆ›å»ºçš„æ„å»ºé…ç½®ä¸Šç‚¹å‡»`Run`ã€‚

[![start build](img/024843656920b5e3a53f340c0a42d283.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--6KSzIpP7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9fadr0ubxjo8yg48pix4.png)

ä¹‹åï¼Œæ‚¨å°†èƒ½å¤Ÿçœ‹åˆ°æ„å»ºè¿›åº¦:

[![build running](img/3c11bf517ab9fecf70a2435ee6f881b0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qoRKsHQM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/n0nikhqc09683grwv78q.png)

å¦‚æœæ‚¨æƒ³æŸ¥çœ‹å½“å‰æ„å»ºçš„è¿›åº¦ï¼Œåªéœ€ç‚¹å‡»`Running`æ ‡ç­¾å¹¶è½¬åˆ°`Build log`éƒ¨åˆ†ã€‚å¦‚æœåœ¨ç¼–è¯‘æ—¶å‘ç”Ÿäº†ä¸€äº›é”™è¯¯ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚

[![build running](img/67f1eca0653084895d74dfb93dc256b5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7xqvGhuS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ebfrz3k5wagw0jtxru9e.png)

æœ€åï¼Œåœ¨æ‰€æœ‰æ„å»ºæ­¥éª¤ä¹‹åï¼Œæ‚¨å°†èƒ½å¤Ÿçœ‹åˆ°:

[![build success](img/ccbf6322c21d280f7704c5d612c43e21.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UeREOQBd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/r2a78x8t5h0xxl80db6r.png)

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œ`XML Processing Report` Build ç‰¹æ€§æä¾›äº†ä¸€ä¸ªå…³äºå•å…ƒæµ‹è¯•çš„å¾ˆé…·çš„è¾“å‡º:`Test passed: 24`ã€‚

# ç¬¬åäºŒæ­¥:ç¥å™¨ï¼

æœ€åä¸€ä¸ªå¯é€‰æ­¥éª¤ã€‚æˆ‘å¯ä»¥æƒ³è±¡ä½ å¯ä»¥æ‰¾åˆ°å¾ˆå¤šæ¡ˆä¾‹ï¼Œä½ æƒ³ç¼–è¯‘ä¸€ä¸ªé¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ª`.ipa`æ–‡ä»¶ï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç¥å™¨å°±æ˜¯ä¸ºå®ƒè€Œé€ çš„ã€‚
ä¸ºæ­¤:ç‚¹å‡»`Edit Settings`è¿›å…¥æ„å»ºé…ç½®è®¾ç½®:

[![build configuration settings](img/87f39f6b63f8b210e8dd796a601c699c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xNB4EgqN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/e91xqe7qml6r3iuqt7xd.png)

åœ¨`Artifacts paths`ä¸‹çš„`General Settings`ä¸­ï¼Œè¾“å…¥ä¸€ä¸ªåˆ°`.ipa`æ–‡ä»¶çš„è·¯å¾„ï¼Œè¯¥æ–‡ä»¶å°†ç”±æ‚¨çš„æ„å»ºè„šæœ¬ç”Ÿæˆã€‚æˆ‘å»ºè®®å†æ¬¡ä½¿ç”¨æµªå­ã€‚åä¸º`gym`çš„æµªå­åŠ¨ä½œå°†æ„å»ºæ‚¨çš„é¡¹ç›®å¹¶åœ¨è¾“å‡ºç›®å½•ä¸­åˆ›å»º`.ipa`æ–‡ä»¶ã€‚æ›´å¤šå…³äº`gym`ä½ å¯ä»¥[é˜…è¯»è¿™é‡Œ](https://docs.fastlane.tools/actions/gym/)ã€‚

[![artifacts path](img/e6c734c83f5cfc22f446a4f24cf0c73b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--dxdIVUA7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/evnikgedcaq1n1f96v7w.png)

å¦‚æœä½ è¿™æ ·åšï¼Œåœ¨ä¸‹ä¸€æ¬¡æ„å»ºä¹‹åï¼Œä½ å°†èƒ½å¤Ÿé€šè¿‡ TeamCity ä¸Šçš„`Artifacts`é¡µé¢ä¸‹è½½`.ipa`ã€‚

[![artifacts published](img/77195ad3eb6b9ec19af0f4b97240cbfd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--q67aiHyT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/z8ghyx94x40dcft4zq8d.png)

# ç»“è®º

TeamCity æ˜¯åœ¨æ‚¨çš„é¡¹ç›®ä¸­æä¾›æŒç»­é›†æˆçš„ä¸€ä¸ªå¾ˆå¥½çš„å¹³å°ã€‚ä¸æµªå­ç›¸ç»“åˆï¼Œå®ƒå¯ä»¥ä¸ºæ‚¨èŠ‚çœå¤§é‡çš„æ‰‹åŠ¨éƒ¨ç½²ã€æµ‹è¯•å’Œç¼–è¯‘æ—¶é—´ã€‚

æ­¤å¤–ï¼Œå¦‚æœæ‚¨å°†åœ¨æ„å»ºé…ç½®ä¸­é…ç½®å·¥ä»¶ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°å‘æ‚¨çš„å®¢æˆ·å‘é€ä¸€ä¸ªæŒ‡å‘ TeamCity é¡µé¢çš„é“¾æ¥ï¼Œå¹¶ç»™ä»–ä¸€äº›å¦‚ä½•ç‚¹å‡»ä¸‹è½½`.ipa`çš„è¯´æ˜ã€‚å› æ­¤ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒæ¯æ¬¡åˆ›å»ºæ–°çš„æ–‡ä»¶ç‰ˆæœ¬æ—¶éƒ½è¦å‘é€`.ipa`æ–‡ä»¶ã€‚

å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªå¸–å­ã€‚æ¬¢è¿éšæ—¶è¯„è®ºåˆ†äº«:)

æœ€åˆå‘å¸ƒäº [brightinventions.pl](https://brightinventions.pl/blog/)

ç”± Kamil Wysockiï¼Œè½¯ä»¶å·¥ç¨‹å¸ˆ@å…‰æ˜å‘æ˜
[åšå®¢](https://wysockikamil.com)ï¼Œ[æ¨ç‰¹](//htpps://twitter.com/kamwysoc)