# ä½¿ç”¨ dep ç®¡ç† Go ä¾èµ–é¡¹

> åŸæ–‡:[https://dev.to/ykyuen/manage-go-dependencies-using-dep-16p9](https://dev.to/ykyuen/manage-go-dependencies-using-dep-16p9)

## T2ã€‘

**æ›´æ–°@ 2018-11-26:ç§‘æŠ€ä¸ä»…ä»…æ˜¯åœ¨ä»¥æå¿«çš„é€Ÿåº¦å‰è¿›ï¼Œä¹Ÿåœ¨å¿«é€Ÿå˜åŒ–ã€‚ä¸å‡ºä¸€å¹´ï¼Œè¿™ç¯‡æ–‡ç« å°±è¿‡æ—¶äº†ï¼**

> ![John Arundel profile image](../Images/d5b2c679b32132ce7a1fcdb5864c2ee1.png)çº¦ç¿°é˜¿ä¼¦å¾·å°”[@æ¯”ç‰¹è²å°”å¾·](https://dev.to/bitfield)![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)[@é›…åº“ç‰¹](https://twitter.com/yakuter) [@ykyuen](https://twitter.com/ykyuen) è¿™ä¸ªå·²ç»ä¸¥é‡è¿‡æ—¶äº†ï¼Go ä» 1.11 å¼€å§‹å°±æœ‰äº†å†…ç½®çš„ä¾èµ–ç®¡ç†ï¼Œdep ä¸å†æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚2018 å¹´ 11 æœˆ 24 æ—¥ 23 ç‚¹ 26 åˆ†[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=1066473266020261888)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=1066473266020261888)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=1066473266020261888)

å¹¶æ ¹æ® [dep é¡¹ç›®é¡µé¢](https://github.com/golang/dep):

> dep æ˜¯â€œå®˜æ–¹å®éªŒâ€ã€‚ä» 1.11 å¼€å§‹ï¼ŒGo å·¥å…·é“¾å·²ç»(å®éªŒæ€§åœ°)é‡‡ç”¨äº†ä¸€ç§ä¸ dep æˆªç„¶ä¸åŒçš„æ–¹æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç»§ç»­å¼€å‘ depï¼Œä½†æ˜¯ gear çš„å·¥ä½œä¸»è¦æ˜¯ä¸ºå·¥å…·é“¾ä¸­çš„ç‰ˆæœ¬æ§åˆ¶è¡Œä¸ºå¼€å‘ä¸€ä¸ªæ›¿ä»£åŸå‹ã€‚

å…³äºæ–° Go å†…ç½®ç®¡ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒå®˜æ–¹ GitHub Wiki - [Go 1.11 æ¨¡å—](https://github.com/golang/go/wiki/Modules)ã€‚

æ„Ÿè°¢[çº¦ç¿°Â·é˜¿ä¼¦å¾·å°”@æ¯”ç‰¹è²å°”å¾·](https://twitter.com/bitfield)å’Œ[äºŒæ±—Â·é›…åº“ç‰¹@é›…åº“ç‰¹](https://twitter.com/yakuter)æ­éœ²é—®é¢˜ã€‚ğŸ™‡ğŸ½â€â™‚ï¸

* * *

**æ›´æ–°@ 2018-02-03: [æ¥è‡ª godep å›¢é˜Ÿçš„ Sam Boyer](https://github.com/sdboyer) æ¾„æ¸…äº†æœ¬æ–‡ä¸­ä¸€äº›ä¸æ­£ç¡®çš„ä¿¡æ¯ã€‚å¯¹äºç”±æ­¤å¸¦æ¥çš„ä¸ä¾¿ï¼Œæˆ‘å‘å±±å§†Â·åšè€¶å’Œè¯»è€…é“æ­‰ã€‚**ğŸ˜¢

* * *

*æœ€åˆå‘å¸ƒåœ¨[æ°´æ‰‹é•¿åšå®¢](https://blog.boatswain.io/post/manage-go-dependencies-using-dep/)ä¸Šã€‚*

* * *

ä¹‹å‰æˆ‘åœ¨ä½¿ç”¨ [Glide](https://glide.sh/) çš„ [Go](https://golang.org/) ä¸­å‘å¸ƒäº†ä¸€ç¯‡å…³äºä¾èµ–ç®¡ç†çš„[æ–‡ç« ï¼Œæˆ‘å¾—åˆ°äº†å…³äº](https://blog.boatswain.io/post/manage-go-dependencies-using-glide/) [Glide](https://glide.sh/) å°†ä¼šè¿‡æ—¶çš„åé¦ˆï¼Œå¹¶ä¸” [Glide](https://glide.sh/) å›¢é˜Ÿå»ºè®®ç”¨æˆ·è½¬ç§»åˆ°ç”± [golang](https://golang.org/) å›¢é˜Ÿç¼–å†™çš„å¦ä¸€ä¸ªåä¸º [dep](https://github.com/golang/dep) çš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚

> Go ç¤¾åŒºç°åœ¨æœ‰äº† dep é¡¹ç›®æ¥ç®¡ç†ä¾èµ–å…³ç³»ã€‚è¯·è€ƒè™‘å°è¯•ä» Glide è¿ç§»åˆ° dep...Glide å°†åœ¨ä¸€æ®µæ—¶é—´å†…ç»§ç»­å¾—åˆ°æ”¯æŒï¼Œä½†è¢«è§†ä¸ºå¤„äºæ”¯æŒçŠ¶æ€ï¼Œè€Œä¸æ˜¯ç§¯æçš„åŠŸèƒ½å¼€å‘ã€‚

åœ¨ [Go 1.10 ç‰ˆæœ¬](https://tip.golang.org/doc/go1.10)ä¸­æœ‰ä¸€ä¸ªå…³äºå°† [dep](https://github.com/golang/dep) æ•´åˆåˆ°å·¥å…·é“¾ä¸­çš„è®¡åˆ’ï¼Œä½†ä¼¼ä¹[è¿˜æœ‰ä¸€æ®µè·¯è¦èµ°](https://www.reddit.com/r/golang/comments/7dd2ty/go_110_release_notes_draft/#thing_t1_dpwyj4i)ã€‚

**æ›´æ–°@ 2018-02-03:**

*   **[dep](https://github.com/golang/dep) æ­£å¼å‘å¸ƒã€‚**
*   **[dep](https://github.com/golang/dep) æ²¡æœ‰è¿›å…¥ 1.10 çš„å·¥å…·é“¾ã€‚è¯·å‚è€ƒ[è·¯çº¿å›¾](https://github.com/golang/dep/wiki/Roadmap)äº†è§£æœ€æ–°ä¿¡æ¯ã€‚**

[![Technology is moving too fast](../Images/cb8980f56909c49f1b3e027e470f0343.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--8z24Fa5r--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kghqq76vmqrkz019hkob.jpg)

##### è€Œæˆ‘å°±æ˜¯ä¸å¤Ÿå¿«ã€‚ğŸŒ

## [](#create-the-project-inside-gopath)åœ¨ GOPATH ä¸­åˆ›å»ºé¡¹ç›®

å’Œä»¥å‰ä¸€æ ·ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæ ¹è·¯å¾„ä¸º*$ GOPATH/src/git lab . com/yk yuen/dep-example*ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹æ–‡ä»¶ã€‚

`main.go`

```
package main

import humanize "github.com/dustin/go-humanize"
import "fmt"

func main() {
  fmt.Println("hello world")
  fmt.Printf("That file is %s.\n", humanize.Bytes(82854982)) // That file is 83 MB.
  fmt.Printf("You're my %s best friend.\n", humanize.Ordinal(193)) // You are my 193rd best friend.
  fmt.Printf("You owe $%s.\n", humanize.Comma(6582491)) // You owe $6,582,491.
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## dep æ–¹å¼

### [](#gopkgtoml-and-gopkglock)Gopkg.toml å’Œ Gopkg.lock

[dep](https://github.com/golang/dep) è¯»å–ä¸¤ä¸ªåä¸º *Gopkg.toml* å’Œ *Gopkg.lock* çš„æ–‡ä»¶ã€‚è®©æˆ‘ä»¬åˆå§‹åŒ–è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚

```
[ykyuen@camus dep-example]$ dep init
  Using master as constraint for direct dep github.com/dustin/go-humanize
  Locking in master (bb3d318) for direct dep github.com/dustin/go-humanize 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œ *dep init* å‘½ä»¤æ‰«ææºä»£ç ï¼Œå¹¶å°†é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰åŒ…ä¸‹è½½åˆ°*ä¾›åº”å•†*æ–‡ä»¶å¤¹ä¸­ã€‚

*Gopkg.lock* å’Œ *glide.lock* æ–‡ä»¶çš„ä½œç”¨å®Œå…¨ä¸€æ ·ï¼Œé”å®š**åŒ…çš„ç‰ˆæœ¬ï¼Œé™¤äº†**ç‰ˆæœ¬åº”è¯¥åœ¨ *Gopkg.toml* ä¸­ç»´æŠ¤ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ *Gopkg.lock* æ–‡ä»¶æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒä¾èµ–äºæºä»£ç ä¸­çš„ *import* è¯­å¥ï¼Œå…¶ç‰ˆæœ¬ç”± *Gopkg.toml* æ§åˆ¶ã€‚

[![](../Images/cae4b499893086a06cd2ca92aa7caf46.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--u8bc5kMj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/76aglpqie9q1kx22ft78.png)

### [](#update-dependencys-version)æ›´æ–°ä¾èµ–å…³ç³»çš„ç‰ˆæœ¬

è®©æˆ‘ä»¬ç¼–è¾‘ä¸€ä¸‹ *Gopkg.toml* ï¼Œç”¨ç¨å¾®è€ä¸€ç‚¹ç‰ˆæœ¬çš„ [go-humanize](https://github.com/dustin/go-humanize) åŒ…ä»£æ›¿æœ€æ–°çš„ master branchã€‚

```
# Gopkg.toml example
#
# Refer to https://github.com/golang/dep/blob/master/docs/Gopkg.toml.md
# for detailed Gopkg.toml documentation.
#
# required = ["github.com/user/thing/cmd/thing"]
# ignored = ["github.com/user/project/pkgX", "bitbucket.org/user/project/pkgA/pkgY"]
#
# [[constraint]]
#   name = "github.com/user/project"
#   version = "1.0.0"
#
# [[constraint]]
#   name = "github.com/user/project2"
#   branch = "dev"
#   source = "github.com/myfork/project2"
#
# [[override]]
#  name = "github.com/x/y"
#  version = "2.4.0"

[[constraint]]
  #branch = "master"
  name = "github.com/dustin/go-humanize"
  revision = "0b19b17f90333e44518aa31bbf8126017960aee3" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åè¿è¡Œ *dep ç¡®ä¿*å°†åŒ…æ›´æ–°åˆ°æ‰€éœ€ç‰ˆæœ¬ã€‚ä»¥ä¸‹æ˜¯æ›´æ–°åçš„ *Gopkg.lock* çš„åŒºåˆ«ã€‚

```
-------- /home/ykyuen/go/src/gitlab.com/ykyuen/dep-example/Gopkg.lock +++ # This file is autogenerated, do not edit; changes @@ -2,14 +2,13 @@

 [[projects]]
-  branch = "master"
   name = "github.com/dustin/go-humanize"
   packages = ["."]
-  revision = "bb3d318650d48840a39aa21a027c6630e198e626" +  revision = "0b19b17f90333e44518aa31bbf8126017960aee3" 
 [solve-meta]
   analyzer-name = "dep"
   analyzer-version = 1
-  inputs-digest = "a5d65a2bdf47e41b99ad71813142ae93970f5806c77630b2aea665fe631dde23" +  inputs-digest = "0023bfe634a061b89ae0fbd71e3236f3f75f0843a0c974eeb9822040c0ea2dc4"
   solver-name = "gps-cdcl"
   solver-version = 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#add-a-new-dependency)æ·»åŠ æ–°çš„ä¾èµ–å…³ç³»

å¯ä»¥ä½¿ç”¨*dep assure-add*å‘½ä»¤æ·»åŠ æ–°çš„åŒ…ã€‚

```
[ykyuen@camus dep-example]$ dep ensure -add github.com/leekchan/accounting
Fetching sources...

"github.com/leekchan/accounting" is not imported by your project, and has been temporarily added to Gopkg.lock and vendor/.
If you run "dep ensure" again before actually importing it, it will disappear from Gopkg.lock and vendor/. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨*ä¾›åº”å•†*æ–‡ä»¶å¤¹ä¸­å‡†å¤‡å¥½äº†æ–°çš„*ä¼šè®¡*åŒ…ï¼Œæ–°çš„çº¦æŸè¢«å†™å…¥ *Gopkg.toml* å¹¶è¢«é”å®šåœ¨ *Gopkg.lock* ä¸­ã€‚è®©æˆ‘ä»¬æ›´æ–° *main.go* å¦‚ä¸‹ã€‚

`main.go`

```
package main

import humanize "github.com/dustin/go-humanize"
import accounting "github.com/leekchan/accounting"
import "math/big"
import "fmt"

func main() {
  fmt.Println("hello world")
  fmt.Printf("That file is %s.\n", humanize.Bytes(82854982)) // That file is 83 MB.
  fmt.Printf("You're my %s best friend.\n", humanize.Ordinal(193)) // You are my 193rd best friend.
  fmt.Printf("You owe $%s.\n", humanize.Comma(6582491)) // You owe $6,582,491.

  ac := accounting.Accounting{Symbol: "$", Precision: 2}
  fmt.Println(ac.FormatMoney(123456789.213123))                       // "$123,456,789.21"
  fmt.Println(ac.FormatMoney(12345678))                               // "$12,345,678.00"
  fmt.Println(ac.FormatMoney(big.NewRat(77777777, 3)))                // "$25,925,925.67"
  fmt.Println(ac.FormatMoney(big.NewRat(-77777777, 3)))               // "-$25,925,925.67"
  fmt.Println(ac.FormatMoneyBigFloat(big.NewFloat(123456789.213123))) // "$123,456,789.21"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶è¿è¡Œå®ƒã€‚

```
[ykyuen@camus dep-example]$ go run main.go
hello world
That file is 83 MB.
You're my 193rd best friend.
You owe $6,582,491.
$123,456,789.21
$12,345,678.00
$25,925,925.67
-$25,925,925.67
$123,456,789.21 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#the-issue-with-git-submodule)ä¸ git å­æ¨¡å—çš„é—®é¢˜

ä¸ [Glide](https://glide.sh/) ç›¸æ¯”ï¼Œ [dep](https://github.com/golang/dep) çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯è½¯ä»¶åŒ…çš„å­æ¨¡å—è¢«å¿½ç•¥ã€‚æ¯”å¦‚ [dep](https://github.com/golang/dep) æ·»åŠ  [go-goracle/goracle](https://github.com/go-goracle/goracle) åŒ…åï¼Œé‡Œé¢çš„ [odpi](https://oracle.github.io/odpi/) å­æ¨¡å—ä¸ºç©ºå¯¼è‡´é”™è¯¯ã€‚åˆ é™¤å­æ¨¡å—çš„åŸå› å¯ä»¥åœ¨ä¸‹é¢çš„é“¾æ¥ä¸­æ‰¾åˆ°ã€‚

*   æœ‰è®¡åˆ’æ·»åŠ  git å­æ¨¡å—æ”¯æŒå—ï¼Ÿ

**æ›´æ–°@ 2018-02-03:**

**å…³äº git å­æ¨¡å—çš„æ®µè½ä¸æ­£ç¡®ã€‚**

**[å±±å§†Â·åšè€¶](https://github.com/sdboyer)å†™é“:**

> åœ¨æ‚¨æè¿°çš„æƒ…å†µä¸‹ï¼Œdep åº”è¯¥å¯ä»¥å¾ˆå¥½åœ°å¼•å…¥ git å­æ¨¡å—ã€‚æˆ‘åªæ˜¯åœ¨æœ¬åœ°å¤åˆ¶äº†ä½ åœ¨è¿™é‡Œæè¿°çš„ä¸œè¥¿ï¼Œé—®é¢˜ä¸åœ¨äºå­æ¨¡å—â€”â€”è€Œæ˜¯åœ¨ github.com/go-goracle/goracle/odpi,æ²¡æœ‰ Go ä»£ç ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å¯¼å…¥ã€‚
> 
> æ‚¨å¯èƒ½éœ€è¦ä¸“é—¨ä¸ºè¯¥é¡¹ç›®å…³é—­ Gopkg.toml ä¸­æœªä½¿ç”¨çš„åŒ…ä¿®å‰ªï¼Œå¦åˆ™ dep ensure å°†è‡ªåŠ¨ç›´æ¥åˆ é™¤çœ‹èµ·æ¥æ˜¯æœªä½¿ç”¨çš„åŒ…(ä½†çœ‹èµ·æ¥å®ƒå®é™…ä¸Šæ˜¯ç”± cgo ä½¿ç”¨çš„)ã€‚

**æ›´æ–°@ 2018-03-04:**

å‘ç° [go-goracle/goracle](https://github.com/go-goracle/goracle) åŒ…ä¸ [dep](https://github.com/golang/dep) ä¸å…¼å®¹ã€‚ä½ å¯ä»¥å…³æ³¨ä¸‹é¢çš„é—®é¢˜ï¼ŒæŸ¥çœ‹æ¥è‡ª [dep](https://github.com/golang/dep) å›¢é˜Ÿçš„æœ€æ–°æ›´æ–°ã€‚

*   [åœ¨ dep ç¡®ä¿å‘½ä»¤](https://github.com/golang/dep/issues/1633)ä¹‹åï¼Œæ— æ³•è·å–åŒ…çš„ git å­æ¨¡å—

## [](#summary)æ€»ç»“

*   ~~[dep](https://github.com/golang/dep) å¾ˆæœ‰å¯èƒ½æˆä¸º [Golang](https://golang.org/) ç¤¾åŒºçš„å®˜æ–¹ä¾èµ–ç®¡ç†å·¥å…·ã€‚~~
*   å¦‚æœä½ æ­£åœ¨å¼€å§‹ä¸€ä¸ªæ–°çš„ [Golang](https://golang.org/) é¡¹ç›®ï¼Œé‚£ä¹ˆ [dep](https://github.com/golang/dep) æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚
*   å¦‚æœä½ åœ¨ä¸€ä¸ªé—ç•™é¡¹ç›®ä¸­ä½¿ç”¨ [Glide](https://glide.sh/) ã€‚ä½ å¯ä»¥è€ƒè™‘è¿ç§»åˆ° [dep](https://github.com/golang/dep) ä½†æ˜¯æˆ‘è®¤ä¸ºç»§ç»­ä½¿ç”¨ [Glide](https://glide.sh/) ä¸€æ®µæ—¶é—´ç›´åˆ° [dep](https://github.com/golang/dep) æ­£å¼å‘å¸ƒä¹Ÿæ²¡æœ‰åå¤„ã€‚
*   æ­¤å¤–ï¼Œç¼ºå°‘è½¯ä»¶åŒ…çš„å­æ¨¡å—å¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„ä»£ç å‡ºç°æ•…éšœã€‚
*   **[dep](https://github.com/golang/dep) æ­£å¼å‘å¸ƒã€‚**
*   **[dep](https://github.com/golang/dep) åœ¨æ‹‰ git å­æ¨¡å—ä¸Šå·¥ä½œè‰¯å¥½ã€‚**
*   ä½ å¯ä»¥åœ¨[gitlab.com](https://gitlab.com/ykyuen/dep-example)ä¸ŠæŸ¥çœ‹è¿™ä¸ªä¾‹å­ã€‚