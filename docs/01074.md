# å¦‚ä½•åœ¨ iOS ä¸­åˆ›å»ºå®æ—¶æµ®åŠ¨å¿ƒå½¢æ•ˆæœ

> åŸæ–‡:[https://dev . to/neo/how-to-create-real time-floating-hearts-effect-in-IOs-nlc](https://dev.to/neo/how-to-create-realtime-floating-hearts-effect-in-ios-nlc)

å¦‚æœä½ æ˜¯ Periscopeã€Instagram å’Œè„¸ä¹¦ç­‰åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ï¼Œé‚£ä¹ˆä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ä»–ä»¬çš„ç›´æ’­æµä¸­æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œæ¯å½“æœ‰äººå–œæ¬¢ç›´æ’­å†…å®¹æ—¶ï¼Œâ€œå–œæ¬¢â€å°±ä¼šæµ®åœ¨ä½ çš„å±å¹•ä¸Šã€‚æœ¬æ–‡å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Swift å’Œ Pusher åœ¨æ‚¨çš„ iOS åº”ç”¨ç¨‹åºä¸Šå®ç°å®æ—¶æµ®åŠ¨çº¢å¿ƒåŠŸèƒ½ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ Swift å’Œ Pusher å°†å®ç°çš„å†…å®¹çš„å±å¹•è®°å½•ã€‚

[![](img/5d83c2813b933181ecd113057b48ca44.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--pCmxSuhy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/7lvk43qkfq7btqvxvnjq.gif)

ä»å½•éŸ³ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å½“ç‚¹å‡»å–œæ¬¢æŒ‰é’®æ—¶ï¼Œå–œæ¬¢ä¼šæµ®åˆ°é¡¶éƒ¨ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿä¼šå¤åˆ¶åˆ°å¦ä¸€ä¸ªè§‚çœ‹æ­£åœ¨æ’­æ”¾çš„è§†é¢‘çš„è®¾å¤‡ä¸Šã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ—…ç¨‹ã€‚

**è¦æ±‚**
æŒ‰ç…§æœ¬æ•™ç¨‹ï¼Œä½ å°†éœ€è¦ä»¥ä¸‹ä¸œè¥¿:

*   äº†è§£ Swift å’Œ Xcode æ•…äº‹æ¿ã€‚
*   Xcode å®‰è£…åœ¨æ‚¨çš„æœºå™¨ä¸Šã€‚
*   æ¨é€åº”ç”¨ç¨‹åºâ€“æ‚¨å¯ä»¥åœ¨æ­¤åˆ›å»ºä¸€ä¸ªå…è´¹çš„æ¨é€è´¦æˆ·[ã€‚](https://pusher.com)
*   node.js å’Œ npm å®‰è£…åœ¨æ‚¨çš„è®¡ç®—æœºä¸Š
*   å®‰è£…åœ¨ä½ æœºå™¨ä¸Šçš„ Cocoapods ä½¿ç”¨ Ruby é€šè¿‡è¿è¡Œ:`gem install cocoapods`æ¥å®‰è£…å®ƒã€‚

å¸Œæœ›ä½ å·²ç»æ£€æŸ¥äº†æ‰€æœ‰çš„éœ€æ±‚ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

## åœ¨ Xcode ä¸­åˆ›å»ºæµ®åŠ¨å¿ƒå½¢åº”ç”¨ç¨‹åº

å¯åŠ¨ Xcodeï¼Œåœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚æˆ‘ä»¬å°†æŠŠè¿™ä¸ªåº”ç”¨ç¨‹åºå«åš **streamlove** (æ˜¯çš„ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå¾ˆè¹©è„š)ã€‚å®Œæˆåˆå§‹è®¾ç½®åï¼Œå…³é—­ Xcode å¹¶å¯åŠ¨ç»ˆç«¯ã€‚`cd`åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•å¹¶è¿è¡Œ`pod init`ã€‚è¿™å°†åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`Podfile`ã€‚åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€å®ƒï¼Œç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢å®ƒ:

```
 platform :ios, '9.0'
    target 'streamlove' do
      use_frameworks!
      pod 'PusherSwift', '~> 4.0'
      pod 'Alamofire', '~> 4.4'
    end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¹‹åï¼Œä¿å­˜å¹¶å…³é—­æ–‡ä»¶ï¼Œè¿è¡Œå‘½ä»¤`pod install`ã€‚è¿™å°†å¼€å§‹å®‰è£…æˆ‘ä»¬æ­£åœ¨åˆ›å»ºçš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚ç°åœ¨åœ¨ Xcode ä¸­æ‰“å¼€`streamlove.xcworkspace`æ–‡ä»¶ã€‚

æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯è®¾è®¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ•…äº‹æ¿ã€‚æ‰“å¼€`Main.storyboard`æ–‡ä»¶ã€‚æˆ‘ä»¬å°†æ·»åŠ ä¸€äº›æ¨¡æ‹Ÿè§†å›¾ï¼Œå› ä¸ºæˆ‘ä»¬çœŸçš„ä¸æƒ³åœ¨å®ƒä»¬ä¸Šé¢å®ç°ä»»ä½•ä¸œè¥¿ï¼Œå®ƒä»¬åªæ˜¯ä¸ºäº†ç¾è§‚ã€‚æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯æŒ‰é’®å’ŒèƒŒæ™¯è§†é¢‘ã€‚åœ¨è®¾è®¡å¥½æˆ‘ä»¬çš„æ•…äº‹æ¿ä¹‹åï¼Œè¿™æ˜¯æˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„:

[![](img/91cd934cf7caa5c65e27366bdfebabb0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xoMZf9-N--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zd5ldqox4vemaivwress.png)

åœ¨è¿™ä¸ªæ•…äº‹æ¿ä¸­ï¼Œæˆ‘ä»¬åœ¨å±å¹•çš„å³ä¸‹è§’æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™ä¸ªæŒ‰é’®åœ¨`ViewController`ä¸­æœ‰ä¸€ä¸ª`@IBAction`ï¼Œæ‰€ä»¥ä½ éœ€è¦`ctrl+drag`æ¥è¿æ¥è¿™ä¸ªæŒ‰é’®å’Œ`ViewController`ã€‚

è¿™å°†æŠŠ`@IBAction`æ·»åŠ åˆ°`ViewController`ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
 @IBAction func hearted(_ sender: Any) {
        // This function will be fired every time the button is tapped!
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ä½¿ç”¨ Swift åœ¨ iOS ä¸­åˆ›å»ºèƒŒæ™¯å¾ªç¯è§†é¢‘

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæ¨¡æ‹Ÿå®æ—¶æµçš„è§†é¢‘èƒŒæ™¯(å› ä¸ºåˆ›å»ºå®é™…çš„å®æ—¶æµè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´)ã€‚æ‰“å¼€`ViewController`æ–‡ä»¶å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
 import UIKit
    import PusherSwift
    import Alamofire

    class ViewController: VideoSplashViewController {

        override func viewDidLoad() {
            super.viewDidLoad()
            loadVideoStreamSample()
        }

        private func loadVideoStreamSample() {
            let url = NSURL.fileURL(withPath: Bundle.main.path(forResource: "video", ofType: "mp4")!)
            self.videoFrame = view.frame
            self.fillMode = .resizeAspectFill
            self.alwaysRepeat = true
            self.sound = true
            self.startTime = 0.0
            self.duration = 10.0
            self.alpha = 0.7
            self.backgroundColor = UIColor.black
            self.contentURL = url
            self.restartForeground = true
        }

        override var prefersStatusBarHidden: Bool {
            return true
        }  

        @IBAction func hearted(_ sender: Any) {
            // This function will be called everytime the button is tapped!
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬å·²ç»å¯¼å…¥äº†æˆ‘ä»¬éœ€è¦çš„åº“ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æ˜¯åœ¨æ•™ç¨‹çš„åé¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨å…¶ä»–äººèº«ä¸Šã€‚`ViewController`æ‰©å±•äº†æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»ºçš„`VideoSplashViewController`ã€‚åœ¨`viewDidLoad`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•`loadVideoStreamSample`ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯åŠ è½½ä¸€ä¸ªè§†é¢‘å¹¶ä¸ºè§†é¢‘è®¾ç½®ä¸€äº›å‚æ•°ã€‚è¿™äº›å‚æ•°å°†åœ¨`VideoSplashViewController`ä¸­å®ç°ã€‚

ç°åœ¨å¯¹äº`VideoSplashViewController`ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Github ä¸Šçš„[Swift åº“ã€‚ç„¶è€Œï¼Œç”±äºè¯¥åº“ä¸æ”¯æŒ Swift 3ï¼Œæˆ‘ä»¬å°†æŒ‘é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ”¯æŒ Swift 3ã€‚ç¬¬ä¸€ä¸ªæ˜¯](https://github.com/svtek/VideoSplashKit/)[videossplashviewcontroller](https://github.com/svtek/VideoSplashKit/blob/master/VideoSplashKit/Source/VideoSplashViewController.swift)ã€‚åˆ›å»ºä¸€ä¸ªæ‰©å±•äº†`UIViewController`çš„æ–°æ–‡ä»¶`VideoSplashViewController`ï¼Œå¹¶åœ¨å…¶ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
 import UIKit
    import MediaPlayer
    import AVKit

    public enum ScalingMode {
        case resize
        case resizeAspect
        case resizeAspectFill
    }

    public class VideoSplashViewController: UIViewController {

        private let moviePlayer = AVPlayerViewController()
        private var moviePlayerSoundLevel: Float = 1.0

        public var videoFrame: CGRect = CGRect()
        public var startTime: CGFloat = 0.0
        public var duration: CGFloat = 0.0
        public var backgroundColor = UIColor.black { didSet { view.backgroundColor = backgroundColor } }
        public var contentURL: URL = URL(fileURLWithPath: "") { didSet { setMoviePlayer(url: contentURL) } }
        public var sound: Bool = true { didSet { moviePlayerSoundLevel = sound ? 1 : 0 } }
        public var alpha: CGFloat = 1 { didSet { moviePlayer.view.alpha = alpha } }

        public var alwaysRepeat: Bool = true {

            didSet {

                if alwaysRepeat {
                    NotificationCenter.default.addObserver(forName:.AVPlayerItemDidPlayToEndTime, object:nil, queue:nil) { [weak self] (notification) in
                        self?.playerItemDidReachEnd()
                    }
                    return
                }

                if !alwaysRepeat {
                    NotificationCenter.default.removeObserver(self, name:.AVPlayerItemDidPlayToEndTime, object: nil)
                }
            }
        }

        public var fillMode: ScalingMode = .resizeAspectFill {
            didSet {
                switch fillMode {
                case .resize:
                    moviePlayer.videoGravity = AVLayerVideoGravityResize
                case .resizeAspect:
                    moviePlayer.videoGravity = AVLayerVideoGravityResizeAspect
                case .resizeAspectFill:
                    moviePlayer.videoGravity = AVLayerVideoGravityResizeAspectFill
                }
            }
        }

        public var restartForeground: Bool = false {
            didSet {
                if restartForeground {
                    NotificationCenter.default.addObserver(forName:.UIApplicationWillEnterForeground, object:nil, queue:nil) { [weak self] (notification) in
                        self?.playerItemDidReachEnd()
                    }
                }
            }
        }

        override public func viewDidAppear(_ animated: Bool) {
            super.viewDidAppear(animated)
            moviePlayer.view.frame = videoFrame
            moviePlayer.view.backgroundColor = self.backgroundColor;
            moviePlayer.showsPlaybackControls = false
            moviePlayer.view.isUserInteractionEnabled = false
            view.addSubview(moviePlayer.view)
            view.sendSubview(toBack: moviePlayer.view)
        }

        private func setMoviePlayer(url: URL){
            let videoCutter = VideoCutter()
            videoCutter.cropVideoWithUrl(videoUrl: url, startTime: startTime, duration: duration) { [weak self] (videoPath, error) -> Void in
                guard let path = videoPath, let strongSelf = self else { return }
                strongSelf.moviePlayer.player = AVPlayer(url: path)
                strongSelf.moviePlayer.player?.addObserver(strongSelf, forKeyPath: "status", options: .new, context: nil)
                strongSelf.moviePlayer.player?.play()
                strongSelf.moviePlayer.player?.volume = strongSelf.moviePlayerSoundLevel
            }
        }

        public override func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?) {

            guard let player = object as? AVPlayer else {
                super.observeValue(forKeyPath: keyPath, of: object, change: change, context: context)
                return
            }

            if player.status == .readyToPlay {
                movieReadyToPlay()
            }
        }

        deinit{
            moviePlayer.player?.removeObserver(self, forKeyPath: "status")
            NotificationCenter.default.removeObserver(self)
        }

        // Override in subclass
        public func movieReadyToPlay() { }

        func playerItemDidReachEnd() {
            moviePlayer.player?.seek(to: kCMTimeZero)
            moviePlayer.player?.play()
        }

        func playVideo() {
            moviePlayer.player?.play()
        }

        func pauseVideo() {
            moviePlayer.player?.pause()
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨åˆ›å»ºå¦ä¸€ä¸ªåä¸º`VideoCutter`çš„æ–‡ä»¶ï¼Œå®ƒæ‰©å±•äº† NSObject å¹¶ç²˜è´´åˆ°ä¸‹é¢:

```
 import UIKit
    import AVFoundation

    extension String {
        var convert: NSString { return (self as NSString) }
    }

    public class VideoCutter: NSObject {

        /**
         Block based method for crop video url

         @param videoUrl Video url
         @param startTime The starting point of the video segments
         @param duration Total time, video length

         */
        public func cropVideoWithUrl(videoUrl url: URL, startTime: CGFloat, duration: CGFloat, completion: ((_ videoPath:URL?, _ error: NSError?) -> Void)?) {

            DispatchQueue.global().async {

                let asset = AVURLAsset(url: url, options: nil)
                var outputPath = NSHomeDirectory()
                let documentPaths = NSSearchPathForDirectoriesInDomains(.documentDirectory, .userDomainMask, true)
                if (documentPaths.count > 0) {
                    outputPath = documentPaths.first!
                }
                let fileManager = FileManager.default

                guard let exportSession = AVAssetExportSession(asset: asset, presetName: "AVAssetExportPresetHighestQuality") else { return }
                let outputFilePath = outputPath.convert.appendingPathComponent("output.mp4")

                if fileManager.fileExists(atPath: outputFilePath) {
                    do {
                        try fileManager.removeItem(atPath: outputFilePath)
                    } catch let error {
                        print(error)
                    }
                }

                do {
                    try fileManager.createDirectory(atPath:outputPath, withIntermediateDirectories: true, attributes: nil) }
                catch let error {
                    print(error)
                }

                let start = CMTimeMakeWithSeconds(Float64(startTime), 600)
                let duration = CMTimeMakeWithSeconds(Float64(duration), 600)
                let range = CMTimeRangeMake(start, duration)
                let outputURL = URL(fileURLWithPath: outputFilePath)
                exportSession.outputURL = outputURL
                exportSession.timeRange = range
                exportSession.shouldOptimizeForNetworkUse = true
                exportSession.outputFileType = AVFileTypeMPEG4
                exportSession.exportAsynchronously(completionHandler: {
                    switch exportSession.status {
                    case .completed:
                        DispatchQueue.main.async { completion?(exportSession.outputURL, nil) }
                    default:
                        DispatchQueue.main.async { completion?(nil, nil) }
                    }
                })
            }
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶ä¸­ï¼Œå®ƒåŸºæœ¬ä¸Šå¯ä»¥å¸®åŠ©ä½ ç®¡ç†è§†é¢‘èƒŒæ™¯ï¼Œå¹¶å°†ä½ é€‰æ‹©çš„è§†é¢‘è®¾ç½®ä¸ºèƒŒæ™¯è§†é¢‘ï¼Œå¹¶æ°¸è¿œå¾ªç¯æ’­æ”¾ã€‚è¿™å¯¹äºåº”ç”¨ç¨‹åºç™»å½•é¡µé¢ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åªæ˜¯æŠŠå®ƒç”¨äºä¸€ä¸ªè™šæ„çš„è§†é¢‘æµã€‚

> ğŸ’¡**å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä½äº 3 çš„ Swift ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨å­˜å‚¨åº“ä¸­çš„æºä»£ç ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Swift 3 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæ‚¨å¯èƒ½éœ€è¦è¿™äº›ä¿®æ”¹æ‰èƒ½ä½¿å…¶å·¥ä½œã€‚**

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯å‘æˆ‘ä»¬çš„å·¥ä½œåŒºæ·»åŠ ä¸€ä¸ª mp4 æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³ä½¿ç”¨çš„ mp4 æ–‡ä»¶ã€‚å°†è§†é¢‘æ–‡ä»¶`video.mp4`æ”¾å…¥å·¥ä½œåŒºï¼Œ**ç¡®ä¿å®ƒè¢«å¤åˆ¶**å¹¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºç›®æ ‡ã€‚

å¦‚æœæ‚¨ç°åœ¨æ„å»ºå¹¶é¢„è§ˆæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°è§†é¢‘åœ¨åå°å¾ªç¯æ’­æ”¾ã€‚å¤ªå¥½äº†ã€‚

## å°†æµ®åŠ¨å¿ƒå½¢æ·»åŠ åˆ°æ‚¨çš„ iOS åº”ç”¨ç¨‹åº

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†èƒŒæ™¯ä¸­çš„è§†é¢‘å¾ªç¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„æ˜¯ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ æµ®åŠ¨å¿ƒè„åŠŸèƒ½ã€‚åŸºæœ¬ä¸Šï¼Œæ¯æ¬¡æœ‰äººç‚¹å‡»å¿ƒå½¢æŒ‰é’®æ—¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªå¿ƒå½¢å›¾æ ‡æµ®åˆ°é¡¶éƒ¨ï¼Œç„¶åæ…¢æ…¢æ¶ˆå¤±ã€‚

æ‰“å¼€`Main.storyboard`æ–‡ä»¶ï¼Œåœ¨å¿ƒè„æŒ‰é’®çš„å³ä¸‹æ–¹ï¼Œæ·»åŠ ä¸€ä¸ªæ²¡æœ‰èƒŒæ™¯çš„è§†å›¾ã€‚è¿™å°†æ˜¯æµ®åŠ¨çš„å¿ƒå°†æ—…è¡Œçš„è§†çª—ã€‚å¯ä»¥åšæˆ 250Ã—350 å·¦å³çš„é•¿æ–¹å½¢ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Github çš„å¦ä¸€ä¸ª[åº“æ¥ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ æµ®åŠ¨å¿ƒå½¢åŠŸèƒ½ã€‚æˆ‘ä»¬å®é™…éœ€è¦çš„æ–‡ä»¶æ˜¯](https://github.com/ravenshore/iOS-Floaters) [Floater.swift](https://github.com/ravenshore/iOS-Floaters/blob/master/floaters/Floater.swift) æ–‡ä»¶ã€‚è¯¥åº“è¿˜æ²¡æœ‰ä»»ä½•è½¯ä»¶åŒ…ç®¡ç†å™¨æ¥å®‰è£…å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å¤åˆ¶è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬å·¥ä½œåŒºçš„ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Swift 3 æ„å»ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¯¥ç±»è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œæ‰€ä»¥å¦‚æœæ‚¨ä½¿ç”¨ Swift 3ï¼Œè¯·å¤åˆ¶å¹¶ç²˜è´´ä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœæ‚¨ä¸ä½¿ç”¨ï¼Œè¯·æŒ‰åŸæ ·ä½¿ç”¨ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`Floater.swift`å¹¶æ‰©å±•`UIView`å¯¹è±¡ã€‚å°†æ­¤ç²˜è´´åˆ°ç­çº§:

```
 import UIKit

    @IBDesignable public class Floater: UIView {

        var image1: UIImage?
        var image2: UIImage?
        var image3: UIImage?
        var image4: UIImage?

        var isAnimating: Bool = false
        var views: [UIView]!
        var duration: TimeInterval = 1.0
        var duration1: TimeInterval = 2.0
        var duration2: TimeInterval = 2.0
        var floatieSize = CGSize(width: 50, height: 50)
        var floatieDelay: Double = 10
        var delay: Double = 10.0
        var startingAlpha: CGFloat = 1.0
        var endingAlpha: CGFloat = 0.0
        var upwards: Bool = true
        var remove: Bool = true

        @IBInspectable var removeAtEnd: Bool = true {
            didSet {
                remove = removeAtEnd
            }
        }
        @IBInspectable var FloatingUp: Bool = true {
            didSet {
                upwards = FloatingUp
            }
        }
        @IBInspectable var alphaAtStart: CGFloat = 1.0 {
            didSet {
                startingAlpha = alphaAtStart
            }
        }
        @IBInspectable var alphaAtEnd: CGFloat = 0.0 {
            didSet {
                endingAlpha = alphaAtEnd
            }
        }
        @IBInspectable var rotationSpeed: Double = 10 {
            didSet {
                duration2 = 20 / rotationSpeed
            }
        }
        @IBInspectable var density: Double = 10 {
            didSet {
                floatieDelay = 1 / density
            }
        }
        @IBInspectable var delayedStart: Double = 10 {
            didSet {
                delay = delayedStart
            }
        }
        @IBInspectable var speedY: CGFloat = 10 {
            didSet {
                duration = Double(10/speedY)
            }
        }
        @IBInspectable var speedX: CGFloat = 5 {
            didSet {
                duration1 = Double(10/speedX)
            }
        }
        @IBInspectable var floatieWidth: CGFloat = 50 {
            didSet {
                floatieSize.width = floatieWidth
            }
        }
        @IBInspectable var floatieHeight: CGFloat = 50 {
            didSet {
                floatieSize.height = floatieHeight
            }
        }
        @IBInspectable var borderColor: UIColor = UIColor.clear {
            didSet {
                layer.borderColor = borderColor.cgColor
            }
        }

        @IBInspectable var borderWidth: CGFloat = 0 {
            didSet {
                layer.borderWidth = borderWidth
            }
        }

        @IBInspectable var cornerRadius: CGFloat = 0 {
            didSet {
                layer.cornerRadius = cornerRadius
            }
        }

        @IBInspectable var floaterImage1: UIImage? {
            didSet {
                image1 = floaterImage1
            }
        }
        @IBInspectable var floaterImage2: UIImage? {
            didSet {
                image2 = floaterImage2
            }
        }
        @IBInspectable var floaterImage3: UIImage? {
            didSet {
                image3 = floaterImage3
            }
        }
        @IBInspectable var floaterImage4: UIImage? {
            didSet {
                image4 = floaterImage4
            }
        }

        override public func awakeFromNib() {
            super.awakeFromNib()
        }

        func startAnimation() {
            print("Start Animating")
            isAnimating = true
            views = []
            var imagesArray = [UIImage?]()
            var actualImages = [UIImage]()
            let frameW = self.frame.width
            let frameH = self.frame.height
            var startingPoint: CGFloat!
            var endingPoint: CGFloat!
            if upwards {
                startingPoint = frameH
                endingPoint = floatieHeight*2
            } else {
                startingPoint = 0
                endingPoint = frameH - floatieHeight*2
            }
            imagesArray += [image1, image2, image3, image4]
            if !imagesArray.isEmpty {
                for i in imagesArray {
                    if i != nil {
                        actualImages.append(i!)
                    }
                }
            }

            let deadlineTime = DispatchTime.now() + .seconds(Int(self.delay * Double(NSEC_PER_SEC)))

            DispatchQueue.global().asyncAfter(deadline: deadlineTime, execute: {
                var goToNext = true
                while self.isAnimating {
                    if goToNext {
                        goToNext = false

                        DispatchQueue.main.asyncAfter(deadline: .now()+0.3, execute: {
                            let randomNumber = self.randomIntBetweenNumbers(firstNum:1, secondNum: 2)
                            var randomRotation: CGFloat!
                            if randomNumber == 1 {
                                randomRotation = -1
                            } else {
                                randomRotation = 1
                            }
                            let randomX = self.randomFloatBetweenNumbers(firstNum: 0 + self.floatieSize.width/2, secondNum: self.frame.width - self.floatieSize.width/2)
                            let floatieView = UIView(frame: CGRect(x: randomX, y: startingPoint, width: 50, height: 50))
                            self.addSubview(floatieView)

                            let floatie = UIImageView(frame: CGRect(x: 0, y: 0, width: self.floatieSize.width, height: self.floatieSize.height))

                            if !actualImages.isEmpty {

                                let randomImageIndex = (self.randomIntBetweenNumbers(firstNum: 1, secondNum: actualImages.count) - 1 )
                                floatie.image = actualImages[randomImageIndex]
                                floatie.center = CGPoint(x: 0, y: 0)
                                floatie.backgroundColor = UIColor.clear
                                floatie.layer.zPosition = 10
                                floatie.alpha = self.startingAlpha

                                floatieView.addSubview(floatie)
                                var xChange: CGFloat!
                                if randomX < self.frame.width/2 {
                                    xChange = randomX + self.randomFloatBetweenNumbers(firstNum: randomX, secondNum: frameW-randomX)
                                } else {
                                    xChange = self.randomFloatBetweenNumbers(firstNum: self.floatieSize.width*2, secondNum: randomX)
                                }

                                self.views.append(floatieView)
                                UIView.animate(withDuration: self.duration, delay: 0,
                                               options: [], animations: {
                                                floatieView.center.y = endingPoint
                                                floatie.alpha = self.endingAlpha
                                                goToNext = false
                                }, completion: {(value: Bool) in
                                    if self.remove {
                                        floatieView.removeFromSuperview()
                                    }
                                })
                                UIView.animate(withDuration: self.duration1, delay: 0,
                                               options: [.repeat, .autoreverse], animations: {
                                                floatieView.center.x = xChange
                                }, completion: nil)
                                UIView.animate(withDuration: self.duration2, delay: 0, options: [.repeat, .autoreverse], animations: {                 floatieView.transform = CGAffineTransform(rotationAngle: CGFloat(M_PI_2)*randomRotation)
                                }, completion: nil)
                            }
                        })
                    }
                }
            })
        }

        func stopAnimation() {
            print("Stop Animating")
            views = []
            isAnimating = false
            if !views.isEmpty {
                for i in views {
                    i.removeFromSuperview()
                }
            }
        }

        func randomFloatBetweenNumbers(firstNum: CGFloat, secondNum: CGFloat) -> CGFloat{
            return CGFloat(arc4random()) / CGFloat(UINT32_MAX) * abs(firstNum - secondNum) + min(firstNum, secondNum)
        }

        func randomIntBetweenNumbers(firstNum: Int, secondNum: Int) -> Int{
            return firstNum + Int(arc4random_uniform(UInt32(secondNum - firstNum + 1)))
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“è°ƒç”¨`startAnimation`æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªåº“ç®€å•åœ°åˆ›å»ºä¸€ä¸ªæµ®åŠ¨çš„å¿ƒï¼Œå½“è°ƒç”¨`stopAnimation`æ–¹æ³•æ—¶ï¼Œå®ƒåœæ­¢ã€‚ç°åœ¨æ–‡ä»¶å·²ç»åˆ›å»ºå¥½äº†ï¼Œæ‰“å¼€æ‚¨çš„`Main.storyboard`æ–‡ä»¶å¹¶å°†`Floater.swift`è§†å›¾æ·»åŠ åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æµ®åŠ¨è§†å›¾ä¸­ã€‚è¿™åº”è¯¥ä¼šåœ¨è¾¹æ ä¸­æ·»åŠ ä¸€äº›æ–°çš„é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹æ˜¯ç”±äºæ·»åŠ åˆ°`Floater.swift`ç±»çš„`@IBDesignable`å’Œ`@IBInspectable`è€Œäº§ç”Ÿçš„ã€‚

> **æç¤º:** `**IBDesignable**` **å’Œ** `**IBInspectable**` **ï¼Œä¸€ç§åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ å’Œå±æ€§çš„æ–¹å¼ã€‚è¿™å¯ä»¥ç›´æ¥æ·»åŠ åˆ° iOS ç•Œé¢ç”Ÿæˆå™¨ä¸­ã€‚** [**é˜…è¯»æ›´å¤šå…³äº IBDesignable å’Œ IBInspectable**](https://medium.com/@Anantha1992/ibdesignable-and-ibinspectable-in-swift-3-702d7dd00ca) **ã€‚**

ç°åœ¨ï¼Œåœ¨æ–°çš„é€‰é¡¹å­—æ®µä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å€¼:

[![](img/f1e7360aeb1056c4290c0ab590302b7d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iQNhT_hj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/olch8o3bx0uaek316b26.png)

å¯¹äºæµ®åŠ¨å›¾åƒï¼Œå°†ä¸€ä¸ª 30Ã—30 çš„å¿ƒå½¢å›¾åƒæ·»åŠ åˆ°æ‚¨çš„å·¥ä½œåŒºï¼Œç„¶ååœ¨æµ®åŠ¨å›¾åƒéƒ¨åˆ†é€‰æ‹©å®ƒã€‚

ç°åœ¨æ‰“å¼€`ViewController`å¹¶æ·»åŠ ä»¥ä¸‹æ–¹æ³•:

```
 @IBOutlet weak var floaterView: Floater!

    private func startEndAnimation() {
        floaterView.startAnimation()
        DispatchQueue.main.asyncAfter(deadline: .now() + 1, execute: {
            self.floaterView.stopAnimation()
        })
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ä»`hearted`æ–¹æ³•ä¸­è°ƒç”¨`startEndAnimation`ï¼Œè¿™æ ·å½“æŒ‰é’®è¢«æŒ‰ä¸‹æ—¶å°±ä¼šè°ƒç”¨å®ƒã€‚ç¡®ä¿`@IBOutlet floaterView`é“¾æ¥åˆ°æˆ‘ä»¬åœ¨æ–‡ç« å‰é¢åˆ›å»ºçš„è§†å›¾ç«¯å£ã€‚ç°åœ¨ï¼Œå½“æ‚¨æ„å»ºå’Œé¢„è§ˆæ—¶ï¼Œæ¯æ¬¡å•å‡»æŒ‰é’®æ—¶ï¼Œæ‚¨éƒ½åº”è¯¥çœ‹åˆ°å¿ƒå½¢æµ®åŠ¨ã€‚

## ä½¿ç”¨ Pusher ä¸ºæˆ‘ä»¬çš„æµ®åŠ¨å¿ƒè„æ·»åŠ å®æ—¶åŠŸèƒ½

ç°åœ¨æˆ‘ä»¬å·²ç»æˆåŠŸåœ°æ·»åŠ äº†æµ®åŠ¨å¿ƒè„ï¼Œæ¥ä¸‹æ¥è¦åšçš„æ˜¯ä½¿ç”¨ Pusher æ·»åŠ å®æ—¶åŠŸèƒ½ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œ[åˆ›å»ºä¸€ä¸ª Pusher å¸æˆ·](https://pusher.com)ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨éœ€è¦æ—¶å¤åˆ¶å‡­è¯ã€‚

æ‰“å¼€`ViewController`å¹¶åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
 static let API_ENDPOINT = "http://localhost:4000";

    var pusher : Pusher!

    let deviceUuid : String = UIDevice.current.identifierForVendor!.uuidString

    private func listenForNewLikes() {
        pusher = Pusher(key: "PUSHER_KEY", options: PusherClientOptions(host: .cluster("PUSHER_CLUSTER")))

        let channel = pusher.subscribe("likes")
        let _ = channel.bind(eventName: "like", callback: { (data: Any?) -> Void in
            if let data = data as? [String: AnyObject] {
                let uuid = data["uuid"] as! String

                if uuid != self.deviceUuid {
                    self.startEndAnimation()
                }
            }
        })
        pusher.connect()
    }

    private func postLike() {
        let params: Parameters = ["uuid": deviceUuid]

        Alamofire.request(ViewController.API_ENDPOINT + "/like", method: .post, parameters: params).validate().responseJSON { response in
            switch response.result {

            case .success:
                print("Liked")
            case .failure(let error):
                print(error)
            }
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›ç±»å±æ€§ï¼Œç”¨äºå­˜å‚¨ API ç«¯ç‚¹åŸºæœ¬ URLã€æ¨é€å™¨å®ä¾‹å’Œè®¾å¤‡ UUIDã€‚åœ¨`listenForNewLikes`ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä¾¦å¬å™¨ï¼Œå®ƒç­‰å¾… Pusher å‘é€çš„äº‹ä»¶ï¼Œç„¶ååœ¨æ¥æ”¶åˆ°äº‹ä»¶æ—¶è§¦å‘å›è°ƒã€‚æˆ‘ä»¬å°†ç”¨å®ƒæ¥è§¦å‘æµ®åŠ¨çº¢å¿ƒ`startAndEndAnimation`æ–¹æ³•ã€‚åœ¨`postLike`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`AlamoFire`æ¥è¾¾åˆ°ä¸€ä¸ªç«¯ç‚¹(æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºå®ƒ)ã€‚ç«¯ç‚¹å°†æ˜¯æˆ‘ä»¬å‘ Pusher å‘é€â€œlikeâ€äº‹ä»¶çš„åœ°æ–¹ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥è¢«å¹¿æ’­ç»™é€šé“ä¸Šçš„å…¶ä»–ä¾¦å¬å™¨ã€‚

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨çš„`ViewController`ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
 import UIKit
    import PusherSwift
    import Alamofire

    class ViewController: VideoSplashViewController {

        @IBOutlet weak var floaterView: Floater!

        static let API_ENDPOINT = "http://localhost:4000";

        var pusher : Pusher!

        let deviceUuid : String = UIDevice.current.identifierForVendor!.uuidString

        override func viewDidLoad() {
            super.viewDidLoad()
            loadVideoStreamSample()
            listenForNewLikes()
        }

        @IBAction func hearted(_ sender: Any) {
            postLike()
            startEndAnimation()
        }

        private func startEndAnimation() {
            floaterView.startAnimation()
            DispatchQueue.main.asyncAfter(deadline: .now() + 1, execute: {
                self.floaterView.stopAnimation()
            })
        }

        private func listenForNewLikes() {
            pusher = Pusher(key: "PUSHER_KEY", options: PusherClientOptions(host: .cluster("PUSHER_CLUSTER")))

            let channel = pusher.subscribe("likes")
            let _ = channel.bind(eventName: "like", callback: { (data: Any?) -> Void in
                if let data = data as? [String: AnyObject] {
                    let uuid = data["uuid"] as! String

                    if uuid != self.deviceUuid {
                        self.startEndAnimation()
                    }
                }
            })
            pusher.connect()
        }

        private func postLike() {
            let params: Parameters = ["uuid": deviceUuid]

            Alamofire.request(ViewController.API_ENDPOINT + "/like", method: .post, parameters: params).validate().responseJSON { response in
                switch response.result {

                case .success:
                    print("Liked")
                case .failure(let error):
                    print(error)
                }
            }
        }

        private func loadVideoStreamSample() {
            let url = NSURL.fileURL(withPath: Bundle.main.path(forResource: "video", ofType: "mp4")!)
            self.videoFrame = view.frame
            self.fillMode = .resizeAspectFill
            self.alwaysRepeat = true
            self.sound = true
            self.startTime = 0.0
            self.duration = 10.0
            self.alpha = 0.7
            self.backgroundColor = UIColor.black
            self.contentURL = url
            self.restartForeground = true
        }

        override var prefersStatusBarHidden: Bool {
            return true
        }  
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> **æ³¨æ„**æ‚¨åº”è¯¥ç”¨ä»æ‚¨çš„ PUSHER åº”ç”¨ä»ªè¡¨æ¿ä¸­è·å¾—çš„å®é™…å€¼æ›¿æ¢â€œPUSHER_CLUSTERâ€å’Œâ€œPUSHER_KEYâ€ã€‚**

è¿™åº”è¯¥å¯ä»¥è§£å†³ Xcode æ–¹é¢çš„é—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªåç«¯åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªåç«¯åº”ç”¨ç¨‹åºå°†ä»åº”ç”¨ç¨‹åºæ¥æ”¶æœ‰æ•ˆè½½è·ï¼Œå¹¶å°†å…¶å‘é€åˆ° Pusherã€‚

## ä¸ºæˆ‘ä»¬çš„å®æ—¶æµ®åŠ¨å¿ƒåº”ç”¨ç¨‹åºåˆ›å»º NodeJS åç«¯

ä¸º web åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶ååˆ›å»ºä¸¤ä¸ªæ–°æ–‡ä»¶:

**index.js** æ–‡ä»¶â€¦â€¦

```
 let Pusher     = require('pusher');
    let express    = require('express');
    let app        = express();
    let bodyParser = require('body-parser')
    let pusher     = new Pusher(require('./config.js')['config']);

    app.use(bodyParser.json());
    app.use(bodyParser.urlencoded({ extended: false }));

    app.post('/like', (req, res, next) => {
      let payload = {uuid: req.body.uuid}
      pusher.trigger('likes', 'like', payload)
      res.json({success: 200})
    })

    app.get('/', (req, res) => {
      res.json("It works!");
    });

    app.use((req, res, next) => {
        let err = new Error('Not Found');
        err.status = 404;
        next(err);
    });

    app.listen(4000, function() {
        console.log('App listening on port 4000!')
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`index.js`æ–‡ä»¶ä¹Ÿæœ‰ä¸€ä¸ªè·¯å¾„ï¼Œå®ƒæ¥æ”¶æ¥è‡ª iOS åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯ï¼Œå¹¶è§¦å‘åº”ç”¨ç¨‹åºè·å–çš„ Pusher äº‹ä»¶ã€‚

ä¸‹ä¸€ä¸ªæ–‡ä»¶æ˜¯ **packages.json** ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº† NPM ä¾èµ–é¡¹:

```
 {
      "main": "index.js",
      "dependencies": {
        "body-parser": "^1.16.0",
        "express": "^4.14.1",
        "pusher": "^1.5.1"
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª **config.js** ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ”¾ç½®æˆ‘ä»¬çš„æ¨é€å™¨é…ç½®:

```
 module.exports = {
        appId: 'PUSHER_ID',
        key: 'PUSHER_KEY',
        secret: 'PUSHER_SECRET',
        cluster: 'PUSHER_CLUSTER',
    }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨åœ¨ç›®å½•ä¸Šè¿è¡Œ`npm install`ï¼Œç„¶ååœ¨ npm å®‰è£…å®Œæˆåè¿è¡Œ`node index.js`ã€‚ä½ åº”è¯¥çœ‹åˆ°*åº”ç”¨ç¨‹åºç›‘å¬ 4000 ç«¯å£ï¼*æ¶ˆæ¯ã€‚

## æµ‹è¯•æˆ‘ä»¬çš„æµ®åŠ¨å¿ƒè„åº”ç”¨ç¨‹åº

ä¸€æ—¦æ‚¨çš„æœ¬åœ°èŠ‚ç‚¹ web æœåŠ¡å™¨å¼€å§‹è¿è¡Œï¼Œæ‚¨å°†éœ€è¦è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œä»¥ä¾¿æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥ä¸æœ¬åœ° web æœåŠ¡å™¨é€šä¿¡ã€‚åœ¨`info.plist`æ–‡ä»¶ä¸­ï¼Œè¿›è¡Œä»¥ä¸‹æ›´æ”¹:

[![](img/8618c6f7c70f4ab05b52fcb7c842a8ec.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NIYk_D56--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/n9bd56izghhsqjz9ah14.png)

é€šè¿‡è¿™ä¸€æ›´æ”¹ï¼Œæ‚¨å¯ä»¥æ„å»ºå¹¶è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œå®ƒå°†ç›´æ¥ä¸æ‚¨çš„æœ¬åœ° web åº”ç”¨ç¨‹åºå¯¹è¯ã€‚

## ç»“è®º

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿå¤åˆ¶åƒè„¸ä¹¦ã€Instagramã€Periscope ç­‰åº”ç”¨ç¨‹åºæ‰€å…·æœ‰çš„æµ®åŠ¨å¿ƒè„åŠŸèƒ½ã€‚æ‚¨å¯ä»¥ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œå°†å®é™…åŠŸèƒ½æ‰©å±•åˆ°æ‚¨è‡ªå·±çš„å·¥ä½œåº”ç”¨ç¨‹åºä¸­ã€‚

å¯¹æ–‡ç« æœ‰é—®é¢˜æˆ–åé¦ˆå—ï¼Ÿè¯·åœ¨è¯„è®ºåŒºä¸‹é¢æé—®ã€‚åº”ç”¨ç¨‹åºå’ŒèŠ‚ç‚¹åç«¯çš„å­˜å‚¨åº“å¯ä»¥åœ¨ [Github](https://github.com/neoighodaro/Realtime-Floating-Hearts-iOS-Pusher) ä¸Šè·å¾—ã€‚

è¿™ç¯‡åšæ–‡æœ€æ—©å‡ºç°åœ¨[æ¨æ‰‹åšå®¢](https://blog.pusher.com/create-realtime-floating-hearts-effect-ios/)ä¸Š