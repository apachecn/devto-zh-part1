# ç»©æ•ˆæ ‡å¿—:ç¼ºå¤±çš„æ‰‹å†Œï¼Œç¬¬ä¸€éƒ¨åˆ†

> åŸæ–‡:[https://dev . to/hom 3 chuk/performance-marks-the-missing-manual-part-1-B6](https://dev.to/hom3chuk/performance-marks-the-missing-manual-part-1-b6)

å›¾åƒä¸º[ç»´å¤šåˆ©äºšè¯­](https://www.shutterstock.com/g/viktoriiaa)

[`performance.mark()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/mark) æ˜¯[ç”¨æˆ·å®šæ—¶ API](https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API) çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥è¯´ï¼Œè¿™æ˜¯ç›®å‰æµè§ˆå™¨ä¸­æœ€æœ‰ç”¨çš„ä¸æ€§èƒ½ç›¸å…³çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒçš„åº”ç”¨å¯èƒ½æ€§è¿œè¿œä¸æ­¢â€œä¸ºæˆ‘æ ‡è®°è¿™ä¸ªæ—¶é—´æˆ³â€ï¼Œå°¤å…¶æ˜¯ç»“åˆå¯¹æµè§ˆå™¨å®é™…å·¥ä½œæ–¹å¼çš„æ·±å…¥ç†è§£ã€‚

## [](#basic-usage)åŸºæœ¬ç”¨æ³•

è¦ä½¿ç”¨å®ƒï¼Œåªéœ€è°ƒç”¨`performance.mark()`å¹¶åœ¨ä»»ä½• JavaScript ä»£ç ä¸­å°† mark name ä½œä¸ºå‚æ•°ä¼ é€’:

```
performance.mark("fontsLoaded"); 
```

è¿™å°†ä¸º[ç»©æ•ˆæ—¶é—´çº¿](https://www.w3.org/TR/performance-timeline/#performance-timeline)æ·»åŠ ä¸€ä¸ª[ç»©æ•ˆæ ‡è®°](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceMark)ã€‚
è¦åˆ é™¤ä¸€ä¸ªæ ‡è®°ï¼Œè°ƒç”¨`performance.clearMarks()`æ–¹æ³•:

```
performance.clearMarks("fontsLoaded"); 
```

ç›´æ¥å†…è”åˆ° HTML ä¸­çš„ JS ä¸€è¡Œç¨‹åºä¹Ÿå¯ä»¥:

```
<p>What a beautiful text</p>
<script>
  performance.mark("afterText");
</script> 
```

æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆ:â€œå˜¿ï¼ŒJS åŸºæœ¬ä¸Šæ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘èƒ½æ ‡è®°æµè§ˆå™¨åˆ°è¾¾æ–‡æ¡£ä¸­çš„*ç¡®åˆ‡è¡Œ*çš„æ—¶åˆ»å—ï¼Ÿâ€ã€‚åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œæ˜¯çš„ï¼Œä½ å¯ä»¥ã€‚è®©æˆ‘ä»¬è¯•è¯•è¿™ä¸ªï¼

## [](#mark-all-the-things)æ ‡æ³¨æ‰€æœ‰çš„äº‹ç‰©

é¦–å…ˆï¼Œä¸€ç‚¹ç†è®ºğŸ¤“ã€‚[å¤§å¤šæ•°æ—¶å€™](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers)ï¼Œæ–‡æ¡£è§£æå’Œ JS æ‰§è¡Œæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆçš„ï¼Œä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œçš„æ–‡æ¡£ç»“æ„éƒ½æ˜¯å¦‚æ­¤ã€‚å½“æµè§ˆå™¨é‡åˆ°æ ·å¼è¡¨æˆ–è„šæœ¬çš„`<link>`æ—¶ï¼Œå®ƒæš‚åœæ‰§è¡Œï¼Œä¸‹è½½å¶ç„¶å‘ç°çš„èµ„æºï¼Œè§£æå¹¶æ‰§è¡Œå®ƒï¼Œç„¶åæ‰ç»§ç»­è§£æå’Œæ‰§è¡Œä¸‹é¢çš„å†…å®¹ã€‚è¿™ä¸ªæ¦‚å¿µâ€”â€”æ¸²æŸ“é˜»å¡èµ„æºâ€”â€”å¯¹äºå®ç°å¿«é€Ÿæ¸²æŸ“æ—¶é—´è‡³å…³é‡è¦ï¼Œä¼Šåˆ©äºšÂ·æ ¼é‡Œæˆˆåˆ©å…‹åœ¨ä»–çš„æ¼”è®²å’Œ[å…è´¹åœ¨çº¿è¯¾ç¨‹](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/)ä¸­ç²¾å½©åœ°è®²è¿°äº†è¿™ä¸ªæ¦‚å¿µã€‚

ç°åœ¨ï¼Œæ’‡å¼€ä¼˜åŒ–ä¸è°ˆï¼Œä½ å¯èƒ½æƒ³çŸ¥é“*ç”±äºæ¸²æŸ“è¢«èµ„æº*é˜»å¡ï¼Œä½ æŸå¤±äº†å¤šå°‘æ—¶é—´ã€‚çœ‹ä¸€ä¸‹è¿™ä¸ªç‰‡æ®µ:

```
<html>
  <head>
  <title>Performance marks demo #1</title>
  <script>performance.mark('parsing:css:start');</script>
  <link rel="stylesheet" href="shiny-style.css">
  <script>performance.mark('parsing:css:end');</script>
  </head>
  <body>
    <p>What a beautiful text</p>
  </body>
</html> 
```

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å®ƒå°†æ ‡è®°ä¸¤ä¸ªäº‹ä»¶:ä¸€ä¸ªåœ¨æ ·å¼è¡¨é“¾æ¥ä¹‹å‰ï¼Œä¸€ä¸ªåœ¨æ ·å¼è¡¨é“¾æ¥ä¹‹åã€‚ç§ç§:
[![render-blocking CSS performance marks](../Images/aa332b41f683bb7df0291e7ca9985306.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7b7lKvEo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/li3j6ec1vlgvav8ug6cc.jpg) 
å“‡å“¦ğŸ˜±ï¼æµè§ˆå™¨èŠ±äº†å°†è¿‘ 80 æ¯«ç§’æ¥ä¸‹è½½ã€è§£æå’Œåº”ç”¨æˆ‘ä»¬é—ªäº®çš„æ ·å¼è¡¨ï¼Œæ¯”ä¸€çœ¨çœ¼çš„æ—¶é—´è¿˜è¦å¿«ã€‚ä¸è¿‡ï¼Œå¯¹äºæˆ‘ä»¬ç°æœ‰çš„ä¸€ä¸ª CSS é€‰æ‹©å™¨æ¥è¯´ï¼Œé€Ÿåº¦è¿˜ä¸å¤Ÿå¿«ã€‚

å¥½çš„ä¸€é¢æ˜¯ï¼Œæ‚¨ç°åœ¨çŸ¥é“å¦‚ä½•æµ‹é‡æ¸²æŸ“è¢«èµ„æºé˜»å¡äº†å¤šé•¿æ—¶é—´ã€‚ç­‰ç­‰ï¼Œæˆ‘è¯´`measure`äº†å—ï¼Ÿ

### [](#measures)æªæ–½

æˆ‘ä»¬éƒ½ [â¤ï¸æ•°å­¦](https://xkcd.com/55/)ï¼Œä¸æ˜¯å—ï¼Ÿä½†æ˜¯å½“æ¶‰åŠåˆ°å®é™…è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬å–œæ¬¢è®©è®¡ç®—æœºæ¥åšã€‚è¡¨ç°åˆ†æ•°ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘ä»¬æœ‰ç®€ä¾¿çš„ [`performance.measure()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/measure) æ–¹æ³•ï¼Œå—¯ï¼Œ*æµ‹é‡ä¸¤ä¸ªåˆ†æ•°ä¹‹é—´çš„*è·ç¦»ã€‚è®©æˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ HTML ç‰‡æ®µä¸­:

```
<html>
  <head>
  <title>Performance marks demo #2: measures</title>
  <script>performance.mark('parsing:css:start');</script>
  <link rel="stylesheet" href="shiny-style.css">
  <script>
    performance.mark('parsing:css:end');
    performance.measure('blocking-styles', 'parsing:css:start', 'parsing:css:end');
  </script>
  </head>
  <body>
    <p>What a beautiful text</p>
  </body>
</html> 
```

ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹[æµè§ˆå™¨](https://hom3chuk.github.io/perfmarks-demo-1/index-2.html) :
[![performance measure example](../Images/800739ce4c4c715417ea9d98ebae34c4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--YnnxkKNv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nu4gjhrhbfq5k3gg4iz1.jpg) 
å¦‚ä½•æµ‹é‡è¿™ä¸ªä¸œè¥¿ã€‚é…·ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åªçœ‹`measure`çš„`duration`è€Œä¸æ˜¯åšæ•°å­¦ã€‚è€¶ç”µè„‘ï¼

## [](#markfu)é©¬å…‹-å‚…

æˆ‘æœ¬äººä»¥åŠå…¶ä»–ä¸€äº›å¼€å‘äººå‘˜åœ¨è®¾ç½®æ ‡è®°æ—¶æ›´å–œæ¬¢ä½¿ç”¨æŸç§å‘½åç©ºé—´æ¥è·¨ä¸åŒçš„æ ‡è®°å’Œäº‹ä»¶ç±»å‹ç»„ç»‡åˆ†ç±»æ³•:

```
performance.mark("fonts:roboto:load");
performance.mark("parsing.head.start"); 
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨åªéœ€ç”¨å†’å·æˆ–ç‚¹åˆ†éš”åç§°ç©ºé—´ï¼Œæ‚¨çš„æ ‡è®°å°±ä¼šå¾—åˆ°è‰¯å¥½çš„ç»“æ„ã€‚å½“ç„¶ä½ å¯ä»¥ç”¨ä»»ä½•ä¸œè¥¿([ğŸ°ï¼Œæœ‰äººå—ï¼Ÿ](https://hom3chuk.github.io/perfmarks-demo-1/index-3.html))æ¥åˆ†éš”åç§°ç©ºé—´ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‚¹å’Œå†’å·ã€‚ç»©æ•ˆæ ‡å¿—å‘½åç©ºé—´æ²¡æœ‰å›ºå®šçš„æ ‡å‡†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨æƒ³ä½¿ç”¨çš„åˆ†éš”ç¬¦ï¼Œå°±åƒ CSV æ ¼å¼ä¸€æ ·ã€‚

## [](#retrieve-your-marks)æ‰¾å›ä½ çš„åˆ†æ•°

### [](#during-development)å‘è‚²æœŸ

ä½¿ç”¨æµè§ˆå™¨è·å¾—æ€§èƒ½åˆ†æ•°å¾ˆå®¹æ˜“:

1.  è½¬åˆ°æµè§ˆå™¨çš„å¼€å‘å·¥å…·
2.  åˆ‡æ¢åˆ° JavaScript æ§åˆ¶å°é€‰é¡¹å¡
3.  å†™ä¸‹æ¥ï¼Œå®ƒä»¬åœ¨è¿™é‡Œï¼

### [](#from-real-users)æ¥è‡ªçœŸå®ç”¨æˆ·

ç°åœ¨ï¼Œæœ€å›°éš¾çš„éƒ¨åˆ†æ˜¯ä»ä½ çš„çœŸå®ç”¨æˆ·é‚£é‡Œå–å›è¿™äº›æ ‡è®°ï¼Œæˆ‘ä»¬åœ¨å¡”åŸºéå¸¸å…³å¿ƒæ ‡è®°ã€‚æˆ‘ä»¬ç›®å‰æ­£åœ¨å¼€å‘æ ‡è®°' n 'æªæ–½ä»ªè¡¨æ¿ï¼Œè™½ç„¶æ ‡è®°å·²ç»åœ¨æˆ‘ä»¬çš„ç€‘å¸ƒè§†å›¾ä¸­å¯è§ã€‚

[Webpagetest](https://www.webpagetest.org) ï¼Œä»¥åŠæ€»éƒ¨ä½äº WPT çš„[mach metrics](https://www.machmetrics.com/)&[speed curve](https://speedcurve.com)ï¼Œéƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¯æŒç»©æ•ˆè¯„åˆ†ï¼Œä½¿ç”¨è¿™äº›å·¥å…·ä½ å¯ä»¥å¯¹ç»©æ•ˆæ—¶é—´è¡¨ä¸­çš„è¯„åˆ†ä¸€ç›®äº†ç„¶ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å¬è¯´è¿‡ WPTï¼Œé‚£å°±å»çœ‹çœ‹å§:å®ƒæ˜¯æœ€å¥½çš„#webperf å·¥å…·ä¹‹ä¸€ï¼Œå®Œå…¨å…è´¹ï¼Œä½†æœ‰å¾ˆå¤šåŠŸèƒ½ã€‚æˆ‘æ¯å¤©éƒ½ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”éå¸¸å–œæ¬¢å®ƒã€‚

## [](#who-use-it)è°ç”¨å®ƒï¼Ÿ

æ®æˆ‘æ‰€çŸ¥ï¼Œåœ¨ wild ä¸­æœ‰å‡ ä¸ªæ€§èƒ½æ ‡è®°çš„ä¾‹å­:Google Maps å’Œ Optimizelyã€‚ä»–ä»¬åœ¨ä»–ä»¬çš„å®¢æˆ·ç«¯ JS ä¸­è®¾ç½®äº†æ ‡è®°ï¼Œæ‰€ä»¥å¦‚æœä½ åµŒå…¥äº† GMapsï¼Œæˆ–è€…åšäº†ä¸€äº›ä¼˜åŒ–å®éªŒï¼Œç”¨ä½ çš„ devtools åœ¨é‚£äº›é¡µé¢ä¸Šæ£€æŸ¥æ€§èƒ½æ¡ç›®ï¼

## [](#what-next)æ¥ä¸‹æ¥å‘¢ï¼Ÿ

åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºæ›´å¤šçš„é«˜çº§æ ‡è®°ç¬¦ï¼Œå¹¶å‘Šè¯‰ä½ ä¸åŒæµè§ˆå™¨åœ¨æ ‡è®°å¤„ç†ä¸Šçš„å·®å¼‚(ä½ ç”šè‡³ä¸è®¤ä¸ºæˆ‘ä»¬å¼€å‘çš„æ‰€æœ‰æµè§ˆå™¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯å—ï¼ŸğŸ˜‰).

å¦‚æœä½ çŸ¥é“é™¤äº†è°·æ­Œåœ°å›¾å’Œ Optimizely ä¹‹å¤–çš„ä¸€äº›å…¶ä»–é‡å¤–æ ‡è®°çš„ä¾‹å­ï¼Œè¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­åˆ†äº«å®ƒä»¬ã€‚å½“ç„¶ï¼Œæˆ‘é¼“åŠ±ä½ åˆ†äº«ä½ ä½¿ç”¨ marks çš„ç»éªŒï¼Œæˆ‘å¾ˆä¹æ„çœ‹çœ‹å…¶ä»–å¼€å‘è€…ä½¿ç”¨ marks çš„æ–¹æ³•ã€‚

è®°ä½ï¼Œ#perfmattersï¼