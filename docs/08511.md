# ä½¿ç”¨ requestIdleCallback åˆ›å»ºä¸€ä¸ªç®€å•çš„æ— é™æ»šåŠ¨

> åŸæ–‡:[https://dev . to/Ben/using-requestidlecallback-to-create-a-less-janky-infinite-scroll](https://dev.to/ben/using-requestidlecallback-to-create-a-less-janky-infinite-scroll)

æˆ‘ä»¬æœ€è¿‘ä»åˆ†é¡µçš„ home feed æ¢æˆäº†æ— é™æ»šåŠ¨çš„ã€‚æˆ‘ä»¬æ—©å°±åº”è¯¥è¿™ä¹ˆåšäº†ï¼Œå› ä¸ºè¿™è®©ååœ¨é©¬æ¡¶ä¸Šæµè§ˆä¸» [dev åˆ°](https://dev.to/) feed å˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¿™éš¾é“ä¸æ˜¯ç»ˆæç›®æ ‡å—ï¼Ÿ

ä½†æ˜¯ï¼Œå½“ç”¨æˆ·æ»šåŠ¨é¡µé¢è€Œä¸ä¸­æ–­å¸§é€Ÿç‡æ—¶ï¼Œå‘é¡µé¢æ·»åŠ  30 ä¸ªå…ƒç´ ä¸ä¼šè‡ªåŠ¨å‘ç”Ÿã€‚æˆ‘å¸Œæœ›æˆ‘ä»¬èƒ½å°½ä¸€åˆ‡åŠªåŠ›ç¡®ä¿ä¸€æ¬¡æ²¡æœ‰æ¶ä½œå‰§çš„ç»å†ã€‚è¿™å°±æ˜¯æˆ‘ä½¿ç”¨ [`requestIdleCallback`](https://developers.google.com/web/updates/2015/08/using-requestidlecallback) çš„åŸå› ã€‚

API æ˜¯ä¸€ä¸ªæ–°çš„ APIï¼Œå¯¹æµè§ˆå™¨çš„æ”¯æŒæœ‰é™ï¼Œä½†æ˜¯å®ƒéå¸¸å®¹æ˜“ä½¿ç”¨ï¼Œå¹¶ä¸”æ”¯æŒæˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„ç›®æ ‡ã€‚å½“ä¸€å¸§ç»“æŸæ—¶æœ‰ç©ºé—²æ—¶é—´ï¼Œæˆ–è€…å½“ç”¨æˆ·ä¸æ´»åŠ¨æ—¶ï¼ŒAPI å°†å®‰æ’å·¥ä½œã€‚æ— é™æ»šåŠ¨æ˜¯è¿™ç§è¡Œä¸ºçš„ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ã€‚è¿™æ˜¯ä¸€ç§åœ¨æ»šåŠ¨çš„åŒæ—¶éœ€è¦é‡ç”»æµè§ˆå™¨çš„æƒ…å†µã€‚

[![](img/ae3e9777e081a7e79199328593629ac7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--rBVDBTsh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vsyq6t0vvamnig63zte3.png)

> è‡ªå·±å®‰æ’éå¿…è¦çš„å·¥ä½œæ˜¯éå¸¸å›°éš¾çš„ã€‚ä¸å¯èƒ½å‡†ç¡®è®¡ç®—å‡ºè¿˜å‰©ä¸‹å¤šå°‘å¸§æ—¶é—´ï¼Œå› ä¸ºåœ¨`requestAnimationFrame`å›è°ƒæ‰§è¡Œä¹‹åï¼Œè¿˜æœ‰æ ·å¼è®¡ç®—ã€å¸ƒå±€ã€ç»˜åˆ¶å’Œå…¶ä»–æµè§ˆå™¨å†…éƒ¨éœ€è¦è¿è¡Œã€‚è‡ªåˆ¶çš„è§£å†³æ–¹æ¡ˆæ— æ³•è§£å†³è¿™äº›é—®é¢˜ã€‚ä¸ºäº†ç¡®ä¿ç”¨æˆ·æ²¡æœ‰ä»¥æŸç§æ–¹å¼è¿›è¡Œäº¤äº’ï¼Œæ‚¨è¿˜éœ€è¦ä¸ºæ¯ç§äº¤äº’äº‹ä»¶(`scroll`ã€`touch`ã€`click`)é™„åŠ ç›‘å¬å™¨ï¼Œå³ä½¿æ‚¨åœ¨åŠŸèƒ½ä¸Šä¸éœ€è¦å®ƒä»¬ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç»å¯¹ç¡®ä¿ç”¨æˆ·æ²¡æœ‰è¿›è¡Œäº¤äº’ã€‚å¦ä¸€æ–¹é¢ï¼Œæµè§ˆå™¨ç¡®åˆ‡åœ°çŸ¥é“åœ¨ä¸€å¸§ç»“æŸæ—¶æœ‰å¤šå°‘æ—¶é—´å¯ç”¨ï¼Œä»¥åŠç”¨æˆ·æ˜¯å¦æ­£åœ¨äº¤äº’ï¼Œå› æ­¤é€šè¿‡`requestIdleCallback`ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸€ä¸ª APIï¼Œå…è®¸æˆ‘ä»¬ä»¥æœ€æœ‰æ•ˆçš„æ–¹å¼åˆ©ç”¨ä»»ä½•ç©ºé—²æ—¶é—´ã€‚

å¤§çº¦ä¸‰åˆ†ä¹‹äºŒçš„[å¼€å‘è€…åˆ°](https://dev.to/)çš„è®¿é—®è€…æ˜¯é€šè¿‡æ”¯æŒ`requestIdleCallback`çš„æµè§ˆå™¨è®¿é—®çš„ï¼Œè¿™ä¸ª API å¸å¼•äººçš„åœ°æ–¹åœ¨äºï¼Œå¾ˆå®¹æ˜“æ·»åŠ ä¸€ä¸ªç®€å•çš„æµè§ˆå™¨æ”¯æŒæ£€æŸ¥ï¼Œå¦åˆ™å°±é€€å›åˆ°é»˜è®¤è¡Œä¸ºã€‚

### è¿™é‡Œæ˜¯æˆ‘ä»¬æ— é™å·è½´çš„ä»£ç 

```
 if (('requestIdleCallback' in window) && distanceFromBottom > 1400) {
    requestIdleCallback(function(){ appendPosts(newArticlesHTML) }, { timeout: 1500 });
  } else {
    appendPosts(newArticlesHTML);
  } 
```

### è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

```
('requestIdleCallback' in window) 
```

è¿™å°†è¯¢é—® API æ˜¯å¦å¯ç”¨ã€‚

```
distanceFromBottom > 1400 
```

è¿™æ˜¯åœ¨é—®æˆ‘ä»¬æ˜¯å¦ç¦»åº•éƒ¨è¿˜è¶³å¤Ÿè¿œï¼Œä¸éœ€è¦ç­‰å¾…ã€‚å¦‚æœæˆ‘ä»¬æ¥è¿‘ï¼Œæˆ‘ä»¬å°†è·³è¿‡`requestIdleCallback`éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå¦‚æœç”¨æˆ·æ»šåŠ¨å¾—éå¸¸å¿«ï¼Œä»–ä»¬ä¼šé©¬ä¸Šçœ‹åˆ°é™„åŠ çš„å¸–å­ã€‚

```
requestIdleCallback(function(){ appendPosts(newArticlesHTML) }, { timeout: 1500 }) 
```

è¿™è¦æ±‚æµè§ˆå™¨å°½å¯èƒ½æ‰§è¡Œ`requestIdleCallback`ï¼Œä½†ç­‰å¾…æ—¶é—´ä¸è¦è¶…è¿‡ 1.5 ç§’ã€‚

```
else {
    appendPosts(newArticlesHTML);
  } 
```

å¦‚æœä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œæˆ‘ä»¬å°±ä¸ç†ä¼š`requestIdleCallback`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è°ƒç”¨å‡½æ•°å°±è¶³å¤Ÿäº†ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³å‡ºè‡ªå®šä¹‰é€»è¾‘æ¥å¼•å¯¼ç±»ä¼¼äº requestIdleCallback çš„ç»“æœã€‚æ ¹æ®ä½ çš„éœ€è¦ï¼Œæœ‰ä¸€äº›[èšåˆå¡«æ–™å¯ç”¨](https://github.com/search?utf8=%E2%9C%93&q=requestidlecallback+polyfill&type=)ï¼Œä½†æ˜¯ä½ çš„é‡Œç¨‹æ•°ä¸€å®šä¼šéšç€è¿™ç§ API èšåˆå¡«æ–™è€Œå˜åŒ–ã€‚æˆ‘ä¸ä¼šç›²ç›®åœ°ä¾èµ–è¿™äº›ã€‚

## æœ€åçš„æƒ³æ³•

è¿™åªæ˜¯å­—é¢ä¸Šçš„æ„æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šä¿®æ”¹å®ç°ï¼Œæˆ–è€…æ„è¯†åˆ°æˆ‘ä»¬éœ€è¦é‡‡å–ä¸åŒçš„æ–¹æ³•ã€‚ä¸è¿‡ï¼Œæˆ‘é€‰æ‹©è¿™ä¸ª API çš„ä¸€ä¸ªé‡è¦åŸå› æ˜¯ï¼Œå®ƒæ˜“äºå®ç°ï¼Œå¹¶ä¸”å¯ä»¥ä¼˜é›…åœ°åé€€ã€‚æˆ‘ä¸éœ€è¦è¿›è¡Œé‡å¤§çš„æˆæœ¬æ•ˆç›Šåˆ†æï¼Œå› ä¸ºå®æ–½æˆæœ¬éå¸¸ä½ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦é‡‡å–ä¸€ç§ä¸åŒçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ä¼šç”¨è¿‡äºå¤æ‚çš„ API å‡ºå–è‡ªå·±ã€‚

*ç¼–è¾‘:å…³äºå‰é¢æåˆ°çš„â€œä¸Šå•æ‰€â€çš„è¨€è®ºï¼Œæˆ‘ç»™ä½ å‘è¿™æ¡æ¨æ–‡*ğŸ˜³

> ![unknown tweet media content](img/eeb69483d9ef5cf549bc19a482c65576.png)![beld ğŸ© profile image](img/3585ac8277143e1e1efa48aa8ef4fdef.png)beldğŸ©[@ beld _ pro](https://dev.to/beld_pro)![twitter logo](img/ca5dfdb28b446702d18cbfa9843f8167.png)[@ ThePracticalDev](https://twitter.com/ThePracticalDev)[@ bendhalpern](https://twitter.com/bendhalpern)é¡ºä¾¿è¯´ä¸€å¥ï¼Œç›®å‰åœ¨å•æ‰€å‘ä¸‹æ»šåŠ¨ dev.toğŸ¤”æ‰€æœ‰å…³äºè®¡æ—¶2017 å¹´ 4 æœˆ 13 æ—¥ä¸‹åˆ 16:53[![Twitter reply action](img/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=852565413393297408)0[![Twitter like action](img/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=852565413393297408)0