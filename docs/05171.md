# ç§‘ç‰¹æ—çš„å››äººç»„æ¨¡å¼-è½»å¾®å›å½’

> åŸæ–‡:[https://dev.to/lovis/gang-of-four-patterns-in-kotlin-è½»å¾®-è¿”å›](https://dev.to/lovis/gang-of-four-patterns-in-kotlin---slight-return)

å¾ˆå¤šäººåœ¨ Kotlin ä¸Šè¯»è¿‡æˆ‘çš„æ–‡ç« [å››äººå¸®æ¨¡å¼ã€‚è€å®è¯´ï¼Œæˆ‘æ²¡æƒ³åˆ°ä¼šæœ‰è¿™ä¹ˆå¤§çš„åå“ã€‚å®ƒè¢«ç‰¹åˆ«æŠ¥é“ã€è½¬å‘å’Œè®¨è®ºã€‚å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œ](https://dev.to/lovis/gang-of-four-patterns-in-kotlin/) [github åº“](https://github.com/lmller/gof-in-kotlin)å·²ç»æ”¶åˆ°äº† 100 å¤šé¢—æ˜Ÿæ˜Ÿã€‚ä¸ºæ­¤æ„Ÿè°¢å¤§å®¶ï¼ğŸ™Œ

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³å†æ¬¡æå‡ºè®¨è®ºæœ€å¤šçš„æ¨¡å¼:**è£…é¥°å™¨**å’Œ**ç”Ÿæˆå™¨**ã€‚
æ­¤å¤–ï¼Œæˆ‘æƒ³æ·»åŠ ä¸€ä¸ª Kotlin å®ç°çš„ä¾‹å­ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ°ç›®å‰ä¸ºæ­¢å­˜å‚¨åº“ä¸­ç¼ºå°‘çš„é‡è¦æ¨¡å¼:è®¿é—®è€…**ã€‚**

 *** * *

#### è£…é¥°å·¥

> GoF ä¸­å±•ç¤ºçš„è£…é¥°æ¨¡å¼åªæ˜¯å®ç°åŠŸèƒ½ç»„åˆçš„ä¸€ç§éå¸¸å¤æ‚çš„æ–¹å¼

è¿™æ˜¯é©¬é‡Œå¥¥Â·å¯Œæ–¯ç§‘ç»™æˆ‘çš„è¯„è®ºã€‚æˆ‘è¯¥è¯´ä»€ä¹ˆï¼Ÿæˆ‘è®¤ä¸ºä»–æ˜¯æ­£ç¡®çš„ã€‚æˆ‘ä¸æƒ³ä½¿ç”¨ Mario åœ¨ä»–çš„å­˜å‚¨åº“ä¸­ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æˆ‘é€€å›åˆ°â€œçº¯â€Kotlin æ–¹æ³•ã€‚ç„¶è€Œï¼Œ[functionale](https://github.com/MarioAriasC/funKTionale)ï¼Œä¸€ä¸ªä¸º Kotlin æ·»åŠ äº†è®¸å¤šâ€œæ ‡å‡†â€å‡½æ•°æ¨¡å¼çš„åº“ï¼Œè¡¨æ˜ä½¿ç”¨ Kotlin è¿›è¡Œå‡½æ•°ç»„åˆå®é™…ä¸Šæ˜¯å¯èƒ½çš„ï¼Œè€Œä¸”æ²¡æœ‰æ¯”ä½¿ç”¨æ‰©å±•å‡½æ•°æ›´â€œçº¯ç²¹â€çš„äº†ã€‚

ä¸‹é¢æ˜¯åŒä¸€ä¸ªæ—§çš„è£…é¥°å™¨ç¤ºä¾‹ï¼Œä½†æ˜¯è¿™æ¬¡ä½¿ç”¨äº†å‡½æ•°ç»„åˆ:

```
fun ((String) -> String).then(f: (String) -> String): (String) -> String {
    return { t -> f(this(t)) }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚`(String) -> String.then`æ„å‘³ç€å‡½æ•°`then`è¢«æ·»åŠ åˆ°æ‰€æœ‰æ¥å—`String`å¹¶è¿”å›`String`çš„å‡½æ•°ä¸­ã€‚è¿™æ„å‘³ç€`then`æ˜¯å‡½æ•°çš„ä¸€ä¸ª*æ‰©å±•å‡½æ•°ã€‚
è¿™é‡Œæœ‰è¶£çš„éƒ¨åˆ†æ˜¯`then`ä¹Ÿå°†ç›¸åŒç±»å‹çš„å‡½æ•°ä½œä¸ºå®ƒæ‰©å±•çš„å‚æ•°ï¼›å¹¶ä¸”å®ƒä¹Ÿè¿”å›ç›¸åŒç±»å‹çš„å‡½æ•°ã€‚
å› æ­¤å¯ä»¥è¿™æ ·å†™:* 

```
val compose: (String) -> String = { string: String -> "$string?" }.then { string: String -> string.replace('c', 'k') }

println(compose("functional")) // will print "funktional?" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒåªæ˜¯å°†å‡½æ•°è°ƒç”¨é“¾æ¥åœ¨ä¸€èµ·ï¼Œé¦–å…ˆåœ¨åŸå§‹å€¼ä¸ŠåŠ ä¸€ä¸ª`?`ï¼Œå¹¶ç”¨`k`æ›¿æ¢æ‰€æœ‰çš„`c`ã€‚

ä½¿ç”¨`infix`ä¿®æ”¹å™¨å¯ä»¥ç¨å¾®æ¸…ç†ä¸€ä¸‹ã€‚`infix`å‡½æ•°æ˜¯ä¸€ä¸ªä¸ç”¨æ‹¬å·æˆ–ç‚¹å°±å¯ä»¥è®¿é—®çš„å‡½æ•°ã€‚
ä¸€ä¸ªä¾‹å­æ˜¯ Kotlin çš„å†…ç½®`to`å‡½æ•°ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ª`Pair` :

```
val pair = "key".to("value") // this is possible
val pair = "key" to "value" // but this is nicer. it works thanks to infix 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`infix`ä¿®é¥°ç¬¦åº”ç”¨åˆ°`then`å‡½æ•°ä¼šäº§ç”Ÿä¸‹é¢çš„ä»£ç :

```
infix fun ((String) -> String).then(f: (String) -> String): (String) -> String { ... }
...
val compose = { ... } then { ... } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†è®©è¿™ä¸ªä¾‹å­æ›´ç±»ä¼¼äºæ—§çš„ä¾‹å­ï¼Œæˆ‘å¼•å…¥äº†å¦ä¸€ä¸ª`infix`æ‰©å±•å‡½æ•°:

```
infix fun String.decorate(f: (String) -> String): Text {
    return DefaultText(f(this))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªå‡½æ•°`decorate`æ˜¯å¯¹`String`çš„æ‰©å±•å‡½æ•°ï¼Œå®ƒç”¨å‡½æ•°`f`çš„ç»“æœæ„é€ äº†ä¸€ä¸ª`DefaultText`å¯¹è±¡ã€‚
**æˆ‘ç°åœ¨å®é™…ä¸Šæ˜¯åœ¨è£…é¥°`Strings`è€Œä¸å†æ˜¯`Text`** å¯¹è±¡äº†ï¼Œä½†ç»“æœæ˜¯ä¸€æ ·çš„ã€‚

æœ‰äº†è¿™ä¸¤ä¸ªæ‰©å±•å‡½æ•°ï¼Œæˆ‘ç°åœ¨å¯ä»¥åˆ›å»ºå¹¶ç»˜åˆ¶ä¸€ä¸ªè£…é¥°æ–‡æœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
 fun underline(text: String) = "_${text}_"
 fun background(text: String) = "\u001B[43m$text\u001B[0m"

 val text = "Functional" decorate (::underline then ::background)

 text.draw() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`then`å‡½æ•°*ä¸`background`å‡½æ•°*ç»„æˆ`underline`ã€‚æˆ‘åœ¨è¿™é‡Œä½¿ç”¨å‡½æ•°å¼•ç”¨ï¼Œ(`::`)ï¼Œä½†æ˜¯ lambdas ä¹Ÿå¯ä»¥ã€‚
è¿™æ˜¯å‡½æ•°ç»„åˆçš„ä¸€ä¸ªéå¸¸å…·ä½“çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘å¯¹å®ƒè¿›è¡Œé‡æ„å’Œæ¦‚æ‹¬ï¼Œå®ƒæœ€ç»ˆå°†ä¸æ¥è‡ª[functionale åº“](https://github.com/MarioAriasC/funKTionale) :
çš„ç»„åˆç›¸åŒ

```
infix fun <P1, IP, R> ((P1) -> IP).andThen(f: (IP) -> R): (P1) -> R = { p1: P1 -> f(this(p1)) } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

#### æ„å»ºå™¨

æœ‰äº›äººæ³¨æ„åˆ°æˆ‘çš„**æ„å»ºå™¨**çš„ä¾‹å­å¹¶ä¸åœ°é“ï¼Œå› ä¸ºä½ å¯ä»¥ç®€å•åœ°ä½¿ç”¨å¸¦æœ‰å‘½åå‚æ•°çš„æ„é€ å™¨ã€‚æˆ‘ç¡®å®åŒæ„è¿™ç§è¯´æ³•ï¼Œä½†å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½åŒæ„ã€‚
æˆ‘çš„ä¾‹å­å¾ˆç®€å•ï¼›ä¸€ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°çš„`Car`ç±»ã€‚

```
class Car() {
    var color: String = "red"
    var doors = 3

    override fun toString() = "$color car with $doors doors"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†è¿™å·²ç»æ˜¯é—®é¢˜äº†ã€‚å¤ªç®€å•äº†ã€‚æ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°(å¹¶ä¸”æ›´ä¹ æƒ¯åœ°)ç”¨æ„é€ å‡½æ•°å‚æ•°æ¥ç¼–å†™å®ƒ:

```
class Car(var color = "red", var doors = 3) {
    override fun toString() = "$color car with $doors doors"
}

//called e.g. like this:
val car1 = Car(color="green")
val car2 = Car(doors=4, color="blue")
val car3 = Car() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¨¡å¼ã€‚å¯¹äºç®€å•çš„ä¾‹å­ï¼Œå®ƒç»å¯¹å¯ä»¥å–ä»£**æ„å»ºå™¨**æ¨¡å¼ã€‚ä½†æ˜¯å¦‚æœä½ æœ‰æ›´å¤šçš„æˆ¿äº§å‘¢ï¼Ÿå®ƒä¼šå˜å¾—å¾ˆéš¾çœ‹ã€‚é™¤äº†è§†è§‰æ•ˆæœï¼Œæˆ‘è¦è¯´çš„æ˜¯ï¼Œä¸€ä¸ªè¶…è¿‡ 5 ä¸ªæ„é€ å‡½æ•°å‚æ•°çš„ç±»å‡ ä¹æ€»æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºå®ƒå¯èƒ½åšå¤ªå¤šçš„äº‹æƒ…(é™¤éå®ƒéƒ½æ˜¯æ•°æ®)ã€‚
è¿™ç§æ–¹æ³•çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä¸èƒ½é‡ç”¨å’Œä¼ é€’é…ç½®ã€‚æœ‰äº†`apply`ï¼Œæˆ‘å¯ä»¥å‡†å¤‡ä¸€ä¸ªè¿™æ ·çš„æ±½è½¦é…ç½®:

```
val config: Car.() -> Unit = {
    color = "yellow"
    doors = 5
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶åœ¨ä»¥åé€šè¿‡ä½¿ç”¨`Car().apply(config)`æ¥åº”ç”¨å®ƒã€‚æˆ‘è¿˜å¯ä»¥ä¸€æ¬¡åº”ç”¨å¤šä¸ªé…ç½®ï¼Œè¿™æ¯”ä½¿ç”¨å‡ åä¸ªæ„é€ å‡½æ•°å‚æ•°æ›´å®¹æ˜“é˜…è¯»ä»£ç ã€‚

```
val car = Car()
           .apply(COBALT_BLUE)
           .apply(LEATHER_PACKAGE)
           .apply(TIRES_18_INCH) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ä¸ºäº†ä¿æŒçµæ´»æ€§ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»ç„¶æ›´å–œæ¬¢`apply`æ–¹æ³•ï¼Œä½†æ˜¯æ„é€ å‡½æ•°æ–¹æ³•åŒæ ·æœ‰ç”¨å’Œæœ‰æ•ˆã€‚

* * *

#### æ¥è®¿è€…

> è¡¨ç¤ºè¦åœ¨å¯¹è±¡ç»“æ„çš„å…ƒç´ ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è®¿é—®è€…å…è®¸ä½ å®šä¹‰ä¸€ä¸ªæ–°çš„æ“ä½œï¼Œè€Œä¸æ”¹å˜å®ƒæ‰€æ“ä½œçš„å…ƒç´ çš„ç±»

å½“æˆ‘æƒ³æä¾›ä¸€ç»„åœ¨ç›¸åŒå…ƒç´ ä¸Šæ“ä½œçš„ä¸ç›¸å…³çš„ç®—æ³•æ—¶ï¼Œä¸€ä¸ª**è®¿é—®è€…**å¯ä»¥æ˜¯è§£å†³æ–¹æ¡ˆã€‚ä¸ä¾‹å¦‚**ç­–ç•¥**çš„åŒºåˆ«åœ¨äºï¼Œè¢«æ‰§è¡Œçš„æ“ä½œå–å†³äºä¸¤ç§ç±»å‹:è®¿é—®è€…**çš„ç±»å‹å’Œå®ƒâ€œè®¿é—®â€çš„å…ƒç´ çš„ç±»å‹ã€‚è¿™å«åš*åŒè°ƒåº¦*ã€‚è¿™æ˜¯è¿™ä¸ªæ¨¡å¼çš„å…³é”®ã€‚å…ƒç´ ä¸ä¼šå‘å…ƒç´ æ·»åŠ è®¸å¤šæ–¹æ³•ï¼Œå› æ­¤é™æ€åœ°å°†æ‰€æœ‰å¯èƒ½çš„åŠŸèƒ½ç»‘å®šåˆ°å®ƒä»¬ï¼Œå…ƒç´ å°†åªå£°æ˜ä¸€ä¸ªæ–¹æ³•`accept`ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¯´â€œè¯·åœ¨æˆ‘èº«ä¸Šæ“ä½œâ€,å¹¶åˆ©ç”¨ OOP æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€â€”â€”åŠ¨æ€ç»‘å®šã€‚**

ä¸è¿‡ï¼Œè¿™ä¹Ÿæœ‰ä¸€äº›æš—ç¤ºã€‚è™½ç„¶æ·»åŠ æ–°çš„æ“ä½œå¾ˆå®¹æ˜“ï¼Œä½†æ˜¯å‘å…ƒç´ å±‚æ¬¡ç»“æ„æ·»åŠ æ–°çš„ç±»å´ç›¸å½“å›°éš¾ã€‚å¯¹äºå±‚æ¬¡ç»“æ„ä¸­çš„æ¯ä¸ªæ–°ç±»ï¼Œæ¯ä¸ªè®¿é—®è€…éƒ½éœ€è¦å®ç°ä¸€ä¸ªæ–°æ–¹æ³•ã€‚

è®¿é—®è€…åŠå…¶å¯¹åº”çš„å…ƒç´ å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

```
interface ShapeVisitor<T> {
  T visit(Square element);
  T visit(Circle element);
  T visit(Rectangle element);
  // ... and another `visit` method for every element of the hierarchy
}
interface Shape {
   <T> T accept(ShapeVisitor<T> visitor);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

(è¿™æ¬¡æˆ‘å·äº†é©¬é‡Œå¥¥Â·å¯Œæ–¯ç§‘çš„ä¾‹å­ã€‚æˆ‘ä¸è§‰å¾—ç¾è€»ï¼)

`Shape`çš„æ¯ä¸ªå­ç±»å‹éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªå½¢çŠ¶éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•æ¥æ¥å—ç®—æ³•ã€‚ä¸€ä¸ªå…·ä½“çš„è®¿é—®è€…å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·:

```
public static class AreaVisitor implements ShapeVisitor<Double> {
        public Double visit(Square element) {
            return element.side * element.side;
        }

        public Double visit(Circle element) {
            return Math.PI * element.radius * element.radius;
        }

        public Double visit(Rectangle element) {
            return element.height * element.width;
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶ä¸”ä¼šè¢«è¿™æ ·ç§°å‘¼:

```
 double totalArea = 0.0;
 ShapeVisitor<Double> areaVisitor = new AreaVisitor();
 for (Shape figure : figures) {
    totalArea += figure.accept(areaVisitor);
 }
 System.out.println("Total area = " + totalArea); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¦æ·»åŠ å¦ä¸€ä¸ªæ“ä½œï¼Œæˆ‘å¯ä»¥ç®€å•åœ°æ·»åŠ å¦ä¸€ä¸ª**è®¿é—®è€…**

```
public static class PerimeterVisitor implements ShapeVisitor<Double> {
        public Double visit(Square element) {
            return 4 * element.side;
        }

        public Double visit(Circle element) {
            return 2 * Math.PI * element.radius;
        }

        public Double visit(Rectangle element) {
            return (2 * element.height + 2 * element.width);
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚å…¶ä»–äººå·²ç»æŒ‡å‡ºçš„ï¼Œè¿™åªæ˜¯åœ¨å¯¹è±¡çš„ç±»ä¸Šåšä¸€ä¸ª`switch`è¯­å¥çš„ä¸€ç§å¤æ‚æ–¹å¼ã€‚Java åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸Šæ²¡æœ‰`switch`ã€‚åæ­£è¿™è¢«è®¤ä¸ºæ˜¯å oop çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ã€‚
å‡½æ•°å¼ç¼–ç¨‹æœ‰ä¸€ä¸ªæ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯è¿™æ ·çš„:*æ¨¡å¼åŒ¹é…*ã€‚

å¹¸è¿çš„æ˜¯ï¼ŒKotlin æ˜¯ä¸€ç§å¤šèŒƒä¾‹è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦*çº¯ç²¹çš„*é¢å‘å¯¹è±¡ã€‚åŒæ ·å¹¸è¿çš„æ˜¯ï¼ŒKotlin å°†â€œå…‰â€ä¸`when`è¡¨è¾¾å¼å’Œ`sealed`ç±»è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚

```
sealed class Shape()
class Square(val side: Double) : Shape()
class Circle(val radius: Double) : Shape()
class Rectangle(val width: Double, val height: Double) : Shape() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯†å°ç±»çš„å¥½å¤„æ˜¯â€”â€”ä¸åƒæ¥å£æˆ–`abstract`ç±»â€”
,ç¼–è¯‘å™¨çŸ¥é“è¯¥ç±»çš„æ¯ä¸€ç§å¯èƒ½çš„è¡¨ç°å½¢å¼ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª`when`è¡¨è¾¾å¼æ¥æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¯èƒ½çš„å­ç±»éƒ½è¢«æ£€æŸ¥è¿‡:

```
 val areaVisitor = { shape: Shape ->
        when (shape) {
            is Rectangle -> shape.height * shape.width
            is Circle -> shape.radius.square() * Math.PI
            is Square -> shape.side.square()
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘åˆ é™¤äº†è¡Œ`is Square -> ...`ï¼Œä»£ç å°†æ— æ³•ç¼–è¯‘(è¿™ç±»ä¼¼äº`enum`çš„è¡Œä¸ºã€‚è¿˜è¦æ³¨æ„[æ™ºèƒ½ç±»å‹è½¬æ¢](https://kotlinlang.org/docs/reference/typecasts.html#smart-casts)çš„ç”¨æ³•ï¼Œå®ƒå…è®¸åœ¨æ²¡æœ‰æ˜¾å¼ç±»å‹è½¬æ¢çš„æƒ…å†µä¸‹è®¿é—®å­ç±»çš„å±æ€§(ä¾‹å¦‚`radius`æˆ–`side`)ã€‚

ç°åœ¨ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ lambda-visitor æ¥æ€»ç»“æ‰€æœ‰åŒºåŸŸã€‚

```
 val totalArea = figures.sumByDouble { areaVisitor(it) }
 println("Total area = $totalArea") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ ä¸€ä¸ªæ–°çš„**è®¿é—®è€…**ä¹Ÿå¾ˆå®¹æ˜“ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ªæ–°çš„ lambdaã€‚

```
val perimeterVisitor = { shape: Shape ->
        when (shape) {
            is Rectangle -> 2 * shape.height + 2 * shape.width
            is Circle -> 2 * Math.PI * shape.radius
            is Square -> 4 * shape.side
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨`when`è¯­å¥ç”šè‡³å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼Œä¾‹å¦‚ä¸€ä¸ª`else`åˆ†æ”¯æˆ–è€…ä¸ºå¤šä¸ªæ¡ä»¶å…±äº«åŒä¸€ä¸ªæ“ä½œã€‚
è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œæˆ‘å»ºè®®æŸ¥çœ‹å…³äº [`when`](https://kotlinlang.org/docs/reference/control-flow.html#when-expression) å’Œ [`sealed`èŒä¸š](https://kotlinlang.org/docs/reference/sealed-classes.html)çš„æ–‡æ¡£ã€‚

æˆ‘æŠŠå®Œæ•´çš„æ–°ä¾‹å­æ·»åŠ åˆ°äº† github åº“ã€‚ğŸ’¥

* * *

<sup>å°é¢å›¾ç‰‡å–è‡ª[stock snap . io](http://stocksnap.io)T3ã€‘</sup>**