# å¿«ç…§æµ‹è¯•ç®€ä»‹ğŸ“¸

> åŸæ–‡:[https://dev.to/skyweb07/an-intro-to-snapshot-testing-æŸ¯](https://dev.to/skyweb07/an-intro-to-snapshot-testing--ke)

å› æ­¤ï¼Œæˆ‘æ­£åœ¨åˆ¶ä½œä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘å¾ˆä¹æ„åˆ†äº«æˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥ä¿æŒè‡ªæˆ‘æ¿€åŠ±ï¼Œå¹¶åˆ†äº«ä¸€äº›çŸ¥è¯†ï¼Œå¸Œæœ›ä½ å¯ä»¥ç”¨äºä½ è‡ªå·±çš„åº”ç”¨ç¨‹åºã€‚

### ğŸ¨ä¸ºä»€ä¹ˆè¦æµ‹è¯• UIï¼Ÿ

ä½ è¦ç¡®ä¿æ¯æ¬¡æ¥è§¦ä»»ä½• UI å…ƒç´ æ—¶ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½ä¿æŒå®ƒä»¬åŸæœ¬çš„æ ·å­ï¼Œè€Œä¸”è¿™ç§é›†æˆæµ‹è¯•å¯ä»¥å¸®åŠ©ä½ å®ç°å®Œç¾çš„åƒç´ è§†å›¾ï¼Œè®©ä½ çš„è®¾è®¡è€…é«˜å…´ï¼Œå› ä¸ºä»–ä»¬ç”šè‡³å¯ä»¥åœ¨ä½ çš„æ‹‰å–è¯·æ±‚ä¸­çœ‹åˆ°è®¾è®¡å‚è€ƒå›¾åƒã€‚

[![](img/0576b825ac378ff40894537eade89ba9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--40MCPO7n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2A_Kt6ULxjNjf8wVv3l9dzrg.jpeg) 
æ‰€ä»¥ä½ æƒ³åœ¨åšä¸€äº›æ¼‚äº®çš„æµ‹è¯•æ—¶è¾¾åˆ°åƒç´ å®Œç¾ï¼Ÿ

### âš¡ï¸æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ

æˆ‘å°†å°è¯•ä½¿ç”¨æˆ‘æœ€æ–°çš„ lib [Snap.swift](https://github.com/skyweb07/Snap.swift) æ¥æè¿°å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚

å®ƒçš„å·¥ä½œåŸç†æ˜¯ç”Ÿæˆä¸€ä¸ªå­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­çš„å‚è€ƒå›¾åƒï¼Œç„¶åå°†æ¯ä¸ªæ–°çš„æµ‹è¯•ç”¨ä¾‹ä¸`reference image`è¿›è¡Œæ¯”è¾ƒï¼Œä»¥æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å·®å¼‚ã€‚å¦‚æœ test å‘ç°äº†ä»»ä½•å·®å¼‚ï¼Œå®ƒä¼šåœ¨æ‚¨çš„æµ‹è¯•ç”¨ä¾‹ä¸­æ·»åŠ ä¸€ä¸ªé™„ä»¶ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æ£€æŸ¥ä»€ä¹ˆå‘ç”Ÿäº†å˜åŒ–

[![Project attachment](img/ba13a59a0138ed0cbd4678dd304ecf80.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fKSWNNDp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/skyweb07/Snap.swift/blob/develop/.art/xcode_attachment.png%3Fraw%3Dtrue)

### ğŸ› é…ç½®

ä¸ºäº†é…ç½®å¿«ç…§æµ‹è¯•æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬éœ€è¦å‘é¡¹ç›®æ·»åŠ ä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡ï¼Œåç§°ä¸º`SNAP_REFERENCE_IMAGE_PATH`ï¼Œå€¼ä¸º`$(SOURCE_ROOT)/$(PROJECT_NAME)Tests/`ï¼Œè¿™æ ·`Snap.swift`å°±å¯ä»¥æ‰¾åˆ°å­˜å‚¨å‚è€ƒå›¾åƒçš„æ–‡ä»¶å¤¹ã€‚å¦‚æœé…ç½®è®¾ç½®æ­£ç¡®ï¼Œé¡¹ç›®åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

[![Project attachment](img/f3d4b13d3ef51b5ad3e1bacba7f3a8ea.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--GJSLow3n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/skyweb07/Snap.swift/blob/develop/.art/xcode_project_environment_variable.png%3Fraw%3Dtrue)

### ğŸ¯è£…ç½®

Snap.swift å¯é€šè¿‡ [CocoaPods](http://cocoapods.org) è·å¾—ã€‚è¦å®‰è£…
,åªéœ€åœ¨ Podfile ä¸­æ·»åŠ ä¸‹é¢ä¸€è¡Œ:

```
pod 'Snap.swift' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### âœ…åˆ›é€ äº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè¯•éªŒ

1)æˆ‘ä»¬é¦–å…ˆéœ€è¦è®°å½•æˆ‘ä»¬çš„å‚è€ƒå›¾åƒï¼Œä¸ºäº†è¿™æ ·åšï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆè¿›å…¥æˆ‘ä»¬çš„æµ‹è¯•ç±»ï¼Œå°†`isRecording`å˜é‡è®¾ç½®ä¸º`true`ï¼Œè¿™æ ·åº“å°±çŸ¥é“æˆ‘ä»¬å¤„äºè®°å½•æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥æå–`reference images`T3

```
import XCTest
import Snap_swift

class SnapTests: XCTestCase {

  override func setUp() {
    super.setUp()
    isRecording = true
  }

  func test_box_with_text_aligned_to_center() {
    let view = BoxWithTextAlignedToCenterView()

    expect(view).toMatchSnapshot()
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ‰§è¡Œå®Œæµ‹è¯•å¥—ä»¶åï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°æ‰€æœ‰çš„æµ‹è¯•éƒ½å¤±è´¥äº†ï¼Œå¹¶å‡ºç°ç±»ä¼¼äº
çš„è­¦å‘Š

```
âš ï¸ Test ran in record mode, reference image has been saved to $SNAP_REFERENCE_IMAGE_PATH/testcase.png, now remove `isRecording` in order to perform the snapshot comparison. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ²¡é—®é¢˜ï¼Œè¿™åªæ˜¯æ„å‘³ç€æˆ‘ä»¬çš„å‚è€ƒå›¾åƒè¢«ä¿å­˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„`reference image`ç›®å½•ä¸­æ£€æŸ¥å®ƒä»¬ï¼Œæˆ‘ä»¬é€šå¸¸åº”è¯¥å°†å®ƒä»¬æ·»åŠ åˆ°`git`ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸å®ƒä»¬è¿›è¡Œæ¯”è¾ƒã€‚

#### è­¦å‘Š

> *ç”Ÿæˆå‚è€ƒå›¾åƒåï¼Œè®°å¾—ç§»é™¤`isRecording`æ ‡è®°ï¼Œå¦åˆ™æ‚¨å°†æ— æ³•è¿›è¡Œå›¾åƒæ¯”è¾ƒ*

### ğŸ“ç¬”è®°

> åƒä»Šå¤©ä¸€æ ·ï¼Œæ‚¨å¯ä»¥å¯¹`UIView`å’Œ`CALayer`ç±»è¿›è¡Œæ–­è¨€ã€‚

è¿™ä¸ªé¡¹ç›®åœ¨`Facebook` [FBSnapshotTestCase](https://github.com/facebookarchive/ios-snapshot-test-case/) åº“ä¸Šå¾—åˆ°äº†å¾ˆå¤§çš„å¯å‘ï¼Œçœ‹èµ·æ¥ä»–ä»¬å·²ç»å¯¹è¿™ä¸ªåº“è¿›è¡Œäº†å½’æ¡£ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹äº†è¿™ä¸ªé¡¹ç›®æ¥ç»§ç»­å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼Œå¹¶ç»§ç»­ä½¿ç”¨ mobile `snapshot-testing`

è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥é€šè¿‡ä½¿ç”¨åº“æ¥æµ‹è¯• UI å…ƒç´ ï¼Œæ¯”å¦‚ KIF æˆ– Google çš„ EarlGreyï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºè¿™ç§å¿«ç…§æµ‹è¯•æ›´å®¹æ˜“ç»´æŠ¤ï¼Œå…¶ä¸­ä¸€ä¸ªå¿«ç…§æµ‹è¯•å¯ä»¥ç­‰åŒäºè®¸å¤šå…¶ä»–æ¡†æ¶ã€‚å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡[æ¨ç‰¹](https://twitter.com/skyweb07)è”ç³»æˆ‘ï¼Œæˆ‘ä¼šå°½åŠ›å¸®ä½ è§£å†³ã€‚

è°¢è°¢å¤§å®¶ï¼Œç¥å¿«ç…§æµ‹è¯•æ„‰å¿«ğŸ“¸