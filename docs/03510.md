# æ¾å¼›+å¿«è½¦é“= â¤ï¸.è°ˆæŒç»­é›†æˆçš„å›°æƒ‘ä¹‹ä¸€ã€‚

> åŸæ–‡:[https://dev.to/kamwysoc/slack-å¿«è½¦é“-è°ˆè®ºè¿ç»­é›†æˆçš„éš¾é¢˜ä¹‹ä¸€-4l9](https://dev.to/kamwysoc/slack--fastlane---talk-about-one-of-puzzles-of-continuous-integration-4l9)

[![](img/1a6305573954f9d93b62ee931b6c7eaf.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YU3DFIul--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/puzzle.jpg)

èŒä¸šå‘å±•è¿‡ç¨‹åŒ…å«è®¸å¤šå›°æƒ‘ã€‚è¿™äº›éš¾é¢˜åŒ…æ‹¬:å•å…ƒæµ‹è¯•ã€é€‰æ‹©å¥½çš„æ¶æ„ã€å¹²å‡€çš„ä»£ç ã€æŒç»­é›†æˆç­‰ç­‰ã€‚
åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å…³æ³¨å…¶ä¸­ä¸€ä¸ªéš¾é¢˜â€”â€”æŒç»­é›†æˆ(CI)ã€‚iOS å¼€å‘è¿‡ç¨‹ä¸­ CI ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªå«åš[æµªå­](https://fastlane.tools/)çš„ä¼Ÿå¤§å·¥å…·ã€‚
æµªå­æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼•æ“ï¼Œå®ƒå¯ä»¥å¤„ç†è®¸å¤šä»»åŠ¡ï¼Œæ¯”å¦‚:å¤„ç†ä»£ç ç­¾åï¼Œåˆ›å»º`.ipa`æ–‡ä»¶ï¼Œç”Ÿæˆæˆªå›¾åˆ° AppStore ç­‰ç­‰ã€‚æµªå­çš„ä¸€ä¸ªå¾ˆé…·çš„ç‰¹ç‚¹æ˜¯æ¾æ•£çš„é›†æˆâ€”â€”è¿™ä¹Ÿæ˜¯æˆ‘æƒ³å†™çš„ã€‚

# ğŸ’ªåŠ¨æœºğŸ’ª

åœ¨å…‰æ˜å‘æ˜å…¬å¸ï¼Œæˆ‘æ­£åœ¨åšå‡ ä¸ªé¡¹ç›®ã€‚æˆ‘ä»¬å¯åŠ¨çš„æ¯ä¸ªé¡¹ç›®éƒ½ä»å‡ ä¸ªåŸºæœ¬æ­¥éª¤å¼€å§‹:åˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨åº“ã€åŸºæœ¬çš„åº”ç”¨ç¨‹åºè®¾ç½®ä»¥åŠæœ€é‡è¦çš„...æŒç»­é›†æˆè·¯å¾„ã€‚åœ¨ iOS åº”ç”¨ç¨‹åºä¸Šï¼Œå®ƒä»å®‰è£…æµªå­å¼€å§‹ï¼Œåœ¨ Fastfile ä¸­åˆ›å»ºä¸€äº›é€šé“ï¼Œç„¶åå°†æ›´æ”¹æ¨é€åˆ°æˆ‘ä»¬çš„æ–°å­˜å‚¨åº“ä¸­ã€‚ä¸‹ä¸€æ­¥æ˜¯ä¸ºé¡¹ç›®é…ç½®ä¸€ä¸ªæ–°çš„ TeamCity(æˆ‘ä»¬ç”¨äº CI çš„ä¸€ä¸ªæœåŠ¡)å’Œä¸€ä¸ªæ–°çš„ä»£ç†æœºå™¨ã€‚åœ¨é‚£ä¹‹å...æˆ‘ä»¬çš„ CI æ„å»ºæœåŠ¡å·²ç»å‡†å¤‡å¥½ä»å­˜å‚¨åº“ä¸­æ”¶é›†å˜æ›´å¹¶ä¸ºæˆ‘ä»¬çš„å®¢æˆ·è§¦å‘æ„å»ºï¼Œæˆ–è€…åªæ˜¯æ„å»ºåº”ç”¨ç¨‹åºå¹¶è¿è¡Œæˆ‘ä»¬çš„å•å…ƒ/UI æµ‹è¯•æ¥æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ã€‚

ä½†æ˜¯å¦‚æœå‡ºäº†ä»€ä¹ˆé—®é¢˜å‘¢...

[![](img/51e1f51fbd099cf30585e51ec1ccc796.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7hdcJIWV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/error.jpg)

æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æ­£åœ¨åšä¸€äº›ä»£ç é‡æ„ï¼Œæˆ‘ä»¬æäº¤äº†å˜æ›´ï¼Œå¹¶æ¨å…¥äº†æˆ‘ä»¬çš„å­˜å‚¨åº“ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çš„æ„å»ºç³»ç»Ÿå‘ç°æœ‰å¯ç”¨çš„æ–°æäº¤â€”â€”æ‰€ä»¥å®ƒå¼€å§‹è·å–å’Œæ„å»ºå®ƒä»¬å¹¶è¿è¡Œå•å…ƒæµ‹è¯•ã€‚è¿™é‡Œæœ‰äº›æµ‹è¯•å¤±è´¥äº†ã€‚

[![](img/ecbd77c382f24617b081ccc416e7ccc7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PrnJwigy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/test-failed.png)

å½“ç„¶ï¼Œå½“æˆ‘æŠŠä¸€äº›ä¸œè¥¿æ¨é€åˆ°å­˜å‚¨åº“æ—¶ï¼Œæˆ‘ä¸ä¼šä¸€ç›´æ‰“å¼€æµè§ˆå™¨æ¥æ£€æŸ¥ Teamcity ç«™ç‚¹æ˜¯å¦ä¸€åˆ‡é¡ºåˆ©ã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•å¤±è´¥ã€è¶…æ—¶æˆ–è€…ç¼–è¯‘é”™è¯¯ï¼Œæˆ‘å¸Œæœ›å¾—åˆ°é€šçŸ¥ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®è¯â€”â€”çŸ¥æƒ…ã€‚æˆ‘ä»¬çš„æ„å»ºä»£ç†å¦‚ä½•é€šçŸ¥æˆ‘ä»¬å‘ç”Ÿäº†é”™è¯¯ï¼Ÿ

### é‚®ä»¶

[![](img/ec0bd1830c0c82c468bbc64dd24bd5e8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Z5lle1NR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/email.jpeg)

æˆ‘ä»¬ä½¿ç”¨ TeamCity å†…ç½®çš„ç”µå­é‚®ä»¶æœåŠ¡ã€‚æ¯æ¡å·²å»ºè½¦é“éƒ½æœ‰ä¸€æ¡è§„åˆ™ï¼Œä¸Šé¢å†™ç€â€œå½“å‡ºç°é—®é¢˜ä¸”å»ºè®¾å¤±è´¥æ—¶ï¼Œå‘æ‰€æœ‰å¼€å‘äººå‘˜å‘é€ç”µå­é‚®ä»¶â€ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆè¿è¡Œè‰¯å¥½ï¼Œå¹¶ä¸”åœ¨è®¸å¤šé¡¹ç›®å’Œå…¬å¸ä¸­æ™®éä½¿ç”¨ã€‚ä½†æˆ‘ä¸ªäººå¹¶ä¸æ˜¯ç™¾åˆ†ç™¾æ»¡æ„ã€‚å¦‚æœä½ åœ¨å‡ ä¸ªé¡¹ç›®ä¸­å·¥ä½œï¼Œä½ ä¼šæ”¶åˆ°è¶Šæ¥è¶Šå¤šæ¥è‡ªå®¢æˆ·ã€å‰æ‹‰ã€å›¢é˜Ÿç­‰çš„ç”µå­é‚®ä»¶ã€‚æ­¤å¤–ï¼Œè®©æˆ‘ä»¬ä» TeamCity æœåŠ¡ä¸­è·å–æ–°çš„ç”µå­é‚®ä»¶ã€‚å½“ç„¶ï¼Œæˆ‘å¯ä»¥åˆ›å»ºè¿‡æ»¤å™¨å¹¶å¯¹æ‰€æœ‰çš„ä¸œè¥¿è¿›è¡Œåˆ†ç»„(æˆ‘å°±æ˜¯è¿™æ ·åšçš„)ï¼Œä½†å³ä½¿è¿™æ ·ï¼Œå¯¹æˆ‘æ¥è¯´ä¹Ÿå¤ªå¤šäº†ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–°äº‹ç‰©â€”â€”å¦‚æœä¸€äº›æ„å»ºå¤±è´¥äº†â€”â€”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¿«é€Ÿä¿®å¤å®ƒæ˜¯å¾ˆé‡è¦çš„ã€‚å› æ­¤ï¼Œæˆ‘æ›´å–œæ¬¢å¦ä¸€ç§æ–¹å¼â€”â€”åœ¨æˆ‘çœ‹æ¥æ›´å¿«â€”â€”åœ¨å‘ç”Ÿä¸å¥½çš„äº‹æƒ…æ—¶å¾—åˆ°é€šçŸ¥ã€‚

# fast lane+slack

## 1ã€‚ç”¨æ­£ç¡®çš„æ–¹æ³•åˆ›å»ºä½ çš„å¿«é€Ÿæ–‡ä»¶

è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ä¸€ä¸ªé€šé“ç¼–è¯‘é¡¹ç›®å¹¶è¿è¡Œå•å…ƒæµ‹è¯•:

```
platform :ios do
    desc "Runs all the tests"
    lane :test do
        begin
            test_lane()
        rescue => exception
            on_error(exception)
        end
    end
end 
```

å¯ä»¥çœ‹åˆ°`:test`è½¦é“çš„è½¦èº«ç”±`begin-rescue-end`ç»“æ„ç»„æˆã€‚è¿™æ˜¯ä¸€ä¸ª ruby ç‰¹æœ‰çš„ç»“æ„ã€‚åœ¨`begin`ä¸­ï¼Œä½ æ”¾äº†ä¸€äº›å¯èƒ½ä¼šå¤±è´¥çš„ä»£ç ã€‚åœ¨`rescue => exception`è¡Œä¹‹åï¼Œä½ æ”¾ç½®äº†å‡ºé”™æ—¶åº”è¯¥æ‰§è¡Œçš„ä»£ç ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒå°†æ˜¯`on_error(exception)`å‡½æ•°ã€‚æ‰€ä»¥å¿«é€Ÿæ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:

```
platform :ios do
   desc "Runs all the tests"
   lane :test do
       begin
           test_lane()
       rescue => exception
           on_error(exception)
       end
   end
end

### Methods

def test_lane
   cocoapods
   clear_derived_data
   scan(scheme: "YourProjectSchemeName", configuration: "Debug")
end

def on_error(exception)
   slack(
       message: "Some thing goes wrong",
       success: false,
       slack_url: "https://your slack incoming webhook url",
       attachment_properties: {
           fields: [
               {
                   title: "Build number",
                   value: ENV["BUILD_NUMBER"],
               },
               {
                   title: "Error message",
                   value: exception.to_s,
                   short: false
               }
           ]
       }
   )
end 
```

## 2ã€‚ç”Ÿæˆæ¾å¼› URL

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œ`slack`æ–¹æ³•å¸¦æœ‰ä¸€ä¸ª`slack_url`å‚æ•°ã€‚ä½†æ˜¯æˆ‘æ€æ ·æ‰èƒ½å¾—åˆ°ä¸€ä¸ªå‘¢ï¼Ÿ

### åˆ›å»ºä¼ å…¥çš„ webhook

è¿›å…¥[slack incoming weebbook webiste](https://my.slack.com/services/new/incoming-webhook/)ï¼Œç™»å½•ï¼Œä¹‹åæ‚¨ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™æ ·çš„å±å¹•:

[![](img/77f5a99ec6ce48d183a35e292b80bfe6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zOHZ5vqB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/webhook-slack-url.png)

é€‰æ‹©æ‚¨çš„æ¸ é“(å‡ºäºæµ‹è¯•ç›®çš„ï¼Œæˆ‘å»ºè®®æ‚¨é€‰æ‹©ç›´æ¥å‘è‡ªå·±å‘é€æ¶ˆæ¯)ã€‚ç‚¹å‡»`Add incoming WebHooks integration`ã€‚
ä¸‹ä¸€æ­¥æ˜¯å¤åˆ¶ Webhook URL å¹¶å°†å…¶ç”¨ä½œ`slack_url`ã€‚

å½“ç„¶ï¼Œåœ¨æ‚¨äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ä¹‹åï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„ slack å›¢é˜Ÿä¸­ä¸ºä¸“é—¨åˆ›å»ºçš„é€šé“ç”Ÿæˆä¸€ä¸ª URLã€‚

[![](img/0504b0ed1e1832533c2f0a612ab9e3db.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Y1ezc2vf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/webhook-slack-url2.png)

## 3ã€‚åœ¨å¿«é€Ÿæ–‡ä»¶ä¸­æ„å»ºæ¾å¼›æ¶ˆæ¯

é¦–å…ˆï¼Œ[åœ¨è¿™é‡Œ](https://docs.fastlane.tools/actions/slack/)ä½ å¯ä»¥åœ¨æµªå­å·¥å…·ä¸­æ‰¾åˆ° Slack action çš„å®˜æ–¹æ–‡æ¡£ã€‚åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘ä¼šè¯•ç€ç»™ä½ ä¸€ä¸ªæ›´è¿‘çš„è§†è§’ã€‚

ä»£ç éå¸¸ç®€å•ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„`slack_message`é€šé“æ¥æµ‹è¯•å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚
åœ¨æ‚¨çš„å¿«é€Ÿæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°è½¦é“ï¼Œç„¶åè¿è¡Œ:

`fastlane slack_message`ï¼Œ

æˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨æ†æ‰æœº

`bundle exec fastlane slack_message`ã€‚

```
platform :ios do
   desc "Runs all the tests"
   lane :slack_message do
       slack(
           message: "App successfully uploaded to iTunesConnect.",
           success: true,
           slack_url: "https://your slack incoming webhook url"
       )
   end
end 
```

æˆ‘ä»¬çš„ä¿¡æ¯çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

[![](img/2e64685acf15709b46790849f413e633.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--M2XTyVE7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/basic-message.png)

å¦‚ä½ æ‰€è§ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½ ä¼šå¾—åˆ°ä¸€äº›å…³äº`Git Commit`ã€`Git Commit Hash`ã€`Lane`ã€`Result`ã€`Git Author`çš„ä¿¡æ¯ã€‚

# ğŸ”§è‡ªå®šä¹‰æ—¶å·®æ¶ˆæ¯ğŸ”§

#### ğŸ‘‰`message`

ç”¨äºåˆ›å»ºæ¶ˆæ¯çš„ç®€å•é”®ï¼Œè¯¥æ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨æ¾å¼›æ¶ˆæ¯çš„ç¬¬ä¸€è¡Œã€‚è¿™å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚

*   `message: "App Successfully uploaded to iTunesConnect"`
*   `message: "All tests have been successful"`
*   `message: "Something went wrong"` -æˆ‘æœ€å–œæ¬¢çš„é”™è¯¯ä¿¡æ¯ğŸ˜‰

ä½†æ˜¯å°½é‡è®©ä½ çš„æ‡ˆæ€ ä¿¡æ¯æœ‰ç”¨ã€‚æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„`Fastfile`ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘åœ¨ Ruby ä¸­ä½¿ç”¨äº†ä¸€ä¸ª`begin-rescue`ç»“æ„ã€‚è¿™éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä½¿ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™çš„å¼‚å¸¸ï¼Œå¹¶åˆ›å»ºä¸€äº›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯ã€‚

æˆ‘æƒ³ä½ ä»¬éƒ½ä½¿ç”¨å¹¶ä¸”çŸ¥é“ [CococaPods](https://cocoapods.org/) ã€‚è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„`Podfile`æœ‰ä¸€ä¸ªé”™åˆ«å­—çš„æƒ…å†µ

```
platform :ios, '10.0'
inhibit_all_warnings!

target 'MyAppTarget' do
 use_frameworks!

 # Pods for MyApp
 podd 'SnapKit' # <------- should fail because of `podd`
 pod 'Result'
end 
```

ç°åœ¨åœ¨æˆ‘ä»¬çš„`Fastfile`ä¸­åˆ›å»ºä¸€ä¸ªå°†å®‰è£…æˆ‘ä»¬çš„ CocoaPods çš„é€šé“ï¼Œå¹¶æ„å»ºé¡¹ç›®ã€‚

```
fastlane_version "2.54.1"

default_platform :ios

xcode_select ENV["XCODE_PATH"]

platform :ios do
   desc "Runs all the tests"
   lane :build_and_test do
       begin
           build_and_test_lane()
       rescue => exception
           on_error(exception)
       end
   end
end

def build_and_test_lane
   cocoapods
   clear_derived_data
   scan(scheme: "MyAppScheme", configuration: "Debug")
end

def on_error(exception)
       slack(
           message: "Lane failed with exception : #{exception}",
           success: false,
           slack_url: "https://slackurl",
       )
end 
```

å¦‚ä½ æ‰€è§ï¼Œå¦‚æœ`build_and_test_lane`æ–¹æ³•å‡ºé”™ï¼Œæˆ‘ä»¬çš„è„šæœ¬å°†å¾—åˆ°ä¸€ä¸ª`exception`å¹¶è¿è¡Œ`on_error(exception)`æ–¹æ³•ã€‚è®©æˆ‘ä»¬è¯•è¯•çœ‹...

`fastlane build_and_test`æˆ–`bundle exec fastlane build_and_test`

ç­‰å¾…ä¸€æ®µæ—¶é—´....å’Œ...ğŸ”” ğŸ””

[![](img/b6013987ca3b64ea99c4ef3f02fcd288.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--a3_LPRma--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/exception.png)

ç°åœ¨æˆ‘ä»¬çš„æ¶ˆæ¯æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„`Podfile`æœ‰ä¸€äº›é”™è¯¯ã€‚

#### ğŸ‘‰`deafult_payloads`

æ­£å¦‚æˆ‘ä»¬åœ¨æ–‡æ¡£ä¸­çœ‹åˆ°çš„:

> å¦‚æœä½ æƒ³è¦æ‰€æœ‰çš„é»˜è®¤æœ‰æ•ˆè½½è·ï¼Œä¸è¦æ·»åŠ è¿™ä¸ªé”®æˆ–è€…ä¼ é€’ nilã€‚å¯ç”¨çš„é»˜è®¤æœ‰æ•ˆè½½è·æœ‰:`lane`ã€`test_result`ã€`git_branch`ã€`git_author`ã€`last_git_commit_message`ã€`last_git_commit_hash`ã€‚

æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œä½†å¦‚æœä½ æƒ³é€šè¿‡åˆ é™¤å…¶ä¸­ä¸€äº›ä¿¡æ¯æ¥å®šåˆ¶ä¿¡æ¯ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ä¸ªä¾‹å­:

```
slack(
   message: "App successfully uploaded to iTunesConnect.",
   success: true,
   slack_url: "https://your slack incoming webhook url",
   default_payloads: [:git_branch, :last_git_commit_message]
) 
```

ä¸‹é¢æ˜¯å¸¦æœ‰å®šåˆ¶çš„`default_payloads`çš„æ¶ˆæ¯çš„æ ·å­:

[![](img/8debd6741b58efb582a87905348784bc.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_bKVSGl---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/default-payload-message.png)

#### ğŸ‘‰`success`

æ‚¨è¿˜å¯ä»¥å®šä¹‰æ¶ˆæ¯æ˜¯å¦æˆåŠŸã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæˆåŠŸä¸Šä¼ åˆ° iTunesConnectï¼Œåˆ™å¯ä»¥ä½¿ç”¨æˆåŠŸä¿¡æ¯ã€‚

ç¬¬äºŒç§é€‰æ‹©æ˜¯å°†`success`è®¾ç½®ä¸º`false`ï¼Œç„¶åæ¶ˆæ¯çœ‹èµ·æ¥ä¼šæœ‰ç‚¹ä¸åŒ:

[![](img/f129689353bdfa147066c4d580c1c485.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4wnH1Bhs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/message-fail.png)

çº¢è‰²è¡¨ç¤ºå‡ºäº†é—®é¢˜ï¼Œä½ å¿…é¡»è§£å†³å®ƒï¼Œè¿™æ˜¯é€šçŸ¥ä½ çš„å¥½æ–¹æ³•ã€‚

#### ğŸ‘‰`attachment_properties`

è¿™é‡Œï¼Œä¸€ä¸ªçœŸæ­£çš„å®šåˆ¶è¿‡ç¨‹å¼€å§‹äº†ã€‚é€šè¿‡ä½¿ç”¨è¯¥å±æ€§ï¼Œæ‚¨å¯ä»¥å‘æ—¶å·®æ¶ˆæ¯ä¸­æ·»åŠ ä»»ä½•åŸŸã€‚å‡è®¾æ‚¨æƒ³è¦å°†`BUILD_NUMBER`å’Œ`URL`æ·»åŠ åˆ°å·¥ä»¶ä¸­ã€‚

```
slack(
   message: "App successfully uploaded to iTunesConnect.",
   success: true,
   slack_url: "https://your slack incoming webhook url",
   default_payloads: [:git_branch, :last_git_commit_message],
   attachment_properties: {
       fields: [
           {
               title: "Build number",
               value: ENV["BUILD_NUMBER"],
           },
           {
               title: "Artifacts URL",
               value: "https://url-to-your-artifacts.com",
           }
       ]
   }
) 
```

[![](img/5ffc9745e53cc5f7c4b5c14fe4ce8d4b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sDW5DGxa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/message-with-custom-fields.png)

å¦ä¸€ä¸ªä¾‹å­...è®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„`on_error(exception)`æ–¹æ³•ã€‚

```
def on_error(exception)
       slack(
           message: "Error occured!",
           success: false,
           slack_url: "https://slackurl",
           attachment_properties: {
               fields: [
                   {
                       title: "Error message",
                       value: exception
                   }
               ]
           }
       )
end 
```

è¿™é‡Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªä¿¡æ¯ğŸ””ğŸ””

[![](img/61b2270dab837c0093e7173890f4fb55.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--j4ktgaWM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://wysockikamil.com/assets/posts/slack-fastlane/exception2.png)

å¦‚æ‚¨æ‰€è§ï¼Œç°åœ¨é”™è¯¯æ¶ˆæ¯æ˜¯è‡ªå®šä¹‰å­—æ®µã€‚

#### ğŸ‘‰å…¶ä»–æ ‡å¿—...

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»¥æˆ‘ä¸ªäººçš„æµ…è§ï¼Œæˆ‘æŠŠé‡ç‚¹æ”¾åœ¨äº†å…è®¸ä½ é…ç½® Slack message çš„æœ€é‡è¦çš„é”®ä¸Šã€‚å…¶ä»–çš„åˆ†åˆ«æ˜¯:`channel`ã€`message`ã€`use_webhook_configured_username_and_icon`ã€`icon_url`ã€`payload`ã€‚å…³äºè¿™äº›æŒ‰é”®çš„æ›´å¤šä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨[å®˜æ–¹æ–‡æ¡£](https://docs.fastlane.tools/actions/slack/)ä¸­æ‰¾åˆ°ã€‚

# ğŸ‰ç»“è®ºğŸ‰

æˆ‘â¤ï¸å¿«è½¦é“å·¥å…·ã€‚å®ƒå¸®åŠ©æ‰€æœ‰å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­èŠ‚çœå¤§é‡æ—¶é—´ã€‚æˆ‘è§‰å¾—è¿™ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªè°œé¢˜å°±æ˜¯ è¿™ä¸ªè¯å®Œæ•´æ„ä¹‰ä¸Šçš„æŒç»­æ•´åˆ ***ã€‚æˆ‘å¦‚ä½•ç†è§£æŒç»­é›†æˆï¼Ÿä½ å¯ä»¥åœ¨[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Continuous_integration)ä¸Šè¯»åˆ°***

> åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼ŒæŒç»­é›†æˆ(CI)æ˜¯å°†æ‰€æœ‰å¼€å‘äººå‘˜çš„å·¥ä½œå‰¯æœ¬ä¸€å¤©å‡ æ¬¡åˆå¹¶åˆ°ä¸€ä¸ªå…±äº«ä¸»çº¿çš„å®è·µã€‚

è¿™æ˜¯ 100%çœŸå®çš„ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§çŠ¶æ€ï¼Œå½“æˆ‘ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œåœ¨å°†æ›´æ”¹æ¨é€åˆ°å­˜å‚¨åº“ä¹‹å‰ï¼ŒCI ä»£ç†å¯ä»¥é€šçŸ¥æˆ‘æˆåŠŸå’Œé”™è¯¯ï¼Œè€Œä¸éœ€è¦ç‰¹åˆ«æ£€æŸ¥å®ƒä»¬ã€‚ä½†æ˜¯ä¸è¦è¯¯è§£æˆ‘ã€‚æˆ‘ä¸å»ºè®®åœ¨æ²¡æœ‰ç¼–è¯‘çš„æƒ…å†µä¸‹æäº¤å’Œæ¨é€(å› ä¸ºå½“å‡ºç°æ•…éšœæ—¶ï¼Œæˆ‘ä»¬çš„ CI ä»£ç†ä¼šé€šçŸ¥æˆ‘ä»¬)ã€‚æˆ‘è¯´çš„æ˜¯å½“ä½ æœ‰è®¸å¤šåŒ…å«è®¸å¤šæµ‹è¯•çš„é¡¹ç›®æ—¶çš„æƒ…å†µ(æ˜¯çš„ï¼Œæˆ‘å‡è®¾ä½ æ­£åœ¨ç¼–å†™æµ‹è¯•ğŸ˜‰).è€Œä¸”æˆ‘è®¤ä¸ºæ‚¨ä¸å¸Œæœ›æ¯æ¬¡åœ¨å°†æ–°çš„å˜æ›´æ¨é€åˆ°å­˜å‚¨åº“ä¹‹å‰éƒ½è¿è¡Œå®ƒä»¬ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œä½ é…ç½®æ•´ä¸ª CI çš„ä¸œè¥¿æ¥é¿å…å®ƒã€‚è®© CI ä»£ç†ä¸ºæ‚¨å®Œæˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æµ‹è¯•éƒ½ä¼šæˆåŠŸğŸ˜‰)ï¼Œæ‰€ä»¥å¯ä»¥è¿ç»­å·¥ä½œã€‚ä½†æ˜¯å¦‚æœä¸çŸ¥ä½•æ•…æµ‹è¯•å¤±è´¥äº†â€”â€”è®© CI ä»£ç†åœ¨ä½ æ¾æ‡ˆçš„æ—¶å€™ ping ä½ ğŸ˜‰
å¦ä¸€ä»¶äº‹æ˜¯ï¼Œä½ å¯ä»¥è¢«å‘ŠçŸ¥ä¸€äº›å¥½äº‹ï¼Œæ¯”å¦‚:æˆåŠŸä¸Šä¼ `.ipa`åˆ° TestFlightã€‚

ä¸‹é¢ä½ å¯ä»¥æ‰¾åˆ°è¿™ç¯‡æ–‡ç« ä¸­ç”¨åˆ°çš„æ‰€æœ‰é“¾æ¥ã€‚

ğŸ‘‰[å¯å¯å¸ƒä¸](https://cocoapods.org)

ğŸ‘‰[æµªå­](https://fastlane.tools/)

ğŸ‘‰[æ¾å¼›å¼•å…¥çš„ç½‘é’©](https://api.slack.com/incoming-webhooks)

ğŸ‘‰[æµªå­æ‡ˆæ€ è¡ŒåŠ¨](https://docs.fastlane.tools/actions/slack/)

ğŸ‘‰[æŒç»­é›†æˆ](https://www.google.com/search?q=continuous+integration)

ğŸ‘‰ [TeamCity](https://www.jetbrains.com/teamcity/)

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨æˆ‘å…¬å¸çš„åšå®¢ä¸Š

## å…³äºæˆ‘

æˆ‘æ˜¯æ³¢å…°æ ¼ä½†æ–¯å…‹çš„è½¯ä»¶å¼€å‘äººå‘˜ã€‚ä¸»è¦æ˜¯ä¸ iOS åˆä½œï¼Œä½†æˆ‘å¯¹ä»»ä½•å…¶ä»–æŠ€æœ¯ï¼Œæ¡†æ¶å’ŒæŒ‘æˆ˜æŒå¼€æ”¾æ€åº¦ã€‚å¦‚æœä½ å–œæ¬¢æˆ‘çš„å¸–å­ï¼Œè¯·åœ¨ twitter ä¸Šå…³æ³¨æˆ‘ï¼Œé˜…è¯»æˆ‘çš„ä¸ªäººåšå®¢ã€‚