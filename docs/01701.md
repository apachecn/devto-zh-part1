# æ¸©å’Œåœ°ä»‹ç»ååº”å½¢å¼çš„è§’åº¦

> åŸæ–‡:[https://dev . to/abelagoi/gentle-introduction-to-reactive-forms-in angular-d9m](https://dev.to/abelagoi/gentle-introduction-to-reactive-forms-inangular-d9m)

ååº”å¼è¡¨å•æ˜¯æˆ‘ä»¬åœ¨ä»£ç çš„ç»„ä»¶ç±»éƒ¨åˆ†ä¸­ç¼–å†™é€»è¾‘ã€éªŒè¯å’Œæ§åˆ¶çš„è¡¨å•ï¼Œä¸æ¨¡æ¿é©±åŠ¨è¡¨å•ä¸åŒï¼Œæ¨¡æ¿é©±åŠ¨è¡¨å•åœ¨æ¨¡æ¿ä¸­å®Œæˆæ§åˆ¶ã€‚ååº”å¼è¡¨å•éå¸¸çµæ´»ï¼Œå¯ç”¨äºå¤„ç†ä»»ä½•å¤æ‚è¡¨å•åœºæ™¯ã€‚æˆ‘ä»¬ç¼–å†™æ›´å¤šçš„ç»„ä»¶ä»£ç å’Œæ›´å°‘çš„ html ä»£ç ï¼Œè¿™ä½¿å¾—å•å…ƒæµ‹è¯•æ›´å®¹æ˜“ã€‚

### å¯ç”¨ååº”å¼è¡¨å•

è¦ä½¿ç”¨ååº”å¼è¡¨å•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ¨¡å—ä¸­ä»`@angular/forms`
æ˜¾å¼å¯¼å…¥`{FormsModule, ReactiveFormsModule}`

```
import { ReactiveFormsModule } from '@angular/forms';
@Component({...})
export class App { }
@NgModule({ 
    declarations: [App], 
    imports: [BrowserModule, ReactiveFormsModule], 
    bootstrap: [App]
})
export class AppModule {}
platformBrowserDynamic().bootstrapModule(AppModule); 
```

### è¡¨å•æ§ä»¶å’Œè¡¨å•ç»„

ä½ éœ€è¦ç†è§£`FormControl`å’Œ`FormGroup`æ‰èƒ½åˆ›å»ºæœ‰è§’åº¦çš„å½¢å¼ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®º`FormControl`å’Œ`FormGroup`ã€‚

`FormControl`æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒæ”¯æŒå•ä¸ªè¡¨å•æ§ä»¶ï¼Œè·Ÿè¸ªå€¼å’ŒéªŒè¯çŠ¶æ€ï¼ŒåŒæ—¶æä¾›äº†ä¸€ç³»åˆ—å…¬å…± API æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª`FormControl`
çš„åŸºæœ¬ä¾‹å­

```
'firstname': new FormControl(''); 
```

`FormGroup`æ˜¯ä¸€ç»„ FormControl å®ä¾‹ï¼Œè·Ÿè¸ªè¯¥ç»„çš„å€¼å’ŒéªŒè¯çŠ¶æ€ï¼Œè¿˜æä¾›å…¬å…± APIã€‚ä¸‹é¢æ˜¯`FormGroup`
çš„ä¸€ä¸ªåŸºæœ¬ä¾‹å­

```
this.myGroup = new FormGroup({ 
    'firstname': new FormControl(''), 
    'password': new FormControl('')
}); 
```

ä¸Šé¢å·²ç»å‘æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª`FormControl`å’Œä¸€ä¸ª`FormGroup`çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„æ¨¡æ¿ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œå¦‚ä¸‹:

```
<form [formGroup]="myGroup"> 
    Firstname: <input type="text" formControlName="firstname"> 
    Password: <input type="password" formControlName="password">
</form> 
```

æ³¨æ„`<form [formGroup]="myGroup">`,`formGroup`å¿…é¡»ç­‰äºç”¨äºåˆå§‹åŒ–ç»„ä»¶`myGroup`å†…`FormGroup`çš„åç§°ã€‚`formControlName`ä¹Ÿå¿…é¡»ç­‰äºç”¨äºåˆå§‹åŒ–ç»„ä»¶ç±»ä¸­`FormControl`çš„åç§°ã€‚ä¸‹é¢æ˜¯ app.component.ts.
ä¸­çš„ä»£ç ç»“æ„

```
//app.component.ts
import { Component, OnInit } from '@angular/core';
import { FormGroup, FormControl } from "@angular/forms";

@Component({ 
    selector: 'app-root', 
    templateUrl: './app.component.html', 
    styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit { 
    title = 'reactive forms'; myGroup: FormGroup;
    constructor() {}

    ngOnInit() { 
        this.myGroup = new FormGroup({ 
            'firstname': new FormControl(''), 
            'password': new FormControl('') }); 
        }
    } 
```

ä¸‹é¢çš„æ¨¡æ¿ä»£ç 

```
<form [formGroup]="myGroup"> 
    <div class="form-group"> 
        <label for="firstname" class="label-control">Firstname:</label> 
        <input type="text" formControlName="firstname" class="form-control">        </div>

    <div class="form-group">
        <label for="password" class="label-control">Password:</label> 
        <input type="password" formControlName="password" class="form-control">     </div>
</form> 
```

### åµŒå¥—è¡¨å•ç»„

æœ‰æ—¶ï¼Œåœ¨æ„å»ºå¤æ‚çš„è¡¨å•æ—¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ä¸€ä¸ªç‰¹å®šçš„å€¼æˆä¸ºå…¶ä»–è¾“å…¥çš„çˆ¶å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨çˆ¶å€¼ä¸‹è®¿é—®è¿™äº›è¾“å…¥ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ`account`å°†æ˜¯`firstname`å’Œ`password`çš„çˆ¶ä»£ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†èƒ½å¤Ÿè®¿é—®è´¦æˆ·ä¸‹çš„åå­—å’Œå¯†ç ã€‚

```
@Component({...})
export class SignupFormComponent { 
    form = new FormGroup({ 
        'email': new FormControl(''), 
        'account': new FormGroup({ 
            'firstname': new FromControl(''), 
            'password': new FromControl(''), 
        })
    });
} 
```

æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­è¡¨ç¤ºåµŒå¥—çš„è¡¨å•ç»„ï¼Œå¦‚ä¸‹å›¾

```
<form [formGroup]="form"> 
    <div formGroupName="account">
        <div class="form-group"> 
            <label for="firstname">Firstname: </label> 
            <input formControlName="firstname" id="firstname" 
                type="text" class="form-control" > 
        </div>

        <div class="form-group"> 
            <label for="password">Password: </label> 
            <input formControlName="password" id="password" 
                    type="password" class="form-control" > 
        </div>
    </div>
</form> 
```

æ³¨æ„,`formGroupName`ç­‰äº`account`, T1 æ˜¯åˆ†é…ç»™ç»„ä»¶ä¸­ FormGroup å®ä¾‹çš„åç§°ã€‚`formGroupName`å……å½“åå­—å’Œå¯†ç è¡¨å•æ§ä»¶çš„çˆ¶æ§ä»¶ã€‚

### ç”¨è¡¨å•ç”Ÿæˆå™¨ç®€åŒ–

æˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨`FormGroup`å’Œ`FormControl`ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªç¥å¥‡çš„ API æ¥ä¸ºæˆ‘ä»¬åšæ‰€æœ‰çš„äº‹æƒ…ã€‚æ‰€ä»¥ä¸éœ€è¦è¿›å£`FormGroup`å’Œ`FormControl`ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›å£`FormBuilder`å’Œ

```
import { Component, OnInit } from '@angular/core';
import { FormGroup, FormBuilder } from "@angular/forms";

@Component({ 
    selector: 'app-root', 
    templateUrl: './app.component.html', 
    styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit { 
    title = 'reactive forms'; 
    myGroup: FormGroup;

    constructor(private formBuilder: FormBuilder) {}

    ngOnInit() { 
        this.myGroup = this.formBuilder.group({ 
            'firstname': this.formBuilder.control(''), 
            'password': this.formBuilder.control('') 
        }); 
    }
} 
```

### è¢«åŠ¨æäº¤

ä¸ºäº†åœ¨ç”¨æˆ·æäº¤è¡¨å•æ—¶è·å–æ•°æ®ï¼Œæˆ‘ä»¬å°†æŠŠ`(ngSubmit)="handleSubmit()"`åº”ç”¨åˆ°`<form>`ä¸­ï¼Œåè€…å°†é“¾æ¥åˆ°æˆ‘ä»¬ç»„ä»¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†æäº¤çš„æ•°æ®

```
<form [formGroup]="myGroup" (ngSubmit)="handleSubmit()">
    <div class="form-group"> 
        <label for="firstname" class="label-control">Firstname:</label 
        <input type="text" formControlName="firstname" class="form-control">        </div>

    <div class="form-group"> 
        <label for="password" class="label-control">Password:</label> 
        <input type="password" formControlName="password" class="form-control">     </div>

    <button class="btn btn-primary">submit</button>
</form> 
```

æˆ‘ä»¬å¯ä»¥è®¿é—®ç»„ä»¶ä¸­çš„è¡¨å•æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
handleSubmit() { 
    console.log(this.form.value); 
} 
```

### æ·»åŠ éªŒè¯

ä¸ºäº†ç»™ååº”å¼è¡¨å•æ·»åŠ éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦ä»`@angular/forms`å¯¼å…¥`Validators`ç±»ï¼Œå¹¶å°†`validation(s)`ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™æˆ‘ä»¬çš„`FormControl`å®ä¾‹ã€‚

```
import { FormBuilder, Validators } from '@angular/form';
@Component({...})
export class SignupFormComponent implement OnInit {

    constructor(private formBuilder: FormBuilder) {}

    ngOnInit() { 
        this.myGroup = this.formBuilder.group({ 
            'firstname': this.formBuilder.control('', Validators.required),                 'password': this.formBuilder.control('', Validators.required) 
        }); 
    }

} 
```

å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤šä¸ªéªŒè¯å™¨æ—¶ï¼Œæˆ‘ä»¬å°†ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸ºå¦‚ä¸‹æ‰€ç¤ºçš„æ•°ç»„:

```
'firstname': ['', [Validators.required, Validators.minLength(2)]] 
```

### æ˜¾ç¤ºéªŒè¯é”™è¯¯

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬`FormControl`ä¸­çš„`errors`å¯¹è±¡å‘æ¨¡æ¿æ·»åŠ éªŒè¯é”™è¯¯æ¶ˆæ¯ã€‚æ„Ÿè°¢ typescript getterï¼Œæˆ‘ç”¨å®ƒè®©æ¨¡æ¿æ›´å¹²å‡€

```
import { Component, OnInit } from '@angular/core';
import { FormGroup, FormBuilder, Validators } from "@angular/forms";

@Component({ 
    selector: 'app-root', 
    templateUrl: './app.component.html', 
    styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit { 
    title = 'reactive forms'; 
    myGroup: FormGroup;

    constructor(private formBuilder: FormBuilder) {} 
    ngOnInit() { 
        this.myGroup = this.formBuilder.group({ 
            'firstname': this.formBuilder.control('',Validators.required),                  'password': this.formBuilder.control('', Validators.required) 
        }); 
    }

    get firstname() { 
        return this.myGroup.get('firstname'); //notice this 
    }

    get password() { 
        return this.myGroup.get('password'); //and this too 
    }
} 
```

æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿
ä¸­æ˜¾ç¤ºå¦‚ä¸‹éªŒè¯é”™è¯¯

```
<form [formGroup]="myGroup" (ngSubmit)="handleSubmit()"> 
    <div class="form-group"> 
        <label for="firstname" class="label-control">Firstname:</label> 
        <input type="text" formControlName="firstname" class="form-control" >

        <div *ngIf="firstname.invalid && firstname.touched"> 
            <div *ngIf="firstname.errors.required"> Firstname is required </div>         </div> 
    </div>

    <div class="form-group"> 
        <label for="password" class="label-control">Password:</label> 
        <input type="password" formControlName="password" class="form-control" >

        <div *ngIf="password.invalid && password.touched"> 
            <div *ngIf="password.errors.required"> Password is required </div>          </div> 
    </div>

    <button class="btn btn-primary">submit</button>
</form> 
```

### ç¦ç”¨æäº¤æŒ‰é’®

å½“è¡¨å•æ— æ•ˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¦ç”¨æäº¤æŒ‰é’®ï¼Œæ–¹æ³•æ˜¯æŒ‚é’©åˆ°è¡¨å•ç»„æœ‰æ•ˆçŠ¶æ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæ³¨æ„`myGroup`æ˜¯è¡¨å•æ§ä»¶ã€‚

```
<button class="btn btn-primary" [disabled]="! myGroup.valid"> submit</button> 
```

é™¤äº†åƒè‡ªå®šä¹‰éªŒè¯å’Œå¼‚æ­¥éªŒè¯è¿™æ ·çš„ååº”å¼è¡¨å•ï¼Œè¿˜æœ‰å¾ˆå¤šæ–‡ç« å¯ä»¥å¸®åŠ©å®ƒä»¬ã€‚

å¾ˆé«˜å…´ä¸ä½ åˆ†äº«è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·é¼“æŒè¡¨ç¤ºæ”¯æŒğŸ‘*ã€‚æ„Ÿè°¢æ‚¨çš„å®è´µæ—¶é—´ï¼Œè¯·åŠ¡å¿…å…³æ³¨æˆ‘æˆ–åœ¨*ä¸‹æ–¹ç•™ä¸‹æ‚¨çš„è¯„è®ºğŸ‘‡