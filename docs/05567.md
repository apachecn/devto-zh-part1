# ç”¨ React å’Œ SVG æ„å»ºåŠ¨ç”»å›¾è¡¨

> åŸæ–‡:[https://dev.to/azure/react-svg-chart-animation-5dfh](https://dev.to/azure/react-svg-chart-animation-5dfh)

åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è°ˆåˆ°äº† SVG å¯¹è±¡çš„åŠ¨ç”»åˆ¶ä½œä»¥åŠå¦‚ä½•å°†å®ƒä¸ React ç»“åˆèµ·æ¥ã€‚å½“æˆ‘è°ˆåˆ°å®ƒçš„å‚¬åŒ–å‰‚æ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”ç©¶å¦‚ä½•åˆ¶ä½œå›¾è¡¨ã€‚

å½“ç„¶ï¼Œåœ¨æˆ‘æœ€åˆçš„å®éªŒä¹‹åï¼Œæˆ‘æƒ³å®é™…çœ‹çœ‹å¦‚ä½•åšä¸€ä¸ªå›¾è¡¨ã€‚

## åˆ›å»ºåŸºæœ¬å›¾è¡¨

ä¸ºæ­¤ï¼Œæˆ‘ä» CSS Tricks çš„ [SVG å›¾è¡¨å¼€å§‹ï¼Œæˆ‘å°†ä½¿ç”¨](https://css-tricks.com/how-to-make-charts-with-svg/)[æŠ˜çº¿å›¾](https://css-tricks.com/how-to-make-charts-with-svg/#article-header-id-5)ç¤ºä¾‹(ä½†ä½¿ç”¨éšæœºç”Ÿæˆçš„æ•°æ®)ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†åŸºæœ¬çš„ React ç»„ä»¶æ˜¯ä»€ä¹ˆæ ·å­çš„:

```
const Line = ({ data }) => (
    <polyline
        fill="none"
        stroke="#0074d9"
        strokeWidth="2"
        points={data}
        />
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†è¿™ä¸æ˜¯æˆ‘ä»¬æ¥è¿™é‡Œè¦çœ‹çš„ï¼Œå‘ DOM æ¸²æŸ“å…ƒç´ æ˜¯éå¸¸åŸºæœ¬çš„ï¼Œè®©æˆ‘ä»¬å¼€å§‹è€ƒè™‘åŠ¨ç”»ã€‚

## åˆ¶ä½œæŠ˜çº¿å›¾åŠ¨ç”»

æˆ‘æƒ³åšçš„åŠ¨ç”»æ˜¯è®©çº¿æ¡ä» x è½´å¢é•¿åˆ° y è½´çš„ç»ˆç‚¹ã€‚

æ­¤å¤–ï¼Œæˆ‘å°†å°è¯•ç”¨ä¸€ä¸ªå¯¹è±¡æ¥è¡¨ç¤ºä¸€äº›æ›´çœŸå®çš„ä¸œè¥¿ï¼Œè€Œä¸åªæ˜¯ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜æ”¾æˆ‘ä»¬çš„è¾“å…¥æ•°æ®ã€‚æˆ‘çš„æ•°æ®ä¼šæ˜¯è¿™æ ·çš„:

```
const data = [{ x: 0, y: 120 }, { x: 20, y: 60 }]; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªé«˜é˜¶ç»„ä»¶æ¥åŒ…è£…å¤„ç†åŠ¨ç”»çš„é€»è¾‘ã€‚è®©æˆ‘ä»¬ä»`constructor`å’Œ`render`å¼€å§‹:

```
const animateLine = (WrappedComponent) => {
    class Wrapper extends React.Component {
        constructor(props) {
            super(props);

            const { xSelector, ySelector, data } = props;

            let mappedData = data.map((d) => [xSelector(d), ySelector(d)]).reduce((arr, curr) => arr.concat(curr), []);
            let max = data.map((d) => ySelector(d)).sort((a, b) => a - b).reverse()[0];
            let liveData = mappedData.map((x, i) => i % 2 ? max : x);

            this.mappedData = mappedData;
            this.max = max;
            this.state = {
                data: liveData,
                count: 0
            };
        }

        render() {
            return <WrappedComponent data={this.state.data} />;
        }
    };

    Wrapper.displayName = `AnimationWrapper(${WrappedComponent.displayName | WrappedComponent.name | 'Component'})`;

    return Wrapper;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬æœŸæœ›ç»„ä»¶ä¸Šæœ‰ 3 ä¸ª`props`:

*   ä¸€ç»„æ•°æ®
*   ä»æ•°æ®é¡¹ä¸­è·å–`x`å€¼çš„å‡½æ•°
*   ä»æ•°æ®é¡¹ä¸­è·å–`y`å€¼çš„å‡½æ•°

ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æ¥å±•å¹³æ•°æ®ï¼Œæ‰€ä»¥å®ƒçœ‹èµ·æ¥åƒ:

```
[0, 120, 20, 60] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„åŠ¨ç”»åšå‡†å¤‡ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬ç¬¬ä¸€æ¬¡ç”»çš„çº¿æ‹‰å¹³ï¼Œç„¶åæˆ‘ä»¬å†èµ°å›å»ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€å¤§çš„`y`å€¼ï¼Œæˆ‘å°†è¿™ä¸ªå€¼æ”¾å…¥ä¸€ä¸ªåä¸º`max`çš„å˜é‡ä¸­ã€‚

æœ€åï¼Œæˆ‘éœ€è¦åˆ›å»ºå±•å¹³çš„æ•°æ®é›†ï¼Œè¿™æ˜¯é€šè¿‡è·å–ç‚¹çš„æ•°ç»„å¹¶å°†æ‰€æœ‰çš„`y`ç‚¹è½¬æ¢ä¸º`max`å€¼æ¥å®Œæˆçš„(å› ä¸ºå®ƒæ˜¯æˆ‘ä»¬å¼€å§‹çš„å›¾å½¢çš„åº•éƒ¨ï¼Œè¿™æ˜¯ SVG çš„è¿‘ä¼¼é«˜åº¦)ã€‚ç°åœ¨æˆ‘ä»¬å‘ˆç°ç»™ç”¨æˆ·ç•Œé¢çš„æ•°æ®æ˜¯è¿™æ ·çš„:

```
[0, 0, 20, 0] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¾ˆå¥½ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªéšè—çš„çº¿å›¾ï¼Œå®ƒå®é™…ä¸Šå¹¶ä¸ä»£è¡¨æˆ‘ä»¬çš„æ•°æ®...ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚

æ˜¯æ—¶å€™å¼€å§‹åˆ¶ä½œåŠ¨ç”»äº†ã€‚åƒä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨`componentDidMount`æ¥å¯åŠ¨åŠ¨ç”»ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œä½¿ç”¨`componentWillUnmount`æ¥åœæ­¢åŠ¨ç”»ã€‚è¿™é‡Œæ˜¯`componentDidMount` :

```
componentWillMount() {
    const animator = () => {
        if (this.state.count >= this.max) {
            cancelAnimationFrame(this.rafId);
            return;
        }

        const newData = this.state.data.map((data, index) => {
            if (index % 2) {
                if (data > this.mappedData[index]) {
                    return data - 1;
                }
            }
            return data;
        });

        this.setState({ data: newData, count: this.state.count + 1 });
        this.rafId = requestAnimationFrame(animator);
    }

    this.rafId = requestAnimationFrame(animator);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬æ¥åˆ†è§£å®ƒï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œåˆ†è§£`animator`å‡½æ•°ï¼Œè¿™æ‰æ˜¯åŠ¨ç”»çœŸæ­£ä¸ºæˆ‘ä»¬åšçš„ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šæœ‰`max`çš„åŸå› æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çŸ¥é“ä»€ä¹ˆæ—¶å€™åœæ­¢å°è¯•åŠ¨ç”»ä¸€ä¸ªç‚¹ã€‚è¿™å°±æ˜¯è¿™ä¸ªé€»è¾‘çš„ç”¨é€”:

```
if (this.state.count >= this.max) {
    cancelAnimationFrame(this.rafId);
    return;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç¬¬äºŒæ­¥ï¼Œå¼€å§‹è®©æˆ‘ä»¬çš„ä¸´æ—¶æ•°æ®æ›´æ¥è¿‘çœŸå®æ•°æ®:

```
const newData = this.state.data.map((data, index) => {
    if (index % 2) {
        if (data > this.mappedData[index]) {
            return data - 1;
        }
    }
    return data;
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†ç»˜åˆ¶æ•°æ®å›¾ï¼Œå¹¶:

*   å¦‚æœå½“å‰ç´¢å¼•æ˜¯å¶æ•°ï¼Œä¸€ä¸ª x è½´å€¼ï¼Œåªéœ€è¿”å›å®ƒï¼Œæˆ‘ä»¬ä¸ç§»åŠ¨å®ƒ
*   å¦‚æœå½“å‰ç´¢å¼•æ˜¯å¥‡æ•°
    *   å¦‚æœå°äºç›®æ ‡å€¼ï¼Œåˆ™åŠ  1
    *   å¦åˆ™åªè¿”å›å½“å‰å€¼

ç¬¬ä¸‰æ­¥æ˜¯å°†æ–°æ•°ç»„ç½®äºçŠ¶æ€(å¹¶å¯¼è‡´é‡æ–°æ¸²æŸ“)ä»¥åŠå¢åŠ å¾ªç¯è®¡æ•°ï¼Œç„¶åå†æ¬¡å¯åŠ¨`requestAnimationFrame`ã€‚

ä»…æ­¤è€Œå·²ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯çˆ±çš„åŠ¨ç”»çº¿è½¦ã€‚

## ç»“è®º

æˆ‘ä»¬å†æ¬¡çœ‹åˆ°ï¼Œå°‘é‡çš„ä»£ç å’Œ React ç»„ä»¶å¯ä»¥ä½¿ä¸€ä¸ªéå¸¸å®¹æ˜“é˜…è¯»çš„åŠ¨ç”» SVG æ²¡æœ‰ä»»ä½•å¤–éƒ¨ä¾èµ–æ€§ã€‚

æˆ‘åˆ›å»ºäº†å¦ä¸€ä¸ªä¾‹å­[ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°](https://www.aaron-powell.com/demos/react-svg/react-svg-line-chart/)çš„è¿è¡Œï¼Œæ•°æ®æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ¯æ¬¡é‡æ–°åŠ è½½é¡µé¢éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„å›¾è¡¨ğŸ˜Šã€‚