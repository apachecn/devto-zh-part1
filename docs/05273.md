# ç”¨ React React åˆ›å»ºä¸€ä¸ªç®€å•ä¸”ç»è¿‡æµ‹è¯•çš„ Redux ç±»åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev . to/scastiel/create-a-simple-and-tested-redux-like-app-with-react](https://dev.to/scastiel/create-a-simple-and-tested-redux-like-app-with-reason-react)

åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘æˆäº†[ç†æ€§](https://reasonml.github.io/)çš„å¿ å®ç²‰ä¸ï¼Œå°¤å…¶æ˜¯å®ƒä¸[ç†æ€§ååº”](https://reasonml.github.io/reason-react/)çš„å…³è”ã€‚å› ä¸º Reason å’Œ React éƒ½æ˜¯éå¸¸å¹´è½»çš„é¡¹ç›®ï¼Œæ‰€ä»¥è¿˜æ²¡æœ‰å¾ˆå¤šå…³äºå®ƒçš„æ•™ç¨‹ã€StackOverflow é—®é¢˜å’Œæ–‡æ¡£ã€‚æ‰€ä»¥å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®å¹¶ä¸åƒå®˜æ–¹ç½‘ç«™æƒ³çš„é‚£ä¹ˆç®€å•ã€‚

ä½†æ˜¯ï¼Œä½¿ç”¨çº¯å‡½æ•°å¼è¯­è¨€æ¥åˆ›å»º React åº”ç”¨ç¨‹åºä¸ä»…æ˜¯å¯èƒ½çš„ï¼Œè€Œä¸”ä¹Ÿæ˜¯éå¸¸ä»¤äººå…´å¥‹çš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•èƒ½åšå®ƒã€‚

å½“ç„¶ï¼Œæˆ‘çœ‹åˆ°äº†ä½¿ç”¨ Reason è¿›è¡Œå‰ç«¯å¼€å‘çš„è®¸å¤šä¼˜åŠ¿ï¼Œä½†è¿™ä¸æ˜¯æˆ‘åœ¨æœ¬æ–‡ä¸­æƒ³è¦è°ˆè®ºçš„ã€‚å¦‚æœä½ æ­£åœ¨è¯»å®ƒï¼Œä½ å¯èƒ½å·²ç»è¢«è¯´æœäº†(å¦‚æœä¸æ˜¯ï¼Œé‚£ä¸æ˜¯é—®é¢˜ï¼).æˆ‘æƒ³å†™çš„æ˜¯æ›´å®ç”¨çš„æ•™ç¨‹ï¼Œå¸Œæœ›å®ƒèƒ½é˜²æ­¢ä¸€äº›äººèŠ±è´¹æ•°å°æ—¶å¯»æ‰¾æˆ‘å¿…é¡»æ‰¾åˆ°çš„ç›¸åŒç­”æ¡ˆã€‚

è¯¥æ•™ç¨‹åŸºäºæˆ‘åˆ›å»ºçš„ä¸€ä¸ªéå¸¸å°(å¹¶ä¸”æ— ç”¨)çš„é¡¹ç›®ï¼Œç”±ä¸€ä¸ªå¸¦æœ‰æŒ‰é’®çš„è®¡æ•°å™¨ç»„æˆï¼Œå¯ä»¥å¢åŠ æˆ–å‡å°‘å®ƒ(æˆ‘å‘Šè¯‰è¿‡ä½ å®ƒæ˜¯æ— ç”¨çš„)ã€‚æƒ³æ³•æ˜¯åˆ›å»ºä¸€ä¸ª React åº”ç”¨ç¨‹åºï¼Œç±»ä¼¼ Redux æ¶æ„(æœ‰çŠ¶æ€ã€åŠ¨ä½œå’Œç¼©å‡å™¨)ï¼Œä»¥åŠç›¸å…³çš„å•å…ƒæµ‹è¯•ã€‚

è¿˜è¦çŸ¥é“ï¼Œå¦‚æœä½ å·²ç»æŒæ¡äº†ä¸€äº›å…³äº Reason è¯­æ³•ã€ç±»ä¼¼ Redux çš„ä½“ç³»ç»“æ„(æˆ‘ä»¬åœ¨è¿™é‡Œå°†ä¿æŒå®ƒéå¸¸ç®€å•)ä»¥åŠ React çš„çŸ¥è¯†ï¼Œé‚£ä¹ˆç†è§£æœ¬æ•™ç¨‹å°†ä¼šæ›´åŠ å®¹æ˜“ã€‚è¿™é‡Œæœ‰ä¸¤ç¯‡æ–‡ç« å°†å‘ä½ ä»‹ç»ç†æ€§å’Œç†æ€§ååº”:

*   [ä¸€ä¸ªç”±](https://dev.to/kayis/a-reason-to-code) [K ç¼–ç ](https://twitter.com/K4y1s)çš„ç†ç”±ğŸ‘“
*   [ä¸€ä¸ªç†æ€§çš„ååº”æ•™ç¨‹](https://jaredforsyth.com/2017/07/05/a-reason-react-tutorial/)ä½œè€…[æ°ç‘å¾·Â·ç¦èµ›æ€](https://twitter.com/jaredforsyth)

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å§ï¼å®Œæ•´çš„é¡¹ç›®å¯ä»¥åœ¨ [GitHub](https://github.com/scastiel/reason-react-example-app) ä¸Šæ‰¾åˆ°ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨å¯èƒ½éœ€è¦äº†è§£ä»¥ä¸‹ä¿¡æ¯:

*   è¿™ä¸ªé¡¹ç›®æ˜¯ç”±æ£’æäº†çš„ [Create React App](https://github.com/facebookincubator/create-react-app) å¯åŠ¨çš„ï¼Œä½¿ç”¨äº† [Reason è„šæœ¬](https://github.com/reasonml-community/reason-scripts)ï¼Œç”±[React](https://reasonml.github.io/reason-react/gettingStarted.html#getting-started-reason-scripts)æ¨èã€‚
*   æˆ‘æ²¡æœ‰ä½¿ç”¨ç°æœ‰çš„ç±»ä¼¼ Redux çš„åº“ [Reductive](https://github.com/reasonml-community/reductive) æ¥ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚å®ƒå¯èƒ½ç¬¦åˆæˆ‘çš„éœ€è¦ï¼Œä½†å®ƒä»ç„¶éå¸¸å¹´è½»ï¼Œç¼ºä¹æ–‡æ¡£ã€‚ä¹Ÿè®¸å¦‚æœå®ƒé•¿å¤§äº†ï¼Œåœ¨ä¸ä¹…çš„å°†æ¥å®ƒä¼šå¯¹ä½¿ç”¨å®ƒæ„Ÿå…´è¶£ã€‚
*   æµ‹è¯•æ˜¯ç”¨ JavaScript ç¼–å†™çš„ã€‚è™½ç„¶æœ‰å¯èƒ½åˆç†åœ°ç¼–å†™å®ƒä»¬ï¼Œä½†æ˜¯ [bs-jest](https://github.com/reasonml-community/bs-jest) ä»ç„¶æ˜¯éå¸¸â€œå®éªŒæ€§å’Œæ­£åœ¨è¿›è¡Œä¸­çš„å·¥ä½œâ€(æ­£å¦‚ä»–ä»¬è‡ªå·±æ‰€è¯´çš„)ï¼Œå¹¶ä¸”æˆ‘æ— æ³•å®ç°ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ä½¿ç”¨æ¨¡æ‹Ÿå‡½æ•°ã€‚å®ƒä»¬ä¼¼ä¹å·²ç»å®ç°ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•ç¤ºä¾‹æ–‡æ¡£ã€‚åŒæ ·ï¼Œåœ¨å°†æ¥ç›´æ¥ç”¨ rational ç¼–å†™æ‰€æœ‰çš„æµ‹è¯•å°†ä¼šå¾ˆæœ‰è¶£ã€‚

## æè¿°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€

çŠ¶æ€åŸºæœ¬ä¸Šæ˜¯ä¸€ç§ç±»å‹ï¼Œå¯¹åº”äºæˆ‘ä»¬å¸Œæœ›å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºçŠ¶æ€ä¸­çš„æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬åªæƒ³å­˜å‚¨ä¸€ä¸ªæ•´æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰:

```
type state = int; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å­˜å‚¨ç”±ä¸¤ä¸ªå­—æ®µç»„æˆçš„è®°å½•:

```
type state = {
  counter: int,
  intervalId: option intervalId
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„ç±»å‹å`state`å¾ˆé‡è¦ï¼Œæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°åŸå› ã€‚

åœ¨æˆ‘ä»¬çš„ *state.re* æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜å£°æ˜äº†ä¸€äº›å®ç”¨å‡½æ•°æ¥åˆ›å»ºå’Œæ“ä½œçŠ¶æ€ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬ä¸»è¦æ˜¯å¸®åŠ©ç¼–å†™æˆ‘ä»¬çš„ JavaScript æµ‹è¯•ï¼Œå› ä¸ºåœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è®°å½•æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬ä¸å¯èƒ½å†™å‡ºè¿™æ ·çš„ä¸œè¥¿:

```
const state = { counter: 0, intervalId: 123 } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...æˆ‘ä»¬ä¼šå†™:

```
const state = setCounter(createState(), 0) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## å®šä¹‰å¯èƒ½çš„åŠ¨ä½œ

### åŠ¨ä½œå®šä¹‰

åŠ¨ä½œç”±ç±»å‹å’Œå‚æ•°ç»„æˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†æŸä¸ªçŠ¶æ€å€¼è®¾ç½®ä¸º 10ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªå¸¦æœ‰ç±»å‹`SetValue`å’Œä¸€ä¸ªå‚æ•°`10`çš„åŠ¨ä½œã€‚ç†æ™ºçš„[å˜ç§](https://reasonml.github.io/guide/language/variant)å‹æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼›æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå˜é‡ç±»å‹ä¸­å®šä¹‰æ‰€æœ‰å¯èƒ½çš„åŠ¨ä½œ:

```
type action =
  | Increment
  | Decrement
  | StartIncrementing intervalId
  | StopIncrementing; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åŒæ ·ï¼Œä¸ºäº†ä½¿ JavaScript æµ‹è¯•æ›´å®¹æ˜“ï¼Œæˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€äº›å®ç”¨å‡½æ•°å’Œå€¼:

```
let incrementAction = Increment;
let decrementAction = Decrement;
let startIncrementingAction intervalId => StartIncrementing intervalId;
let stopIncrementingAction = StopIncrementing; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†æœ‰åŠ©äºåˆ›å»ºæ–°çš„åŠ¨ä½œ(æˆ‘ä»¬æ— æ³•è®¿é—® JavaScript ä¸­çš„ variant ç±»å‹æ„é€ å‡½æ•°)ï¼Œä¹Ÿæœ‰åŠ©äºå°†ä¸€äº›ç»“æœåŠ¨ä½œä¸æˆ‘ä»¬é¢„æœŸçš„åŠ¨ä½œè¿›è¡Œæ¯”è¾ƒã€‚

### åŠ¨ä½œåˆ›å»ºè€…

åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¸ä½¿ç”¨åŠ¨ä½œæ„é€ å‡½æ•°ï¼Œç”¨å®ç”¨å‡½æ•°åˆ›å»ºåŠ¨ä½œæ›´å®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œè¦åˆ›å»ºä¸€ä¸ª`Increment`åŠ¨ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°`increment` :

```
let increment => Increment;
let setValue value => SetValue value;

let incrementAction = increment;
let setValueTo10Action = setValue 10; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è¿™çœ‹èµ·æ¥ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯è®©æˆ‘ä»¬æƒ³è±¡æˆ‘ä»¬ç»å¸¸æƒ³è¦å¢åŠ æˆ‘ä»¬çš„è®¡æ•°å™¨ä¸¤æ¬¡ã€‚æˆ‘ä»¬æƒ³å†™ä¸€ä¸ªåŠ¨ä½œåˆ›å»ºå™¨æ¥è§¦å‘ä¸¤ä¸ªåŠ¨ä½œã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„åŠ¨ä½œåˆ›å»ºè€…å°†æŠŠå‡½æ•°`dispatch`ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°å°†è¢«è°ƒç”¨æ¥è§¦å‘åŠ¨ä½œ:

```
let increment dispatch => dispatch Increment;

let incrementTwice dispatch => {
  dispatch Increment;
  dispatch Increment;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤å¤–ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç¼–å†™å¼‚æ­¥åŠ¨ä½œåˆ›å»ºå™¨(æœ‰å‰¯ä½œç”¨)ï¼Œæ¯”å¦‚ HTTP è¯·æ±‚ã€è¶…æ—¶ç­‰ã€‚:

```
let incrementEverySecond dispatch => {
  let intervalId = setInterval (fun () => increment dispatch) 1000;
  startIncrementing intervalId dispatch
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°å¦‚ä½•è°ƒç”¨è¿™äº›åŠ¨ä½œåˆ›å»ºè€…ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å‹`deferredAction`(è¿™å°†æœ‰åŠ©äºæˆ‘ä»¬è¿›è¡Œç±»å‹æ¨æ–­)ï¼Œå¯¹åº”äºåœ¨æ²¡æœ‰`dispatch`å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨åŠ¨ä½œåˆ›å»ºè€…æ—¶è¿”å›çš„å†…å®¹:

```
type deferredAction = (action => unit) => unit;

/* For instance `deferredAction` is the type of `increment`. */ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç¼–å†™å‡é€Ÿå™¨

reducer æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°:å½“å‰çŠ¶æ€å’Œä¸€ä¸ªåŠ¨ä½œï¼Œå¹¶è¿”å›ä»åŠ¨ä½œè®¡ç®—å‡ºçš„æ–°çŠ¶æ€ã€‚åŒæ ·ä¸ºäº†ä½¿ç±»å‹æ¨ç†æ›´å®¹æ˜“ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å‹:

```
open State;
open Actions;
type reducer = state => action => state; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œæˆ‘ä»¬åœ¨åŠ¨ä½œç±»å‹
ä¸Šä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å®šä¹‰æˆ‘ä»¬çš„`reducer`å‡½æ•°

```
let reducer: reducer =
  fun state action =>
    switch action {
    | Increment => {...state, counter: state.counter + 1}
    | StartIncrementing intervalId =>
      switch state.intervalId {
      | None => {...state, intervalId: Some intervalId}
      | _ => state
      }
    }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## è®¾è®¡ React ç»„ä»¶

æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºç”±ä¸€ä¸ªåä¸º`Counter`çš„ä¸»è¦ React ç»„ä»¶ç»„æˆã€‚æˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯å®Œå…¨æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™å®ƒå‚æ•°(é“å…·)*çŠ¶æ€*(æˆ‘ä»¬å¸Œæœ›æ˜¾ç¤ºæˆ–ä½¿ç”¨ä»€ä¹ˆå€¼)å’Œ*åŠ¨ä½œ*ï¼Œä½œä¸ºä¸€äº›äº‹ä»¶(ç‚¹å‡»æŒ‰é’®)è°ƒç”¨çš„å‡½æ•°ã€‚

ä¸‹é¢æ˜¯è¯¥ç»„ä»¶çš„ç®€åŒ–ç‰ˆæœ¬:

```
let component = ReasonReact.statelessComponent "Counter";

let make
    counter::(counter: int)
    increment::(increment: unit => unit)
    _children => {
  ...component,
  render: fun self =>
    <div>
      (ReasonReact.stringToElement ("Counter: " ^ string_of_int counter))
      <button className="plus-button" onClick=(self.handle (fun _ _ => increment ()))>
        (ReasonReact.stringToElement "+")
      </button>
    </div>
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„`increment` prop çš„ç±»å‹:å®ƒæ˜¯ä¸€ä¸ªä¸è¿”å›ä»»ä½•ä¸œè¥¿çš„å‡½æ•°(`unit`)ã€‚æˆ‘ä»¬ä¸çŸ¥é“æˆ‘ä»¬ä»¥å‰åˆ›å»ºçš„åŠ¨ä½œï¼Œæˆ‘ä»¬åªæ˜¯æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨éœ€è¦æ—¶è°ƒç”¨å®ƒï¼Œå®ƒæœ‰ä¸€ä¸ª React React éœ€è¦çš„å¥‡æ€ªè¯­æ³•:`self.handle (fun _ _ => increment ())`ã€‚æƒ³è±¡ä¸€ä¸‹å®ƒå°†å¦‚ä½•ä½¿å•å…ƒæµ‹è¯•å˜å¾—æ›´å®¹æ˜“ï¼

## è¿æ¥æ‰€æœ‰çš„æ£‹å­

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†çŠ¶æ€å®šä¹‰ã€å®ƒä»¬çš„åˆ›å»ºè€…çš„æ“ä½œã€æˆ‘ä»¬çš„ reducer å’Œä¸€ä¸ªç»„ä»¶æ¥æ˜¾ç¤ºå’Œæ“ä½œæ‰€æœ‰è¿™äº›éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦ç»„è£…æ‰€æœ‰è¿™äº›ã€‚

å…ˆä» app çš„ä¸»æ–‡ä»¶ *index.re* è¯´èµ·ã€‚å®ƒé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°`createComponent` :

```
let createComponent state dispatch => <CounterApp state dispatch />; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥å‡½æ•°å°†çŠ¶æ€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°†å‡½æ•°`dispatch`ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªåä¸º`CounterApp`çš„ç»„ä»¶çš„æ–°å®ä¾‹ï¼Œæˆ‘ä»¬å°†åœ¨å‡ åˆ†é’Ÿåçœ‹åˆ°ï¼Œç»™å®ƒä¸¤ä¸ªå‚æ•°`state`å’Œ`dispatch`ã€‚

æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ç»™å¦ä¸€ä¸ªç»„ä»¶ï¼Œ`Provider` :

```
ReactDOMRe.renderToElementWithId
  <Provider reducer initialState=(createState ()) createComponent /> "root"; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ª`Provider`ç»„ä»¶å°†å¤„ç†æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚æ— éœ€æ·±å…¥ç»†èŠ‚(å‚è§æ¨¡å— *providerFactory* äº†è§£æ›´å¤š)ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå…·æœ‰çŠ¶æ€(åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€)çš„ç»„ä»¶ï¼Œå¹¶åœ¨å‘å‡ºåŠ¨ä½œæ—¶ä½¿ç”¨ reducer æ›´æ–°è¯¥çŠ¶æ€ã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯ *redux-react* æ‰€åšçš„äº‹æƒ…çš„é‡æ–°å®ç°ï¼Œä»¥ä¸€ç§æ›´åŠ ç®€å•å’Œæç®€çš„æ–¹å¼ã€‚

è¿˜è¦æ³¨æ„ï¼Œ*æä¾›è€…*ç»„ä»¶æ˜¯é€šè¿‡è°ƒç”¨æ¨¡å— *ProviderFactory åˆ›å»ºçš„ã€‚MakeProvider* å¸¦æœ‰ä½œä¸ºå‚æ•°çš„å¦ä¸€ä¸ªæ¨¡å—:`State`ï¼Œå®ƒåŒ…å«æˆ‘ä»¬çŠ¶æ€çš„ç±»å‹:`state`ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„å›½å®¶ç±»å‹éœ€è¦è¢«ç§°ä¸º`state`ï¼› *ProviderFactory* æ¨¡å—ä¸çŸ¥é“æˆ‘ä»¬çš„çŠ¶æ€ï¼Œå®ƒç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ä¸­ï¼Œæ‰€ä»¥ä½¿å®ƒå…³äºçŠ¶æ€ç±»å‹æ˜¯é€šç”¨çš„æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºæœ‰äº†`createComponent`å‚æ•°ï¼Œå°è£…çš„ç»„ä»¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

æœ€åï¼Œæˆ‘ä»¬éœ€è¦`CounterApp`ç»„ä»¶ï¼Œå®ƒå°†æ˜¯æä¾›è€…å’Œ`Counter`ç»„ä»¶ä¹‹é—´çš„é“¾æ¥ã€‚å®ƒçš„ä¸¤ä¸ªé“å…·æ˜¯åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ï¼Œä»¥åŠä¸€ä¸ªå°†è¢«è°ƒç”¨æ¥å‘å‡ºåŠ¨ä½œçš„`dispatch`å‡½æ•°:

```
let component = ReasonReact.statelessComponent "CounterApp";

let make state::(state: state) dispatch::(dispatch: deferredAction => unit) _children => {
  ...component,
  render: fun _ => {
    let onIncrement () => dispatch increment;
    <Counter
      counter=state.counter
      increment=onIncrement
    />
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸º`Counter`éœ€è¦ä¸€ä¸ªæ™®é€šå‡½æ•°(`unit => unit`)ä½œä¸º`increment`å‚æ•°ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨`dispatch` :
æ¥åˆ›å»ºå®ƒ

```
let onIncrement () => dispatch increment; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç¼–å†™å•å…ƒæµ‹è¯•

æ—¢ç„¶æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦‚ä½•ä¸ºæ¯ä¸ªéƒ¨åˆ†ç¼–å†™å•å…ƒæµ‹è¯•äº†ã€‚å¦‚æœæ‚¨ä¹ æƒ¯äºä¸º React ç»„ä»¶ç¼–å†™æµ‹è¯•ï¼Œé‚£ä¹ˆè¿›è¡Œè½¬æ¢åº”è¯¥ä¸ä¼šå¤ªéš¾ã€‚å…³äºåœ¨æ™®é€š JavaScript ä¸­ä½¿ç”¨ Reason çš„ä¸œè¥¿(ç»„ä»¶ã€å‡½æ•°â€¦â€¦)ï¼Œæœ‰ä¸€äº›äº‹æƒ…éœ€è¦äº†è§£ã€‚

### å‡é€Ÿå™¨

æµ‹è¯•å‡å‹å™¨æ˜¯æœ€ç®€å•çš„éƒ¨åˆ†:è¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æµ‹è¯•ç»™å®šä¸€ä¸ªçŠ¶æ€å’Œä¸€ä¸ªåŠ¨ä½œï¼Œæˆ‘ä»¬å¾—åˆ°é¢„æœŸçš„æ–°çŠ¶æ€ã€‚

ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯å¦‚ä½•æµ‹è¯•`Increment`åŠ¨ä½œçš„:

```
describe('with Increment action', () => {
  it('increments counter', () => {
    const state = setCounter(createState(), 0)
    const newState = reducer(state, incrementAction)
    expect(newState).toEqual(setCounter(state, 1))
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„æ•ˆç”¨å‡½æ•°`setCounter`å’Œ`setState`ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½(è‡³å°‘ä¸èƒ½ä»¥ä¸€ç§æ¸…æ™°çš„æ–¹å¼)ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªçŠ¶æ€(å‚è§å…³äºçŠ¶æ€å®šä¹‰çš„éƒ¨åˆ†)ã€‚

### åŠ¨ä½œåˆ›å»ºè€…

åªè¦æ²¡æœ‰è¯¸å¦‚è¶…æ—¶ã€HTTP è¯·æ±‚ç­‰å‰¯ä½œç”¨ï¼Œæµ‹è¯•åŠ¨ä½œåˆ›å»ºè€…å¹¶ä¸å›°éš¾ã€‚

ä¾‹å¦‚ï¼Œä¸ºäº†æµ‹è¯•`increment`åŠ¨ä½œåˆ›å»ºå™¨ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•å½“ç”¨`dispatch`å‡½æ•°(ä¸€ä¸ªç©ç¬‘é—´è°)è°ƒç”¨æ—¶ï¼Œè¿™ä¸ª`dispatch`å‡½æ•°å°†è¢«ç”¨`Increment`åŠ¨ä½œ:
è°ƒç”¨

```
describe('increment', () => {
  it('should call dispatch with Increment action', () => {
    const dispatch = jest.fn()
    increment(dispatch)
    expect(dispatch.mock.calls.length).toEqual(1)
    expect(dispatch.mock.calls[0][0]).toEqual(incrementAction)
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†æ¬¡æ³¨æ„ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨æˆ‘ä»¬çš„æ•ˆç”¨å€¼`incrementAction`æ¥æ£€æŸ¥ç»“æœå€¼æ˜¯å¦æ˜¯ä¸€ä¸ª`Increment`åŠ¨ä½œï¼Œå› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šè¿™ä¸ªå˜é‡ç±»å‹åœ¨ JavaScript ä¸­æ˜¯å¦‚ä½•è½¬æ¢çš„ã€‚

å¦‚æœè¢«æµ‹è¯•çš„åŠ¨ä½œåˆ›å»ºå™¨æ˜¯å¼‚æ­¥çš„ï¼Œè¿‡ç¨‹æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Jest èƒ½åŠ›æ¥æµ‹è¯•å¸¦æœ‰`async`å‡½æ•°çš„å¼‚æ­¥ä»£ç (å‚è§ *action.test.js* æ–‡ä»¶ä¸­çš„ä¸€äº›ä¾‹å­)ã€‚

### ç»„ä»¶

æµ‹è¯•ç»„ä»¶çœŸçš„å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦çŸ¥é“ä¸€ä»¶äº‹:React ç»„ä»¶ä¸èƒ½åœ¨ JavaScript ä¸­ä½¿ç”¨çš„åŸå› ã€‚è¦åœ¨ JavaScript ä¸­ä½¿ç”¨ React ç»„ä»¶ï¼Œå¿…é¡»å¯¼å‡ºè¯¥ç»„ä»¶çš„ JS-friendly ç‰ˆæœ¬ã€‚ä¾‹å¦‚åœ¨*æ–‡ä»¶çš„æœ«å°¾æœ‰ä¸€ä¸ª*æ–‡ä»¶:

```
let counter =
  ReasonReact.wrapReasonForJs
    ::component
    (
      fun jsProps =>
        make
          counter::jsProps##counter
          increment::jsProps##increment
          [||]
    ); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œåœ¨æµ‹è¯•æ–‡ä»¶(æˆ–ä»»ä½• JavaScript æ–‡ä»¶)ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å…¥æˆ‘ä»¬çš„ç»„ä»¶ï¼Œå¹¶å°†å…¶ç”¨ä½œä»»ä½• React ç»„ä»¶:

```
import { counter as Counter } from '../counter.re' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æµ‹è¯•éƒ¨åˆ†ç°åœ¨ä»ç„¶å’Œæµ‹è¯•ä»»ä½• React ç»„ä»¶ä¸€æ ·ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æŠ€å·§å¯ä»¥ä½¿ç”¨ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œä¸‹é¢æ˜¯æˆ‘å¦‚ä½•æµ‹è¯•æˆ‘çš„`Counter`ç»„ä»¶:

#### ç”¨å¿«ç…§æµ‹è¯•æ¸²æŸ“

åœ¨ç»™å®šæŸäº›å±æ€§çš„æƒ…å†µä¸‹ï¼Œæµ‹è¯•ç»„ä»¶æ¸²æŸ“è‰¯å¥½çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨å¿«ç…§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ£€æŸ¥è®¡æ•°å™¨çš„å‘ˆç°å…ƒç´ åœ¨è®¡æ•°å™¨ä¸º 0 æˆ– 10 æ—¶æ˜¯å¦æ­£å¸¸ï¼Œæˆ‘ä»¬å†™:

```
import { shallow } from 'enzyme'
describe('Counter component', () => {
  it('renders with value 0 without intervalId', () => {
    const wrapper = shallow(<Counter counter={0} />)
    expect(wrapper).toMatchSnapshot()
  })

  it('renders with value 10 without intervalId', () => {
    const wrapper = shallow(<Counter counter={10} />)
    expect(wrapper).toMatchSnapshot()
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼ŒJest å°†ç”Ÿæˆå¿«ç…§æ–‡ä»¶ï¼Œä¸‹ä¸€æ¬¡å®ƒå°†æ¯”è¾ƒå‘ˆç°çš„å…ƒç´ æ˜¯å¦ä»ç„¶ç›¸åŒã€‚

#### æµ‹è¯•åŠ¨ä½œ

ä¸ºäº†æµ‹è¯•å½“ä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œæ­£ç¡®çš„å‡½æ•°å°†è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ *enzyme* èƒ½åŠ›æ¥æ¨¡æ‹Ÿç‚¹å‡»å’Œ Jest mock å‡½æ•°ã€‚è¿™å¾ˆå®¹æ˜“:

```
it('calls increment when plus button is clicked', () => {
  const increment = jest.fn()
  const wrapper = shallow(
    <Counter counter={10} increment={increment} />
  )
  wrapper.find('.plus-button').simulate('click')
  expect(increment.mock.calls.length).toEqual(1)
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆï¼Ÿ

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•åˆç†åœ°åˆ›å»ºä¸€ä¸ªç®€å•çš„ React ç»„ä»¶ï¼Œä½¿ç”¨ç±»ä¼¼ Redux çš„æ¶æ„å’Œå•å…ƒæµ‹è¯•ã€‚å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹ React/Redux èƒ½åšä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡æ¥ä¸‹æ¥è¦å®ç°å¾ˆå¤š:

*   æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„è·¯ç”±å™¨ï¼ŒåŸºäºå®ƒçš„å½“å‰çŠ¶æ€ã€‚ç”šè‡³å¯èƒ½å°†çŠ¶æ€å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Ÿ
*   ç¼–æ’å‡ ä¸ªæ›´å¤æ‚çš„ç»„ä»¶ï¼Œå‡ ä¸ªå‡é€Ÿå™¨â€¦
*   ä½¿ç”¨ React Nativeï¼é‚£å°†æ˜¯æƒŠäººçš„ï¼›æˆ‘å¬è¯´æœ‰äº›äººå·²ç»æˆåŠŸåšåˆ°äº†ğŸ˜‰

Reason è¿˜æ˜¯ä¸€é—¨å¾ˆå¹´è½»çš„è¯­è¨€ï¼Œå®ƒçš„ç”Ÿæ€ç³»ç»Ÿæˆé•¿å¾ˆå¿«ï¼Œå¾ˆç‰›é€¼ã€‚æˆ‘å·²ç»ä¸å¾—ä¸é‡å†™æœ¬æ•™ç¨‹çš„ä¸€äº›éƒ¨åˆ†ï¼Œå› ä¸ºè‡ªä»æˆ‘å¼€å§‹ä»¥æ¥å‡ºç°äº†æ–°çš„åŠŸèƒ½æˆ–é¡¹ç›®ã€‚æ¯«æ— ç–‘é—®ï¼Œå®ƒå°†ç»§ç»­ä¸‹å»ğŸ˜ƒ

*è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨æˆ‘çš„åšå®¢ä¸Šã€‚*