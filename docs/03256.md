# é€šè¿‡æ»¥ç”¨ Ruby åŸç”Ÿè§£æå™¨ä¸­çš„ä¸€ä¸ª bug ç»•è¿‡æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ è¿‡æ»¤å™¨ã€‚

> åŸæ–‡:[https://dev . to/edoverflow/bypassing-server-side-request-forge-filters-by-abuse-a-bug-in-rubys-native-resolver-1g0j](https://dev.to/edoverflow/bypassing-server-side-request-forgery-filters-by-abusing-a-bug-in-rubys-native-resolver--1g0j)

## æ€»ç»“

è¿™æ˜¯æˆ‘åœ¨`Resolv::getaddresses`ä¸­å‘ç°çš„ä¸€ä¸ªæ¼æ´çš„å®‰å…¨å»ºè®®ï¼Œè¿™ä¸ªæ¼æ´ä½¿æˆ‘èƒ½å¤Ÿç»•è¿‡å¤šä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ è¿‡æ»¤å™¨ã€‚GitLab å’Œ HackerOne ç­‰åº”ç”¨éƒ½å—åˆ°äº†è¿™ä¸ª bug çš„å½±å“ã€‚æœ¬å…¬å‘Šä¸­å¼•ç”¨çš„æ‰€æœ‰æŠ¥å‘Šçš„æŠ«éœ²éµå¾ª [HackerOne çš„æ¼æ´æŠ«éœ²æŒ‡å—](https://www.hackerone.com/disclosure-guidelines)ã€‚

è¿™ä¸ª bug è¢«åˆ†é… [CVE-2017-0904](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-0904) ã€‚

## æ¼æ´è¯¦æƒ…

ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼Œå› æ­¤é€šè¿‡ä½¿ç”¨ä¸åŒçš„ IP æ ¼å¼å¯ä»¥è¿”å›ç©ºå€¼ã€‚è¯¥æ¼æ´å¯è¢«æ»¥ç”¨æ¥ç»•è¿‡é€šå¸¸ç”¨äºé˜²èŒƒ SSRF ç—…æ¯’çš„æ’é™¤åˆ—è¡¨ã€‚

| ğŸ’»æœºå™¨ 1 | ğŸ’»æœºå™¨ 2 |
| --- | --- |
| ruby 2 . 3 . 3 p 222(2016-11-21)[x86 _ 64-Linux-GNU] | ruby 2 . 3 . 1 p 112(2016-04-26)[x86 _ 64-Linux-GNU] |

ğŸ’»æœºå™¨ 1

```
irb(main):002:0> Resolv.getaddresses("127.0.0.1")
=> ["127.0.0.1"]
irb(main):003:0> Resolv.getaddresses("localhost")
=> ["127.0.0.1"]
irb(main):004:0> Resolv.getaddresses("127.000.000.1")
=> ["127.0.0.1"] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ’»æœºå™¨ 2

```
irb(main):008:0> Resolv.getaddresses("127.0.0.1")
=> ["127.0.0.1"]
irb(main):009:0> Resolv.getaddresses("localhost")
=> ["127.0.0.1"]
irb(main):010:0> Resolv.getaddresses("127.000.000.1")
=> [] # ğŸ˜± 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªé—®é¢˜åœ¨ Ruby çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ä¸­é‡ç°:

```
$ ruby -v
ruby 2.4.3p201 (2017-10-11 revision 60168) [x86_64-linux]
$ irb
irb(main):001:0> require 'resolv'
=> true
irb(main):002:0> Resolv.getaddresses("127.000.001")
=> [] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æ¦‚å¿µè¯æ˜

```
irb(main):001:0> require 'resolv'
=> true
irb(main):002:0> uri = "0x7f.1"
=> "0x7f.1"
irb(main):003:0> server_ips = Resolv.getaddresses(uri)
=> [] # The bug!
irb(main):004:0> blocked_ips = ["127.0.0.1", "::1", "0.0.0.0"]
=> ["127.0.0.1", "::1", "0.0.0.0"]
irb(main):005:0> (blocked_ips & server_ips).any?
=> false # Bypass 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æ ¹æœ¬åŸå› 

ä¸‹ä¸€èŠ‚æè¿°äº†è¿™ä¸ªé”™è¯¯çš„æ ¹æœ¬åŸå› ã€‚æˆ‘åœ¨ä»£ç ç‰‡æ®µä¸­æ·»åŠ äº†ä¸€äº›æ³¨é‡Šï¼Œä»¥å¸®åŠ©è¯»è€…ç†è§£ã€‚

å½“æˆ‘ä»¬åœ¨è°ƒè¯•æ¨¡å¼(`irb -d`)ä¸‹è¿è¡Œ irb æ—¶ï¼Œä¼šè¿”å›ä»¥ä¸‹é”™è¯¯:

```
irb(main):002:0> Resolv.getaddresses "127.1"
Exception `Resolv::DNS::Config::NXDomain' at /usr/lib/ruby/2.3.0/resolv.rb:549 - 127.1
Exception `Resolv::DNS::Config::NXDomain' at /usr/lib/ruby/2.3.0/resolv.rb:549 - 127.1
=> [] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ä¾‹å¤–æºäº`fetch_resource()`<sup>[ã€1ã€‘](https://github.com/ruby/ruby/blob/e16bd0f4d81ef74035712853a5eb527f28abb342/lib/resolv.rb#L514-L554)</sup>ã€‚â€œNXDOMAINâ€å“åº”è¡¨ç¤ºè§£æç¨‹åºæ‰¾ä¸åˆ°ç›¸åº”çš„ PTR è®°å½•ã€‚è¿™å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸ºæ­£å¦‚æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°çš„ï¼Œ`resolv.rb`ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„è§£æå™¨ã€‚

```
# Reverse DNS lookup on ğŸ’» Machine 1.
$ nslookup 127.0.0.1
Server: 127.0.0.53
Address: 127.0.0.53#53

Non-authoritative answer:
1.0.0.127.in-addr.arpa name = localhost.

Authoritative answers can be found from:

$ nslookup 127.000.000.1
Server: 127.0.0.53
Address: 127.0.0.53#53

Non-authoritative answer:
Name: 127.000.000.1
Address: 127.0.0.1

# NXDOMAIN for 127.1.
$ nslookup 127.1
Server: 127.0.0.53
Address: 127.0.0.53#53

** server can't find 127.1: NXDOMAIN 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†ä¸ºä»€ä¹ˆ`Resolv::getaddresses`ä¾èµ–äºæ“ä½œç³»ç»Ÿã€‚

`getaddresses`è·å–åœ°å€(`name`)å¹¶å°†å…¶ä¼ é€’ç»™`each_address`ï¼Œåœ¨é‚£é‡Œä¸€æ—¦è¢«è§£æï¼Œå®ƒå°±è¢«é™„åŠ åˆ°`ret`æ•°ç»„ä¸­ã€‚

```
# File lib/resolv.rb, line 100
def getaddresses(name)
  # This is the "ret" array.
  ret = []
  # This is where "address" is appended to the "ret" array.
  each_address(name) {|address| ret << address}
  return ret
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`each_address`é€šè¿‡`@resolvers`è¿è¡Œ`name`ã€‚

```
# File lib/resolv.rb, line 109
def each_address(name)
    if AddressRegex =~ name
      yield name
      return
    end
    yielded = false
    # "name" is passed on to the resolver here.
    @resolvers.each {|r|
      r.each_address(name) {|address|
        yield address.to_s
        yielded = true
      }
      return if yielded
    }
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`@resolvers`åœ¨`initialize()`ä¸­åˆå§‹åŒ–ã€‚

```
# File lib/resolv.rb, line 109
def initialize(resolvers=[Hosts.new, DNS.new])
    @resolvers = resolvers
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤å¤–ï¼Œ`initialize`å®é™…ä¸Šæ˜¯é€šè¿‡å°†`config_info`è®¾ç½®ä¸º`nil`æ¥åˆå§‹åŒ–çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹`/etc/resolv.conf`ä½¿ç”¨é»˜è®¤é…ç½®ã€‚

```
# File lib/resolv.rb, line 308
# Set to /etc/resolv.conf Â¯\_(ãƒ„)_/Â¯
def initialize(config_info=nil)
  @mutex = Thread::Mutex.new
  @config = Config.new(config_info)
  @initialized = nil
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»¥ä¸‹æ˜¯é»˜è®¤é…ç½®:

```
# File lib/resolv.rb, line 959
def Config.default_config_hash(filename="/etc/resolv.conf")
  if File.exist? filename
    config_hash = Config.parse_resolv_conf(filename)
  else
    if /mswin|cygwin|mingw|bccwin/ =~ RUBY_PLATFORM
      require 'win32/resolv'
      search, nameserver = Win32::Resolv.get_resolv_info
      config_hash = {}
      config_hash[:nameserver] = nameserver if nameserver
      config_hash[:search] = [search].flatten if search
    end
  end
  config_hash || {}
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™è¡¨æ˜`Resolv::getaddresses`æ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ï¼Œå¹¶ä¸”å½“æä¾›äº†ä¸€ä¸ªåœ¨åå‘ DNS æŸ¥æ‰¾ä¸­å¤±è´¥çš„ IP åœ°å€æ—¶ï¼Œ`getaddresses`è¿”å›ä¸€ä¸ªç©ºçš„`ret`æ•°ç»„ã€‚

## ç¼“è§£

æˆ‘å»ºè®®å®Œå…¨è¿œç¦»`Resolv::getaddresses`ï¼Œä½¿ç”¨`Socket`åº“ã€‚

```
irb(main):002:0> Resolv.getaddresses("127.1")
=> []
irb(main):003:0> Socket.getaddrinfo("127.1", nil).sample[3]
=> "127.0.0.1" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Ruby æ ¸å¿ƒå¼€å‘å›¢é˜Ÿå»ºè®®ä½¿ç”¨ç›¸åŒçš„åº“ã€‚

> æ£€æŸ¥åœ°å€çš„æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„è§£æå™¨ï¼Œè€Œä¸æ˜¯ resolv.rbï¼Œå¦‚æœåœ°å€æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„è§£æå™¨è§£æçš„ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨ socket åº“çš„ Addrinfo.getaddrinfoã€‚
> 
> *   ç”°ä¸­å½°

```
% ruby -rsocket -e '
as = Addrinfo.getaddrinfo("192.168.0.1", nil)
p as
p as.map {|a| a.ipv4_private? }
'
[#<Addrinfo: 192.168.0.1 TCP>, #<Addrinfo: 192.168.0.1 UDP>, #<Addrinfo: 192.168.0.1 SOCK_RAW>]
[true, true, true] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## å—å½±å“çš„åº”ç”¨å’Œå®çŸ³

### GitLab ç¤¾åŒºç‰ˆå’Œä¼ä¸šç‰ˆ

*é“¾æ¥æŠ¥é“:[https://hackerone.com/reports/215105](https://hackerone.com/reports/215105)T3ã€‘*

å¯¹[ç©†æ–¯å¡”æ³•å“ˆæ¡‘](https://hackerone.com/strukt)çš„[æŠ¥å‘Š](https://hackerone.com/reports/135937) ( [)çš„ä¿®å¤ï¼17286](https://gitlab.com/gitlab-org/gitlab-ce/issues/17286) )å¾ˆå®¹æ˜“è¢«æ»¥ç”¨è¿™ä¸ª bug ç»•è¿‡ã€‚GitLab å¼•å…¥äº†ä¸€ä¸ªæ’é™¤åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šä½¿ç”¨`Resolv::getaddresses`è§£æç”¨æˆ·æä¾›çš„åœ°å€ï¼Œç„¶åå°†è¾“å‡ºä¸æ’é™¤åˆ—è¡¨ä¸­çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ„å‘³ç€äººä»¬ä¸èƒ½å†ä½¿ç”¨æŸäº›åœ°å€ï¼Œå¦‚`http://127.0.0.1`å’Œ`http://localhost/`ï¼Œç©†æ–¯å¡”æ³•Â·å“ˆæ¡‘åœ¨æœ€åˆçš„æŠ¥å‘Šä¸­ä½¿ç”¨è¿‡è¿™äº›åœ°å€ã€‚æ—è·¯å…è®¸æˆ‘æ‰«æ GitLab å®ä¾‹çš„å†…éƒ¨ç½‘ç»œã€‚

[![Error message - Open port](img/20777bede76d24559e909072ebbd7938.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--a7kqEogN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/18099289/32322200-fed2e176-bfc3-11e7-8bc1-e2dc241abf6b.png)

[![Error message - Closed port](img/d06800f0135224c7f46529a3e760e072.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ecbEGaN7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/18099289/32322478-ec02630e-bfc4-11e7-9d76-d481d27db8f3.png)

GitLab å·²ç»æä¾›äº†è¡¥ä¸:[https://about . git lab . com/2017/11/08/git lab-10-dot-1-dot-2-security-release/](https://about.gitlab.com/2017/11/08/gitlab-10-dot-1-dot-2-security-release/)ã€‚

### [ç§äºº _ åœ°å€ _ æ”¯ç¥¨](https://github.com/jtdowney/private_address_check)ä½œè€…[çº¦ç¿°Â·å”å°¼](https://twitter.com/jtdowney)

*é“¾æ¥æŠ¥é“:[https://github.com/jtdowney/private_address_check/issues/1](https://github.com/jtdowney/private_address_check/issues/1)T3ã€‘*

[private_address_check](https://github.com/jtdowney/private_address_check) æ˜¯ä¸€ç§çº¢å®çŸ³ï¼Œæœ‰åŠ©äºé¢„é˜² SSRFã€‚å®é™…çš„è¿‡æ»¤å‘ç”Ÿåœ¨`lib/private_address_check.rb`ä¸­ã€‚è¯¥è¿‡ç¨‹é¦–å…ˆå°è¯•ç”¨`Resolv::getaddresses`è§£æç”¨æˆ·æä¾›çš„ URLï¼Œç„¶åå°†è¿”å›å€¼ä¸é»‘åå•ä¸­çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘åˆä¸€æ¬¡èƒ½å¤Ÿä½¿ç”¨ä¸ä¹‹å‰ GitLab ç›¸åŒçš„æŠ€æœ¯æ¥ç»•è¿‡è¿™ä¸ªæ»¤æ³¢å™¨ã€‚

```
# File lib/private_address_check.rb, line 32
def resolves_to_private_address?(hostname)
  ips = Resolv.getaddresses(hostname)
  ips.any? do |ip| 
    private_address?(ip)
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› æ­¤ï¼Œ [HackerOne å—åˆ°äº†è¿™ä¸ªæ—è·¯](https://hackerone.com/reports/287245)çš„å½±å“ï¼Œå› ä¸ºä»–ä»¬ä½¿ç”¨ *private_address_check* å®çŸ³æ¥é˜»æ­¢â€œé›†æˆâ€é¢æ¿ä¸Šçš„ SSRF:`https://hackerone.com/{BBP}/integrations`ã€‚

[![HackerOne - Blocked Address](img/31fa5e65b7a59bde51ce42dc8f95c9ae.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WQg-2k6N--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/18099289/32408319-5f50eb78-c196-11e7-8aee-c6ffd572597f.png)

[![HackerOne - Bypass](img/71090669d9e6bf8991fdd516c5f82e82.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ayuwo9UW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/18099289/32408337-7bcdd874-c196-11e7-9fcc-1de5283bd7b0.png)

ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘æ— æ³•åˆ©ç”¨è¿™ä¸ª SSRFï¼Œå› æ­¤ï¼Œè¿™ä¸ªé—®é¢˜åªåŒ…æ‹¬ä¸€ä¸ªè¿‡æ»¤å™¨æ—è·¯ã€‚HackerOne ä»ç„¶é¼“åŠ±æˆ‘æŠ¥å‘Šå®ƒï¼Œå› ä¸ºä»–ä»¬ä¼šè€ƒè™‘ä»»ä½•æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œè€Œè¿™ç§ç»•è¿‡è¯æ˜äº†æ½œåœ¨çš„é£é™©ã€‚

æ­¤é—®é¢˜å·²åœ¨[0 . 4 . 0 ç‰ˆ](https://github.com/jtdowney/private_address_check/commit/58a0d7fe31de339c0117160567a5b33ad82b46af)ä¸­å¾—åˆ°ä¿®è¡¥ã€‚

## æœªå—å½±å“çš„åº”ç”¨å’Œå®çŸ³

### [ssrf _ filter](https://github.com/arkadiyt/ssrf_filter)by[arka DIY Tetelman](https://twitter.com/arkadiyt)

è¿™ä¸ª gem ä¸å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå› ä¸ºå®ƒæ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸ºç©ºã€‚

```
# File lib/ssrf_filter/ssrf_filter.rb, line 116
raise UnresolvedHostname, "Could not resolve hostname '#{hostname}'" if ip_addresses.empty?

irb(main):001:0> require 'ssrf_filter'
=> true
irb(main):002:0> SsrfFilter.get("http://127.1/")
SsrfFilter::UnresolvedHostname: Could not resolve hostname '127.1'
  from /var/lib/gems/2.3.0/gems/ssrf_filter-1.0.2/lib/ssrf_filter/ssrf_filter.rb:116:in `block (3 levels) in <class:SsrfFilter>'
  from /var/lib/gems/2.3.0/gems/ssrf_filter-1.0.2/lib/ssrf_filter/ssrf_filter.rb:107:in `times'
  from /var/lib/gems/2.3.0/gems/ssrf_filter-1.0.2/lib/ssrf_filter/ssrf_filter.rb:107:in `block (2 levels) in <class:SsrfFilter>'
  from (irb):2
  from /usr/bin/irb:11:in `<main>' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [æ³•æ‹‰ç¬¬é™åˆ¶ ip åœ°å€](https://rubygems.org/gems/faraday-restrict-ip-addresses/versions/0.1.1)ä½œè€…[æœ¬Â·æ‹‰æ–‡å¾·](https://github.com/bhuga)

è¿™ä¸ª gem ä½¿ç”¨äº† Ruby ä»£ç å¼€å‘å›¢é˜Ÿæ¨èçš„`Addrinfo.getaddrinfo`ã€‚

```
# File lib/faraday/restrict_ip_addresses.rb, line 61
def addresses(hostname)
      Addrinfo.getaddrinfo(hostname, nil, :UNSPEC, :STREAM).map { |a| IPAddr.new(a.ip_address) }
    rescue SocketError => e
      # In case of invalid hostname, return an empty list of addresses
      []
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç»“è®º

ä½œè€…è¦æ„Ÿè°¢åœ¨å‘ç°æ¼æ´æœŸé—´[æ±¤å§†Â·å“ˆå¾·æ£®](https://twitter.com/TomNomNom)å’Œ[äºšè¾›Â·ç´¢åˆ©æ›¼](https://twitter.com/SecurityYasin)æä¾›çš„å¸®åŠ©ã€‚

çº¦ç¿°Â·å”å°¼å’Œ T2Â·é˜¿å¡è¿ªÂ·æ³°ç‰¹å°”æ›¼ååº”éƒ½éå¸¸è¿…é€Ÿã€‚çº¦ç¿°å”å°¼èƒ½å¤Ÿç«‹å³æä¾›ä¸€ä¸ªè¡¥ä¸ï¼Œå’Œ Arkadiy Tetelman å¸®åŠ©æˆ‘æ‰¾å‡ºä¸ºä»€ä¹ˆä»–ä»¬çš„å®çŸ³æ²¡æœ‰å—åˆ°å½±å“çš„é—®é¢˜ã€‚

* * *

æ›´æ–°(2017 å¹´ 11 æœˆ 10 æ—¥ï¼Œæ˜ŸæœŸäº”):æˆ‘æ‰©å±•äº†â€œæ ¹æœ¬åŸå› â€éƒ¨åˆ†ï¼Œä»¥ä¾¿æ›´å¥½åœ°è§£é‡Šå®é™…é—®é¢˜ã€‚