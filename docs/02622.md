# åœ¨ Raspberry Pi Zero W ä¸Šå¼€å§‹ä½¿ç”¨ Homebridge

> åŸæ–‡:[https://dev . to/Brandon 927/getting-started-with-home bridge-on-a-raspberry-pi-zero-w-242h](https://dev.to/brandonb927/getting-started-with-homebridge-on-a-raspberry-pi-zero-w-242h)

è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘æŒ‡å¯¼ä½ åœ¨ macOS ä¸Šè®¾ç½®ä¸€ä¸ªæ— å¤´çš„ Raspberry Pi Zero W çš„ç¬¬ä¸€ç¯‡æ–‡ç« çš„å»¶ç»­ã€‚åœ¨æˆ‘å†™å®Œé‚£ç¯‡æ–‡ç« ä¹‹åï¼Œæˆ‘çš„ rPi å¹¶æ²¡æœ‰å‘ç”Ÿå¤ªå¤šçš„äº‹æƒ…ï¼Œåœ¨æˆ‘è€ƒè™‘å°†å®ƒæŠ•å…¥ä½¿ç”¨çš„æ—¶å€™ï¼Œå®ƒè¢«æç½®äº†å‡ ä¸ªæœˆã€‚ç„¶è€Œï¼Œåœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘å¯¹å®¶åº­è‡ªåŠ¨åŒ–è¶Šæ¥è¶Šæ„Ÿå…´è¶£ï¼Œå°¤å…¶æ˜¯å¯¹ [HomeKit](https://www.macrumors.com/guide/homekit-101-getting-started-beginners/) æ„Ÿå…´è¶£ã€‚æˆ‘å¼€å§‹æƒ³ï¼Œâ€œæˆ‘åº”è¯¥èƒ½å¤Ÿåœ¨æˆ‘çš„ iPhone 7 Plus ä¸Šä½¿ç”¨è¿è¡Œ iOS 11 çš„å®¶åº­åº”ç”¨ç¨‹åºæ¥æ§åˆ¶æˆ‘å®¶é‡Œæ‰€æœ‰çš„è¿æ¥è®¾å¤‡ï¼Œè€Œä¸æ˜¯è¿™äº›å…¶ä»–åŠ£è´¨åº”ç”¨ç¨‹åºï¼â€ã€‚

åœ¨ä¸ºå®¶åº­è‡ªåŠ¨åŒ–åšç ”ç©¶çš„æ—¶å€™ï¼Œæˆ‘å¶ç„¶å‘ç°äº† homebridgeï¼Œå®ƒè®©æˆ‘æ˜ç™½äº†ä½¿ç”¨ rPi å°±æ˜¯ä¸ºäº†å®ƒã€‚åœ¨å®‰è£…å’Œè®¾ç½®äº†å‡ æ¬¡(åœ¨å®‰è£…å’Œé‡è¯•ä¹‹é—´æ“¦é™¤ SD å¡)ä¹‹åï¼Œæˆ‘å¼€å§‹æ„è¯†åˆ°è®¾ç½®æ˜¯å¤šä¹ˆä»¤äººæƒŠè®¶çš„ç®€å•ï¼åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•è®©ä½ è‡ªå·±çš„ rPi è¿è¡Œ homebridgeï¼Œç”šè‡³æ¨èä¸€äº›æ’ä»¶æ¥ä½¿å®ƒæœ‰ç”¨ã€‚

é¦–å…ˆï¼Œæˆ‘å¼€å§‹æ¸…ç‚¹æˆ‘å®¶é‡Œæ‰€æœ‰å¯ä»¥æ·»åŠ åˆ° homebridge ä»¥ä¸ HomeKit ä¸€èµ·ä½¿ç”¨çš„ä¸œè¥¿ã€‚æˆ‘æœ€åˆè®¡åˆ’åªä»¥æŸç§æ–¹å¼é›†æˆæˆ‘çš„ 2016 ä¸‰æ˜Ÿæ™ºèƒ½ç”µè§†å’Œ Playstation 4ï¼Œä½†ä¸€æ—¦æˆ‘å®‰è£…å¹¶è¿è¡Œäº†æ‰€æœ‰ä¸œè¥¿ï¼Œæˆ‘å°±è´­ä¹°äº†å‡ ä¸ª TP-Link HS100 æ™ºèƒ½ wifi æ’å¤´ã€‚wifi æ’å¤´åœ¨æˆ‘å½“åœ°çš„ BestBuy ä»¥ 20 ç¾å…ƒ/ä¸ªçš„ä»·æ ¼å‡ºå”®ï¼Œæ¯”æ­£å¸¸ä»·æ ¼ä½ 50%ğŸ˜±æˆ‘ä¸èƒ½è¯´ä¸ï¼Œè€Œä¸”æˆ‘å·²ç»æ³¨æ„åˆ°å®ƒä»¬äº†ï¼Œå› ä¸ºå¯¹ homebridge æ’ä»¶çš„ç ”ç©¶è¡¨æ˜å®ƒä»¬å¯¹ç³»ç»Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œå°½ç®¡ HomeKit æ ¹æœ¬ä¸æ”¯æŒå®ƒä»¬ã€‚

### [](#install-node-and-homebridge)å®‰è£…èŠ‚ç‚¹å’Œ homebridge

ä»è¿™é‡Œå¼€å§‹ç”¨ npm [å®‰è£… node(ä¸è¦ä»`apt-get`å¼€å§‹å®‰è£…ï¼Œå› ä¸º PPA çš„åŒ…å·²ç»éå¸¸è¿‡æ—¶äº†)ã€‚npm çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆæ˜¯ä½¿ç”¨](https://github.com/sdesalas/node-pi-zero#v890)[çº±çº¿](https://yarnpkg.com/en/)ï¼Œä½†æ˜¯æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™æ¡è·¯çº¿è¿˜æ²¡æœ‰ç»è¿‡æµ‹è¯•ã€‚

ä¸€æ—¦å®‰è£…äº†èŠ‚ç‚¹ï¼Œç»§ç»­å®‰è£… [homebridge](https://github.com/nfarina/homebridge) ã€‚å®‰è£…å®ƒå°±åƒå®‰è£…ä¸€ä¸ªå…¨å±€ npm åŒ…ä¸€æ ·ç®€å•ï¼

```
npm install -g homebridge 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#running-homebridge)è¿è¡Œä½å®…æ¡¥

å®‰è£…åï¼Œæ‚¨åªéœ€è°ƒç”¨å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±å¯ä»¥å°è¯•ä» cli è¿è¡Œ homebridgeã€‚å®ƒä¼šåœ¨`/home/<user>/.homebridge`ä¸­å¯»æ‰¾é…ç½®ï¼Œæ‰€ä»¥å¯ä»¥éšæ„æ·»åŠ ä¸€ä¸ªåŸºæœ¬çš„é…ç½®æ–‡ä»¶è¿›è¡Œæµ‹è¯•ã€‚

ç„¶è€Œï¼Œä½¿ç”¨ homebridge çš„ç†æƒ³æ–¹å¼æ˜¯ä½¿ç”¨ systemd åœ¨åå°å°†å®ƒä½œä¸ºæœåŠ¡è¿è¡Œã€‚è¿™å…è®¸ homebridge åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œå¹¶ä¸”ä¸éœ€è¦åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šæ‰“å¼€å¤–å£³ã€‚æˆ‘åœ¨è¿™ä¸ªè®¾ç½®ä¸­å‘ç°äº†ä¸€ä¸ªè­¦å‘Šï¼Œè™½ç„¶å¾ˆå®¹æ˜“è§£å†³ï¼Œä½†æ˜¯ homebridge å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å¯¹äºè®¾ç½®å®ƒæ—¶å¿…é¡»åˆ›å»ºçš„æ‰€éœ€çš„`homebridge`ç³»ç»Ÿç”¨æˆ·æ¥è¯´æ˜¯æœªçŸ¥çš„ã€‚å®ƒæ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è®°å½•ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å‘ç”¨æˆ·æ·»åŠ èŠ‚ç‚¹`bin`è·¯å¾„æ¥ä¿®å¤ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨`/etc/profile.d`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¹¶ä½¿å…¶å¯æ‰§è¡Œ
æ¥åšåˆ°è¿™ä¸€ç‚¹

```
sudo touch /etc/profile.d/node.sh
sudo chmod +x /etc/profile.d/node.sh 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¶ä¸­çš„å†…å®¹æ˜¯

```
export PATH=$PATH:/opt/nodejs/bin 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯å°†`/opt/nodejs/bin`æ·»åŠ åˆ°æ¯ä¸ªç”¨æˆ·é…ç½®æ–‡ä»¶çš„`PATH`ç¯å¢ƒå˜é‡ä¸­ã€‚è¿™æ„å‘³ç€ç³»ç»Ÿç”¨æˆ·`homebridge`ç°åœ¨å¯ä»¥æ­£å¸¸è¿è¡Œ homebridge exectuableï¼Œè€Œä¸éœ€è¦å®Œæ•´çš„è·¯å¾„ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨è°ƒç”¨æ—¶æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚

### [T1ã€‘é…ç½® homebridge](#configuring-homebridge)

æ­¤æ—¶ï¼Œé‡æ–°å¯åŠ¨ piï¼Œè®©ç³»ç»Ÿç”¨æˆ·é€‰æ‹© homebridge å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å¹¶å¯åŠ¨å®ƒã€‚å¯¹äº homebridgeï¼Œæ‚¨æ²¡æœ‰ä»»ä½•é…ç½®è®¾ç½®å¯ä»¥ä½¿ç”¨(é™¤éæ‚¨è·³åˆ°è¿™é‡ŒğŸ˜‰)è€Œä¸”å®ƒä¼šæŠ±æ€¨è¿™ä¸ªã€‚æ‚¨å¯ä»¥ä½¿ç”¨
æŸ¥çœ‹ homebridge æœåŠ¡çš„å®æ—¶æ—¥å¿—æµ

```
sudo journalctl -u homebridge -f 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åˆ›å»ºæ–‡ä»¶`/var/lib/homebridge/config.json`,å¹¶ç”¨ä¸‹é¢çš„å¯åŠ¨å™¨é…ç½®
å¡«å……å®ƒ

```
{
  "bridge": {
    "name": "Homebridge",
    "username": "1A:2B:3C:4D:5E:6F",
    "port": 45525,
    "pin": "937-19-468"
  },
  "description": "SmartHome with Homebridge",
  "accessories": [...],
  "platforms": [...]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#notes)å¤‡æ³¨

*   ä½¿ç”¨[è¿™ä¸ªå·¥å…·](https://www.miniwebtool.com/mac-address-generator/)åœ¨é…ç½®ä¸­ç”Ÿæˆä¸€ä¸ªéšæœºçš„`username`å€¼
*   ä¸€æ—¦ä½ ç¡®è®¤ homebridge å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œå°±ç”¨ä½ æƒ³è¦çš„æ’ä»¶æ›¿æ¢`...`

åœ¨ä½ å®Œæˆæ‰€æœ‰çš„ä¿®æ”¹åï¼Œç¡®ä¿`homebridge`ç”¨æˆ·æ‹¥æœ‰`/var/lib/homebridge`æ–‡ä»¶å¤¹å’Œ
çš„æ‰€æœ‰æƒ

```
sudo chown -R homebridge /var/lib/homebridge 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„**è¿™ä¸€æ­¥æ˜¯*éå¸¸å…³é”®çš„*å› ä¸ºå¦‚æœ homebridge å¯æ‰§è¡Œæ–‡ä»¶ä¸èƒ½å°†å®ƒçš„å„ç§ç¼“å­˜å†™å…¥æ–‡ä»¶å¤¹ï¼Œäº‹æƒ…å¯èƒ½ä¼šåœ¨ä½ èº«ä¸Šå‘ç”Ÿï¼

### [](#extending-homebridge)å»¶ä¼¸ä½å®…æ¡¥

ä½ ä¼šå‘ç° Homebridge æœ¬èº«å¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œå®ƒçœŸæ­£çš„äº®ç‚¹æ˜¯å…¶ç¤¾åŒºæ”¯æŒçš„æ’ä»¶ç³»ç»Ÿã€‚åªè¦åœ¨ npmjs.com ä¸Šæœç´¢`homebridge-plugin`ï¼Œå°±ä¼šæœ‰å‡ ç™¾ä¸ªæ’ä»¶å¯ä¾›é€‰æ‹©ã€‚æŒ‰å—æ¬¢è¿ç¨‹åº¦æ’åºï¼Œå‰å‡ é¡µå…¨æ˜¯å¥½æ’ä»¶ã€‚

ä»¥ä¸‹æ˜¯æˆ‘æ­£åœ¨ä½¿ç”¨/æ¨èçš„ä¸€ç³»åˆ—äº§å“:

*   [https://www.npmjs.com/package/homebridge-cmdswitch2](https://www.npmjs.com/package/homebridge-cmdswitch2)
    *   ğŸ‘†ç»“åˆ[https://github.com/dhleong/ps4-waker](https://github.com/dhleong/ps4-waker)
*   [https://www.npmjs.com/package/homebridge-samsungsmarttv](https://www.npmjs.com/package/homebridge-samsungsmarttv)
    *   [æˆ‘æ­£åœ¨è¿›è¡Œçš„åˆ†å‰](https://github.com/brandonb927/homebridge-plugin-samsungsmarttv)(ç­‰å¾… iOS 11 åœ¨ Home åº”ç”¨ä¸­æ­£ç¡®æ”¯æŒ`Speaker`æœåŠ¡ï¼Œå®ƒä»¬æ˜¯ HomeKit è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯åœ¨æ’°å†™æœ¬æ–‡æ—¶å°šæœªå®ç°)
*   [https://www.npmjs.com/package/homebridge-tplink-smarthome](https://www.npmjs.com/package/homebridge-tplink-smarthome)(æ”¯æŒå¼€å…³ã€ç¯æ³¡å’Œæ’å¤´)

### [](#using-homebridge-with-the-ios-11-home-app)é…åˆ iOS 11 Home app ä½¿ç”¨ homebridge

ä½ å¯èƒ½ä¸€ç›´åœ¨ç­‰å¾…çš„æ—¶åˆ»:åœ¨ iOS Home ä¸­è®¾ç½® Homebridge å’Œâ€œé™„ä»¶â€(è¿æ¥çš„è®¾å¤‡)éå¸¸ç®€å•ã€‚åº”ç”¨å†…æ–‡æ¡£éå¸¸å®¹æ˜“ç†è§£ï¼Œå¦‚æœæ‚¨ä»ç»ˆç«¯(è€Œä¸æ˜¯åŸºäºæœåŠ¡çš„ç³»ç»Ÿç”¨æˆ·)è¿è¡Œ homebridge cli å·¥å…·ï¼Œæ‚¨åªéœ€æ‰«æä½¿ç”¨ Home åº”ç”¨è¿è¡Œ`homebridge`æ—¶ç”Ÿæˆçš„äºŒç»´ç ã€‚å¦ä¸€ç§ä¸»è®¾ç½®æ–¹æ³•æ˜¯ï¼Œæ‚¨å¿…é¡»è¾“å…¥æ‚¨åœ¨`config.json`æ–‡ä»¶ä¸­é…ç½®çš„`pin`ã€‚

ä¸‹é¢æ˜¯æœ€ç»ˆäº§å“çš„è§†é¢‘ï¼Œä»¥åŠå®ƒä¸ iOS 11 Home åº”ç”¨ç¨‹åºçš„é…åˆæƒ…å†µã€‚è¯¥è§†é¢‘é¦–å…ˆå±•ç¤ºäº†åº”ç”¨ç¨‹åºä¸­ä¸åŒè®¾å¤‡çš„è§¦å‘æ–¹å¼(ä»¥åŠä¸€äº›è®¾å¤‡å¿…é¡»å¦‚ä½•è¿›è¡Œäº¤äº’ï¼Œç‰¹åˆ«æ˜¯æˆ‘çš„æ™ºèƒ½ç”µè§†å’Œ PS4ï¼Œè¿™æœ‰ä¸€äº›å»¶è¿Ÿï¼Œæˆ‘ç¨åä¼šè¯¦ç»†ä»‹ç»)ï¼Œç„¶åå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Siri é€šè¿‡å®¶åº­åœºæ™¯ä¸è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚

<video width="100%" height="320" controls=""><source src="https://dc1r9kxqg42ml.cloudfront.net/brandonb.ca/posts/getting-started-with-homebridge-on-a-raspberry-pi-zero-w-with-homekit/homebridge-ios-home-demo.mp4" type="video/mp4">

å—¯ï¼Œä½ çš„æµè§ˆå™¨å¥½åƒä¸æ”¯æŒ HTML5 è§†é¢‘ã€‚</video>