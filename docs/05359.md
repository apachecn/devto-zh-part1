# ç”¨ Jest ç¼–å†™ç¬¬ä¸€ä¸ª Vue.js ç»„ä»¶å•å…ƒæµ‹è¯•

> åŸæ–‡:[https://dev . to/alexjoverm/write-the-first-vuejs-component-unit-test-in-jest-35f](https://dev.to/alexjoverm/write-the-first-vuejs-component-unit-test-in-jest-35f)

*ç­‰ç­‰ï¼Œä¸€æœ¬ç”¨ Jest æµ‹è¯• Vue çš„ **[ä¹¦ï¼Ÿ](https://leanpub.com/testingvuejscomponentswithjest)** æ˜¯å•Šï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯ç¬¬ä¸€ç« *ğŸ˜‰

åŸºäº [avoriaz](https://github.com/eddyerburgh/avoriaz) çš„å®˜æ–¹ VueJS æµ‹è¯•åº“ vue-test-utils å³å°†é¢ä¸–ã€‚ [@EddYerburgh](https://twitter.com/EddYerburgh) ç¡®å®åœ¨åˆ›é€ å®ƒæ–¹é¢åšå¾—éå¸¸å¥½ã€‚å®ƒä¸ºåœ¨ VueJS åº”ç”¨ç¨‹åºä¸­ç¼–å†™å•å…ƒæµ‹è¯•æä¾›äº†æ‰€æœ‰å¿…è¦çš„å·¥å…·ã€‚

å¦ä¸€æ–¹é¢ï¼Œè„¸ä¹¦å¼€å‘çš„æµ‹è¯•æ¡†æ¶ä½¿æµ‹è¯•å˜å¾—è½»è€Œæ˜“ä¸¾ï¼Œå®ƒå…·æœ‰ä»¤äººæ•¬ç•çš„ç‰¹æ€§ï¼Œä¾‹å¦‚:

*   é»˜è®¤æƒ…å†µä¸‹å‡ ä¹æ²¡æœ‰é…ç½®
*   éå¸¸é…·çš„äº’åŠ¨æ¨¡å¼
*   å¹¶è¡Œè¿è¡Œæµ‹è¯•
*   å¼€ç®±å³ç”¨çš„é—´è°è½¯ä»¶ã€å­˜æ ¹è½¯ä»¶å’Œæ¨¡æ‹Ÿè½¯ä»¶
*   å†…ç½®ä»£ç è¦†ç›–ç‡
*   å¿«ç…§æµ‹è¯•
*   æ¨¡å—æ¨¡æ‹Ÿå®ç”¨ç¨‹åº

ä¹Ÿè®¸ä½ å·²ç»ä¸ç”¨è¿™ä¸ªå·¥å…·ï¼Œåªç”¨ karma + mocha + chai + sinon +å°±å¯ä»¥ç¼–å†™æµ‹è¯•äº†ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°è¿™æœ‰å¤šç®€å•ğŸ˜‰ã€‚

## å»ºç«‹ä¸€ä¸ª vue-æµ‹è¯•æ ·æœ¬é¡¹ç›®

è®©æˆ‘ä»¬ä»ä½¿ç”¨ [`vue-cli`](https://github.com/vuejs/vue-cli) åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®å¼€å§‹ï¼Œå¯¹æ‰€æœ‰æ˜¯/å¦é—®é¢˜å›ç­”â€œå¦â€:

```
npm install -g vue-cli
vue init webpack vue-test
cd vue-test 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–é¡¹:

```
# Install dependencies 
npm i -D jest jest-vue-preprocessor babel-jest 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åˆ¶ä½œ jest ç†è§£`.vue`æ–‡ä»¶éœ€è¦ [`jest-vue-preprocessor`](https://github.com/vire/jest-vue-preprocessor) ï¼Œä¸ Babel æ•´åˆéœ€è¦ [`babel-jest`](https://github.com/babel/babel-jest) ã€‚

æ ¹æ®`vue-test-utils`ï¼Œå®ƒ~~è¿˜æ²¡æœ‰å‘å¸ƒï¼Œä½†æ˜¯ç°åœ¨ä½ å¯ä»¥ä»æº~~å°†å®ƒæ·»åŠ åˆ°ä½ çš„`package.json`:

**æ›´æ–°(2017/10/10)** :å·²ç»å¯ä»¥ä» npm å®‰è£…ï¼Œå› ä¸º`beta.1`å·²ç»å‘å¸ƒã€‚

```
npm i -D vue-test-utils 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬åœ¨`package.json` :
ä¸­æ·»åŠ ä»¥ä¸‹ Jest é…ç½®

```
...  "jest":  {  "moduleNameMapper":  {  "^vue$":  "vue/dist/vue.common.js"  },  "moduleFileExtensions":  [  "js",  "vue"  ],  "transform":  {  "^.+\\.js$":  "<rootDir>/node_modules/babel-jest",  ".*\\.(vue)$":  "<rootDir>/node_modules/jest-vue-preprocessor"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æµ‹è¯•ä¸€ä¸ªç»„ä»¶

æˆ‘å°†åœ¨è¿™é‡Œä½¿ç”¨å•ä¸ªæ–‡ä»¶ç»„ä»¶ï¼Œæˆ‘è¿˜æ²¡æœ‰æ£€æŸ¥å®ƒæ˜¯å¦å¯ä»¥é€šè¿‡å°†å®ƒä»¬åˆ†å‰²æˆå„è‡ªçš„`html`ã€`css`æˆ–`js`æ–‡ä»¶æ¥å·¥ä½œï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å‡è®¾ä½ ä¹Ÿåœ¨è¿™æ ·åšã€‚

é¦–å…ˆåœ¨`src/components` :
ä¸‹åˆ›å»ºä¸€ä¸ª`MessageList.vue`ç»„ä»¶

```
<template>
    <ul>
        <li v-for="message in messages"> {{ message }} </li>
    </ul>
</template>

<script>
    export default { 
        name: 'list', 
        props: ['messages']
    }
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶æ›´æ–°`App.vue`æ¥ä½¿ç”¨å®ƒï¼Œå¦‚ä¸‹:

```
<template>
    <div id="app">
        <MessageList messages="messages" />
    </div>
</template>

<script>
import MessageList from './components/MessageList'
export default {
    name: 'app', 
    data: () => ({
        messages: ['Hey John', 'Howdy Paco'] 
    }), 
    components: { MessageList }
}
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å·²ç»æœ‰äº†å‡ ä¸ªå¯ä»¥æµ‹è¯•çš„ç»„ä»¶ã€‚è®©æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`test`æ–‡ä»¶å¤¹ï¼Œå’Œä¸€ä¸ª`App.test.js` :

```
import Vue from 'vue'
import App from '../src/App'

describe('App.test.js', () => {
  let cmp, vm

  beforeEach(() => {
    cmp = Vue.extend(App) // Create a copy of the original component
    vm = new cmp({
      data: { // Replace data value with this fake data
        messages: ['Cat']
      }
    }).$mount() // Instances and mounts the component
  })

  it('equals messages to ["Cat"]', () => {
    expect(vm.messages).toEqual(['Cat'])
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ`npm test`(æˆ–`npm t`çš„ç®€å†™ç‰ˆæœ¬)ï¼Œæµ‹è¯•åº”è¯¥è¿è¡Œå¹¶é€šè¿‡ã€‚æ—¢ç„¶æˆ‘ä»¬æ­£åœ¨ä¿®æ”¹æµ‹è¯•ï¼Œæˆ‘ä»¬æœ€å¥½åœ¨**è§‚å¯Ÿæ¨¡å¼** :
ä¸‹è¿è¡Œå®ƒ

```
npm t -- --watch 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### åµŒå¥—ç»„ä»¶çš„é—®é¢˜

è¿™ä¸ªæµ‹è¯•å¤ªç®€å•äº†ã€‚è®©æˆ‘ä»¬æ£€æŸ¥è¾“å‡ºæ˜¯å¦ä¹Ÿæ˜¯é¢„æœŸçš„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Jest æƒŠäººçš„å¿«ç…§ç‰¹æ€§ï¼Œå®ƒå°†ç”Ÿæˆè¾“å‡ºçš„å¿«ç…§ï¼Œå¹¶åœ¨æ¥ä¸‹æ¥çš„è¿è¡Œä¸­è¿›è¡Œæ£€æŸ¥ã€‚åœ¨`App.test.js`ä¸­å‰é¢çš„`it`åå¢åŠ :

```
it('has the expected html structure', () => {
  expect(vm.$el).toMatchSnapshot()
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åˆ›å»ºä¸€ä¸ª`test/ __snapshots__ /App.test.js.snap`æ–‡ä»¶ã€‚è®©æˆ‘ä»¬æ‰“å¼€æ¥æ£€æŸ¥ä¸€ä¸‹:

```
// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`App.test.js has the expected html structure 1`] = `
<div
  id="app"
>
  <ul>
    <li>
      Cat
    </li>
  </ul>
</div>
`; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¤§é—®é¢˜:`MessageList`ç»„ä»¶ä¹Ÿè¢«æ¸²æŸ“äº†ã€‚**å•å…ƒæµ‹è¯•å¿…é¡»ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒ**è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ„å‘³ç€åœ¨`App.test.js`ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦æµ‹è¯•`App`ç»„ä»¶ï¼Œè€Œæ ¹æœ¬ä¸å…³å¿ƒå…¶ä»–ä»»ä½•äº‹æƒ…ã€‚

è¿™å¯èƒ½æ˜¯å‡ ä¸ªé—®é¢˜çš„åŸå› ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¾‹å¦‚ï¼Œå­ç»„ä»¶(æœ¬ä¾‹ä¸­ä¸º`MessageList`)åœ¨`created`é’©å­ä¸Šæ‰§è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œæ¯”å¦‚è°ƒç”¨`fetch`,ä¸€ä¸ª Vuex åŠ¨ä½œæˆ–è€…çŠ¶æ€æ”¹å˜ï¼Ÿè¿™ç»å¯¹ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

å¹¸è¿çš„æ˜¯ï¼Œ**æµ…æ¸²æŸ“**å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

### ä»€ä¹ˆæ˜¯æµ…å±‚æ¸²æŸ“ï¼Ÿ

[æµ…å±‚æ¸²æŸ“](http://airbnb.io/enzyme/docs/api/shallow.html)æ˜¯ä¸€ç§ç¡®ä¿ä½ çš„ç»„ä»¶åœ¨æ²¡æœ‰å­ç»„ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œæ¸²æŸ“çš„æŠ€æœ¯ã€‚è¿™æœ‰åŠ©äº:

*   åªæµ‹è¯•ä½ æƒ³æµ‹è¯•çš„ç»„ä»¶(è¿™å°±æ˜¯å•å…ƒæµ‹è¯•çš„å«ä¹‰)
*   é¿å…å­ç»„ä»¶å¯èƒ½äº§ç”Ÿçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚è¿›è¡Œ HTTP è°ƒç”¨ã€è°ƒç”¨å­˜å‚¨æ“ä½œâ€¦

## ç”¨ vue-test-utils æµ‹è¯•ä¸€ä¸ªç»„ä»¶

ä¸ºæˆ‘ä»¬æä¾›æµ…å±‚æ¸²æŸ“å’Œå…¶ä»–åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¹‹å‰çš„æµ‹è¯•é‡å†™å¦‚ä¸‹:

```
import { shallow } from 'vue-test-utils'
import App from '../src/App'

describe('App.test.js', () => {
  let cmp

  beforeEach(() => {
    cmp = shallow(App, { // Create a shallow instance of the component
      data: {
        messages: ['Cat']
      }
    })
  })

  it('equals messages to ["Cat"]', () => {
    // Within cmp.vm, we can access all Vue instance methods
    expect(cmp.vm.messages).toEqual(['Cat'])
  })

  it('has the expected html structure', () => {
    expect(cmp.element).toMatchSnapshot()
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœæ‚¨ä»ç„¶åœ¨è§‚å¯Ÿæ¨¡å¼ä¸‹è¿è¡Œ Jestï¼Œæ‚¨å°†çœ‹åˆ°æµ‹è¯•ä»ç„¶é€šè¿‡ï¼Œä½†æ˜¯å¿«ç…§ä¸åŒ¹é…ã€‚æŒ‰`u`é‡æ–°ç”Ÿæˆã€‚å†æ¬¡æ‰“å¼€æ£€æŸ¥:

```
// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`App.test.js has the expected html structure 1`] = `
<div
  id="app"
>
  <!--  -->
</div>
`; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ çœ‹åˆ°äº†å—ï¼Ÿç°åœ¨æ²¡æœ‰å­©å­è¢«æ¸²æŸ“ï¼Œæˆ‘ä»¬æµ‹è¯•äº†ä»ç»„ä»¶æ ‘ä¸­å®Œå…¨éš”ç¦»çš„`App`ç»„ä»¶**ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ åœ¨å­ç»„ä»¶ä¸­æœ‰ä»»ä½•`created`æˆ–ä»»ä½•æŒ‚é’©ï¼Œå®ƒä»¬ä¹Ÿæ²¡æœ‰è¢«è°ƒç”¨ğŸ˜‰ã€‚**

 **å¦‚æœä½ å¯¹**å¦‚ä½•å®ç°æµ…å±‚æ¸²æŸ“**æ„Ÿåˆ°å¥½å¥‡ï¼ŒæŸ¥çœ‹ä¸€ä¸‹[çš„æºä»£ç ](https://github.com/vuejs/vue-test-utils/blob/master/src/lib/stub-components.js)ï¼Œä½ ä¼šå‘ç°å®ƒåŸºæœ¬ä¸Šæ˜¯æŒ‰ä¸‹äº†`components`é”®ã€`render`æ–¹æ³•å’Œç”Ÿå‘½å‘¨æœŸæŒ‚é’©ã€‚

åŒæ ·ï¼Œæ‚¨å¯ä»¥å¦‚ä¸‹å®ç°`MessageList.test.js`æµ‹è¯•:

```
import { shallow } from 'vue-test-utils'
import MessageList from '../src/components/MessageList'

describe('MessageList.test.js', () => {
  let cmp

  beforeEach(() => {
    cmp = shallow(MessageList, {
      // Beaware that props is overriden using `propsData`
      propsData: {
        messages: ['Cat']
      }
    })
  })

  it('has received ["Cat"] as the message property', () => {
    expect(cmp.vm.messages).toEqual(['Cat'])
  })

  it('has the expected html structure', () => {
    expect(cmp.element).toMatchSnapshot()
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ Github ä¸Šæ‰¾åˆ°[çš„å®Œæ•´ç¤ºä¾‹ã€‚](https://github.com/alexjoverm/vue-testing-series/tree/lesson-1)

*æœ€åˆå‘å¸ƒäº[alexjoverm . github . io](http://alexjoverm.github.io/2017/08/21/Write-the-first-Vue-js-Component-Unit-Test-in-Jest/)2017 å¹´ 8 æœˆ 21 æ—¥***