# å¦‚ä½•åœ¨æ²¡æœ‰ jQuery çš„æƒ…å†µä¸‹å°† SweetAlert2 ç”¨äº Rails +5.1 (rails-ujs)ç¡®è®¤

> åŸæ–‡:[https://dev . to/Peter fication/how-to-use-sweet alert 2-for-your-rails-51-rails-ujs-confirms-without query-67h](https://dev.to/peterfication/how-to-use-sweetalert2-for-your-rails-51-rails-ujs-confirms-withoutjquery-67h)

[![Screenshot SweetAlert2](../Images/0b91e2fc155d3714dbc4bb6b9f91e29a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--G6OlQUQ2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/816weq5ka6lzy04vn34j.png)

*TLï¼›è§[åšå£«è¿™ä¸ªæ¼”ç¤ºé¡¹ç›®](https://github.com/store2be/rails-sweetalert)çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚*

è¯·æ³¨æ„ï¼Œæ­¤å¤„çš„ç¤ºä¾‹æä¾›äº† ES6 è¯­æ³•ã€‚[è®© ES6 åœ¨ Rails ä¸­å·¥ä½œæœ‰ä¸åŒçš„æ–¹æ³•](https://stackoverflow.com/a/42464363)ã€‚æ¼”ç¤ºé¡¹ç›®æœ‰ä¸€ä¸ª [ES5 åˆ†æ”¯](https://github.com/store2be/rails-sweetalert/tree/master-es5)ä½œä¸ºå‚è€ƒã€‚

* * *

å¦‚æœä½ æ­£åœ¨è¯»è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘æƒ³ä½ åº”è¯¥ç†Ÿæ‚‰ Ruby on Rails å’Œ T2 çš„ SweetAlert2ã€‚å¯¹äºç‰ˆæœ¬ 5.1 ä¹‹å‰çš„ Railsï¼Œ[å½“ rails-ujs è¿˜æ˜¯ jquery-ujs](https://blog.bigbinary.com/2017/06/20/rails-5-1-has-dropped-dependency-on-jquery-from-the-default-stack.html) æ—¶ï¼Œæœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•[å°† SweetAlert(æˆ– SweetAlert2)](http://alexzerbach.com/use-sweet-alert-rails/) ä¸[Rails ç¡®è®¤åŠŸèƒ½](https://stackoverflow.com/questions/16668949/how-to-add-confirm-message-with-link-to-ruby-on-rails)æŒ‚é’©ã€‚

å®ç°å®ƒçš„ä¸€ä¸ªæ–¹æ³•æ˜¯é‡å†™ Rails çš„ç¡®è®¤å¤„ç†ç¨‹åº:

```
// Override the default confirm dialog of Rails
$.rails.handleConfirm = link => {
  if (link.data('confirm') === undefined){
    return true
  }
  showSweetAlertConfirmationDialog(link)
  return false
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„ä¸€ä¸ªåº”ç”¨ä¸­æœ‰è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘æƒ³ä½¿ç”¨æ–°çš„`rails-ujs`ã€‚æˆ‘çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯ï¼Œé€‚åº”åº”è¯¥æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚åªè¦æŠŠ`$.rails.`æ¢æˆ`Rails.`å°±å¯ä»¥äº†:

```
// Override the default confirm dialog of Rails
Rails.handleConfirm = link => {
  if (link.data('confirm') === undefined){
    return true
  }
  showSweetAlertConfirmationDialog(link)
  return false
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

äº‹å®è¯æ˜æœ‰äº›äº‹æƒ…å·²ç»æ”¹å˜äº†ã€‚

`Rails.handleConfirm`å¯ä»¥è¢«è¦†ç›–ï¼Œä½†ä¸ä¼šè¦†ç›–è‡ª`rails-ujs`åˆå§‹åŒ–ä»¥æ¥å·²ç»è¿æ¥çš„äº‹ä»¶ç›‘å¬å™¨ã€‚ä½†æ˜¯æ²¡é—®é¢˜ï¼Œè®©æˆ‘ä»¬å†™æˆ‘ä»¬è‡ªå·±çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶æŠŠå®ƒæ’å…¥åˆ°æ–°çš„`rails-ujs`åšäº‹æ–¹å¼ä¸­ã€‚å¦‚æœä½ çœ‹ä¸€ä¸‹`rails-ujs` å¼€å§‹éƒ¨åˆ†çš„æºä»£ç [ï¼Œä½ ä¼šçœ‹åˆ°äº‹ä»¶ç›‘å¬å™¨æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚ä¸ºæˆ‘ä»¬è‡ªå·±çš„æ–¹æ³•æ·»åŠ äº‹ä»¶ç›‘å¬å™¨çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º:](https://github.com/rails/rails/blob/master/actionview/app/assets/javascripts/rails-ujs/start.coffee) 

```
const handleConfirm = link => {
  // Do your thing
}
Rails.delegate(document, 'a[data-confirm-swal]', 'click', handleConfirm) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å§ï¼Œé…·ã€‚ç°åœ¨å®ƒé€‚ç”¨äºå±æ€§ä¸º`data-confirm-swal="Are you sure?"`çš„é“¾æ¥ğŸ‰â€¦ **ä½†æ˜¯ç­‰å¾…**ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåˆ é™¤é“¾æ¥ï¼Œç¡®è®¤å¯¹è¯æ¡†æ°¸è¿œä¸ä¼šå‡ºç°ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚ğŸ¤”åŸæ¥`method: :delete`çš„äº‹ä»¶ç›‘å¬å™¨è¢«æå‰è°ƒç”¨ï¼Œå› ä¸ºå®ƒåœ¨æˆ‘ä»¬çš„ SweetAlert2 çš„äº‹ä»¶ç›‘å¬å™¨ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚è¿™æ˜¯å› ä¸ºåœ¨è¯„ä¼°ä»£ç æ—¶ï¼Œ`rails-ujs`çš„äº‹ä»¶ç›‘å¬å™¨æ˜¯ç›´æ¥è¿æ¥çš„ã€‚

å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡åœ¨`rails-ujs`ä¹‹å‰è¦æ±‚æˆ‘ä»¬çš„ Javascript ä»£ç æ¥æ·»åŠ æˆ‘ä»¬çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå³`Rails.delegate`è¿˜æ²¡æœ‰å®šä¹‰ã€‚å½“ä½ è¦æ±‚`rails-ujs`è¿™æ˜¯æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…:

*   å®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºå’Œ`Rails.delegate`
*   åœ¨æ–‡æ¡£ä¸Šè§¦å‘`rails:attachBindings`äº‹ä»¶
*   é™„åŠ äº‹ä»¶å¤„ç†ç¨‹åº(`Rails.start`)

æ‰€ä»¥ä¸ºäº†ä»‹äº`Rails.delegate`çš„å®šä¹‰å’Œ`Rails.start`çš„æ‰§è¡Œä¹‹é—´ï¼Œæˆ‘ä»¬å¿…é¡»é™„åŠ åˆ°`rails:attachBindings`äº‹ä»¶ã€‚(ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `rails-ujs`ä¹‹å‰è¦æ±‚æˆ‘ä»¬çš„è„šæœ¬*ï¼)* 

```
document.addEventListener('rails:attachBindings', element => {
  Rails.delegate(document, 'a[data-confirm-swal]', 'click', handleConfirm)
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ‰ç°åœ¨ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸè¿è¡ŒğŸ‰

* * *

å¯¹äºæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆ[ï¼Œçœ‹çœ‹è¿™ä¸ªæ¼”ç¤ºé¡¹ç›®](https://github.com/store2be/rails-sweetalert)(æœ‰ ES5 å’Œ ES6 ç‰ˆæœ¬)æˆ–è€…çœ‹çœ‹ä¸‹é¢çš„ä»£ç (åªæœ‰ ES6)ã€‚

```
// This file has to be required before rails-ujs
// To use it change `data-confirm` of your links to `data-confirm-swal`
(function() {
  const handleConfirm = function(element) {
    if (!allowAction(this)) {
      Rails.stopEverything(element)
    }
  }

  const allowAction = element => {
    if (element.getAttribute('data-confirm-swal') === null) {
      return true
    }

    showConfirmationDialog(element)
    return false
  }

  // Display the confirmation dialog
  const showConfirmationDialog = element => {
    const message = element.getAttribute('data-confirm-swal')
    const text = element.getAttribute('data-text')

    swal({
      title: message || 'Are you sure?',
      text: text || '',
      type: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes',
      cancelButtonText: 'Cancel',
    }).then(result => confirmed(element, result))
  }

  const confirmed = (element, result) => {
    if (result.value) {
      // User clicked confirm button
      element.removeAttribute('data-confirm-swal')
      element.click()
    }
  }

  // Hook the event before the other rails events so it works togeter
  // with `method: :delete`.
  // See https://github.com/rails/rails/blob/master/actionview/app/assets/javascripts/rails-ujs/start.coffee#L69
  document.addEventListener('rails:attachBindings', element => {
    Rails.delegate(document, 'a[data-confirm-swal]', 'click', handleConfirm)
  })

}).call(this) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

ä¸ºäº†æ‰¾å‡ºè¿™ä¸€åˆ‡ï¼Œæˆ‘èŠ±äº†å‡ ä¸ªå°æ—¶ï¼Œå› ä¸ºæˆ‘ä¸ç†Ÿæ‚‰`rails-ujs`çš„ä»£ç åº“ã€‚ä½†æ˜¯ä¸€è·¯ä¸Šæˆ‘å­¦åˆ°äº†å¾ˆå¤šã€‚å¸Œæœ›é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®åŠ©å…¶ä»–ä¸€äº›æƒ³åœ¨ SweetAlert2 ä¸­ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Rails è€Œä¸ä½¿ç”¨ jQuery çš„å¼€å‘äººå‘˜ã€‚

* * *

å¦‚æœä½ ä½¿ç”¨ [Webpacker](https://github.com/rails/webpacker) ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•è¿›å…¥`rails-ujs`ä»£ç å’Œå¯åŠ¨è„šæœ¬:

```
import Rails from 'rails-ujs';

const handleConfirm = () => {
  // Do your thing
}

// Add event listener before the other Rails event listeners like the one
// for `method: :delete`
Rails.delegate(document, 'a[data-confirm-swal]', 'click', handleConfirm)

Rails.start() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*å¤§å®¶å¥½ï¼Œæˆ‘ä»¬æ˜¯ [store2be](https://www.store2be.com) ï¼Œä¸€å®¶æ€»éƒ¨ä½äºæŸæ—çš„åˆåˆ›å…¬å¸ï¼Œè‡´åŠ›äºä¸ºçŸ­æœŸé›¶å”®ç©ºé—´å»ºç«‹ä¸€ä¸ª SaaS å¼çš„å¸‚åœºã€‚å¦‚æœä½ å–œæ¬¢æˆ‘ä»¬å‘å¸ƒçš„å†…å®¹ï¼Œä½ å¯èƒ½æƒ³çœ‹çœ‹[store 2 be æŠ€æœ¯é¡µé¢](https://tech.store2be.com)æˆ–è€…å…³æ³¨æˆ‘ä»¬çš„[åª’ä½“é¢‘é“](https://medium.com/store2be-tech)ã€‚*